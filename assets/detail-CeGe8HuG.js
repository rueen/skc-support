import{_ as re,i as de,j as V,r as Y,x as ie,b as me,k as pe,c as p,e as t,d as m,w as l,f as u,l as x,m as f,y as c,g as fe,o as i,F as U,n as M,p as _,h as r,t as g,q as z,z as ce,A as ve}from"./index-ByCb6rGy.js";import{P as _e}from"./PageHeader-CNm2-22t.js";const ge={class:"task-form content-container"},ke={class:"form-container"},ye={class:"group-select"},be={key:1,class:"group-tip"},Te={class:"user-range"},we={key:0,class:"task-count"},qe={class:"quota-container"},Ye={class:"custom-fields"},Ue={__name:"detail",setup(Me){const h=de(),$=V(()=>h.loaded?h.getEnumOptions("TaskType"):[]),I=ie(),R=fe(),P=Y(),C=V(()=>I.name==="TaskEdit"),a=me({taskName:"",channelId:void 0,category:void 0,taskType:void 0,reward:void 0,brand:"",groupIds:[],groupMode:0,customFields:[{title:"",type:"input"}],startTime:null,endTime:null,quota:void 0,unlimitedQuota:!0,fansRequired:void 0,contentRequirement:"",taskInfo:"",notice:`1.请尽快完成发布，填写发布链接。
2.任务结束后无法填写，不能结算。
3.发布内容不符合要求，将无法审核通过。
4.填写链接无法访问或其他无关链接，视为放弃结算。`,userRange:0,taskCount:0}),G={taskName:[{required:!0,message:"请输入任务名称"}],channelId:[{required:!0,message:"请选择平台渠道"}],category:[{required:!0,message:"请输入达人领域"}],taskType:[{required:!0,message:"请选择任务类型"}],reward:[{required:!0,message:"请输入任务奖励"}],fansRequired:[{required:!0,message:"请输入粉丝要求"}],groupIds:[{validator:(s,e)=>a.groupMode===1&&(!e||e.length===0)?Promise.reject("请选择指定群组"):Promise.resolve()}],taskCount:[{validator:(s,e)=>a.userRange===1&&e==null?Promise.reject("请输入完成任务次数"):Promise.resolve()}]},O=Y([]),S=Y([]),L=()=>{a.customFields.length<10&&a.customFields.push({title:"",type:"input"})},A=s=>{a.customFields.splice(s,1)},J=s=>{s.target.value===0&&(a.groupIds=[])},K=async()=>{try{k.value=!0;const s={...a,groupIds:a.groupMode===0?[]:a.groupIds,startTime:a.startTime?c(a.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:a.endTime?c(a.endTime).format("YYYY-MM-DD HH:mm:ss"):null},e=await ve("task.add",s);e.code===0?(f.success("提交成功"),R.back()):f.error(e.message)}catch(s){console.log(s)}finally{k.value=!1}},W=async()=>{try{k.value=!0;const s={...a,groupIds:a.groupMode===0?[]:a.groupIds,startTime:a.startTime?c(a.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:a.endTime?c(a.endTime).format("YYYY-MM-DD HH:mm:ss"):null},e=await ce("task.edit",{...s},{urlParams:{id:I.params.id}});e.code===0?(f.success("提交成功"),R.back()):f.error(e.message)}catch(s){console.log(s)}finally{k.value=!1}},k=Y(!1),X=()=>{P.value.validate().then(async()=>{C.value?await W():await K()})},Z=()=>{R.back()},ee=async s=>{try{const e=await x("task.detail",{},{urlParams:{id:s}});if(e.code===0){let d={};for(let o in e.data)o!=="groups"&&(d[o]=e.data[o]);d.startTime&&(d.startTime=c(d.startTime)),d.endTime&&(d.endTime=c(d.endTime)),Object.assign(a,d)}}catch(e){console.log(e),f.error(e)}},ae=async()=>{const s=await x("channel.list");s.code===0&&(O.value=s.data.list)},j=async(s="")=>{try{const e=await x("group.list",{page:1,pageSize:50,groupName:s});e.code===0&&(S.value=e.data.list||[])}catch{f.error("获取群组列表失败")}};return pe(()=>{ae(),j(),C.value&&ee(I.params.id)}),(s,e)=>{const d=u("a-input"),o=u("a-form-item"),v=u("a-select-option"),y=u("a-select"),b=u("a-input-number"),E=u("a-date-picker"),D=u("a-col"),te=u("a-row"),T=u("a-radio"),B=u("a-radio-group"),Q=u("a-form-item-rest"),le=u("question-circle-outlined"),ne=u("a-tooltip"),oe=u("a-checkbox"),H=u("a-space"),w=u("a-button"),se=u("plus-outlined"),F=u("a-textarea"),ue=u("a-form");return i(),p("div",ge,[t(_e,{title:C.value?"编辑任务":"新建任务",back:!0,class:"page-header"},null,8,["title"]),m("div",ke,[t(ue,{ref_key:"formRef",ref:P,model:a,rules:G,"label-col":{span:3},"wrapper-col":{span:20},layout:"horizontal"},{default:l(()=>[t(o,{label:"任务名称",name:"taskName"},{default:l(()=>[t(d,{value:a.taskName,"onUpdate:value":e[0]||(e[0]=n=>a.taskName=n),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),t(o,{label:"平台渠道",name:"channelId"},{default:l(()=>[t(y,{value:a.channelId,"onUpdate:value":e[1]||(e[1]=n=>a.channelId=n),placeholder:"请选择平台渠道"},{default:l(()=>[(i(!0),p(U,null,M(O.value,n=>(i(),_(v,{key:n.id,value:n.id},{default:l(()=>[r(g(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(o,{label:"达人领域",name:"category"},{default:l(()=>[t(d,{value:a.category,"onUpdate:value":e[2]||(e[2]=n=>a.category=n),placeholder:"请输入达人领域"},null,8,["value"])]),_:1}),t(o,{label:"任务类型",name:"taskType"},{default:l(()=>[t(y,{value:a.taskType,"onUpdate:value":e[3]||(e[3]=n=>a.taskType=n),placeholder:"请选择任务类型"},{default:l(()=>[(i(!0),p(U,null,M($.value,n=>(i(),_(v,{key:n.value,value:n.value},{default:l(()=>[r(g(n.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(o,{label:"任务奖励",name:"reward"},{default:l(()=>[t(b,{value:a.reward,"onUpdate:value":e[4]||(e[4]=n=>a.reward=n),min:0,precision:2,step:.1,placeholder:"请输入任务奖励"},null,8,["value"])]),_:1}),t(o,{label:"粉丝要求",name:"fansRequired"},{default:l(()=>[t(b,{value:a.fansRequired,"onUpdate:value":e[5]||(e[5]=n=>a.fansRequired=n),min:0,step:1,placeholder:"请输入粉丝要求"},null,8,["value"])]),_:1}),t(o,{label:"任务时间",required:""},{default:l(()=>[t(te,{gutter:8},{default:l(()=>[t(D,{span:11},{default:l(()=>[t(o,{name:"startTime",rules:[{required:!0,message:"请选择开始时间"}]},{default:l(()=>[t(E,{value:a.startTime,"onUpdate:value":e[6]||(e[6]=n=>a.startTime=n),"show-time":"",style:{width:"100%"},placeholder:"开始时间",format:"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1})]),_:1}),t(D,{span:2,class:"text-center"},{default:l(()=>e[18]||(e[18]=[m("span",null,"至",-1)])),_:1}),t(D,{span:11},{default:l(()=>[t(o,{name:"endTime",rules:[{required:!0,message:"请选择结束时间"}]},{default:l(()=>[t(E,{value:a.endTime,"onUpdate:value":e[7]||(e[7]=n=>a.endTime=n),"show-time":"",style:{width:"100%"},placeholder:"结束时间",format:"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(o,{label:"指定群组",name:"groupIds"},{default:l(()=>[m("div",ye,[t(B,{value:a.groupMode,"onUpdate:value":e[8]||(e[8]=n=>a.groupMode=n),onChange:J},{default:l(()=>[t(T,{value:0},{default:l(()=>e[19]||(e[19]=[r("不指定")])),_:1}),t(T,{value:1},{default:l(()=>e[20]||(e[20]=[r("指定群组")])),_:1})]),_:1},8,["value"]),t(Q,null,{default:l(()=>[a.groupMode===1?(i(),_(y,{key:0,value:a.groupIds,"onUpdate:value":e[9]||(e[9]=n=>a.groupIds=n),"show-search":"","filter-option":!1,mode:"multiple",placeholder:"请选择群组",style:{width:"100%","margin-top":"8px"},onSearch:j},{default:l(()=>[(i(!0),p(U,null,M(S.value,n=>(i(),_(v,{key:n.id,value:n.id},{default:l(()=>[r(g(n.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(i(),p("div",be," 所有群组的会员都可以接取该任务 "))]),_:1})])]),_:1}),t(o,{label:"用户范围",name:"userRange"},{default:l(()=>[m("div",Te,[t(B,{value:a.userRange,"onUpdate:value":e[10]||(e[10]=n=>a.userRange=n)},{default:l(()=>[t(T,{value:0},{default:l(()=>e[21]||(e[21]=[r("全部用户")])),_:1}),t(T,{value:1},{default:l(()=>e[22]||(e[22]=[r("完成任务次数")])),_:1})]),_:1},8,["value"]),t(Q,null,{default:l(()=>[a.userRange===1?(i(),p("div",we,[t(o,{name:"taskCount"},{default:l(()=>[t(b,{value:a.taskCount,"onUpdate:value":e[11]||(e[11]=n=>a.taskCount=n),min:0,precision:0,placeholder:"请输入次数","addon-after":"次"},null,8,["value"])]),_:1}),t(ne,null,{title:l(()=>e[23]||(e[23]=[r(" 举例："),m("br",null,null,-1),r(" 0：表示新人即从未完成过任务的会员可显示并参与"),m("br",null,null,-1),r(" 2：表示仅完成过0次/1次/2次的会员可显示并参与"),m("br",null,null,-1),r(" 5：表示完成过0/1/2/3/4/5次任务的会员可显示并参与 ")])),default:l(()=>[t(le)]),_:1})])):z("",!0)]),_:1})])]),_:1}),t(o,{label:"任务名额"},{default:l(()=>[m("div",qe,[t(H,{align:"baseline"},{default:l(()=>[t(o,{name:"quota"},{default:l(()=>[t(b,{value:a.quota,"onUpdate:value":e[12]||(e[12]=n=>a.quota=n),min:0,precision:0,disabled:a.unlimitedQuota,placeholder:"请输入任务名额"},null,8,["value","disabled"])]),_:1}),t(oe,{checked:a.unlimitedQuota,"onUpdate:checked":e[13]||(e[13]=n=>a.unlimitedQuota=n)},{default:l(()=>e[24]||(e[24]=[r(" 不限制 ")])),_:1},8,["checked"])]),_:1})])]),_:1}),t(o,{label:"品牌",name:"brand"},{default:l(()=>[t(d,{value:a.brand,"onUpdate:value":e[14]||(e[14]=n=>a.brand=n),placeholder:"请输入品牌名称"},null,8,["value"])]),_:1}),t(o,{label:"提交信息字段"},{default:l(()=>[m("div",Ye,[(i(!0),p(U,null,M(a.customFields,(n,N)=>(i(),p("div",{key:N,class:"field-item"},[t(H,{align:"baseline"},{default:l(()=>[t(o,{name:["customFields",N,"title"],rules:[{required:!0,message:"请输入字段标题"}]},{default:l(()=>[t(d,{value:n.title,"onUpdate:value":q=>n.title=q,placeholder:"请输入字段标题"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),t(y,{value:n.type,"onUpdate:value":q=>n.type=q,style:{width:"120px"}},{default:l(()=>[t(v,{value:"input"},{default:l(()=>e[25]||(e[25]=[r("输入框")])),_:1}),t(v,{value:"image"},{default:l(()=>e[26]||(e[26]=[r("上传图片")])),_:1})]),_:2},1032,["value","onUpdate:value"]),t(w,{type:"link",danger:"",onClick:q=>A(N)},{default:l(()=>e[27]||(e[27]=[r(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]))),128)),a.customFields.length<10?(i(),_(w,{key:0,type:"dashed",block:"",onClick:L},{default:l(()=>[t(se),e[28]||(e[28]=r("添加字段 "))]),_:1})):z("",!0)])]),_:1}),t(o,{label:"作品要求",name:"contentRequirement"},{default:l(()=>[t(F,{value:a.contentRequirement,"onUpdate:value":e[15]||(e[15]=n=>a.contentRequirement=n),rows:4,placeholder:"请输入作品要求"},null,8,["value"])]),_:1}),t(o,{label:"任务信息",name:"taskInfo"},{default:l(()=>[t(F,{value:a.taskInfo,"onUpdate:value":e[16]||(e[16]=n=>a.taskInfo=n),rows:4,placeholder:"请输入任务信息"},null,8,["value"])]),_:1}),t(o,{label:"温馨提示",name:"notice"},{default:l(()=>[t(F,{value:a.notice,"onUpdate:value":e[17]||(e[17]=n=>a.notice=n),rows:4,placeholder:"请输入温馨提示"},null,8,["value"])]),_:1}),t(o,{"wrapper-col":{span:16,offset:4}},{default:l(()=>[t(H,null,{default:l(()=>[t(w,{type:"primary",onClick:X},{default:l(()=>[r(g(s.$t("common.submit")),1)]),_:1}),t(w,{onClick:Z},{default:l(()=>[r(g(s.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},Ce=re(Ue,[["__scopeId","data-v-aae96630"]]);export{Ce as default};
