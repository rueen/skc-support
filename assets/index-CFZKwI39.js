import{b as ee,r as m,c as A,j as D,k as ae,d as P,e as u,f as r,w as i,g as o,l as se,o as k,i as h,t as _,p as T,s as V,q,F as te,n as re,v as ie,m as n,z as oe,A as ne}from"./index-Zoa6Hfy2.js";const le={class:"content-container"},me={class:"table-container"},de={class:"table-header"},ue={class:"right"},pe=["onClick"],we={__name:"index",setup(ce){const{t:l}=ee(),b=m(!1),d=m(!1),p=m(!1),c=m("add"),C=m(),g=m(null),a=A({username:"",password:"",remarks:"",permissions:[]}),S=[{title:"task",permissions:"task:list"},{title:"taskGroup",permissions:"task:group"},{title:"taskCreate",permissions:"task:create"},{title:"taskEdit",permissions:"task:edit"},{title:"account",permissions:"account:list"},{title:"taskPreAudit",permissions:"task:preAudit"},{title:"taskConfirmAudit",permissions:"task:confirmAudit"},{title:"taskSubmittedDetail",permissions:"task:submittedDetail"},{title:"member",permissions:"member:list"},{title:"memberCreate",permissions:"member:create"},{title:"memberEdit",permissions:"member:edit"},{title:"memberView",permissions:"member:view"},{title:"channel",permissions:"channel:list"},{title:"group",permissions:"group:list"},{title:"withdrawal",permissions:"finance:withdrawal"},{title:"bills",permissions:"finance:bills"},{title:"waiter",permissions:"waiter:list"},{title:"ad",permissions:"ad:list"},{title:"article",permissions:"article:list"},{title:"messages",permissions:"messages:list"},{title:"systemConfig",permissions:"system:config"}],U=D(()=>[{title:l("waiter.username"),dataIndex:"username",key:"username"},{title:l("waiter.remarks"),dataIndex:"remarks",key:"remarks"},{title:l("waiter.action"),key:"action",width:200}]),$=m([]),f=A({current:1,pageSize:10,total:0}),j=D(()=>c.value==="add"?l("waiter.addTitle"):l("waiter.editTitle")),z=e=>{Object.assign(f,e),w()},B=()=>{c.value="add",a.username="",a.password="",a.remarks="",a.permissions=[],d.value=!0},E=e=>{g.value=e.id,c.value="edit",a.username=e.username,a.password="",a.remarks=e.remarks,a.permissions=e.permissions.split(","),d.value=!0},I=async e=>{try{const s=await ie("waiter.delete",{id:e.id},{urlParams:{id:e.id}});s.code===0?(n.success("删除成功"),w()):n.error(s.message)}catch{n.error("删除失败")}},L=async()=>{try{p.value=!0;const e=await ne("waiter.add",{...a,permissions:a.permissions.join(",")});e.code===0?(n.success("添加成功"),d.value=!1,w()):n.error(e.message)}catch{n.error("添加失败")}finally{p.value=!1}},N=async()=>{try{p.value=!0;const e={id:g.value,username:a.username,remarks:a.remarks,permissions:a.permissions.join(",")};a.password&&(e.password=a.password);const s=await oe("waiter.edit",e,{urlParams:{id:g.value}});s.code===0?(n.success("编辑成功"),d.value=!1,w()):n.error(s.message)}catch{n.error("编辑失败")}finally{p.value=!1}},O=async()=>{switch(await C.value.validate(),c.value){case"add":L();break;case"edit":N();break}},w=async()=>{b.value=!0;try{const e=await se("waiter.list",{page:f.current,pageSize:f.pageSize});$.value=e.data.list,f.total=e.data.total}finally{b.value=!1}};return ae(()=>{w()}),(e,s)=>{const R=o("a-button"),x=o("a-typography-text"),F=o("a-popconfirm"),W=o("a-space"),G=o("a-table"),M=o("a-input"),v=o("a-form-item"),H=o("a-input-password"),J=o("a-textarea"),K=o("a-checkbox"),Q=o("a-checkbox-group"),X=o("a-form"),Y=o("a-modal");return k(),P("div",le,[u("div",me,[u("div",de,[s[5]||(s[5]=u("div",{class:"left"},null,-1)),u("div",ue,[r(R,{type:"primary",onClick:B},{default:i(()=>[h(_(e.$t("waiter.add")),1)]),_:1})])]),r(G,{columns:U.value,"data-source":$.value,loading:b.value,pagination:f,onChange:z},{bodyCell:i(({column:t,record:y})=>[t.key==="action"?(k(),T(W,{key:0},{default:i(()=>[u("a",{onClick:Z=>E(y)},_(e.$t("waiter.edit")),9,pe),y.isAdmin?V("",!0):(k(),T(F,{key:0,title:e.$t("waiter.deleteConfirm"),onConfirm:Z=>I(y)},{default:i(()=>[u("a",null,[r(x,{type:"danger"},{default:i(()=>[h(_(e.$t("waiter.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"]))]),_:2},1024)):V("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),r(Y,{open:d.value,"onUpdate:open":s[4]||(s[4]=t=>d.value=t),title:j.value,confirmLoading:p.value,onOk:O},{default:i(()=>[r(X,{ref_key:"formRef",ref:C,model:a,"label-col":{span:6},"wrapper-col":{span:16}},{default:i(()=>[r(v,{label:e.$t("waiter.username"),name:"username",rules:[{required:!0,message:q(l)("waiter.usernameRequired")}]},{default:i(()=>[r(M,{value:a.username,"onUpdate:value":s[0]||(s[0]=t=>a.username=t),placeholder:e.$t("waiter.usernamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(v,{label:e.$t("waiter.password"),name:"password",rules:[{required:c.value==="add",message:q(l)("waiter.passwordRequired")}]},{default:i(()=>[r(H,{value:a.password,"onUpdate:value":s[1]||(s[1]=t=>a.password=t),placeholder:e.$t("waiter.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(v,{label:e.$t("waiter.remarks"),name:"remarks"},{default:i(()=>[r(J,{value:a.remarks,"onUpdate:value":s[2]||(s[2]=t=>a.remarks=t),placeholder:e.$t("waiter.remarksPlaceholder"),rows:3},null,8,["value","placeholder"])]),_:1},8,["label"]),r(v,{label:e.$t("waiter.permissions"),name:"permissions"},{default:i(()=>[r(Q,{value:a.permissions,"onUpdate:value":s[3]||(s[3]=t=>a.permissions=t)},{default:i(()=>[(k(),P(te,null,re(S,t=>r(K,{key:t.title,value:t.permissions},{default:i(()=>[h(_(e.$t("menu."+t.title)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}};export{we as default};
