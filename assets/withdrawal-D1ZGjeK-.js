import{_ as he,b as pe,a as _e,j as F,r as f,c as L,k as ve,d as k,e as b,f as a,s as _,w as t,g as i,l as fe,m,h as ke,o as w,F as $,n as ge,p as R,i as c,t as d,q as Y,M as P,A as V}from"./index-BFCoVMee.js";import{d as be}from"./download-BHr6nN8O.js";const ye={class:"withdrawal content-container"},Ne={class:"table-container"},Se={class:"table-header"},Ce={class:"left"},$e={class:"right"},Re=["onClick"],je=["onClick"],Te={key:0,class:"count-container"},De={__name:"withdrawal",setup(Ie){const{t:s}=pe(),j=ke(),T=_e(),W=F(()=>T.loaded?T.getEnumOptions("WithdrawalStatus"):[]),D=f(!1),y=f(!1),I=f(!1),g=f(""),n=L({billNo:"",memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),z=F(()=>[{title:s("withdrawal.list.billNo"),dataIndex:"billNo",key:"billNo"},{title:s("withdrawal.list.memberNickname"),key:"nickname"},{title:s("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:s("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:s("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:s("withdrawal.list.name"),dataIndex:"withdrawalName",key:"withdrawalName"},{title:s("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:s("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:s("withdrawal.list.operator"),key:"waiterName"},{title:s("withdrawal.list.action"),key:"action",width:150}]),h=f([]),K={selectedRowKeys:h,onChange:e=>{h.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},A=f([]),B=f(0),p=L({current:1,pageSize:10,total:0}),x=()=>{p.current=1,N()},q=()=>{Object.assign(n,{billNo:"",memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),x()},G=e=>{Object.assign(p,e),N()},J=()=>{P.confirm({title:s("common.export"),content:s("common.confirmExportContent"),onOk:async()=>{var v,r;const e=m.loading("正在导出数据，请稍候...",0),o={billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,startTime:(v=n.timeRange)==null?void 0:v[0],endTime:(r=n.timeRange)==null?void 0:r[1]};try{await be("withdrawals.export",o,`提现列表_${new Date().toLocaleDateString()}.xlsx`),m.success(s("common.exportSuccess"))}catch(M){console.error("导出失败:",M),m.error(s("common.exportFailed"))}finally{e()}}})},Q=e=>{j.push(`/member/view/${e.memberId}`)},X=e=>{P.error({content:e.rejectReason})},Z=async e=>{h.value=[e.id],E()},E=async()=>{if(!h.value.length){m.warning("请选择要操作的记录");return}const e=await V("withdrawals.batchResolve",{ids:h.value});e.code===0?(m.success("操作成功"),h.value=[],N()):m.error(e.message)},ee=e=>{h.value=[e.id],g.value="",y.value=!0},ae=()=>{if(!h.value.length){m.warning("请选择要操作的记录");return}g.value="",y.value=!0},te=async()=>{if(!g.value){m.error("请输入打款失败原因");return}I.value=!0;try{await V("withdrawals.batchReject",{rejectReason:g.value,ids:h.value}),m.success("操作成功"),y.value=!1,h.value=[],N()}catch(e){m.error(e.message)}finally{I.value=!1}},N=async()=>{var e,o;D.value=!0;try{const v={page:p.current,pageSize:p.pageSize,billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,startTime:(e=n.timeRange)==null?void 0:e[0],endTime:(o=n.timeRange)==null?void 0:o[1]},r=await fe("withdrawals.list",{...v});r.code===0?(A.value=r.data.list||[],p.total=r.data.total||0,B.value=r.data.totalAmount):m.error(r.message)}finally{D.value=!1}};return ve(()=>{N()}),(e,o)=>{const v=i("a-input"),r=i("a-form-item"),M=i("a-select-option"),le=i("a-select"),ne=i("a-range-picker"),S=i("a-button"),O=i("a-space"),oe=i("a-form"),ie=i("RightOutlined"),H=i("a-typography-link"),se=i("download-outlined"),re=i("info-circle-outlined"),de=i("a-popconfirm"),ce=i("a-table"),U=i("a-descriptions-item"),ue=i("a-descriptions"),me=i("a-textarea"),we=i("a-modal");return w(),k("div",ye,[b("div",Ne,[b("div",Se,[b("div",Ce,[a(oe,{layout:"inline",model:n},{default:t(()=>[a(r,{label:e.$t("withdrawal.list.billNo")},{default:t(()=>[a(v,{value:n.billNo,"onUpdate:value":o[0]||(o[0]=l=>n.billNo=l),placeholder:e.$t("withdrawal.list.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(v,{value:n.memberNickname,"onUpdate:value":o[1]||(o[1]=l=>n.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(le,{value:n.withdrawalStatus,"onUpdate:value":o[2]||(o[2]=l=>n.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(w(!0),k($,null,ge(W.value,l=>(w(),R(M,{key:l.value,value:l.value},{default:t(()=>[c(d(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(ne,{value:n.timeRange,"onUpdate:value":o[3]||(o[3]=l=>n.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(r,null,{default:t(()=>[a(O,null,{default:t(()=>[a(S,{type:"primary",onClick:x},{default:t(()=>[c(d(e.$t("common.search")),1)]),_:1}),a(S,{onClick:q},{default:t(()=>[c(d(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),b("div",$e,[a(O,null,{default:t(()=>[a(H,{onClick:o[4]||(o[4]=l=>Y(j).push("/payment-transactions"))},{default:t(()=>[c(d(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(ie)]),_:1}),a(S,{onClick:J},{icon:t(()=>[a(se)]),default:t(()=>[c(" "+d(e.$t("withdrawal.list.export")),1)]),_:1}),a(S,{type:"primary",onClick:E},{default:t(()=>[c(d(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(S,{danger:"",onClick:ae},{default:t(()=>[c(d(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(ce,{columns:z.value,"data-source":A.value,loading:D.value,pagination:p,rowKey:"id","row-selection":K,onChange:G},{bodyCell:t(({column:l,record:u})=>[l.key==="nickname"?(w(),R(H,{key:0,onClick:C=>Q(u)},{default:t(()=>[c(d(u.nickname),1)]),_:2},1032,["onClick"])):_("",!0),l.key==="withdrawalStatus"?(w(),k($,{key:1},[c(d(Y(T).getEnumText("WithdrawalStatus",u.withdrawalStatus))+" ",1),u.withdrawalStatus==="failed"?(w(),R(re,{key:0,class:"danger",onClick:C=>X(u)},null,8,["onClick"])):_("",!0)],64)):_("",!0),l.key==="waiterName"?(w(),k($,{key:2},[c(d(u.waiterName||"--"),1)],64)):_("",!0),l.key==="action"?(w(),k($,{key:3},[u.withdrawalStatus==="pending"?(w(),R(O,{key:0},{default:t(()=>[a(de,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:C=>Z(u)},{default:t(()=>[b("a",null,d(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),b("a",{class:"danger",onClick:C=>ee(u)},d(e.$t("withdrawal.list.reject")),9,Re)]),_:2},1024)):_("",!0),u.withdrawalStatus==="failed"?(w(),k("a",{key:1,onClick:C=>Y(j).push(`/payment-transactions?withdrawalId=${u.id}`)},"查看交易记录",8,je)):_("",!0)],64)):_("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),p.total?(w(),k("div",Te,[a(ue,{column:2},{default:t(()=>[a(U,{label:e.$t("common.totalCount")},{default:t(()=>[c(d(p.total),1)]),_:1},8,["label"]),a(U,{label:e.$t("common.totalAmount")},{default:t(()=>[c(d(B.value),1)]),_:1},8,["label"])]),_:1})])):_("",!0)]),a(we,{open:y.value,"onUpdate:open":o[6]||(o[6]=l=>y.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:te,confirmLoading:I.value},{default:t(()=>[a(me,{value:g.value,"onUpdate:value":o[5]||(o[5]=l=>g.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Ye=he(De,[["__scopeId","data-v-521f7e0d"]]);export{Ye as default};
