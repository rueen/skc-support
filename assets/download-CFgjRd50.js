import{B as m,m as i,J as h}from"./index-DswJQUfE.js";const x=(s,d={},u="",c={})=>{const a=h.create({baseURL:m.businessApiUrl,timeout:6e4,responseType:"blob"});return a.interceptors.request.use(r=>{const e=localStorage.getItem("token");return e&&(r.headers.Authorization=`Bearer ${e}`),r},r=>(console.error("下载请求错误:",r),Promise.reject(r))),a({url:s,method:"get",params:d,...c}).then(r=>{let e=u;if(!e){const l=r.headers["content-disposition"];if(l){const f=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(l);if(f&&f[1]){e=f[1].replace(/['"]/g,"");try{e=decodeURIComponent(e)}catch(p){console.error("文件名解码失败:",p)}}}if(!e){const n=r.headers["content-type"];n?n.includes("excel")||n.includes("spreadsheetml")?e="export.xlsx":n.includes("csv")?e="export.csv":n.includes("pdf")?e="export.pdf":e="export.file":e="export.file"}}const t=new Blob([r.data]),o=document.createElement("a");return o.href=URL.createObjectURL(t),o.download=e,document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o),{success:!0,filename:e}}).catch(r=>{let e="下载失败";if(r.response)if(r.response.status===401)e="登录已过期，请重新登录",localStorage.removeItem("token"),window.location.href="/login";else try{const t=new FileReader;t.onload=()=>{try{e=JSON.parse(t.result).message||"下载失败",i.error(e)}catch{i.error("下载失败")}},t.readAsText(r.response.data)}catch{i.error("下载失败")}else i.error(e);return Promise.reject(r)})},g=(s,d={},u="",c={})=>{const[a,r]=s.split("."),e=m.api[a]&&m.api[a][r];if(!e)return console.error(`API ${s} 不存在`),i.error(`API ${s} 不存在`),Promise.reject(new Error(`API ${s} 不存在`));let t=e;return c.urlParams&&(t=t.replace(/:([^/]+)/g,(o,l)=>{const n=c.urlParams[l];return n===void 0?(console.warn(`URL 参数 ${l} 未提供`),o):n})),x(t,d,u,c)};export{g as d};
