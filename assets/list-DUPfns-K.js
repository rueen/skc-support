import{_ as Ce,a as $e,b as Se,j as Q,r as v,c as X,k as Ie,d,e as i,f as l,w as n,g as m,x as Re,h as je,l as T,m as g,o as c,F as k,n as O,p as y,i as p,t as s,s as h,q as Ae,A as Z,M as Te,v as Oe}from"./index-BsNCkEur.js";import{_ as x}from"./CopyContent-tSBCa-_Q.js";import{G as Ne}from"./GroupOwner-CGVkAdYp.js";import{d as Fe,e as Ue}from"./routeParamsEncryption-BKFTaOaF.js";const Pe={class:"account content-container"},ze={class:"table-container"},De={class:"table-header"},Me={style:{width:"100%",display:"flex","justify-content":"space-between"}},Ee={class:"right"},Ye={key:0,class:"account-info"},Be={class:"link-text-container"},He={class:"label"},qe=["href"],Ve={class:"stats"},Ge={key:0,class:"stat-item"},Le={key:1,class:"stat-item"},We={key:2,class:"stat-item"},Ke={key:1},Je={key:1},Qe={class:"danger"},Xe=["onClick"],Ze={class:"danger"},xe={__name:"list",setup(et){const N=je(),U=Re(),P=$e(),{t:f}=Se(),ee=Q(()=>P.loaded?P.getEnumOptions("AccountAuditStatus"):[]),z=v(!1),_=v([]),S=v(!1),D=v(!1),w=v(""),Y=v(null),te=()=>{const e=U.query.filters;if(e){Y.value=Fe(e),Object.assign(o,{accountAuditStatus:null},Y.value);const t={...U.query};delete t.filters,N.replace({path:U.path,query:t})}},o=X({keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),B=v([]),H=v([]),q=v([]),M=v([]),ae=Q(()=>[{title:f("account.list.accountInfo"),key:"accountInfo",width:500},{title:f("account.list.memberInfo"),key:"member"},{title:f("account.list.submitTime"),dataIndex:"submitTime",key:"submitTime"},{title:f("account.list.auditStatus"),dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:f("account.list.rejectReason"),key:"rejectReason"},{title:f("account.list.waiterName"),key:"waiterName"},{title:f("account.list.action"),key:"action"}]),ne={selectedRowKeys:_,onChange:e=>{_.value=e},getCheckboxProps:e=>({disabled:e.accountAuditStatus!=="pending"})},V=v([]),C=X({current:1,pageSize:10,total:0}),G=()=>{C.current=1,$()},le=()=>{Object.assign(o,{keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),G()},oe=e=>{N.push(`/member/view/${e.memberId}`)},se=e=>{var b,r;const t=Ue({...o,submitStartTime:(b=o.submitTimeRange)==null?void 0:b[0],submitEndTime:(r=o.submitTimeRange)==null?void 0:r[1],submitTimeRange:void 0});N.push({name:"AccountEdit",params:{id:e.id},query:{filters:t}})},ue=()=>{N.push("/account/old")},ce=e=>{Object.assign(C,{current:e.current,pageSize:e.pageSize}),$()},ie=async e=>{_.value=[e.id],L()},L=async()=>{if(!_.value.length){g.warning(f("account.list.message.selectAccount"));return}const e=await Z("account.batchResolve",{ids:_.value});if(e.code===0){const t=e.data.failed.map(b=>b.reason).join(",");t?Te.error({title:f("account.list.batchRejectFailedTitle"),content:`成功 ${e.data.successCount} 条，失败 ${e.data.failedCount} 条，失败原因：${t}`}):(g.success(f("account.list.message.success")),_.value=[],$())}else g.error(e.message)},re=async()=>{if(!_.value.length){g.warning(f("account.list.message.selectAccount"));return}w.value="",S.value=!0},de=e=>{_.value=[e.id],w.value="",S.value=!0},me=async()=>{if(!w.value){g.error(f("account.list.message.rejectReason"));return}D.value=!0;try{const e=await Z("account.batchReject",{ids:_.value,rejectReason:w.value});e.code===0?(g.success(f("account.list.message.success")),_.value=[],S.value=!1,$()):g.error(e.message)}catch(e){console.log(e)}finally{D.value=!1}},$=async()=>{var e,t;z.value=!0;try{const b={page:C.current,pageSize:C.pageSize,keyword:o.keyword,channelId:o.channelId,accountAuditStatus:o.accountAuditStatus,waiterId:o.waiterId,groupId:o.groupId,memberId:o.memberId,submitStartTime:(e=o.submitTimeRange)==null?void 0:e[0],submitEndTime:(t=o.submitTimeRange)==null?void 0:t[1]},r=await T("account.list",{...b});r.code===0?(V.value=r.data.list,C.total=r.data.total):g.error(r.message)}finally{z.value=!1}},pe=async()=>{const e=await T("channel.list");e.code===0&&(B.value=e.data.list)},W=async(e="")=>{try{const t=await T("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(H.value=t.data.list||[])}catch{g.error("获取群组列表失败")}},K=async(e="")=>{const t=await T("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(q.value=t.data.list||[])},fe=async e=>{const t=await Oe("account.delete",{},{urlParams:{id:e.id}});t.code===0?(g.success(t.message),$()):g.error(t.message)},he=async()=>{if(M.value.length)return;const e=await T("waiter.list",{page:1,pageSize:100});if(e.code===0){const t={id:0,username:"无"};M.value=[t,...e.data.list]}};return Ie(()=>{te(),$(),W(),pe(),K(),he()}),(e,t)=>{const b=m("a-input"),r=m("a-form-item"),I=m("a-select-option"),R=m("a-select"),ve=m("a-range-picker"),j=m("a-button"),A=m("a-space"),ge=m("a-form"),_e=m("a-avatar"),J=m("a-typography-link"),ye=m("a-typography-text"),E=m("a-popconfirm"),be=m("a-table"),ke=m("a-textarea"),we=m("a-modal");return c(),d("div",Pe,[i("div",ze,[i("div",De,[l(ge,{layout:"inline",model:o},{default:n(()=>[l(r,{label:e.$t("account.search.account")},{default:n(()=>[l(b,{value:o.keyword,"onUpdate:value":t[0]||(t[0]=a=>o.keyword=a),placeholder:e.$t("account.search.accountPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("account.search.channel")},{default:n(()=>[l(R,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=a=>o.channelId=a),placeholder:e.$t("account.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(c(!0),d(k,null,O(B.value,a=>(c(),y(I,{key:a.id,value:a.id},{default:n(()=>[p(s(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("account.search.submitTime")},{default:n(()=>[l(ve,{value:o.submitTimeRange,"onUpdate:value":t[2]||(t[2]=a=>o.submitTimeRange=a),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),l(r,{label:e.$t("account.search.auditStatus")},{default:n(()=>[l(R,{value:o.accountAuditStatus,"onUpdate:value":t[3]||(t[3]=a=>o.accountAuditStatus=a),placeholder:e.$t("account.search.auditStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(c(!0),d(k,null,O(ee.value,a=>(c(),y(I,{key:a.value,value:a.value},{default:n(()=>[p(s(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("account.search.auditor")},{default:n(()=>[l(R,{value:o.waiterId,"onUpdate:value":t[4]||(t[4]=a=>o.waiterId=a),placeholder:e.$t("account.search.auditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:n(()=>[(c(!0),d(k,null,O(M.value,a=>(c(),y(I,{key:a.id,value:a.id},{default:n(()=>[p(s(a.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("account.search.group")},{default:n(()=>[l(R,{value:o.groupId,"onUpdate:value":t[5]||(t[5]=a=>o.groupId=a),placeholder:e.$t("account.search.groupPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:W},{default:n(()=>[(c(!0),d(k,null,O(H.value,a=>(c(),y(I,{key:a.id,value:a.id},{default:n(()=>[p(s(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("account.search.member")},{default:n(()=>[l(R,{value:o.memberId,"onUpdate:value":t[6]||(t[6]=a=>o.memberId=a),placeholder:e.$t("account.search.memberPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:K},{default:n(()=>[(c(!0),d(k,null,O(q.value,a=>(c(),y(I,{key:a.id,value:a.id},{default:n(()=>[p(s(a.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,null,{default:n(()=>[l(A,null,{default:n(()=>[l(j,{type:"primary",onClick:G},{default:n(()=>[p(s(e.$t("common.search")),1)]),_:1}),l(j,{onClick:le},{default:n(()=>[p(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),i("div",Me,[l(j,{onClick:ue},{default:n(()=>[p(s(e.$t("account.list.oldAccount")),1)]),_:1}),i("div",Ee,[l(A,null,{default:n(()=>[l(j,{type:"primary",onClick:L},{default:n(()=>[p(s(e.$t("common.batchResolve")),1)]),_:1}),l(j,{danger:"",onClick:re},{default:n(()=>[p(s(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),l(be,{columns:ae.value,"data-source":V.value,loading:z.value,pagination:C,"row-selection":ne,rowKey:"id",onChange:ce},{bodyCell:n(({column:a,record:u})=>[a.key==="accountInfo"?(c(),d("div",Ye,[l(A,null,{default:n(()=>[l(_e,{src:u.channelIcon,size:"small"},null,8,["src"]),i("span",null,s(u.account),1)]),_:2},1024),i("div",null,[i("div",Be,[i("span",He,s(e.$t("account.list.homepage"))+"：",1),l(x,{content:u.homeUrl},{default:n(()=>[l(J,null,{default:n(()=>[i("a",{href:u.homeUrl,target:"_blank"},s(u.homeUrl),9,qe)]),_:2},1024)]),_:2},1032,["content"])])]),i("div",null,[t[9]||(t[9]=i("span",{class:"label"},"uid：",-1)),l(x,{content:u.uid},null,8,["content"])]),i("div",Ve,[u.channelCustomFields.includes("fansCount")?(c(),d("div",Ge,s(e.$t("account.list.fansCount"))+"："+s(u.fansCount),1)):h("",!0),u.channelCustomFields.includes("friendsCount")?(c(),d("div",Le,s(e.$t("account.list.friendsCount"))+"："+s(u.friendsCount),1)):h("",!0),u.channelCustomFields.includes("postsCount")?(c(),d("div",We,s(e.$t("account.list.postsCount"))+"："+s(u.postsCount),1)):h("",!0)])])):h("",!0),a.key==="member"?(c(),d("div",Ke,[i("div",null,[l(J,{onClick:F=>oe(u)},{default:n(()=>[p(s(u.memberNickname),1)]),_:2},1032,["onClick"])]),l(A,{class:"group-name"},{default:n(()=>[i("span",null,s(u.groupName),1),u.isGroupOwner?(c(),y(Ne,{key:0})):h("",!0)]),_:2},1024)])):h("",!0),a.key==="accountAuditStatus"?(c(),d(k,{key:2},[p(s(Ae(P).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)],64)):h("",!0),a.key==="rejectReason"?(c(),d(k,{key:3},[u.rejectReason?(c(),y(ye,{key:0,type:"danger"},{default:n(()=>[p(s(u.rejectReason),1)]),_:2},1024)):(c(),d("span",Je,"--"))],64)):h("",!0),a.key==="waiterName"?(c(),d(k,{key:4},[p(s(u.waiterName||"--"),1)],64)):h("",!0),a.key==="action"?(c(),y(A,{key:5},{default:n(()=>[u.accountAuditStatus==="pending"?(c(),y(E,{key:0,title:e.$t("account.list.resolveConfirm"),onConfirm:F=>ie(u)},{default:n(()=>[i("a",null,s(e.$t("account.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),u.accountAuditStatus==="pending"?(c(),y(E,{key:1,title:e.$t("account.list.rejectConfirm"),onConfirm:F=>de(u)},{default:n(()=>[i("a",Qe,s(e.$t("account.list.reject")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),i("a",{onClick:F=>se(u)},s(e.$t("common.edit")),9,Xe),l(E,{title:e.$t("common.deleteConfirm"),onConfirm:F=>fe(u)},{default:n(()=>[i("a",Ze,s(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),l(we,{open:S.value,"onUpdate:open":t[8]||(t[8]=a=>S.value=a),title:e.$t("account.list.rejectReason"),onOk:me,confirmLoading:D.value},{default:n(()=>[l(ke,{value:w.value,"onUpdate:value":t[7]||(t[7]=a=>w.value=a),placeholder:e.$t("account.list.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},ot=Ce(xe,[["__scopeId","data-v-3f94b0ce"]]);export{ot as default};
