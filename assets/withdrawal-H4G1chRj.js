import{_ as ae,i as te,j as ne,r as p,a as Y,k as oe,b as y,d as _,c as t,w as n,e as s,l as le,m as i,o as w,F as D,n as se,p as B,h as d,t as b,g as I,D as ie,q as N,M as re,z as O}from"./index-DfdbcBxU.js";import{d as ce}from"./download-CHU6dqCT.js";const de={class:"withdrawal content-container"},ue={class:"table-container"},me={class:"table-header"},pe={class:"left"},_e={class:"right"},we=["onClick"],ve={__name:"withdrawal",setup(fe){const S=te(),H=ne(()=>S.loaded?S.getEnumOptions("WithdrawalStatus"):[]),x=p(!1),v=p(!1),C=p(!1),u=p(""),l=Y({memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),E=[{title:"会员昵称",dataIndex:"nickname",key:"nickname"},{title:"提现账户",dataIndex:"account",key:"account"},{title:"账户类型",dataIndex:"accountType",key:"accountType"},{title:"申请提现金额",dataIndex:"amount",key:"amount",align:"right"},{title:"姓名",dataIndex:"name",key:"name"},{title:"申请时间",dataIndex:"createTime",key:"createTime"},{title:"提现状态",key:"withdrawalStatus"},{title:"操作",key:"action",width:150}],r=p([]),L={selectedRowKeys:r,onChange:e=>{r.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},j=p([]),m=Y({current:1,pageSize:10,total:0}),T=()=>{m.current=1,f()},U=()=>{Object.assign(l,{memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),T()},V=e=>{Object.assign(m,e),f()},$=()=>{re.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const e=i.loading("正在导出数据，请稍候...",0),a={...l};try{await ce("withdrawals.export",a,`提现列表_${new Date().toLocaleDateString()}.xlsx`),i.success("导出成功")}catch(g){console.error("导出失败:",g),i.error("导出失败，请稍后重试")}finally{e()}}})},z=async e=>{r.value=[e.id],M()},M=async()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}const e=await O("withdrawals.batchResolve",{ids:r.value});e.code===0?(i.success("操作成功"),r.value=[],f()):i.error(e.message)},F=e=>{r.value=[e.id],u.value="",v.value=!0},K=()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}u.value="",v.value=!0},W=async()=>{if(!u.value){i.error("请输入打款失败原因");return}C.value=!0;const e=await O("withdrawals.batchReject",{rejectReason:u.value,ids:r.value});C.value=!1,e.code===0?(i.success("操作成功"),v.value=!1,r.value=[],f()):i.error(e.message)},f=async()=>{var e,a;x.value=!0;try{const g={page:m.current,pageSize:m.pageSize,memberNickname:l.memberNickname,withdrawalStatus:l.withdrawalStatus,startTime:(e=l.timeRange)==null?void 0:e[0],endTime:(a=l.timeRange)==null?void 0:a[1]},c=await le("withdrawals.list",{...g});c.code===0?(j.value=c.data.list||[],m.total=c.data.total||0):i.error(c.message)}finally{x.value=!1}};return oe(()=>{f()}),(e,a)=>{const g=s("a-input"),c=s("a-form-item"),q=s("a-select-option"),A=s("a-select"),P=s("a-range-picker"),h=s("a-button"),R=s("a-space"),G=s("a-form"),J=s("a-popconfirm"),Q=s("a-table"),X=s("a-textarea"),Z=s("a-modal");return w(),y("div",de,[_("div",ue,[_("div",me,[_("div",pe,[t(G,{layout:"inline",model:l},{default:n(()=>[t(c,{label:"会员昵称"},{default:n(()=>[t(g,{value:l.memberNickname,"onUpdate:value":a[0]||(a[0]=o=>l.memberNickname=o),placeholder:"请输入会员昵称","allow-clear":""},null,8,["value"])]),_:1}),t(c,{label:"提现状态"},{default:n(()=>[t(A,{value:l.withdrawalStatus,"onUpdate:value":a[1]||(a[1]=o=>l.withdrawalStatus=o),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:n(()=>[(w(!0),y(D,null,se(H.value,o=>(w(),B(q,{key:o.value,value:o.value},{default:n(()=>[d(b(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(c,{label:"申请时间"},{default:n(()=>[t(P,{value:l.timeRange,"onUpdate:value":a[2]||(a[2]=o=>l.timeRange=o),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1}),t(c,null,{default:n(()=>[t(R,null,{default:n(()=>[t(h,{type:"primary",onClick:T},{default:n(()=>[d(b(e.$t("common.search")),1)]),_:1}),t(h,{onClick:U},{default:n(()=>[d(b(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",_e,[t(R,null,{default:n(()=>[t(h,{onClick:$},{icon:n(()=>[t(I(ie))]),default:n(()=>[a[5]||(a[5]=d(" 导出 "))]),_:1}),t(h,{type:"primary",onClick:M},{default:n(()=>a[6]||(a[6]=[d("批量已打款")])),_:1}),t(h,{danger:"",onClick:K},{default:n(()=>a[7]||(a[7]=[d("批量打款失败")])),_:1})]),_:1})])]),t(Q,{columns:E,"data-source":j.value,loading:x.value,pagination:m,rowKey:"id","row-selection":L,onChange:V},{bodyCell:n(({column:o,record:k})=>[o.key==="withdrawalStatus"?(w(),y(D,{key:0},[d(b(I(S).getEnumText("WithdrawalStatus",k.withdrawalStatus)),1)],64)):N("",!0),o.key==="action"?(w(),y(D,{key:1},[k.withdrawalStatus==="pending"?(w(),B(R,{key:0},{default:n(()=>[t(J,{title:"确定要标记为已打款吗？",onConfirm:ee=>z(k)},{default:n(()=>a[8]||(a[8]=[_("a",null,"已打款",-1)])),_:2},1032,["onConfirm"]),_("a",{class:"danger",onClick:ee=>F(k)},"打款失败",8,we)]),_:2},1024)):N("",!0)],64)):N("",!0)]),_:1},8,["data-source","loading","pagination"])]),t(Z,{open:v.value,"onUpdate:open":a[4]||(a[4]=o=>v.value=o),title:"打款失败原因",onOk:W,confirmLoading:C.value},{default:n(()=>[t(X,{value:u.value,"onUpdate:value":a[3]||(a[3]=o=>u.value=o),placeholder:"请输入打款失败原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},ke=ae(ve,[["__scopeId","data-v-deb1938c"]]);export{ke as default};
