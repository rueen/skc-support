import{_ as _e,i as be,a as ge,j as he,r as k,b as W,k as ye,c as b,d as c,e as n,w as a,f as u,l as U,m,g as we,o as i,F as w,n as M,p as _,h as d,t as o,s as f,q as Te,M as Se,A as G}from"./index-GthWQd0a.js";import{d as Ce}from"./download-BrFhmkUb.js";const Ae={class:"task-audit content-container"},Ne={class:"table-container"},Ie={class:"table-header"},$e={style:{width:"100%",display:"flex","justify-content":"space-between"}},Re={key:4},Oe={class:"group-name"},je=["onClick"],De={__name:"confirm-audit-list",setup(xe){const $=be(),{t:g}=ge(),K=he(()=>$.loaded?$.getEnumOptions("TaskAuditStatus"):[]),q=we(),R=k(!1),Y=k(!1),T=k(!1),B=k(!1),h=k(""),S=k(null),v=k([]),l=W({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),E=k([]),L=k([]),J=[{title:g("submittedTasks.list.taskName"),key:"taskName"},{title:g("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:g("submittedTasks.list.memberInfo"),key:"member"},{title:g("submittedTasks.list.status"),dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:g("submittedTasks.list.preAuditor"),key:"preWaiterName"},{title:g("submittedTasks.list.confirmAuditor"),key:"waiterName"},{title:g("submittedTasks.list.action"),key:"action",fixed:"right",width:180}],O=k([]),y=W({current:1,pageSize:10,total:0}),Q={selectedRowKeys:v,onChange:t=>{v.value=t},getCheckboxProps:t=>({disabled:t.taskAuditStatus!=="pending"})},V=()=>{y.current=1,C()},X=()=>{Object.assign(l,{taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),V()},Z=t=>{Object.assign(y,t),C()},ee=t=>{q.push(`/submitted-tasks/detail/${t.id}?type=confirm`)},te=async t=>{v.value=[t.id],H()},H=async()=>{if(!v.value.length){m.warning("请选择要通过的任务");return}const t=await G("taskSubmitted.batchConfirmAuditApprove",{ids:v.value});t.code===0?(m.success("批量审核通过成功"),v.value=[],C()):m.error(t.message)},ae=t=>{v.value=[t.id],h.value="",T.value=!0},se=async()=>{if(!h.value){m.error("请输入拒绝原因");return}B.value=!0;const t=await G("taskSubmitted.batchConfirmAuditReject",{ids:v.value,reason:h.value});t.code===0?(m.success("审核拒绝成功"),T.value=!1,C()):m.error(t.message)},ne=()=>{if(!v.value.length){m.warning("请选择要拒绝的任务");return}h.value="",T.value=!0},le=async()=>{const t=await U("channel.list");t.code===0&&(E.value=t.data.list)},oe=()=>{Se.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const t=m.loading("正在导出数据，请稍候...",0),s={...l};await Ce("taskSubmitted.confirmAuditExport",s,`复审列表_${new Date().toLocaleDateString()}.xlsx`),t(),m.success("导出成功")}catch(t){console.error("导出失败:",t),m.error("导出失败，请稍后重试")}}})},ue=async(t="")=>{try{const s=await U("group.list",{params:{page:1,pageSize:50,keyword:t}});s.code===0&&(L.value=s.data.list||[])}catch{m.error("获取群组列表失败")}},C=async()=>{var t,s;R.value=!0;try{const j={page:y.current,pageSize:y.pageSize,taskName:l.taskName,channelId:l.channelId,taskAuditStatus:l.taskAuditStatus,groupId:l.groupId,submitStartTime:(t=l.submitTimeRange)==null?void 0:t[0],submitEndTime:(s=l.submitTimeRange)==null?void 0:s[1],completedTaskCount:l.completedTaskCount},p=await U("taskSubmitted.confirmAuditList",{...j});p.code===0?(O.value=p.data.list,y.total=p.data.total):m.error(p.message)}finally{R.value=!1}};return ye(()=>{C(),ue(),le()}),(t,s)=>{const j=u("a-input"),p=u("a-form-item"),D=u("a-select-option"),x=u("a-select"),ie=u("a-range-picker"),de=u("a-input-number"),re=u("a-form"),A=u("a-button"),I=u("a-space"),ce=u("DownloadOutlined"),me=u("a-avatar"),pe=u("a-tag"),z=u("a-popconfirm"),ke=u("a-table"),N=u("a-descriptions-item"),fe=u("a-descriptions"),P=u("a-modal"),ve=u("a-textarea");return i(),b("div",Ae,[c("div",Ne,[c("div",Ie,[n(re,{layout:"inline",model:l},{default:a(()=>[n(p,{label:t.$t("submittedTasks.search.taskName")},{default:a(()=>[n(j,{value:l.taskName,"onUpdate:value":s[0]||(s[0]=e=>l.taskName=e),placeholder:t.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),n(p,{label:t.$t("submittedTasks.search.channelId")},{default:a(()=>[n(x,{value:l.channelId,"onUpdate:value":s[1]||(s[1]=e=>l.channelId=e),placeholder:t.$t("submittedTasks.search.channelIdPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),b(w,null,M(E.value,e=>(i(),_(D,{key:e.id,value:e.id},{default:a(()=>[d(o(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(p,{label:t.$t("submittedTasks.search.taskAuditStatus")},{default:a(()=>[n(x,{value:l.taskAuditStatus,"onUpdate:value":s[2]||(s[2]=e=>l.taskAuditStatus=e),placeholder:t.$t("submittedTasks.search.taskAuditStatusPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),b(w,null,M(K.value,e=>(i(),_(D,{key:e.value,value:e.value},{default:a(()=>[d(o(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(p,{label:t.$t("submittedTasks.search.groupId")},{default:a(()=>[n(x,{value:l.groupId,"onUpdate:value":s[3]||(s[3]=e=>l.groupId=e),placeholder:t.$t("submittedTasks.search.groupIdPlaceholder"),"allow-clear":""},{default:a(()=>[(i(!0),b(w,null,M(L.value,e=>(i(),_(D,{key:e.id,value:e.id},{default:a(()=>[d(o(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(p,{label:t.$t("submittedTasks.search.submitTime")},{default:a(()=>[n(ie,{value:l.submitTimeRange,"onUpdate:value":s[4]||(s[4]=e=>l.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),n(p,{label:t.$t("submittedTasks.search.completedTaskCount")},{default:a(()=>[n(de,{value:l.completedTaskCount,"onUpdate:value":s[5]||(s[5]=e=>l.completedTaskCount=e),min:0,max:9999,"addon-after":t.$t("submittedTasks.search.times"),style:{width:"100px!important"}},null,8,["value","addon-after"])]),_:1},8,["label"])]),_:1},8,["model"]),c("div",$e,[c("div",null,[n(I,null,{default:a(()=>[n(A,{type:"primary",onClick:V},{default:a(()=>[d(o(t.$t("common.search")),1)]),_:1}),n(A,{onClick:X},{default:a(()=>[d(o(t.$t("common.reset")),1)]),_:1})]),_:1})]),c("div",null,[n(I,null,{default:a(()=>[O.value.length?(i(),_(A,{key:0,onClick:oe},{icon:a(()=>[n(ce)]),default:a(()=>[d(" "+o(t.$t("common.export")),1)]),_:1})):f("",!0),n(A,{type:"primary",onClick:H},{default:a(()=>[d(o(t.$t("common.batchResolve")),1)]),_:1}),n(A,{danger:"",onClick:ne},{default:a(()=>[d(o(t.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),n(ke,{columns:J,"data-source":O.value,loading:R.value,pagination:y,"row-selection":Q,rowKey:"id",onChange:Z},{bodyCell:a(({column:e,record:r})=>[e.key==="taskName"?(i(),_(I,{key:0},{default:a(()=>[n(me,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,o(r.taskName),1)]),_:2},1024)):f("",!0),e.key==="taskAuditStatus"?(i(),b(w,{key:1},[d(o(Te($).getEnumText("TaskAuditStatus",r.taskAuditStatus)),1)],64)):f("",!0),e.key==="preWaiterName"?(i(),b(w,{key:2},[d(o(r.preWaiterName||"--"),1)],64)):f("",!0),e.key==="waiterName"?(i(),b(w,{key:3},[d(o(r.waiterName||"--"),1)],64)):f("",!0),e.key==="member"?(i(),b("div",Re,[c("div",null,o(r.memberNickname),1),c("div",Oe,[c("span",null,o(r.groupName),1),r.isGroupOwner?(i(),_(pe,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>s[9]||(s[9]=[d("群主")])),_:1})):f("",!0)])])):f("",!0),e.key==="action"?(i(),_(I,{key:5},{default:a(()=>[c("a",{onClick:F=>ee(r)},"查看",8,je),r.taskAuditStatus==="pending"?(i(),_(z,{key:0,title:"确定要通过该任务吗？",onConfirm:F=>te(r)},{default:a(()=>s[10]||(s[10]=[c("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):f("",!0),r.taskAuditStatus==="pending"?(i(),_(z,{key:1,title:"确定要拒绝该任务吗？",onConfirm:F=>ae(r)},{default:a(()=>s[11]||(s[11]=[c("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):f("",!0)]),_:2},1024)):f("",!0)]),_:1},8,["data-source","loading","pagination"])]),n(P,{open:Y.value,"onUpdate:open":s[6]||(s[6]=e=>Y.value=e),title:"任务详情",footer:null},{default:a(()=>[n(fe,{column:1},{default:a(()=>[n(N,{label:"任务名称"},{default:a(()=>{var e;return[d(o((e=S.value)==null?void 0:e.taskName),1)]}),_:1}),n(N,{label:"任务类型"},{default:a(()=>{var e;return[d(o((e=S.value)==null?void 0:e.taskType),1)]}),_:1}),n(N,{label:"任务描述"},{default:a(()=>{var e;return[d(o((e=S.value)==null?void 0:e.description),1)]}),_:1}),n(N,{label:"任务奖励"},{default:a(()=>{var e;return[d(o((e=S.value)==null?void 0:e.reward),1)]}),_:1}),n(N,{label:"创建时间"},{default:a(()=>{var e;return[d(o((e=S.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),n(P,{open:T.value,"onUpdate:open":s[8]||(s[8]=e=>T.value=e),title:"拒绝原因",onOk:se,confirmLoading:B.value},{default:a(()=>[n(ve,{value:h.value,"onUpdate:value":s[7]||(s[7]=e=>h.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ye=_e(De,[["__scopeId","data-v-aefbf2de"]]);export{Ye as default};
