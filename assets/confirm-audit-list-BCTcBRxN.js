import{_ as Ne,a as Re,b as Oe,j as ae,r as f,c as se,k as je,d as p,e as y,f as l,s as k,w as s,g as c,y as le,x as Ge,h as De,l as D,m as g,o as u,F as _,n as $,p as v,i,t as o,q as Me,M as Ye,A as ne}from"./index-DLG1SMna.js";import{d as Ee}from"./download-BOk9q9lR.js";import{d as Ue,e as We}from"./routeParamsEncryption-BKFTaOaF.js";import{G as He}from"./GroupOwner-C2bRznVX.js";const Fe={class:"task-audit content-container"},Pe={class:"table-container"},ze={class:"table-header"},Be={style:{width:"100%",display:"flex","justify-content":"space-between"}},Le=["onClick"],Ve={class:"danger"},xe={key:0,class:"count-container"},qe={__name:"confirm-audit-list",setup(Ke){const M=Re(),{t:m}=Oe(),oe=ae(()=>M.loaded?M.getEnumOptions("TaskAuditStatus"):[]),Y=De(),E=Ge(),U=f(!1),P=f(!1),N=f(!1),W=f(!1),S=f(""),R=f(null),b=f([]),H=f([]),z=()=>{const e=le().startOf("month").format("YYYY-MM-DD HH:mm:ss"),a=le().endOf("month").format("YYYY-MM-DD HH:mm:ss");return[e,a]},n=se({taskName:"",channelId:void 0,taskAuditStatus:"pending",preWaiterId:void 0,groupId:void 0,submitTimeRange:z(),completedTaskCount:void 0,keyword:"",taskGroupId:void 0}),B=f([]),L=f([]),ue=ae(()=>[{title:m("submittedTasks.list.taskName"),key:"taskName"},{title:m("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:m("submittedTasks.list.memberInfo"),key:"member"},{title:m("submittedTasks.list.status"),dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:m("submittedTasks.rejectTimes"),dataIndex:"rejectTimes",key:"rejectTimes"},{title:m("submittedTasks.preAuditor"),key:"preWaiterName"},{title:m("submittedTasks.preAuditTime"),key:"preAuditTime"},{title:m("submittedTasks.confirmAuditor"),key:"waiterName"},{title:m("submittedTasks.confirmAuditTime"),key:"confirmAuditTime"},{title:m("submittedTasks.list.action"),key:"action",fixed:"right",width:180}]),O=f([]),V=f(0),T=se({current:1,pageSize:10,total:0}),ie={selectedRowKeys:b,onChange:e=>{b.value=e},getCheckboxProps:e=>({disabled:e.taskAuditStatus!=="pending"})},re=()=>{const e=E.query.filters;if(e){const a={},h=Ue(e);Object.keys(h).forEach(w=>{w==="current"?T.current=h[w]:a[w]=h[w]}),Object.assign(n,{taskAuditStatus:null},a);const r={...E.query};delete r.filters,Y.replace({path:E.path,query:r})}},x=()=>{T.current=1,F()},de=()=>{Object.assign(n,{taskName:"",channelId:void 0,taskAuditStatus:"pending",preWaiterId:void 0,groupId:void 0,submitTimeRange:z(),completedTaskCount:void 0,keyword:"",taskGroupId:void 0}),x()},ce=e=>{Object.assign(T,e),F()},me=e=>{Y.push(`/member/view/${e.memberId}`)},pe=e=>{const a=We({...n,current:T.current});Y.push({path:`/submitted-tasks/detail/${e.id}`,query:{type:"confirm",filters:a}})},ke=async e=>{b.value=[e.id],q()},q=async()=>{if(!b.value.length){g.warning(m("submittedTasks.list.selectTask"));return}const e=await ne("taskSubmitted.batchConfirmAuditApprove",{ids:b.value});e.code===0?(g.success(m("submittedTasks.resolveSuccess")),O.value.forEach(a=>{b.value.includes(a.id)&&(a.taskAuditStatus="approved")}),b.value=[]):g.error(e.message)},fe=e=>{b.value=[e.id],S.value="",N.value=!0},ve=async()=>{if(!S.value){g.error("请输入拒绝原因");return}W.value=!0;try{await ne("taskSubmitted.batchConfirmAuditReject",{ids:b.value,reason:S.value}),g.success("审核拒绝成功"),N.value=!1,O.value.forEach(e=>{b.value.includes(e.id)&&(e.taskAuditStatus="rejected")}),b.value=[]}catch(e){g.error(e.message)}finally{W.value=!1}},be=()=>{if(!b.value.length){g.warning("请选择要拒绝的任务");return}S.value="",N.value=!0},he=async()=>{const e=await D("channel.list");e.code===0&&(B.value=e.data.list)},ye=()=>{Ye.confirm({title:m("common.export"),content:m("common.confirmExportContent"),onOk:async()=>{var e,a;try{const h=g.loading(m("common.exporting"),0),r={taskName:n.taskName,channelId:n.channelId,taskAuditStatus:n.taskAuditStatus,preWaiterId:n.preWaiterId,groupId:n.groupId,submitStartTime:(e=n.submitTimeRange)==null?void 0:e[0],submitEndTime:(a=n.submitTimeRange)==null?void 0:a[1],completedTaskCount:n.completedTaskCount,keyword:n.keyword,taskGroupId:n.taskGroupId};await Ee("taskSubmitted.confirmAuditExport",r,`复审列表_${new Date().toLocaleDateString()}.xlsx`),h(),g.success(m("common.exportSuccess"))}catch(h){console.error("导出失败:",h),g.error(m("common.exportFailed"))}}})},K=async(e="")=>{try{const a=await D("group.list",{page:1,pageSize:50,keyword:e});a.code===0&&(L.value=a.data.list||[])}catch{g.error("获取群组列表失败")}},F=async()=>{var e,a;U.value=!0;try{const h={page:T.current,pageSize:T.pageSize,taskName:n.taskName,channelId:n.channelId,taskAuditStatus:n.taskAuditStatus,preWaiterId:n.preWaiterId,groupId:n.groupId,submitStartTime:(e=n.submitTimeRange)==null?void 0:e[0],submitEndTime:(a=n.submitTimeRange)==null?void 0:a[1],completedTaskCount:n.completedTaskCount,keyword:n.keyword,taskGroupId:n.taskGroupId},r=await D("taskSubmitted.confirmAuditList",{...h});r.code===0?(O.value=r.data.list,T.total=r.data.total,V.value=r.data.totalAmount):g.error(r.message)}finally{U.value=!1}},ge=async()=>{if(H.value.length)return;const e=await D("waiter.list",{page:1,pageSize:100});e.code===0&&(H.value=e.data.list||[])},J=f([]),Q=async(e="")=>{const a=await D("taskGroup.list",{page:1,pageSize:50,taskGroupName:e});a.code===0&&(J.value=a.data.list||[])};return je(()=>{re(),F(),K(),he(),ge(),Q()}),(e,a)=>{const h=c("a-input"),r=c("a-form-item"),w=c("a-select-option"),j=c("a-select"),_e=c("a-range-picker"),Te=c("a-input-number"),we=c("a-form"),G=c("a-button"),I=c("a-space"),Ae=c("DownloadOutlined"),Se=c("a-avatar"),X=c("a-tag"),Ie=c("a-typography-link"),Z=c("a-popconfirm"),Ce=c("a-table"),A=c("a-descriptions-item"),ee=c("a-descriptions"),te=c("a-modal"),$e=c("a-textarea");return u(),p("div",Fe,[y("div",Pe,[y("div",ze,[l(we,{layout:"inline",model:n},{default:s(()=>[l(r,{label:e.$t("submittedTasks.search.taskName")},{default:s(()=>[l(h,{value:n.taskName,"onUpdate:value":a[0]||(a[0]=t=>n.taskName=t),placeholder:e.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.channel")},{default:s(()=>[l(j,{value:n.channelId,"onUpdate:value":a[1]||(a[1]=t=>n.channelId=t),placeholder:e.$t("submittedTasks.search.channelPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:s(()=>[(u(!0),p(_,null,$(B.value,t=>(u(),v(w,{key:t.id,value:t.id},{default:s(()=>[i(o(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.submitTime")},{default:s(()=>[l(_e,{value:n.submitTimeRange,"onUpdate:value":a[2]||(a[2]=t=>n.submitTimeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.taskAuditStatus")},{default:s(()=>[l(j,{value:n.taskAuditStatus,"onUpdate:value":a[3]||(a[3]=t=>n.taskAuditStatus=t),placeholder:e.$t("submittedTasks.search.taskAuditStatusPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:s(()=>[(u(!0),p(_,null,$(oe.value,t=>(u(),v(w,{key:t.value,value:t.value},{default:s(()=>[i(o(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.preAuditor")},{default:s(()=>[l(j,{value:n.preWaiterId,"onUpdate:value":a[4]||(a[4]=t=>n.preWaiterId=t),placeholder:e.$t("submittedTasks.search.preAuditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:s(()=>[(u(!0),p(_,null,$(H.value,t=>(u(),v(w,{key:t.id,value:t.id},{default:s(()=>[i(o(t.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.groupId")},{default:s(()=>[l(j,{value:n.groupId,"onUpdate:value":a[5]||(a[5]=t=>n.groupId=t),placeholder:e.$t("submittedTasks.search.groupIdPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:K},{default:s(()=>[(u(!0),p(_,null,$(L.value,t=>(u(),v(w,{key:t.id,value:t.id},{default:s(()=>[i(o(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.completedTaskCount")},{default:s(()=>[l(Te,{value:n.completedTaskCount,"onUpdate:value":a[6]||(a[6]=t=>n.completedTaskCount=t),min:0,max:9999,"addon-after":e.$t("submittedTasks.search.times"),style:{width:"100px!important"}},null,8,["value","addon-after"])]),_:1},8,["label"]),l(r,{label:e.$t("member.search.keyword")},{default:s(()=>[l(h,{value:n.keyword,"onUpdate:value":a[7]||(a[7]=t=>n.keyword=t),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("task.search.taskGroup")},{default:s(()=>[l(j,{value:n.taskGroupId,"onUpdate:value":a[8]||(a[8]=t=>n.taskGroupId=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:"",style:{width:"120px"},"show-search":"","filter-option":!1,onSearch:Q},{default:s(()=>[(u(!0),p(_,null,$(J.value,t=>(u(),v(w,{key:t.id,value:t.id},{default:s(()=>[i(o(t.taskGroupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"]),y("div",Be,[y("div",null,[l(I,null,{default:s(()=>[l(G,{type:"primary",onClick:x},{default:s(()=>[i(o(e.$t("common.search")),1)]),_:1}),l(G,{onClick:de},{default:s(()=>[i(o(e.$t("common.reset")),1)]),_:1})]),_:1})]),y("div",null,[l(I,null,{default:s(()=>[O.value.length?(u(),v(G,{key:0,onClick:ye},{icon:s(()=>[l(Ae)]),default:s(()=>[i(" "+o(e.$t("common.export")),1)]),_:1})):k("",!0),l(G,{type:"primary",onClick:q},{default:s(()=>[i(o(e.$t("common.batchResolve")),1)]),_:1}),l(G,{danger:"",onClick:be},{default:s(()=>[i(o(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),l(Ce,{columns:ue.value,"data-source":O.value,loading:U.value,pagination:T,"row-selection":ie,rowKey:"id",onChange:ce},{bodyCell:s(({column:t,record:d})=>[t.key==="taskName"?(u(),v(I,{key:0},{default:s(()=>[l(Se,{src:d.channelIcon,size:"small"},null,8,["src"]),y("span",null,o(d.taskName),1),d.taskGroup?(u(),v(X,{key:0,color:"orange"},{default:s(()=>[i(o(d.taskGroup.taskGroupName),1)]),_:2},1024)):k("",!0)]),_:2},1024)):k("",!0),t.key==="taskAuditStatus"?(u(),p(_,{key:1},[i(o(Me(M).getEnumText("TaskAuditStatus",d.taskAuditStatus)),1)],64)):k("",!0),t.key==="preWaiterName"?(u(),p(_,{key:2},[i(o(d.preWaiterName||"--"),1)],64)):k("",!0),t.key==="preAuditTime"?(u(),p(_,{key:3},[i(o(d.preAuditTime||"--"),1)],64)):k("",!0),t.key==="waiterName"?(u(),p(_,{key:4},[i(o(d.waiterName||"--"),1)],64)):k("",!0),t.key==="confirmAuditTime"?(u(),p(_,{key:5},[i(o(d.auditTime||"--"),1)],64)):k("",!0),t.key==="member"?(u(),p(_,{key:6},[y("div",null,[l(I,null,{default:s(()=>[l(Ie,{onClick:C=>me(d)},{default:s(()=>[i(o(d.nickname),1)]),_:2},1032,["onClick"]),d.isNew?(u(),v(X,{key:0,color:"green"},{default:s(()=>a[12]||(a[12]=[i("new")])),_:1})):k("",!0)]),_:2},1024)]),y("div",null,o(d.account),1),(u(!0),p(_,null,$(d.groups,C=>(u(),p("div",null,[l(I,null,{default:s(()=>[y("span",null,o(C.groupName),1),C.isOwner?(u(),v(He,{key:0})):k("",!0)]),_:2},1024)]))),256))],64)):k("",!0),t.key==="action"?(u(),v(I,{key:7},{default:s(()=>[y("a",{onClick:C=>pe(d)},o(e.$t("submittedTasks.list.view")),9,Le),d.taskAuditStatus==="pending"?(u(),v(Z,{key:0,title:e.$t("submittedTasks.list.confirmResolve"),onConfirm:C=>ke(d)},{default:s(()=>[y("a",null,o(e.$t("submittedTasks.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):k("",!0),d.taskAuditStatus==="pending"?(u(),v(Z,{key:1,title:e.$t("submittedTasks.list.confirmReject"),onConfirm:C=>fe(d)},{default:s(()=>[y("a",Ve,o(e.$t("submittedTasks.list.reject")),1)]),_:2},1032,["title","onConfirm"])):k("",!0)]),_:2},1024)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),T.total?(u(),p("div",xe,[l(ee,{column:2},{default:s(()=>[l(A,{label:e.$t("common.totalCount")},{default:s(()=>[i(o(T.total),1)]),_:1},8,["label"]),l(A,{label:e.$t("common.totalAmount")},{default:s(()=>[i(o(V.value),1)]),_:1},8,["label"])]),_:1})])):k("",!0)]),l(te,{open:P.value,"onUpdate:open":a[9]||(a[9]=t=>P.value=t),title:"任务详情",footer:null},{default:s(()=>[l(ee,{column:1},{default:s(()=>[l(A,{label:"任务名称"},{default:s(()=>{var t;return[i(o((t=R.value)==null?void 0:t.taskName),1)]}),_:1}),l(A,{label:"任务类型"},{default:s(()=>{var t;return[i(o((t=R.value)==null?void 0:t.taskType),1)]}),_:1}),l(A,{label:"任务描述"},{default:s(()=>{var t;return[i(o((t=R.value)==null?void 0:t.description),1)]}),_:1}),l(A,{label:"任务奖励"},{default:s(()=>{var t;return[i(o((t=R.value)==null?void 0:t.reward),1)]}),_:1}),l(A,{label:"创建时间"},{default:s(()=>{var t;return[i(o((t=R.value)==null?void 0:t.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),l(te,{open:N.value,"onUpdate:open":a[11]||(a[11]=t=>N.value=t),title:"拒绝原因",onOk:ve,confirmLoading:W.value},{default:s(()=>[l($e,{value:S.value,"onUpdate:value":a[10]||(a[10]=t=>S.value=t),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},et=Ne(qe,[["__scopeId","data-v-039260f1"]]);export{et as default};
