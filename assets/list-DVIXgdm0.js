import{_ as Z,i as tt,r as x,a as B,j as et,b as h,d,c as s,w as a,e as l,k as u,f as at,o as c,F as R,l as j,m as _,h as r,t as N,g as p,D as st,P as nt,n as y,M as ot}from"./index-CUxxoPlX.js";import{T as w,g as lt,a as ct,b as it}from"./enums-BRJzZuqT.js";import{g}from"./request-BwrBeGQu.js";const ut={class:"task content-container"},rt={class:"table-container"},dt={class:"table-header"},_t={class:"left"},pt={class:"right"},mt=["onClick"],ft=["onClick"],kt={__name:"list",setup(vt){const C=at(),{locale:A}=tt(),T=x(!1),o=B({taskName:"",channelId:void 0,status:void 0}),I=x([]),F=[{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"平台渠道",dataIndex:"channelName",key:"channelName"},{title:"任务状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",fixed:"right",width:180}],S=x([]),m=B({current:1,pageSize:10,total:0}),O=t=>lt(ct,t,A.value),L=t=>it[t],D=()=>{m.current=1,f()},M=()=>{o.taskName="",o.channelId=void 0,o.status=void 0,D()},U=t=>{Object.assign(m,t),f()},P=()=>{C.push("/task/create")},z=t=>{C.push(`/task/edit/${t.id}`)},q=t=>{C.push(`/task/view/${t.id}`)},G=async t=>{try{const e=await g("task.delete",{id:t.id});e.success?(u.success("删除成功"),f()):u.error(e.message)}catch{u.error("删除失败")}},H=()=>{ot.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const t={taskName:o.taskName,channelId:o.channelId},e=await g("task.export",t);e.success?u.success("导出成功"):u.error(e.message)}catch{u.error("导出失败")}}})},f=async()=>{T.value=!0;try{const t=await g("task.list",o);t.success?(S.value=t.data.list,m.total=t.data.total):u.error(t.message)}finally{T.value=!1}},J=async()=>{const t=await g("channel.list");t.success&&(I.value=t.data.list)};return et(()=>{f(),J()}),(t,e)=>{const K=l("a-input"),k=l("a-form-item"),E=l("a-select-option"),V=l("a-select"),v=l("a-button"),b=l("a-space"),Q=l("a-form"),W=l("a-tag"),X=l("a-popconfirm"),Y=l("a-table");return c(),h("div",ut,[d("div",rt,[d("div",dt,[d("div",_t,[s(Q,{layout:"inline",model:o},{default:a(()=>[s(k,{label:"任务名称"},{default:a(()=>[s(K,{value:o.taskName,"onUpdate:value":e[0]||(e[0]=n=>o.taskName=n),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),s(k,{label:"平台渠道"},{default:a(()=>[s(V,{value:o.channelId,"onUpdate:value":e[1]||(e[1]=n=>o.channelId=n),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(c(!0),h(R,null,j(I.value,n=>(c(),_(E,{key:n.id,value:n.id},{default:a(()=>[r(N(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(k,{label:"任务状态"},{default:a(()=>[s(V,{value:o.status,"onUpdate:value":e[2]||(e[2]=n=>o.status=n),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(c(!0),h(R,null,j(Object.values(p(w)),n=>(c(),_(E,{key:n,value:n},{default:a(()=>[r(N(O(n)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(k,null,{default:a(()=>[s(b,null,{default:a(()=>[s(v,{type:"primary",onClick:D},{default:a(()=>e[3]||(e[3]=[r("查询")])),_:1}),s(v,{onClick:M},{default:a(()=>e[4]||(e[4]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),d("div",pt,[s(b,null,{default:a(()=>[s(v,{onClick:H},{icon:a(()=>[s(p(st))]),default:a(()=>[e[5]||(e[5]=r(" 导出 "))]),_:1}),s(v,{type:"primary",onClick:P},{icon:a(()=>[s(p(nt))]),default:a(()=>[e[6]||(e[6]=r(" 新建任务 "))]),_:1})]),_:1})])]),s(Y,{columns:F,"data-source":S.value,loading:T.value,pagination:m,onChange:U},{bodyCell:a(({column:n,record:i})=>[n.key==="status"?(c(),_(W,{key:0,color:L(i.status)},{default:a(()=>[r(N(O(i.status)),1)]),_:2},1032,["color"])):y("",!0),n.key==="action"?(c(),_(b,{key:1},{default:a(()=>[d("a",{onClick:$=>q(i)},"查看",8,mt),i.status===p(w).NOT_STARTED?(c(),h("a",{key:0,onClick:$=>z(i)},"编辑",8,ft)):y("",!0),i.status===p(w).NOT_STARTED?(c(),_(X,{key:1,title:"确定要删除该任务吗？",onConfirm:$=>G(i)},{default:a(()=>e[7]||(e[7]=[d("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])):y("",!0)]),_:2},1024)):y("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},Ct=Z(kt,[["__scopeId","data-v-55137a4d"]]);export{Ct as default};
