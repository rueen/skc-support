import{c as a,I as se,_ as re,r as b,a as C,j as ie,k as de,b as U,d as f,w as o,e as c,l as L,m as i,o as _,F as ce,n as ue,p as P,h as w,t as x,A as me,g as N,P as pe,q as B,s as fe,y as _e,z as ve}from"./index-CvG11GSV.js";import{_ as ge}from"./CopyContent-Bk3a83QI.js";import{P as he}from"./PageHeader-Dk08bGaZ.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function D(u){for(var s=1;s<arguments.length;s++){var r=arguments[s]!=null?Object(arguments[s]):{},m=Object.keys(r);typeof Object.getOwnPropertySymbols=="function"&&(m=m.concat(Object.getOwnPropertySymbols(r).filter(function(d){return Object.getOwnPropertyDescriptor(r,d).enumerable}))),m.forEach(function(d){ye(u,d,r[d])})}return u}function ye(u,s,r){return s in u?Object.defineProperty(u,s,{value:r,enumerable:!0,configurable:!0,writable:!0}):u[s]=r,u}var z=function(s,r){var m=D({},s,r.attrs);return a(se,D({},m,{icon:be}),null)};z.displayName="UploadOutlined";z.inheritAttrs=!1;const ke={class:"old-account content-container"},Ue={class:"table-container"},we={class:"table-header"},xe={class:"left"},Be={class:"right"},Oe={key:0},Fe={key:1},Se=["href"],Ce={key:3},Pe=["onClick"],ze={__name:"old-list",setup(u){const s=b(!1),r=b(null),m={action:`${me.businessApiUrl}/old-accounts-fb/import`,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},d=C({keyword:"",memberId:void 0}),I=b([]),M=[{title:"FB账户",key:"account",dataIndex:"uid"},{title:"FB昵称",key:"nickname",dataIndex:"nickname"},{title:"FB链接",key:"homeUrl"},{title:"关联会员",key:"member"},{title:"操作",key:"action"}],$=b([]),v=C({current:1,pageSize:10,total:0}),y=b(!1),F=b(!1),T=ie(()=>n.id?"编辑账号":"添加账号"),n=C({id:null,uid:"",nickname:"",homeUrl:""}),q={uid:[{required:!0,message:"请输入FB账户",trigger:"blur"}],nickname:[{required:!0,message:"请输入FB昵称",trigger:"blur"}],homeUrl:[{required:!0,message:"请输入FB链接",trigger:"blur"},{pattern:/^https?:\/\//,message:"请输入有效的链接，以http://或https://开头",trigger:"blur"}]},g=async()=>{s.value=!0;try{const e=await L("oldAccount.list",{page:v.current,pageSize:v.pageSize,...d});e.code===0?($.value=e.data.list,v.total=e.data.total):i.error(e.message)}finally{s.value=!1}},A=()=>{n.id=null,n.uid="",n.nickname="",n.homeUrl="",r.value&&r.value.resetFields()},H=()=>{A(),y.value=!0},R=e=>{A(),Object.assign(n,{id:e.id,uid:e.uid,nickname:e.nickname,homeUrl:e.homeUrl}),y.value=!0},G=async e=>{try{const t=await fe("oldAccount.delete",{id:e.id},{urlParams:{id:e.id}});t.code===0?(i.success("删除成功"),g()):i.error(t.message)}catch{i.error("删除失败")}},J=()=>{r.value.validate().then(async()=>{F.value=!0;try{let e;n.id?e=await _e("oldAccount.edit",n,{urlParams:{id:n.id}}):e=await ve("oldAccount.add",n),e.code===0?(i.success(n.id?"编辑成功":"添加成功"),y.value=!1,g()):i.error(e.message)}finally{F.value=!1}}).catch(e=>{console.log("验证失败",e)})},Q=e=>e.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||e.type==="application/vnd.ms-excel"?(i.loading({content:"正在上传和处理Excel文件...",key:"importTip"}),!0):(i.error("请上传Excel文件(.xlsx或.xls)"),!1),W=e=>{if(i.destroy("importTip"),e.code===0){const t=e.data||{};i.success(`导入成功：${e.message||`总计${t.total||0}条数据，成功导入${t.imported||0}条，跳过${t.skipped||0}条`}`),g()}else i.error(e.message||"导入失败")},X=e=>{console.log(e),i.destroy("importTip"),i.error("上传失败")},E=()=>{v.current=1,g()},Y=()=>{d.keyword="",d.memberId=void 0,E()},Z=e=>{Object.assign(v,{current:e.current,pageSize:e.pageSize}),g()},V=async(e="")=>{try{const t=await L("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(I.value=t.data.list||[])}catch{i.error("获取会员列表失败")}};return de(()=>{g(),V()}),(e,t)=>{const k=c("a-input"),h=c("a-form-item"),K=c("a-select-option"),ee=c("a-select"),O=c("a-button"),S=c("a-space"),j=c("a-form"),te=c("a-upload"),ae=c("a-popconfirm"),oe=c("a-table"),le=c("a-modal");return _(),U("div",ke,[a(he,{title:"FB老账号管理",back:!0,style:{"margin-bottom":"0"}}),f("div",Ue,[f("div",we,[f("div",xe,[a(j,{layout:"inline",model:d},{default:o(()=>[a(h,{label:"搜索关键词"},{default:o(()=>[a(k,{value:d.keyword,"onUpdate:value":t[0]||(t[0]=l=>d.keyword=l),placeholder:"请输入账户/昵称/链接","allow-clear":""},null,8,["value"])]),_:1}),a(h,{label:"关联会员"},{default:o(()=>[a(ee,{value:d.memberId,"onUpdate:value":t[1]||(t[1]=l=>d.memberId=l),placeholder:"请选择关联会员",style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:V},{default:o(()=>[(_(!0),U(ce,null,ue(I.value,l=>(_(),P(K,{key:l.id,value:l.id},{default:o(()=>[w(x(l.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(h,null,{default:o(()=>[a(S,null,{default:o(()=>[a(O,{type:"primary",onClick:E},{default:o(()=>t[6]||(t[6]=[w("查询")])),_:1}),a(O,{onClick:Y},{default:o(()=>t[7]||(t[7]=[w("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",Be,[a(S,null,{default:o(()=>[a(te,{name:"file",multiple:!1,showUploadList:!1,action:m.action,headers:m.headers,beforeUpload:Q,onSuccess:W,onError:X,accept:".xlsx,.xls"},{default:o(()=>[a(O,null,{default:o(()=>[a(N(z)),t[8]||(t[8]=w(" 导入账号 "))]),_:1})]),_:1},8,["action","headers"]),a(O,{type:"primary",onClick:H},{default:o(()=>[a(N(pe)),t[9]||(t[9]=w(" 添加账号 "))]),_:1})]),_:1})])]),a(oe,{columns:M,"data-source":$.value,loading:s.value,pagination:v,rowKey:"id",onChange:Z},{bodyCell:o(({column:l,record:p})=>[l.key==="account"?(_(),U("div",Oe,[f("div",null,x(p.uid),1)])):B("",!0),l.key==="nickname"?(_(),U("div",Fe,x(p.nickname),1)):B("",!0),l.key==="homeUrl"?(_(),P(ge,{key:2,content:p.homeUrl},{default:o(()=>[f("a",{href:p.homeUrl,target:"_blank",class:"link-text",style:{"max-width":"200px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},x(p.homeUrl),9,Se)]),_:2},1032,["content"])):B("",!0),l.key==="member"?(_(),U("div",Ce,x(p.memberNickname||"--"),1)):B("",!0),l.key==="action"?(_(),P(S,{key:4},{default:o(()=>[f("a",{onClick:ne=>R(p)},"编辑",8,Pe),a(ae,{title:"确定要删除该账号吗？",onConfirm:ne=>G(p)},{default:o(()=>t[10]||(t[10]=[f("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):B("",!0)]),_:1},8,["data-source","loading","pagination"])]),a(le,{open:y.value,"onUpdate:open":t[5]||(t[5]=l=>y.value=l),title:T.value,onOk:J,confirmLoading:F.value},{default:o(()=>[a(j,{model:n,rules:q,ref_key:"formRef",ref:r,"label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[a(h,{label:"FB账户",name:"uid"},{default:o(()=>[a(k,{value:n.uid,"onUpdate:value":t[2]||(t[2]=l=>n.uid=l),placeholder:"请输入FB账户"},null,8,["value"])]),_:1}),a(h,{label:"FB昵称",name:"nickname"},{default:o(()=>[a(k,{value:n.nickname,"onUpdate:value":t[3]||(t[3]=l=>n.nickname=l),placeholder:"请输入FB昵称"},null,8,["value"])]),_:1}),a(h,{label:"FB链接",name:"homeUrl"},{default:o(()=>[a(k,{value:n.homeUrl,"onUpdate:value":t[4]||(t[4]=l=>n.homeUrl=l),placeholder:"请输入FB链接"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},Ee=re(ze,[["__scopeId","data-v-6daaf8bd"]]);export{Ee as default};
