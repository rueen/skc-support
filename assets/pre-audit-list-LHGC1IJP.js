import{_ as fe,i as ke,j as ge,r as _,b as F,k as ye,c as g,d as c,e as l,w as a,f as s,l as D,m as p,g as be,o as i,F as x,n as $,p as f,h as r,t as u,s as k,q as he,M as we,A as W}from"./index-D6TRxwQf.js";import{d as Se}from"./download-B3jXR2BR.js";const Ce={class:"task-audit content-container"},Ae={class:"table-container"},xe={class:"table-header"},Te={style:{width:"100%",display:"flex","justify-content":"space-between"}},Ne={key:3},Pe={class:"group-name"},Re=["onClick"],Ie={__name:"pre-audit-list",setup(Oe){const N=ke(),G=ge(()=>N.loaded?N.getEnumOptions("TaskPreAuditStatus"):[]),K=be(),P=_(!1),U=_(!1),h=_(!1),M=_(!1),y=_(""),w=_(null),v=_([]),o=F({taskName:"",channelId:void 0,taskPreAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),Y=_([]),B=_([]),q=[{title:"任务名称",key:"taskName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskPreAuditStatus",key:"taskPreAuditStatus"},{title:"初审员",key:"preWaiterName"},{title:"操作",key:"action",fixed:"right",width:180}],R=_([]),b=F({current:1,pageSize:10,total:0}),J={selectedRowKeys:v,onChange:t=>{v.value=t},getCheckboxProps:t=>({disabled:t.taskPreAuditStatus!=="pending"})},E=()=>{b.current=1,S()},Q=()=>{Object.assign(o,{taskName:"",channelId:void 0,taskPreAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),E()},X=t=>{Object.assign(b,t),S()},Z=t=>{K.push(`/submitted-tasks/detail/${t.id}?type=pre`)},ee=async t=>{v.value=[t.id],L()},L=async()=>{if(!v.value.length){p.warning("请选择要通过的任务");return}const t=await W("taskSubmitted.batchPreAuditApprove",{ids:v.value});t.code===0?(p.success("批量审核通过成功"),v.value=[],S()):p.error(t.message)},te=t=>{v.value=[t.id],y.value="",h.value=!0},ae=async()=>{if(!y.value){p.error("请输入拒绝原因");return}M.value=!0;const t=await W("taskSubmitted.batchPreAuditReject",{ids:v.value,reason:y.value});t.code===0?(p.success("审核拒绝成功"),h.value=!1,S()):p.error(t.message)},ne=()=>{if(!v.value.length){p.warning("请选择要拒绝的任务");return}y.value="",h.value=!0},le=async()=>{const t=await D("channel.list");t.code===0&&(Y.value=t.data.list)},oe=()=>{we.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const t=p.loading("正在导出数据，请稍候...",0),n={...o};await Se("taskSubmitted.preAuditExport",n,`初审列表_${new Date().toLocaleDateString()}.xlsx`),t(),p.success("导出成功")}catch(t){console.error("导出失败:",t),p.error("导出失败，请稍后重试")}}})},se=async(t="")=>{try{const n=await D("group.list",{params:{page:1,pageSize:50,keyword:t}});n.code===0&&(B.value=n.data.list||[])}catch{p.error("获取群组列表失败")}},S=async()=>{var t,n;P.value=!0;try{const I={page:b.current,pageSize:b.pageSize,taskName:o.taskName,channelId:o.channelId,taskPreAuditStatus:o.taskPreAuditStatus,groupId:o.groupId,submitStartTime:(t=o.submitTimeRange)==null?void 0:t[0],submitEndTime:(n=o.submitTimeRange)==null?void 0:n[1],completedTaskCount:o.completedTaskCount},m=await D("taskSubmitted.preAuditList",{...I});m.code===0?(R.value=m.data.list,b.total=m.data.total):p.error(m.message)}finally{P.value=!1}};return ye(()=>{S(),se(),le()}),(t,n)=>{const I=s("a-input"),m=s("a-form-item"),O=s("a-select-option"),j=s("a-select"),ue=s("a-range-picker"),ie=s("a-input-number"),re=s("a-form"),C=s("a-button"),T=s("a-space"),de=s("DownloadOutlined"),ce=s("a-avatar"),pe=s("a-tag"),V=s("a-popconfirm"),me=s("a-table"),A=s("a-descriptions-item"),_e=s("a-descriptions"),H=s("a-modal"),ve=s("a-textarea");return i(),g("div",Ce,[c("div",Ae,[c("div",xe,[l(re,{layout:"inline",model:o},{default:a(()=>[l(m,{label:"任务名称"},{default:a(()=>[l(I,{value:o.taskName,"onUpdate:value":n[0]||(n[0]=e=>o.taskName=e),placeholder:"请输入任务名称","allow-clear":"",style:{width:"140px"}},null,8,["value"])]),_:1}),l(m,{label:"平台渠道"},{default:a(()=>[l(j,{value:o.channelId,"onUpdate:value":n[1]||(n[1]=e=>o.channelId=e),placeholder:"请选择平台渠道","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),g(x,null,$(Y.value,e=>(i(),f(O,{key:e.id,value:e.id},{default:a(()=>[r(u(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(m,{label:"初审状态"},{default:a(()=>[l(j,{value:o.taskPreAuditStatus,"onUpdate:value":n[2]||(n[2]=e=>o.taskPreAuditStatus=e),placeholder:"请选择初审状态","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),g(x,null,$(G.value,e=>(i(),f(O,{key:e.value,value:e.value},{default:a(()=>[r(u(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(m,{label:"所属群组"},{default:a(()=>[l(j,{value:o.groupId,"onUpdate:value":n[3]||(n[3]=e=>o.groupId=e),placeholder:"请选择群组","allow-clear":""},{default:a(()=>[(i(!0),g(x,null,$(B.value,e=>(i(),f(O,{key:e.id,value:e.id},{default:a(()=>[r(u(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(m,{label:"提交时间"},{default:a(()=>[l(ue,{value:o.submitTimeRange,"onUpdate:value":n[4]||(n[4]=e=>o.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1}),l(m,{label:"已完成任务"},{default:a(()=>[l(ie,{value:o.completedTaskCount,"onUpdate:value":n[5]||(n[5]=e=>o.completedTaskCount=e),min:0,max:9999,"addon-after":"次",style:{width:"100px!important"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),c("div",Te,[c("div",null,[l(T,null,{default:a(()=>[l(C,{type:"primary",onClick:E},{default:a(()=>[r(u(t.$t("common.search")),1)]),_:1}),l(C,{onClick:Q},{default:a(()=>[r(u(t.$t("common.reset")),1)]),_:1})]),_:1})]),c("div",null,[l(T,null,{default:a(()=>[R.value.length?(i(),f(C,{key:0,onClick:oe},{icon:a(()=>[l(de)]),default:a(()=>[r(" "+u(t.$t("common.export")),1)]),_:1})):k("",!0),l(C,{type:"primary",onClick:L},{default:a(()=>[r(u(t.$t("common.batchResolve")),1)]),_:1}),l(C,{danger:"",onClick:ne},{default:a(()=>[r(u(t.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),l(me,{columns:q,"data-source":R.value,loading:P.value,pagination:b,"row-selection":J,rowKey:"id",onChange:X},{bodyCell:a(({column:e,record:d})=>[e.key==="taskName"?(i(),f(T,{key:0},{default:a(()=>[l(ce,{src:d.channelIcon,size:"small"},null,8,["src"]),c("span",null,u(d.taskName),1)]),_:2},1024)):k("",!0),e.key==="taskPreAuditStatus"?(i(),g(x,{key:1},[r(u(he(N).getEnumText("TaskPreAuditStatus",d.taskPreAuditStatus)),1)],64)):k("",!0),e.key==="preWaiterName"?(i(),g(x,{key:2},[r(u(d.preWaiterName||"--"),1)],64)):k("",!0),e.key==="member"?(i(),g("div",Ne,[c("div",null,u(d.memberNickname),1),c("div",Pe,[c("span",null,u(d.groupName),1),d.isGroupOwner?(i(),f(pe,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>n[9]||(n[9]=[r("群主")])),_:1})):k("",!0)])])):k("",!0),e.key==="action"?(i(),f(T,{key:4},{default:a(()=>[c("a",{onClick:z=>Z(d)},"查看",8,Re),d.taskPreAuditStatus==="pending"?(i(),f(V,{key:0,title:"确定要通过该任务吗？",onConfirm:z=>ee(d)},{default:a(()=>n[10]||(n[10]=[c("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):k("",!0),d.taskPreAuditStatus==="pending"?(i(),f(V,{key:1,title:"确定要拒绝该任务吗？",onConfirm:z=>te(d)},{default:a(()=>n[11]||(n[11]=[c("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):k("",!0)]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading","pagination"])]),l(H,{open:U.value,"onUpdate:open":n[6]||(n[6]=e=>U.value=e),title:"任务详情",footer:null},{default:a(()=>[l(_e,{column:1},{default:a(()=>[l(A,{label:"任务名称"},{default:a(()=>{var e;return[r(u((e=w.value)==null?void 0:e.taskName),1)]}),_:1}),l(A,{label:"任务类型"},{default:a(()=>{var e;return[r(u((e=w.value)==null?void 0:e.taskType),1)]}),_:1}),l(A,{label:"任务描述"},{default:a(()=>{var e;return[r(u((e=w.value)==null?void 0:e.description),1)]}),_:1}),l(A,{label:"任务奖励"},{default:a(()=>{var e;return[r(u((e=w.value)==null?void 0:e.reward),1)]}),_:1}),l(A,{label:"创建时间"},{default:a(()=>{var e;return[r(u((e=w.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),l(H,{open:h.value,"onUpdate:open":n[8]||(n[8]=e=>h.value=e),title:"拒绝原因",onOk:ae,confirmLoading:M.value},{default:a(()=>[l(ve,{value:y.value,"onUpdate:value":n[7]||(n[7]=e=>y.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},$e=fe(Ie,[["__scopeId","data-v-2b2bdfb2"]]);export{$e as default};
