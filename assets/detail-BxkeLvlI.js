import{_ as re,b as ce,a as me,x as be,j as ke,c as O,r as g,k as fe,d as k,f as a,e as r,w as t,g as p,t as s,F as $,n as U,p as m,s as b,A as V,m as _,l as G,h as pe,o as i,i as u,q as B}from"./index-CjHbnac2.js";import{P as _e}from"./PageHeader-CEuR5FGb.js";import{_ as z}from"./CopyContent-CZ_95-pB.js";import{G as Te}from"./GroupOwner-BVHliq4o.js";import{d as ye}from"./routeParamsEncryption-BKFTaOaF.js";const he={class:"task-audit-detail content-container"},ve={class:"detail-container"},ge={key:0},$e={key:1},Ie={class:"detail-section"},Ce={class:"section-title"},Se={key:0},qe={class:"link-text-container"},we=["href"],Ae={class:"detail-section"},je={class:"section-title"},Pe={class:"link-text-container"},Re=["href"],Ne={key:0,style:{"margin-left":"10px"}},Fe={key:1},Ue={class:"detail-section"},Be={class:"section-title"},Ee={class:"footer-btns"},Le={class:"left"},De={class:"right"},Oe={__name:"detail",setup(Ve){const{t:A}=ce(),j=me(),T=be(),E=pe(),P=T.query.type,M=ke(()=>o.taskPreAuditStatus==="approved"?"confirm":"pre"),R=g(!1),L=g(!1),I=g(""),H=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},h=g(null),o=O({submitContent:{}}),c=O({}),y=O({}),D=g(null),Q=()=>{const e=T.query.filters;e&&(D.value=ye(e))},J=async()=>{const e=M.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",l=await V(e,{ids:[h.value]});l.code===0?(_.success(A("submittedTasks.resolveSuccess")),C()):_.error(l.message)},K=()=>{I.value="",R.value=!0},X=async()=>{if(!I.value){_.error(A("submittedTasks.rejectReasonRequired"));return}L.value=!0;try{const e=M.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject";await V(e,{ids:[h.value],reason:I.value}),_.success(A("submittedTasks.rejectSuccess")),R.value=!1,C()}catch(e){_.error(e.message)}finally{L.value=!1}},Y=()=>{const e=P==="confirm"?"/confirm-audit-tasks":"/pre-audit-tasks",l={};T.query.filters&&(l.filters=T.query.filters),E.push({path:e,query:l})},Z=()=>{const e={type:P};T.query.filters&&(e.filters=T.query.filters),E.push({path:`/submitted-tasks/detail/${o.prevTaskId}`,query:e}),h.value=o.prevTaskId,C()},x=()=>{const e={type:P};T.query.filters&&(e.filters=T.query.filters),E.push({path:`/submitted-tasks/detail/${o.nextTaskId}`,query:e}),h.value=o.nextTaskId,C()},ee=async e=>{try{const l=await G("task.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(c,l.data):_.error(l.message)}catch(l){_.error(l.message)}},te=async e=>{try{const l=await G("member.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(y,l.data):_.error(l.message)}catch{_.error(A("submittedTasks.detail.getMemberDetailFailed"))}},C=async()=>{try{const e={auditType:P,id:h.value};D.value&&(e.filtersParam=D.value);const l=await V("taskSubmitted.detail",e);l.code===0&&(Object.assign(o,l.data),l.data.taskId!=null&&await ee(l.data.taskId),l.data.memberId!=null&&await te(l.data.memberId),l.data.taskId!=null&&l.data.memberId!=null&&await ae())}catch(e){_.error(e.message)}},S=g([]),ae=async()=>{const e=await G("account.list",{taskId:o.taskId,memberId:o.memberId,channelId:c.channelId});e.code===0&&(S.value=e.data.list||[])};return fe(async()=>{h.value=T.params.id,Q(),await C()}),(e,l)=>{const W=p("a-avatar"),v=p("a-space"),n=p("a-descriptions-item"),q=p("a-descriptions"),se=p("a-collapse-panel"),le=p("a-collapse"),N=p("a-tag"),ie=p("a-image"),F=p("a-button"),ue=p("a-textarea"),ne=p("a-modal");return i(),k("div",he,[a(_e,{title:e.$t("submittedTasks.detail.title"),back:!0,useDefaultBack:!1,onBack:Y},null,8,["title"]),r("div",ve,[a(le,{ghost:"",class:"collapse"},{default:t(()=>[a(se,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a(q,{column:2},{default:t(()=>[a(n,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(v,null,{default:t(()=>[a(W,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(c.taskName),1)]),_:1})]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[u(s(c.category),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[u(s(B(j).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[u(s(c.reward),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[u(s(c.brand),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var d;return[c.groupMode===0?(i(),k("span",ge,s(e.$t("submittedTasks.detail.noSpecify")),1)):(i(),k("span",$e,s((d=c.groupNames)==null?void 0:d.join("、")),1))]}),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[u(s(c.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(c.endTime),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[u(s(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[u(s(c.fansRequired),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[u(s(c.contentRequirement),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[u(s(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),r("div",Ie,[r("div",Ce,s(e.$t("submittedTasks.detail.memberInfo")),1),a(q,{column:2},{default:t(()=>[a(n,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[a(v,null,{default:t(()=>[r("span",null,s(y.nickname),1),y.isNew?(i(),m(N,{key:0,color:"green"},{default:t(()=>l[2]||(l[2]=[u("new")])),_:1})):b("",!0)]),_:1})]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[u(s(y.account),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(i(!0),k($,null,U(y.groups,d=>(i(),m(v,null,{default:t(()=>[r("span",null,s(d.groupName),1),d.isOwner?(i(),m(Te,{key:0})):b("",!0)]),_:2},1024))),256)),!y.groups||y.groups.length===0?(i(),k("span",Se,"--")):b("",!0)]),_:1},8,["label"])]),_:1}),(i(!0),k($,null,U(S.value,d=>(i(),k("div",{key:d.channelId},[a(q,{column:2},{default:t(()=>[a(n,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(v,null,{default:t(()=>[a(W,{src:d.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(d.account),1),a(N,{color:"warning"},{default:t(()=>[u(s(B(j).getEnumText("AccountAuditStatus",d.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(n,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(z,{content:d.homeUrl},{default:t(()=>[r("div",qe,[r("a",{href:d.homeUrl,target:"_blank",class:"link-text"},s(d.homeUrl),9,we)])]),_:2},1032,["content"])]),_:2},1032,["label"]),d.channelCustomFields.includes("fansCount")?(i(),m(n,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[u(s(d.fansCount),1)]),_:2},1032,["label"])):b("",!0),d.channelCustomFields.includes("friendsCount")?(i(),m(n,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[u(s(d.friendsCount),1)]),_:2},1032,["label"])):b("",!0),d.channelCustomFields.includes("postsCount")?(i(),m(n,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[u(s(d.postsCount),1)]),_:2},1032,["label"])):b("",!0),a(n,{label:"uid"},{default:t(()=>[u(s(d.uid),1)]),_:2},1024)]),_:2},1024)]))),128))]),r("div",Ae,[r("div",je,s(e.$t("submittedTasks.detail.submitInfo")),1),a(q,{column:1},{default:t(()=>{var d;return[(i(!0),k($,null,U((d=o==null?void 0:o.submitContent)==null?void 0:d.customFields,(f,de)=>(i(),m(n,{key:de,label:f.title},{default:t(()=>[f.type==="image"?(i(!0),k($,{key:0},U(f.value,(w,oe)=>(i(),m(ie,{src:w.url,width:60,key:oe},null,8,["src"]))),128)):(i(),k($,{key:1},[H(f.value)?(i(),k($,{key:0},[a(z,{content:f.value},{default:t(()=>[r("div",Pe,[r("a",{href:f.value,target:"_blank",class:"link-text"},s(f.value),9,Re)])]),_:2},1032,["content"]),f.type==="post"?(i(),k("div",Ne,[S.value.find(w=>w.uid===f.uid)?(i(),m(N,{key:0,color:"green"},{default:t(()=>[u(s(e.$t("submittedTasks.detail.postUidCheckSuccess")),1)]),_:1})):b("",!0),S.value.length&&f.uid!=null&&!S.value.find(w=>w.uid===f.uid)?(i(),m(N,{key:1,color:"red"},{default:t(()=>[u(s(e.$t("submittedTasks.detail.postUidCheckError")),1)]),_:1})):b("",!0)])):b("",!0)],64)):(i(),k("span",Fe,s(f.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),r("div",Ue,[r("div",Be,s(e.$t("submittedTasks.detail.auditInfo")),1),a(q,{column:2},{default:t(()=>[a(n,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[u(s(o.submitTime),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[u(s(B(j).getEnumText("TaskPreAuditStatus",o.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(n,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[u(s(o.preWaiterName),1)]),_:1},8,["label"]),o.taskPreAuditStatus==="approved"?(i(),m(n,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[u(s(B(j).getEnumText("TaskAuditStatus",o.taskAuditStatus)),1)]),_:1},8,["label"])):b("",!0),o.taskPreAuditStatus==="approved"?(i(),m(n,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[u(s(o.waiterName),1)]),_:1},8,["label"])):b("",!0),o.auditStatus==="rejected"?(i(),m(n,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[u(s(o.rejectReason),1)]),_:1},8,["label"])):b("",!0),a(n,{label:e.$t("submittedTasks.detail.updateTime")},{default:t(()=>[u(s(o.updateTime),1)]),_:1},8,["label"])]),_:1})]),r("div",Ee,[r("div",Le,[o.auditStatus==="pending"?(i(),m(v,{key:0},{default:t(()=>[a(F,{type:"primary",onClick:J},{default:t(()=>[u(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(F,{danger:"",onClick:K},{default:t(()=>[u(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):b("",!0)]),r("div",De,[a(v,null,{default:t(()=>[o.prevTaskId&&o.prevTaskId!==o.nextTaskId?(i(),m(F,{key:0,onClick:Z},{default:t(()=>[u(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):b("",!0),o.nextTaskId?(i(),m(F,{key:1,onClick:x},{default:t(()=>[u(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):b("",!0)]),_:1})])])]),a(ne,{open:R.value,"onUpdate:open":l[1]||(l[1]=d=>R.value=d),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:X,confirmLoading:L.value},{default:t(()=>[a(ue,{value:I.value,"onUpdate:value":l[0]||(l[0]=d=>I.value=d),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Qe=re(Oe,[["__scopeId","data-v-11edd61a"]]);export{Qe as default};
