import{_ as Re,a as Ae,b as Oe,j as Z,r as k,c as E,k as Te,d as i,e as r,f as o,s as h,w as n,g as d,y as x,x as Ue,h as Me,l as U,m as _,o as l,F as w,n as j,p as C,i as p,t as s,q as Ye,A as ee,M as Fe,v as De}from"./index-D76b9hFB.js";import{_ as te}from"./CopyContent-BcLBq4Pm.js";import{G as Ne}from"./GroupOwner-BMUrKbUt.js";import{d as He,e as Pe}from"./routeParamsEncryption-BKFTaOaF.js";const Ee={class:"account content-container"},ze={class:"table-container"},Be={class:"table-header"},qe={style:{width:"100%",display:"flex","justify-content":"space-between"}},Le={class:"right"},Ve={key:0,class:"account-info"},We={class:"link-text-container"},Ge={class:"label"},Ke=["href"],Je={class:"stats"},Qe={key:0,class:"stat-item"},Xe={key:1,class:"stat-item"},Ze={key:2,class:"stat-item"},xe={key:1},et={key:1},tt={class:"danger"},at=["onClick"],nt={class:"danger"},ot={key:0,class:"count-container"},st={__name:"list",setup(lt){const M=Me(),Y=Ue(),F=Ae(),{t:f}=Oe(),ae=Z(()=>F.loaded?F.getEnumOptions("AccountAuditStatus"):[]),D=k(!1),y=k([]),R=k(!1),N=k(!1),I=k(""),z=()=>{const e=x().startOf("month").format("YYYY-MM-DD HH:mm:ss"),t=x().endOf("month").format("YYYY-MM-DD HH:mm:ss");return[e,t]},ne=e=>!e||e.startsWith("http://")||e.startsWith("https://")?e:e.toLowerCase().includes("tiktok.com")?`https://${e.replace(/^(.*?)tiktok\.com/i,"www.tiktok.com")}`:`https://${e}`,oe=()=>{const e=Y.query.filters;if(e){const t={},v=He(e);Object.keys(v).forEach(b=>{b==="current"?g.current=v[b]:t[b]=v[b]}),Object.assign(c,{accountAuditStatus:null},t);const m={...Y.query};delete m.filters,M.replace({path:Y.path,query:m})}},c=E({keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:z()}),B=k([]),q=k([]),L=k([]),H=k([]),se=Z(()=>[{title:f("account.list.accountInfo"),key:"accountInfo",width:500},{title:f("account.list.memberInfo"),key:"member"},{title:f("account.list.submitTime"),dataIndex:"submitTime",key:"submitTime",sorter:!0},{title:f("account.list.auditStatus"),dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:f("account.list.rejectReason"),key:"rejectReason"},{title:f("account.list.rejectTimes"),dataIndex:"rejectTimes",key:"rejectTimes"},{title:f("account.list.waiterName"),key:"waiterName"},{title:f("account.list.auditTime"),dataIndex:"auditTime",key:"auditTime",sorter:!0},{title:f("account.list.action"),key:"action"}]),le={selectedRowKeys:y,onChange:e=>{y.value=e},getCheckboxProps:e=>({disabled:e.accountAuditStatus!=="pending"})},V=k([]),g=E({current:1,pageSize:10,total:0}),W=E({sorterField:void 0,sorterOrder:void 0}),G=()=>{g.current=1,S()},ce=()=>{Object.assign(c,{keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:z()}),G()},ue=e=>{M.push(`/member/view/${e.memberId}`)},ie=e=>{const t=Pe({...c,current:g.current});M.push({name:"AccountEdit",params:{id:e.id},query:{filters:t}})},re=()=>{M.push("/account/old")},de=(e,t,v)=>{Object.assign(g,e),Object.assign(W,{sorterField:v.field,sorterOrder:v.order}),S()},me=async e=>{y.value=[e.id],K()},K=async()=>{if(!y.value.length){_.warning(f("account.list.message.selectAccount"));return}const e=await ee("account.batchResolve",{ids:y.value});if(e.code===0){const t=e.data.failed.map(v=>v.reason).join(",");t?Fe.error({title:f("account.list.batchRejectFailedTitle"),content:`成功 ${e.data.successCount} 条，失败 ${e.data.failedCount} 条，失败原因：${t}`}):(_.success(f("account.list.message.success")),y.value=[],S())}else _.error(e.message)},pe=async()=>{if(!y.value.length){_.warning(f("account.list.message.selectAccount"));return}I.value="",R.value=!0},fe=e=>{y.value=[e.id],I.value="",R.value=!0},he=async()=>{if(!I.value){_.error(f("account.list.message.rejectReason"));return}N.value=!0;try{const e=await ee("account.batchReject",{ids:y.value,rejectReason:I.value});e.code===0?(_.success(f("account.list.message.success")),y.value=[],R.value=!1,S()):_.error(e.message)}catch(e){console.log(e)}finally{N.value=!1}},S=async()=>{var e,t;D.value=!0;try{const v={page:g.current,pageSize:g.pageSize,keyword:c.keyword,channelId:c.channelId,accountAuditStatus:c.accountAuditStatus,waiterId:c.waiterId,groupId:c.groupId,memberId:c.memberId,submitStartTime:(e=c.submitTimeRange)==null?void 0:e[0],submitEndTime:(t=c.submitTimeRange)==null?void 0:t[1]},m=await U("account.list",{...v,...W});m.code===0?(V.value=m.data.list,g.total=m.data.total):_.error(m.message)}finally{D.value=!1}},ve=async()=>{const e=await U("channel.list");e.code===0&&(B.value=e.data.list)},J=async(e="")=>{try{const t=await U("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(q.value=t.data.list||[])}catch{_.error("获取群组列表失败")}},Q=async(e="")=>{const t=await U("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(L.value=t.data.list||[])},_e=async e=>{const t=await De("account.delete",{},{urlParams:{id:e.id}});t.code===0?(_.success(t.message),S()):_.error(t.message)},ye=async()=>{if(H.value.length)return;const e=await U("waiter.list",{page:1,pageSize:100});if(e.code===0){const t={id:0,username:"无"};H.value=[t,...e.data.list]}};return Te(()=>{oe(),S(),J(),ve(),Q(),ye()}),(e,t)=>{const v=d("a-input"),m=d("a-form-item"),b=d("a-select-option"),A=d("a-select"),ge=d("a-range-picker"),O=d("a-button"),T=d("a-space"),be=d("a-form"),ke=d("a-avatar"),X=d("a-typography-link"),we=d("a-typography-text"),P=d("a-popconfirm"),Ce=d("a-table"),$e=d("a-descriptions-item"),Ie=d("a-descriptions"),Se=d("a-textarea"),je=d("a-modal");return l(),i("div",Ee,[r("div",ze,[r("div",Be,[o(be,{layout:"inline",model:c},{default:n(()=>[o(m,{label:e.$t("account.search.account")},{default:n(()=>[o(v,{value:c.keyword,"onUpdate:value":t[0]||(t[0]=a=>c.keyword=a),placeholder:e.$t("account.search.accountPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.channel")},{default:n(()=>[o(A,{value:c.channelId,"onUpdate:value":t[1]||(t[1]=a=>c.channelId=a),placeholder:e.$t("account.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(l(!0),i(w,null,j(B.value,a=>(l(),C(b,{key:a.id,value:a.id},{default:n(()=>[p(s(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.submitTime")},{default:n(()=>[o(ge,{value:c.submitTimeRange,"onUpdate:value":t[2]||(t[2]=a=>c.submitTimeRange=a),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.auditStatus")},{default:n(()=>[o(A,{value:c.accountAuditStatus,"onUpdate:value":t[3]||(t[3]=a=>c.accountAuditStatus=a),placeholder:e.$t("account.search.auditStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(l(!0),i(w,null,j(ae.value,a=>(l(),C(b,{key:a.value,value:a.value},{default:n(()=>[p(s(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.auditor")},{default:n(()=>[o(A,{value:c.waiterId,"onUpdate:value":t[4]||(t[4]=a=>c.waiterId=a),placeholder:e.$t("account.search.auditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:n(()=>[(l(!0),i(w,null,j(H.value,a=>(l(),C(b,{key:a.id,value:a.id},{default:n(()=>[p(s(a.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.group")},{default:n(()=>[o(A,{value:c.groupId,"onUpdate:value":t[5]||(t[5]=a=>c.groupId=a),placeholder:e.$t("account.search.groupPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:J},{default:n(()=>[(l(!0),i(w,null,j(q.value,a=>(l(),C(b,{key:a.id,value:a.id},{default:n(()=>[p(s(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.member")},{default:n(()=>[o(A,{value:c.memberId,"onUpdate:value":t[6]||(t[6]=a=>c.memberId=a),placeholder:e.$t("account.search.memberPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:Q},{default:n(()=>[(l(!0),i(w,null,j(L.value,a=>(l(),C(b,{key:a.id,value:a.id},{default:n(()=>[p(s(a.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,null,{default:n(()=>[o(T,null,{default:n(()=>[o(O,{type:"primary",onClick:G},{default:n(()=>[p(s(e.$t("common.search")),1)]),_:1}),o(O,{onClick:ce},{default:n(()=>[p(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),r("div",qe,[o(O,{onClick:re},{default:n(()=>[p(s(e.$t("account.list.oldAccount")),1)]),_:1}),r("div",Le,[o(T,null,{default:n(()=>[o(O,{type:"primary",onClick:K},{default:n(()=>[p(s(e.$t("common.batchResolve")),1)]),_:1}),o(O,{danger:"",onClick:pe},{default:n(()=>[p(s(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),o(Ce,{columns:se.value,"data-source":V.value,loading:D.value,pagination:g,showSorterTooltip:!1,"row-selection":le,rowKey:"id",onChange:de},{bodyCell:n(({column:a,record:u})=>[a.key==="accountInfo"?(l(),i("div",Ve,[o(T,null,{default:n(()=>[o(ke,{src:u.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(u.account),1)]),_:2},1024),r("div",null,[r("div",We,[r("span",Ge,s(e.$t("account.list.homepage"))+"：",1),o(te,{content:u.homeUrl},{default:n(()=>[o(X,null,{default:n(()=>[r("a",{href:ne(u.homeUrl),target:"_blank"},s(u.homeUrl),9,Ke)]),_:2},1024)]),_:2},1032,["content"])])]),r("div",null,[t[9]||(t[9]=r("span",{class:"label"},"uid：",-1)),o(te,{content:u.uid},null,8,["content"])]),r("div",Je,[u.channelCustomFields.includes("fansCount")?(l(),i("div",Qe,s(e.$t("account.list.fansCount"))+"："+s(u.fansCount),1)):h("",!0),u.channelCustomFields.includes("friendsCount")?(l(),i("div",Xe,s(e.$t("account.list.friendsCount"))+"："+s(u.friendsCount),1)):h("",!0),u.channelCustomFields.includes("postsCount")?(l(),i("div",Ze,s(e.$t("account.list.postsCount"))+"："+s(u.postsCount),1)):h("",!0)])])):h("",!0),a.key==="member"?(l(),i("div",xe,[r("div",null,[o(X,{onClick:$=>ue(u)},{default:n(()=>[p(s(u.memberNickname),1)]),_:2},1032,["onClick"])]),(l(!0),i(w,null,j(u.groups,$=>(l(),i("div",null,[o(T,null,{default:n(()=>[r("span",null,s($.groupName),1),$.isOwner?(l(),C(Ne,{key:0})):h("",!0)]),_:2},1024)]))),256))])):h("",!0),a.key==="accountAuditStatus"?(l(),i(w,{key:2},[p(s(Ye(F).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)],64)):h("",!0),a.key==="rejectReason"?(l(),i(w,{key:3},[u.rejectReason?(l(),C(we,{key:0,type:"danger"},{default:n(()=>[p(s(u.rejectReason),1)]),_:2},1024)):(l(),i("span",et,"--"))],64)):h("",!0),a.key==="waiterName"?(l(),i(w,{key:4},[p(s(u.waiterName||"--"),1)],64)):h("",!0),a.key==="auditTime"?(l(),i(w,{key:5},[p(s(u.auditTime||"--"),1)],64)):h("",!0),a.key==="action"?(l(),C(T,{key:6},{default:n(()=>[u.accountAuditStatus==="pending"?(l(),C(P,{key:0,title:e.$t("account.list.resolveConfirm"),onConfirm:$=>me(u)},{default:n(()=>[r("a",null,s(e.$t("account.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),u.accountAuditStatus==="pending"?(l(),C(P,{key:1,title:e.$t("account.list.rejectConfirm"),onConfirm:$=>fe(u)},{default:n(()=>[r("a",tt,s(e.$t("account.list.reject")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),r("a",{onClick:$=>ie(u)},s(e.$t("common.edit")),9,at),o(P,{title:e.$t("common.deleteConfirm"),onConfirm:$=>_e(u)},{default:n(()=>[r("a",nt,s(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),g.total?(l(),i("div",ot,[o(Ie,{column:2},{default:n(()=>[o($e,{label:e.$t("common.totalCount")},{default:n(()=>[p(s(g.total),1)]),_:1},8,["label"])]),_:1})])):h("",!0)]),o(je,{open:R.value,"onUpdate:open":t[8]||(t[8]=a=>R.value=a),title:e.$t("account.list.rejectReason"),onOk:he,confirmLoading:N.value},{default:n(()=>[o(Se,{value:I.value,"onUpdate:value":t[7]||(t[7]=a=>I.value=a),placeholder:e.$t("account.list.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},dt=Re(st,[["__scopeId","data-v-218a9c31"]]);export{dt as default};
