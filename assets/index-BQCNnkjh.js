import{g as Q,p as w}from"./request-DysJmEHt.js";import{_ as X,r as m,a as h,p as Y,k as Z,b as x,d,c as o,w as r,e as n,o as v,h as C,m as D,n as B,F as ee,l as ae,t as se,i}from"./index-Dv7OF5ky.js";const te={class:"waiter content-container"},oe={class:"table-container"},re={class:"table-header"},ne={class:"right"},ie=["onClick"],le={__name:"index",setup(me){const k=m(!1),l=m(!1),c=m(!1),u=m("add"),b=m(),a=h({username:"",password:"",remarks:"",permissions:[]}),V={username:[{required:!0,message:"请输入用户名"}],password:[{required:!0,message:"请输入密码",trigger:"change"}]},U=[{title:"task",permissions:"task:list"},{title:"taskCreate",permissions:"task:create"},{title:"taskEdit",permissions:"task:edit"},{title:"account",permissions:"account:list"},{title:"taskAudit",permissions:"task:audit"},{title:"taskAuditDetail",permissions:"task:auditDetail"},{title:"member",permissions:"member:list"},{title:"memberCreate",permissions:"member:create"},{title:"memberEdit",permissions:"member:edit"},{title:"memberView",permissions:"member:view"},{title:"channel",permissions:"channel:list"},{title:"group",permissions:"group:list"},{title:"withdrawal",permissions:"settlement:withdrawal"},{title:"otherBills",permissions:"settlement:otherBills"},{title:"waiter",permissions:"waiter:list"},{title:"article",permissions:"article:list"}],q=[{title:"账号名称",dataIndex:"username",key:"username"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"操作",key:"action",width:200}],y=m([]),p=h({current:1,pageSize:10,total:0}),E=Y(()=>u.value==="add"?"添加账号":"编辑账号"),L=e=>{Object.assign(p,e),_()},N=()=>{u.value="add",a.username="",a.password="",a.remarks="",a.permissions=[],l.value=!0},O=e=>{u.value="edit",a.username=e.username,a.password="",a.remarks=e.remarks,a.permissions=e.permissions.split(","),l.value=!0},S=async e=>{try{const s=await w("waiter.delete",{id:e.id});s.code===0?(i.success("删除成功"),_()):i.error(s.message)}catch{i.error("删除失败")}},T=async()=>{try{const e=await w("waiter.add",{...a,permissions:a.permissions.join(",")});e.code===0?(i.success("添加成功"),l.value=!1,_()):i.error(e.message)}catch(e){i.error("添加失败"),console.error(e)}finally{c.value=!1}},j=async()=>{try{const e=await w("waiter.edit",{...a,permissions:a.permissions.join(",")});e.code===0?(i.success("编辑成功"),l.value=!1,_()):i.error(e.message)}catch(e){i.error("编辑失败"),console.error(e)}finally{c.value=!1}},z=async()=>{try{switch(await b.value.validate(),c.value=!0,u.value){case"add":T();break;case"edit":j();break}}catch(e){console.error(e)}finally{c.value=!1}},_=async()=>{k.value=!0;try{const e=await Q("waiter.list",{page:p.current,pageSize:p.pageSize});y.value=e.data.list,p.total=e.data.total}finally{k.value=!1}};return Z(()=>{_()}),(e,s)=>{const A=n("a-button"),F=n("a-popconfirm"),I=n("a-space"),$=n("a-table"),R=n("a-input"),f=n("a-form-item"),W=n("a-input-password"),M=n("a-textarea"),G=n("a-checkbox"),H=n("a-checkbox-group"),J=n("a-form"),K=n("a-modal");return v(),x("div",te,[d("div",oe,[d("div",re,[s[6]||(s[6]=d("div",{class:"left"},null,-1)),d("div",ne,[o(A,{type:"primary",onClick:N},{default:r(()=>s[5]||(s[5]=[C(" 添加账号 ")])),_:1})])]),o($,{columns:q,"data-source":y.value,loading:k.value,pagination:p,onChange:L},{bodyCell:r(({column:t,record:g})=>[t.key==="action"?(v(),D(I,{key:0},{default:r(()=>[d("a",{onClick:P=>O(g)},"编辑",8,ie),g.is_admin?B("",!0):(v(),D(F,{key:0,title:"确定要删除该账号吗？",onConfirm:P=>S(g)},{default:r(()=>s[7]||(s[7]=[d("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"]))]),_:2},1024)):B("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(K,{open:l.value,"onUpdate:open":s[4]||(s[4]=t=>l.value=t),title:E.value,confirmLoading:c.value,onOk:z},{default:r(()=>[o(J,{ref_key:"formRef",ref:b,model:a,rules:V,"label-col":{span:6},"wrapper-col":{span:16}},{default:r(()=>[o(f,{label:"用户名",name:"username"},{default:r(()=>[o(R,{value:a.username,"onUpdate:value":s[0]||(s[0]=t=>a.username=t),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),o(f,{label:"密码",name:"password",required:u.value==="add"},{default:r(()=>[o(W,{value:a.password,"onUpdate:value":s[1]||(s[1]=t=>a.password=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["required"]),o(f,{label:"备注",name:"remarks"},{default:r(()=>[o(M,{value:a.remarks,"onUpdate:value":s[2]||(s[2]=t=>a.remarks=t),placeholder:"请输入备注",rows:3},null,8,["value"])]),_:1}),o(f,{label:"权限",name:"permissions"},{default:r(()=>[o(H,{value:a.permissions,"onUpdate:value":s[3]||(s[3]=t=>a.permissions=t)},{default:r(()=>[(v(),x(ee,null,ae(U,t=>o(G,{key:t.title,value:t.permissions},{default:r(()=>[C(se(e.$t("menu."+t.title)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},ue=X(le,[["__scopeId","data-v-24a9a801"]]);export{ue as default};
