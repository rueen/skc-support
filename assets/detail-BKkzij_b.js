import{_ as de,b as ue,a as oe,x as re,j as ce,c as F,r as C,k as me,d as k,f as a,e as r,w as t,g as p,t as s,F as S,n as R,p as m,s as b,l as P,m as f,h as be,o as i,i as u,q as N,A as M}from"./index-C27Kvpns.js";import{P as ke}from"./PageHeader-DQpAKBca.js";import{_ as G}from"./CopyContent-Bvj04L_G.js";import{G as pe}from"./GroupOwner-ZUh0jJMs.js";const fe={class:"task-audit-detail content-container"},_e={class:"detail-container"},Te={key:0},ve={key:1},he={class:"detail-section"},ye={class:"section-title"},ge={key:0},$e={class:"link-text-container"},Ie=["href"],Ce={class:"detail-section"},Se={class:"section-title"},we={class:"link-text-container"},Ae=["href"],je={key:1},Re={class:"detail-section"},Pe={class:"section-title"},Ne={class:"footer-btns"},qe={class:"left"},Fe={class:"right"},De={__name:"detail",setup(Le){const{t:v}=ue(),w=oe(),D=re(),L=be(),q=D.query.type,E=ce(()=>d.taskPreAuditStatus==="approved"?"confirm":"pre"),A=C(!1),O=C(!1),g=C(""),W=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},h=C(null),d=F({submitContent:{}}),c=F({}),T=F({}),z=async()=>{const e=E.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",o=await M(e,{ids:[h.value]});o.code===0?(f.success(v("submittedTasks.resolveSuccess")),$()):f.error(o.message)},H=()=>{g.value="",A.value=!0},Q=async()=>{if(!g.value){f.error(v("submittedTasks.rejectReasonRequired"));return}O.value=!0;const e=E.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject",o=await M(e,{ids:[h.value],reason:g.value});o.code===0?(f.success(v("submittedTasks.rejectSuccess")),A.value=!1,$()):f.error(o.message)},J=()=>{L.push(`/submitted-tasks/detail/${d.prevTaskId}?type=${q}`),h.value=d.prevTaskId,$()},K=()=>{L.push(`/submitted-tasks/detail/${d.nextTaskId}?type=${q}`),h.value=d.nextTaskId,$()},X=async e=>{try{const o=await P("task.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(c,o.data):f.error(o.message)}catch{f.error(v("submittedTasks.detail.getTaskDetailFailed"))}},Y=async e=>{try{const o=await P("member.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(T,o.data):f.error(o.message)}catch{f.error(v("submittedTasks.detail.getMemberDetailFailed"))}},$=async()=>{try{const e=await P("taskSubmitted.detail",{auditType:q},{urlParams:{id:h.value}});e.code===0&&(Object.assign(d,e.data),e.data.taskId!=null&&await X(e.data.taskId),e.data.memberId!=null&&await Y(e.data.memberId),e.data.taskId!=null&&e.data.memberId!=null&&await Z())}catch{f.error(v("submittedTasks.detail.getDetailFailed"))}},U=C([]),Z=async()=>{const e=await P("account.list",{taskId:d.taskId,memberId:d.memberId,channelId:c.channelId});e.code===0&&(U.value=e.data.list||[])};return me(async()=>{h.value=D.params.id,await $()}),(e,o)=>{const V=p("a-avatar"),y=p("a-space"),l=p("a-descriptions-item"),I=p("a-descriptions"),x=p("a-collapse-panel"),ee=p("a-collapse"),B=p("a-tag"),te=p("a-image"),j=p("a-button"),ae=p("a-textarea"),se=p("a-modal");return i(),k("div",fe,[a(ke,{title:e.$t("submittedTasks.detail.title"),back:!0},null,8,["title"]),r("div",_e,[a(ee,{ghost:"",class:"collapse"},{default:t(()=>[a(x,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(y,null,{default:t(()=>[a(V,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(c.taskName),1)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[u(s(c.category),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[u(s(N(w).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[u(s(c.reward),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[u(s(c.brand),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var n;return[c.groupMode===0?(i(),k("span",Te,s(e.$t("submittedTasks.detail.noSpecify")),1)):(i(),k("span",ve,s((n=c.groupNames)==null?void 0:n.join("、")),1))]}),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[u(s(c.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(c.endTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[u(s(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[u(s(c.fansRequired),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[u(s(c.contentRequirement),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[u(s(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),r("div",he,[r("div",ye,s(e.$t("submittedTasks.detail.memberInfo")),1),a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[a(y,null,{default:t(()=>[r("span",null,s(T.nickname),1),T.isNew?(i(),m(B,{key:0,color:"green"},{default:t(()=>o[2]||(o[2]=[u("new")])),_:1})):b("",!0)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[u(s(T.account),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(i(!0),k(S,null,R(T.groups,n=>(i(),m(y,null,{default:t(()=>[r("span",null,s(n.groupName),1),n.isOwner?(i(),m(pe,{key:0})):b("",!0)]),_:2},1024))),256)),!T.groups||T.groups.length===0?(i(),k("span",ge,"--")):b("",!0)]),_:1},8,["label"])]),_:1}),(i(!0),k(S,null,R(U.value,n=>(i(),k("div",{key:n.channelId},[a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(y,null,{default:t(()=>[a(V,{src:n.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(n.account),1),a(B,{color:"warning"},{default:t(()=>[u(s(N(w).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(l,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(G,{content:n.homeUrl},{default:t(()=>[r("div",$e,[r("a",{href:n.homeUrl,target:"_blank",class:"link-text"},s(n.homeUrl),9,Ie)])]),_:2},1032,["content"])]),_:2},1032,["label"]),n.channelCustomFields.includes("fansCount")?(i(),m(l,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[u(s(n.fansCount),1)]),_:2},1032,["label"])):b("",!0),n.channelCustomFields.includes("friendsCount")?(i(),m(l,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[u(s(n.friendsCount),1)]),_:2},1032,["label"])):b("",!0),n.channelCustomFields.includes("postsCount")?(i(),m(l,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[u(s(n.postsCount),1)]),_:2},1032,["label"])):b("",!0)]),_:2},1024)]))),128))]),r("div",Ce,[r("div",Se,s(e.$t("submittedTasks.detail.submitInfo")),1),a(I,{column:1},{default:t(()=>{var n;return[(i(!0),k(S,null,R((n=d==null?void 0:d.submitContent)==null?void 0:n.customFields,(_,le)=>(i(),m(l,{key:le,label:_.title},{default:t(()=>[_.type==="image"?(i(!0),k(S,{key:0},R(_.value,(ne,ie)=>(i(),m(te,{src:ne.url,width:60,key:ie},null,8,["src"]))),128)):(i(),k(S,{key:1},[W(_.value)?(i(),m(G,{key:0,content:_.value},{default:t(()=>[r("div",we,[r("a",{href:_.value,target:"_blank",class:"link-text"},s(_.value),9,Ae)])]),_:2},1032,["content"])):(i(),k("span",je,s(_.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),r("div",Re,[r("div",Pe,s(e.$t("submittedTasks.detail.auditInfo")),1),a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[u(s(d.submitTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[u(s(N(w).getEnumText("TaskPreAuditStatus",d.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[u(s(d.preWaiterName),1)]),_:1},8,["label"]),d.taskPreAuditStatus==="approved"?(i(),m(l,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[u(s(N(w).getEnumText("TaskAuditStatus",d.taskAuditStatus)),1)]),_:1},8,["label"])):b("",!0),d.taskPreAuditStatus==="approved"?(i(),m(l,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[u(s(d.waiterName),1)]),_:1},8,["label"])):b("",!0),d.auditStatus==="rejected"?(i(),m(l,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[u(s(d.rejectReason),1)]),_:1},8,["label"])):b("",!0)]),_:1})]),r("div",Ne,[r("div",qe,[d.auditStatus==="pending"?(i(),m(y,{key:0},{default:t(()=>[a(j,{type:"primary",onClick:z},{default:t(()=>[u(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(j,{danger:"",onClick:H},{default:t(()=>[u(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):b("",!0)]),r("div",Fe,[a(y,null,{default:t(()=>[d.prevTaskId&&d.prevTaskId!==d.nextTaskId?(i(),m(j,{key:0,onClick:J},{default:t(()=>[u(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):b("",!0),d.nextTaskId?(i(),m(j,{key:1,onClick:K},{default:t(()=>[u(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):b("",!0)]),_:1})])])]),a(se,{open:A.value,"onUpdate:open":o[1]||(o[1]=n=>A.value=n),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:Q,confirmLoading:O.value},{default:t(()=>[a(ae,{value:g.value,"onUpdate:value":o[0]||(o[0]=n=>g.value=n),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Be=de(De,[["__scopeId","data-v-680456d9"]]);export{Be as default};
