import{_ as me,k as ve,r as p,a as H,l as _e,b as C,d as f,c as n,w as l,e as s,i as u,f as ke,o as i,F as O,m as U,n as v,h as r,t as d,g as V,p as y}from"./index-BFTMSDHQ.js";import{e as x,g as ge,f as ye,h as be}from"./enums-Vx4wKXVy.js";import{g as B,p as D}from"./request-iE7dzf1b.js";const he={class:"task-audit content-container"},Se={class:"table-container"},we={class:"table-header"},Ce={class:"left"},Ne={class:"right"},xe={key:1},Ae={class:"group-name"},Ie=["onClick"],Re={__name:"list",setup(Te){const J=ke(),{locale:Q}=ve(),A=p(!1),L=p(!1),b=p(!1),I=p(!1),_=p(""),h=p(null),m=p([]),o=H({taskName:"",channelId:void 0,taskAuditStatus:void 0,groupId:void 0}),G=p([]),z=p([]),W=[{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"平台渠道",dataIndex:"channelName",key:"channelName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:"操作",key:"action",fixed:"right",width:180}],E=p([]),k=H({current:1,pageSize:10,total:0}),X={selectedRowKeys:m,onChange:a=>{m.value=a},getCheckboxProps:a=>({disabled:a.taskAuditStatus!==x.PENDING})},P=a=>ge(ye,a,Q.value),Y=a=>be[a],$=()=>{k.current=1,g()},Z=()=>{o.taskName="",o.channelId=void 0,o.taskAuditStatus=void 0,o.groupId=void 0,$()},ee=a=>{Object.assign(k,a),g()},te=a=>{J.push(`/task-audit/detail/${a.id}`)},ae=async a=>{try{const t=await D("taskSubmitted.batchResolve",{ids:[a.id]});t.code===0?(u.success("审核通过成功"),g()):u.error(t.message)}catch{u.error("审核通过失败")}},le=async()=>{if(!m.value.length){u.warning("请选择要通过的任务");return}try{const a=await D("taskSubmitted.batchResolve",{ids:m.value});a.code===0?(u.success("批量审核通过成功"),m.value=[],g()):u.error(a.message)}catch{u.error("批量审核通过失败")}},ne=a=>{m.value=[a.id],_.value="",b.value=!0},oe=async()=>{if(!_.value){u.error("请输入拒绝原因");return}try{I.value=!0;const a=await D("taskSubmitted.batchReject",{ids:m.value,reason:_.value});a.code===0?(u.success("审核拒绝成功"),b.value=!1,g()):u.error(a.message)}catch{u.error("审核拒绝失败")}finally{I.value=!1}},se=()=>{if(!m.value.length){u.warning("请选择要拒绝的任务");return}_.value="",b.value=!0},ue=async()=>{const a=await B("channel.list");a.code===0&&(G.value=a.data.list)},re=async(a="")=>{try{const t=await B("group.list",{params:{page:1,pageSize:50,keyword:a}});t.code===0&&(z.value=t.data.list||[])}catch{u.error("获取群组列表失败")}},g=async()=>{A.value=!0;try{const a=await B("taskSubmitted.list",{params:{page:k.current,pageSize:k.pageSize,...o}});a.code===0?(E.value=a.data.list,k.total=a.data.total):u.error(a.message)}finally{A.value=!1}};return _e(()=>{g(),re(),ue()}),(a,t)=>{const ie=s("a-input"),S=s("a-form-item"),R=s("a-select-option"),T=s("a-select"),N=s("a-button"),j=s("a-space"),de=s("a-form"),F=s("a-tag"),K=s("a-popconfirm"),ce=s("a-table"),w=s("a-descriptions-item"),pe=s("a-descriptions"),M=s("a-modal"),fe=s("a-textarea");return i(),C("div",he,[f("div",Se,[f("div",we,[f("div",Ce,[n(de,{layout:"inline",model:o},{default:l(()=>[n(S,{label:"任务名称"},{default:l(()=>[n(ie,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=e=>o.taskName=e),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),n(S,{label:"平台渠道"},{default:l(()=>[n(T,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=e=>o.channelId=e),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:l(()=>[(i(!0),C(O,null,U(G.value,e=>(i(),v(R,{key:e.id,value:e.id},{default:l(()=>[r(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(S,{label:"审核状态"},{default:l(()=>[n(T,{value:o.taskAuditStatus,"onUpdate:value":t[2]||(t[2]=e=>o.taskAuditStatus=e),placeholder:"请选择审核状态",style:{width:"120px"},"allow-clear":""},{default:l(()=>[(i(!0),C(O,null,U(Object.values(V(x)),e=>(i(),v(R,{key:e,value:e},{default:l(()=>[r(d(P(e)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(S,{label:"所属群组"},{default:l(()=>[n(T,{value:o.groupId,"onUpdate:value":t[3]||(t[3]=e=>o.groupId=e),placeholder:"请选择群组",style:{width:"120px"},"allow-clear":""},{default:l(()=>[(i(!0),C(O,null,U(z.value,e=>(i(),v(R,{key:e.id,value:e.id},{default:l(()=>[r(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(S,null,{default:l(()=>[n(j,null,{default:l(()=>[n(N,{type:"primary",onClick:$},{default:l(()=>t[7]||(t[7]=[r("查询")])),_:1}),n(N,{onClick:Z},{default:l(()=>t[8]||(t[8]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",Ne,[n(j,null,{default:l(()=>[n(N,{type:"primary",onClick:le},{default:l(()=>t[9]||(t[9]=[r("批量通过")])),_:1}),n(N,{danger:"",onClick:se},{default:l(()=>t[10]||(t[10]=[r("批量拒绝")])),_:1})]),_:1})])]),n(ce,{columns:W,"data-source":E.value,loading:A.value,pagination:k,"row-selection":X,onChange:ee},{bodyCell:l(({column:e,record:c})=>[e.key==="taskAuditStatus"?(i(),v(F,{key:0,color:Y(c.taskAuditStatus)},{default:l(()=>[r(d(P(c.taskAuditStatus)),1)]),_:2},1032,["color"])):y("",!0),e.key==="member"?(i(),C("div",xe,[f("div",null,d(c.memberNickname),1),f("div",Ae,[f("span",null,d(c.groupName),1),c.isGroupOwner?(i(),v(F,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:l(()=>t[11]||(t[11]=[r("群主")])),_:1})):y("",!0)])])):y("",!0),e.key==="action"?(i(),v(j,{key:2},{default:l(()=>[f("a",{onClick:q=>te(c)},"查看",8,Ie),c.taskAuditStatus===V(x).PENDING?(i(),v(K,{key:0,title:"确定要通过该任务吗？",onConfirm:q=>ae(c)},{default:l(()=>t[12]||(t[12]=[f("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):y("",!0),c.taskAuditStatus===V(x).PENDING?(i(),v(K,{key:1,title:"确定要拒绝该任务吗？",onConfirm:q=>ne(c)},{default:l(()=>t[13]||(t[13]=[f("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):y("",!0)]),_:2},1024)):y("",!0)]),_:1},8,["data-source","loading","pagination"])]),n(M,{open:L.value,"onUpdate:open":t[4]||(t[4]=e=>L.value=e),title:"任务详情",footer:null},{default:l(()=>[n(pe,{column:1},{default:l(()=>[n(w,{label:"任务名称"},{default:l(()=>{var e;return[r(d((e=h.value)==null?void 0:e.taskName),1)]}),_:1}),n(w,{label:"任务类型"},{default:l(()=>{var e;return[r(d((e=h.value)==null?void 0:e.taskType),1)]}),_:1}),n(w,{label:"任务描述"},{default:l(()=>{var e;return[r(d((e=h.value)==null?void 0:e.description),1)]}),_:1}),n(w,{label:"任务奖励"},{default:l(()=>{var e;return[r(d((e=h.value)==null?void 0:e.reward),1)]}),_:1}),n(w,{label:"创建时间"},{default:l(()=>{var e;return[r(d((e=h.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),n(M,{open:b.value,"onUpdate:open":t[6]||(t[6]=e=>b.value=e),title:"拒绝原因",onOk:oe,confirmLoading:I.value},{default:l(()=>[n(fe,{value:_.value,"onUpdate:value":t[5]||(t[5]=e=>_.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ve=me(Re,[["__scopeId","data-v-f0dce204"]]);export{Ve as default};
