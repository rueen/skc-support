import{_ as we,b as fe,a as ge,r as p,c as R,j as ke,B as he,k as $e,x as ye,d as $,f as t,e as o,t as s,w as a,g as i,F as H,n as W,l as _,h as Ce,o as d,p as y,s as w,i as m,q as N,M as Ae,v as Re,m as b,A as J}from"./index-Zd-ynkfs.js";import{P as Se}from"./PageHeader-AmYf8afu.js";import{_ as F}from"./CopyContent-BM_oyFxQ.js";import{G as Ie}from"./GroupOwner-COwOuQqP.js";const Oe={class:"member-view content-container"},Te={class:"detail-container"},Ee={class:"section"},Ue={class:"section-title"},Pe={key:0},De={key:0},Ne={class:"section"},Fe={class:"section-title"},Ge={class:"account-list"},Be={class:"link-text-container",style:{"max-width":"300px"}},Le=["href"],Me={class:"section",style:{"padding-bottom":"24px"}},je={class:"section-title"},qe={class:"section",style:{"padding-bottom":"24px"}},ze={class:"section-title"},Ve={class:"section"},He={class:"section-title"},We={__name:"view",setup(Je){const{t:I}=fe(),O=ge(),K=ye(),Q=Ce(),c=p(""),l=R({}),G=p([]),X=ke(()=>`${he.h5Url}?inviteCode=${l.inviteCode}`),T=R({}),E=R({}),U=R({}),B=p(),f=p(!1),C=p("grant"),v=R({amount:"",remark:""}),A=p(!1),Y=p({amount:[{required:!0,message:I("member.view.amountRequired")}],remark:[{required:!0,message:I("member.view.remarkRequired")}]}),Z=async()=>{const e=await _("member.detail",{},{urlParams:{id:c.value}});e.code===0&&Object.assign(l,e.data||{})},P=async()=>{const e=await _("member.balance",{},{urlParams:{memberId:c.value}});e.code===0&&(l.balance=e.data.balance)},x=async()=>{const e=await _("member.withdrawalsAccount",{},{urlParams:{memberId:c.value}});e.code===0&&(l.withdrawalsAccount=e.data[0]||{})},L=async()=>{const e=await _("account.list",{memberId:c.value});e.code===0&&(G.value=e.data.list||[])},ee=e=>{Q.push({name:"AccountEdit",params:{id:e.id}})},te=e=>{Ae.confirm({content:I("common.deleteConfirm"),onOk:async()=>{const u=await Re("account.delete",{},{urlParams:{id:e.id}});u.code===0?(b.success(u.message),L()):b.error(u.message)}})},ae=async()=>{const e=await _("member.taskStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(T,e.data||{})},ne=async()=>{const e=await _("member.inviteStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(E,e.data||{})},le=async()=>{const e=await _("member.groupsStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(U,e.data||{})},se=()=>{f.value=!0,C.value="grant"},oe=()=>{f.value=!0,C.value="deduct"},re=async()=>{A.value=!0;try{const e=await J("member.grantReward",{memberId:c.value,amount:v.amount,remark:v.remark});e.code===0?(b.success("奖励发放成功"),f.value=!1,P()):b.error(e.message)}catch{b.error("奖励发放失败")}finally{A.value=!1}},ie=async()=>{A.value=!0;try{const e=await J("member.deductReward",{memberId:c.value,amount:v.amount,remark:v.remark},{urlParams:{memberId:c.value}});e.code===0?(b.success("奖励扣除成功"),f.value=!1,P()):b.error(e.message)}catch{b.error("奖励扣除失败")}finally{A.value=!1}},ue=async()=>{try{switch(await B.value.validate(),C.value){case"grant":re();break;case"deduct":ie();break}}catch(e){console.log(e)}};return $e(()=>{c.value=K.params.id,Z(),P(),L(),ae(),ne(),le(),x()}),(e,u)=>{const me=i("UserOutlined"),M=i("a-avatar"),j=i("a-tag"),g=i("a-space"),r=i("a-descriptions-item"),q=i("a-button"),z=i("a-descriptions"),de=i("EditOutlined"),ce=i("DeleteOutlined"),k=i("a-statistic"),h=i("a-col"),D=i("a-row"),ve=i("a-input"),V=i("a-form-item"),be=i("a-textarea"),pe=i("a-form"),_e=i("a-modal");return d(),$("div",Oe,[t(Se,{title:e.$t("member.view.pageTitle"),back:!0},null,8,["title"]),o("div",Te,[o("div",Ee,[o("div",Ue,s(e.$t("member.view.memberInfo")),1),t(z,{column:2},{default:a(()=>[t(r,{label:e.$t("member.view.memberNickname")},{default:a(()=>[t(g,null,{default:a(()=>[t(M,{src:l.avatar,size:"small"},{icon:a(()=>[t(me)]),_:1},8,["src"]),o("span",null,s(l.nickname),1),l.isNew?(d(),y(j,{key:0,color:"green"},{default:a(()=>u[5]||(u[5]=[m("new")])),_:1})):w("",!0)]),_:1})]),_:1},8,["label"]),t(r,{label:e.$t("member.view.memberAccount")},{default:a(()=>[m(s(l.account),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.gender")},{default:a(()=>[m(s(N(O).getEnumText("GenderType",l.gender)),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.occupation")},{default:a(()=>[m(s(N(O).getEnumText("OccupationType",l.occupation))+" ",1),l.occupation===null?(d(),$("span",Pe," - ")):w("",!0)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.email")},{default:a(()=>[m(s(l.email||"-"),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.phone")},{default:a(()=>[m(s(l.phone||"-"),1)]),_:1},8,["label"]),t(r,{label:"Telegram"},{default:a(()=>[m(s(l.telegram||"-"),1)]),_:1}),t(r,{label:e.$t("member.view.group")},{default:a(()=>[(d(!0),$(H,null,W(l.groups,n=>(d(),y(g,{key:n.id},{default:a(()=>[m(s(n.groupName)+" ",1),n.isOwner?(d(),y(Ie,{key:0})):w("",!0)]),_:2},1024))),128)),!l.groups||!l.groups.length?(d(),$("span",De," - ")):w("",!0)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.inviter")},{default:a(()=>[m(s(l.inviterNickname||"-"),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.inviteUrl")},{default:a(()=>[t(F,{content:X.value},null,8,["content"])]),_:1},8,["label"]),t(r,{label:e.$t("member.view.withdrawalsAccount")},{default:a(()=>[t(g,null,{default:a(()=>{var n,S;return[o("span",null,s(((n=l==null?void 0:l.withdrawalsAccount)==null?void 0:n.paymentChannelName)||"-"),1),o("span",null,s(((S=l==null?void 0:l.withdrawalsAccount)==null?void 0:S.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),t(r,{label:e.$t("member.view.balance")},{default:a(()=>[t(g,null,{default:a(()=>[o("span",null,s(l.balance),1),t(q,{type:"link",size:"small",onClick:u[0]||(u[0]=n=>se())},{default:a(()=>[m(s(e.$t("member.view.rewardGrant")),1)]),_:1}),t(q,{type:"link",size:"small",onClick:u[1]||(u[1]=n=>oe())},{default:a(()=>[m(s(e.$t("member.view.rewardDeduct")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),o("div",Ne,[o("div",Fe,s(e.$t("member.view.accountInfo")),1),o("div",Ge,[(d(!0),$(H,null,W(G.value,n=>(d(),$("div",{key:n.channelId},[t(z,{column:1},{default:a(()=>[t(r,{label:e.$t("member.view.account")},{default:a(()=>[t(g,{size:24},{default:a(()=>[t(g,null,{default:a(()=>[t(M,{src:n.channelIcon,size:"small"},null,8,["src"]),o("span",null,s(n.account),1),t(j,{color:"warning"},{default:a(()=>[m(s(N(O).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024),t(de,{onClick:S=>ee(n)},null,8,["onClick"]),t(ce,{onClick:S=>te(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),t(r,{label:e.$t("member.view.homepage")},{default:a(()=>[t(F,{content:n.homeUrl},{default:a(()=>[o("div",Be,[o("a",{href:n.homeUrl,target:"_blank",class:"link-text"},s(n.homeUrl),9,Le)])]),_:2},1032,["content"])]),_:2},1032,["label"]),t(r,{label:"uid"},{default:a(()=>[t(F,{content:n.uid},null,8,["content"])]),_:2},1024),n.channelCustomFields.includes("fansCount")?(d(),y(r,{key:0,label:e.$t("member.view.fansCount")},{default:a(()=>[m(s(n.fansCount),1)]),_:2},1032,["label"])):w("",!0),n.channelCustomFields.includes("friendsCount")?(d(),y(r,{key:1,label:e.$t("member.view.friendsCount")},{default:a(()=>[m(s(n.friendsCount),1)]),_:2},1032,["label"])):w("",!0),n.channelCustomFields.includes("postsCount")?(d(),y(r,{key:2,label:e.$t("member.view.postsCount")},{default:a(()=>[m(s(n.postsCount),1)]),_:2},1032,["label"])):w("",!0)]),_:2},1024)]))),128))])]),o("div",Me,[o("div",je,s(e.$t("member.view.taskStats")),1),t(D,{gutter:16},{default:a(()=>[t(h,{span:6},{default:a(()=>[t(k,{title:e.$t("member.view.completedTaskCount"),value:T.completedTaskCount},null,8,["title","value"])]),_:1}),t(h,{span:6},{default:a(()=>[t(k,{title:e.$t("member.view.taskReward"),value:T.taskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),o("div",qe,[o("div",ze,s(e.$t("member.view.inviteStats")),1),t(D,null,{default:a(()=>[t(h,{span:6},{default:a(()=>[t(k,{title:e.$t("member.view.inviteCount"),value:E.inviteCount},null,8,["title","value"])]),_:1}),t(h,{span:6},{default:a(()=>[t(k,{title:e.$t("member.view.inviteReward"),value:E.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),o("div",Ve,[o("div",He,s(e.$t("member.view.groupStats")),1),t(D,null,{default:a(()=>[t(h,{span:6},{default:a(()=>[t(k,{title:e.$t("member.view.groupCount"),value:U.groupCount},null,8,["title","value"])]),_:1}),t(h,{span:6},{default:a(()=>[t(k,{title:e.$t("member.view.groupEarnings"),value:U.totalEarnings},null,8,["title","value"])]),_:1})]),_:1})])]),t(_e,{open:f.value,"onUpdate:open":u[4]||(u[4]=n=>f.value=n),title:C.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:ue,confirmLoading:A.value},{default:a(()=>[t(pe,{ref_key:"rewardFormRef",ref:B,model:v,rules:Y.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:a(()=>[t(V,{label:C.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:a(()=>[t(ve,{value:v.amount,"onUpdate:value":u[2]||(u[2]=n=>v.amount=n)},null,8,["value"])]),_:1},8,["label"]),t(V,{label:e.$t("member.view.remark"),name:"remark"},{default:a(()=>[t(be,{value:v.remark,"onUpdate:value":u[3]||(u[3]=n=>v.remark=n),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"])])}}},Ze=we(We,[["__scopeId","data-v-894a06a7"]]);export{Ze as default};
