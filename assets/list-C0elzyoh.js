import{_ as Z,a as ee,b as te,r as x,c as A,x as oe,j as ae,k as ne,d as m,e as i,f as o,w as t,g as c,l as E,m as f,h as se,o as a,F as b,n as I,p as y,i as p,t as n,s as _,q as le,M as re,v as ie}from"./index-D8kOh7io.js";import{_ as ce}from"./CopyContent-ma2SbJZ7.js";import{G as ue}from"./GroupOwner-DUqKwmW8.js";import{d as de}from"./download-fhj8958R.js";const me={class:"member-list content-container"},pe={class:"table-container"},_e={class:"table-header"},ge={class:"left"},ke={class:"right"},fe={key:1,style:{display:"inline-block"}},he={class:"link-text-container"},ye={class:"label"},be=["href"],ve={key:0},we=["onClick"],Ce=["onClick"],$e={class:"danger"},Se={__name:"list",setup(Ne){const B=ee(),{t:l}=te(),C=se(),L=oe(),$=x(!1),g=A({keyword:"",groupId:L.query.groupId}),S=x([]),k=A({current:1,pageSize:10,total:0}),T=x([]),U=ae(()=>[{title:l("member.list.memberNickname"),key:"nickname"},{title:l("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:l("member.list.accounts"),key:"accountList"},{title:l("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:l("member.list.inviter"),key:"inviterNickname"},{title:l("member.list.group"),key:"groups"},{title:l("member.list.updateTime"),dataIndex:"updateTime",key:"updateTime",width:180},{title:l("member.list.action"),key:"action",fixed:"right",width:150}]),D=()=>{k.current=1,v()},V=()=>{Object.assign(g,{keyword:"",groupId:void 0}),D()},F=e=>{k.current=e.current,k.pageSize=e.pageSize,v()},M=()=>{C.push("/member/create")},G=e=>{C.push(`/member/edit/${e.id}`)},P=e=>{C.push(`/member/view/${e.id}`)},R=async e=>{const s=await ie("member.delete",{},{urlParams:{id:e.id}});s.code===0?(f.success("删除成功"),v()):f.error(s.message)},v=async()=>{$.value=!0;try{const e=await E("member.list",{page:k.current,pageSize:k.pageSize,...g});e.code===0?(S.value=e.data.list,k.total=e.data.total):f.error(e.message)}finally{$.value=!1}},O=async(e="")=>{try{const s=await E("group.list",{page:1,pageSize:50,groupName:e});s.code===0&&(T.value=s.data.list||[])}catch{f.error("获取群组列表失败")}},j=()=>{re.confirm({title:l("common.export"),content:l("common.confirmExportContent"),onOk:async()=>{try{const e=f.loading(l("common.exporting"),0),s={...g};await de("member.export",s,`会员列表_${new Date().toLocaleDateString()}.xlsx`),e(),f.success(l("common.exportSuccess"))}catch(e){console.error("导出失败:",e),f.error(l("common.exportFailed"))}}})};return ne(()=>{v(),O()}),(e,s)=>{const q=c("a-input"),N=c("a-form-item"),H=c("a-select-option"),J=c("a-select"),w=c("a-button"),h=c("a-space"),K=c("a-form"),Q=c("DownloadOutlined"),W=c("plus-outlined"),z=c("a-tag"),X=c("a-popconfirm"),Y=c("a-table");return a(),m("div",me,[i("div",pe,[i("div",_e,[i("div",ge,[o(K,{layout:"inline",model:g},{default:t(()=>[o(N,{label:e.$t("member.search.keyword")},{default:t(()=>[o(q,{value:g.keyword,"onUpdate:value":s[0]||(s[0]=r=>g.keyword=r),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(N,{label:e.$t("member.search.group")},{default:t(()=>[o(J,{value:g.groupId,"onUpdate:value":s[1]||(s[1]=r=>g.groupId=r),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:O,style:{width:"200px"}},{default:t(()=>[(a(!0),m(b,null,I(T.value,r=>(a(),y(H,{key:r.id,value:r.id},{default:t(()=>[p(n(r.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(N,null,{default:t(()=>[o(h,null,{default:t(()=>[o(w,{type:"primary",onClick:D},{default:t(()=>[p(n(e.$t("common.search")),1)]),_:1}),o(w,{onClick:V},{default:t(()=>[p(n(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",ke,[o(h,null,{default:t(()=>[S.value.length?(a(),y(w,{key:0,onClick:j},{icon:t(()=>[o(Q)]),default:t(()=>[p(" "+n(e.$t("common.export")),1)]),_:1})):_("",!0),o(w,{type:"primary",onClick:M},{icon:t(()=>[o(W)]),default:t(()=>[p(" "+n(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),o(Y,{columns:U.value,"data-source":S.value,loading:$.value,pagination:k,onChange:F},{bodyCell:t(({column:r,record:d})=>[r.key==="nickname"?(a(),y(h,{key:0},{default:t(()=>[i("span",null,n(d.nickname),1),d.isNew?(a(),y(z,{key:0,color:"green"},{default:t(()=>s[2]||(s[2]=[p("new")])),_:1})):_("",!0)]),_:2},1024)):_("",!0),r.key==="accountList"?(a(),m("div",fe,[(a(!0),m(b,null,I(d.accountList,u=>(a(),m("div",null,[i("div",null,[o(h,null,{default:t(()=>[p(n(e.$t("member.list.account"))+"："+n(u.account)+" ",1),o(z,{color:"warning"},{default:t(()=>[p(n(le(B).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),i("div",he,[i("span",ye,n(e.$t("member.list.homepage"))+"：",1),o(ce,{content:u.homeUrl},{default:t(()=>[i("a",{href:u.homeUrl,target:"_blank",class:"link-text"},n(u.homeUrl),9,be)]),_:2},1032,["content"])])]))),256))])):_("",!0),r.key==="inviterNickname"?(a(),m(b,{key:2},[p(n(d.inviterNickname||"--"),1)],64)):_("",!0),r.key==="groups"?(a(),m(b,{key:3},[(a(!0),m(b,null,I(d.groups,u=>(a(),m("div",null,[o(h,null,{default:t(()=>[i("span",null,n(u.groupName),1),u.isOwner?(a(),y(ue,{key:0})):_("",!0)]),_:2},1024)]))),256)),!d.groups||d.groups.length===0?(a(),m("span",ve,"--")):_("",!0)],64)):_("",!0),r.key==="action"?(a(),y(h,{key:4},{default:t(()=>[i("a",{onClick:u=>G(d)},n(e.$t("member.list.edit")),9,we),i("a",{onClick:u=>P(d)},n(e.$t("member.list.view")),9,Ce),o(X,{title:e.$t("member.list.deleteConfirm"),onConfirm:u=>R(d)},{default:t(()=>[i("a",$e,n(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Oe=Z(Se,[["__scopeId","data-v-c19352d7"]]);export{Oe as default};
