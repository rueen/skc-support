import{_ as Z,i as ee,r as x,a as B,j as te,b as g,d as _,c as s,w as a,e as l,k as r,f as ae,o as c,F as R,l as j,m as p,h as u,t as N,g as m,D as se,P as ne,n as h,M as oe}from"./index-CrTl1_Bc.js";import{T as w,g as le,a as ce,b as ie}from"./enums-u5GZanCL.js";import{g as y}from"./request-DxnL66JX.js";const re={class:"task content-container"},ue={class:"table-container"},de={class:"table-header"},_e={class:"left"},pe={class:"right"},me=["onClick"],fe=["onClick"],ke={__name:"list",setup(ve){const C=ae(),{locale:z}=ee(),T=x(!1),o=B({taskName:"",channelId:void 0,status:void 0}),I=x([]),A=[{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"平台渠道",dataIndex:"channelName",key:"channelName"},{title:"任务状态",dataIndex:"status",key:"status"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",fixed:"right",width:180}],S=x([]),d=B({current:1,pageSize:10,total:0}),O=e=>le(ce,e,z.value),F=e=>ie[e],D=()=>{d.current=1,f()},L=()=>{o.taskName="",o.channelId=void 0,o.status=void 0,D()},M=e=>{Object.assign(d,e),f()},U=()=>{C.push("/task/create")},P=e=>{C.push(`/task/edit/${e.id}`)},q=e=>{C.push(`/task/view/${e.id}`)},G=async e=>{try{const t=await y("task.delete",{id:e.id});t.success?(r.success("删除成功"),f()):r.error(t.message)}catch{r.error("删除失败")}},H=()=>{oe.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const e={taskName:o.taskName,channelId:o.channelId},t=await y("task.export",e);t.success?r.success("导出成功"):r.error(t.message)}catch{r.error("导出失败")}}})},f=async()=>{T.value=!0;try{const e=await y("task.list",{params:{page:d.current,pageSize:d.pageSize,...o}});e.success?(S.value=e.data.list,d.total=e.data.total):r.error(e.message)}finally{T.value=!1}},J=async()=>{const e=await y("channel.list");e.success&&(I.value=e.data.list)};return te(()=>{f(),J()}),(e,t)=>{const K=l("a-input"),k=l("a-form-item"),E=l("a-select-option"),V=l("a-select"),v=l("a-button"),b=l("a-space"),Q=l("a-form"),W=l("a-tag"),X=l("a-popconfirm"),Y=l("a-table");return c(),g("div",re,[_("div",ue,[_("div",de,[_("div",_e,[s(Q,{layout:"inline",model:o},{default:a(()=>[s(k,{label:"任务名称"},{default:a(()=>[s(K,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=n=>o.taskName=n),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),s(k,{label:"平台渠道"},{default:a(()=>[s(V,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=n=>o.channelId=n),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(c(!0),g(R,null,j(I.value,n=>(c(),p(E,{key:n.id,value:n.id},{default:a(()=>[u(N(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(k,{label:"任务状态"},{default:a(()=>[s(V,{value:o.status,"onUpdate:value":t[2]||(t[2]=n=>o.status=n),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(c(!0),g(R,null,j(Object.values(m(w)),n=>(c(),p(E,{key:n,value:n},{default:a(()=>[u(N(O(n)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(k,null,{default:a(()=>[s(b,null,{default:a(()=>[s(v,{type:"primary",onClick:D},{default:a(()=>t[3]||(t[3]=[u("查询")])),_:1}),s(v,{onClick:L},{default:a(()=>t[4]||(t[4]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",pe,[s(b,null,{default:a(()=>[s(v,{onClick:H},{icon:a(()=>[s(m(se))]),default:a(()=>[t[5]||(t[5]=u(" 导出 "))]),_:1}),s(v,{type:"primary",onClick:U},{icon:a(()=>[s(m(ne))]),default:a(()=>[t[6]||(t[6]=u(" 新建任务 "))]),_:1})]),_:1})])]),s(Y,{columns:A,"data-source":S.value,loading:T.value,pagination:d,onChange:M},{bodyCell:a(({column:n,record:i})=>[n.key==="status"?(c(),p(W,{key:0,color:F(i.status)},{default:a(()=>[u(N(O(i.status)),1)]),_:2},1032,["color"])):h("",!0),n.key==="action"?(c(),p(b,{key:1},{default:a(()=>[_("a",{onClick:$=>q(i)},"查看",8,me),i.status===m(w).NOT_STARTED?(c(),g("a",{key:0,onClick:$=>P(i)},"编辑",8,fe)):h("",!0),i.status===m(w).NOT_STARTED?(c(),p(X,{key:1,title:"确定要删除该任务吗？",onConfirm:$=>G(i)},{default:a(()=>t[7]||(t[7]=[_("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])):h("",!0)]),_:2},1024)):h("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},Ce=Z(ke,[["__scopeId","data-v-895a583e"]]);export{Ce as default};
