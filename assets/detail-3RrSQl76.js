import{_ as ae,a as te,b as se,r as f,c as V,j as F,B as Y,k as le,p as B,o as k,w as t,e as O,f as a,g as l,d as P,n as Z,F as x,i as v,t as c,s as U,q as ne,l as A,m as L,x as ue,y as ee,h as me}from"./index-mVxVchfl.js";import{P as pe}from"./PageHeader-DzzyoSGi.js";const ke={class:"select-task-modal"},fe={class:"filter-form"},ve={class:"selected-info"},_e={key:1},he={__name:"SelectTask",props:{visible:{type:Boolean,default:!1},selectedId:{type:Array,default:()=>[]}},emits:["update:visible","confirm","cancel"],setup(K,{emit:y}){const $=te(),{t:w}=se(),_=K,N=y,I=f(!1),G=f(!1),u=f([]),r=V({taskName:"",channelId:void 0,taskStatus:void 0}),C=f([]),H=F(()=>$.loaded?$.getEnumOptions("TaskStatus"):[]),T=F(()=>[{title:w("task.list.name"),key:"taskName",width:200},{title:w("task.list.status"),key:"taskStatus",width:100},{title:w("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:w("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0}]),E=f([]),h=V({current:1,pageSize:10,total:0}),j=V({sorterField:"startTime",sorterOrder:"ascend"}),M=F(()=>({selectedRowKeys:u.value,onChange:(e,d)=>{J(e)},getCheckboxProps:e=>({disabled:!1})})),J=(e,d)=>{const b=E.value.map(S=>S.id),g=u.value.filter(S=>!b.includes(S));u.value=[...g,...e]},q=()=>{h.current=1,n()},Q=()=>{r.taskName="",r.channelId=void 0,r.taskStatus=void 0,q()},W=(e,d,b)=>{Object.assign(h,e),Object.assign(j,{sorterField:b.field,sorterOrder:b.order}),n()},X=()=>{N("confirm",{taskIds:u.value}),s()},s=()=>{N("update:visible",!1),N("cancel")},n=async()=>{I.value=!0;try{const e=await A("task.list",{page:h.current,pageSize:h.pageSize,...j,...r});e.code===0?(E.value=e.data.list,h.total=e.data.total):L.error(e.message)}finally{I.value=!1}},i=async()=>{const e=await A("channel.list");e.code===0&&(C.value=e.data.list)},m=()=>{_.selectedId&&_.selectedId.length>0&&(u.value=[..._.selectedId])};return Y(()=>_.visible,e=>{e?(n(),C.value.length||i(),m()):(u.value=[],h.current=1)}),Y(()=>_.selectedId,()=>{_.visible&&m()},{deep:!0}),le(()=>{_.visible&&(n(),i(),m())}),(e,d)=>{const b=l("a-input"),g=l("a-form-item"),S=l("a-select-option"),D=l("a-select"),p=l("a-button"),R=l("a-space"),oe=l("a-form"),re=l("a-alert"),ie=l("a-avatar"),de=l("a-table"),ce=l("a-modal");return k(),B(ce,{open:K.visible,title:e.$t("task.selectTask.title"),width:900,"confirm-loading":G.value,onOk:X,onCancel:s},{default:t(()=>[O("div",ke,[O("div",fe,[a(oe,{layout:"inline",model:r},{default:t(()=>[a(g,{label:e.$t("task.search.taskName")},{default:t(()=>[a(b,{value:r.taskName,"onUpdate:value":d[0]||(d[0]=o=>r.taskName=o),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(g,{label:e.$t("task.search.channelId")},{default:t(()=>[a(D,{value:r.channelId,"onUpdate:value":d[1]||(d[1]=o=>r.channelId=o),placeholder:e.$t("task.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(k(!0),P(x,null,Z(C.value,o=>(k(),B(S,{key:o.id,value:o.id},{default:t(()=>[v(c(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(g,{label:e.$t("task.search.taskStatus")},{default:t(()=>[a(D,{value:r.taskStatus,"onUpdate:value":d[2]||(d[2]=o=>r.taskStatus=o),placeholder:e.$t("task.search.statusPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:t(()=>[(k(!0),P(x,null,Z(H.value,o=>(k(),B(S,{key:o.value,value:o.value},{default:t(()=>[v(c(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(g,null,{default:t(()=>[a(R,null,{default:t(()=>[a(p,{type:"primary",onClick:q},{default:t(()=>[v(c(e.$t("common.search")),1)]),_:1}),a(p,{onClick:Q},{default:t(()=>[v(c(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),O("div",ve,[a(re,{message:e.$t("task.selectTask.selectedCount",{count:u.value.length}),type:"info","show-icon":""},null,8,["message"])]),a(de,{columns:T.value,"data-source":E.value,loading:I.value,pagination:h,"row-selection":M.value,rowKey:"id",onChange:W,size:"middle"},{bodyCell:t(({column:o,record:z})=>[o.key==="taskName"?(k(),B(R,{key:0},{default:t(()=>[a(ie,{src:z.channelIcon,size:"small"},null,8,["src"]),O("span",null,c(z.taskName),1)]),_:2},1024)):U("",!0),o.key==="taskTime"?(k(),P("div",_e,c(z.startTime)+" - "+c(z.endTime),1)):U("",!0),o.key==="taskStatus"?(k(),P(x,{key:2},[v(c(ne($).getEnumText("TaskStatus",z.taskStatus)),1)],64)):U("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])])]),_:1},8,["open","title","confirm-loading"])}}},ge=ae(he,[["__scopeId","data-v-e561a7df"]]),ye={class:"task-form content-container"},Te={__name:"detail",setup(K){const{t:y}=se(),$=te(),w=ue(),_=me(),N=f(),I=F(()=>w.name==="TaskEdit"),G=f(!1),u=f([]),r=f([]),C=f(!1),H=F(()=>[{title:y("task.list.name"),key:"taskName"},{title:y("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:s})=>$.getEnumText("TaskStatus",s)},{title:y("task.list.startTime"),dataIndex:"startTime",key:"startTime"},{title:y("task.list.endTime"),dataIndex:"endTime",key:"endTime"}]),T=V({taskGroupName:"",taskGroupReward:0}),E={taskGroupName:[{required:!0,message:y("task.group.validation.taskGroupNameRequired")}],taskGroupReward:[{required:!0,message:y("task.group.validation.taskGroupRewardRequired")}]},h=()=>{G.value=!0},j=({taskIds:s})=>{u.value=s,M()},M=async()=>{try{C.value=!0;const s=await A("task.list",{page:1,pageSize:100,sorterField:"startTime",sorterOrder:"ascend",taskIds:u.value});s.code===0?r.value=s.data.list:L.error(s.message)}catch(s){L.error(s)}finally{C.value=!1}},J=async()=>{},q=async()=>{};f(!1);const Q=()=>{N.value.validate().then(async()=>{I.value?await q():await J()})},W=()=>{_.back()},X=async s=>{try{const n=await A("task.detail",{},{urlParams:{id:s}});if(n.code===0){let i={};for(let m in n.data)m!=="groups"&&(i[m]=n.data[m]);i.startTime&&(i.startTime=ee(i.startTime)),i.endTime&&(i.endTime=ee(i.endTime)),Object.assign(T,i)}}catch(n){console.log(n),L.error(n)}};return le(()=>{I.value&&X(w.params.id)}),(s,n)=>{const i=l("a-input"),m=l("a-form-item"),e=l("a-input-number"),d=l("a-button"),b=l("a-avatar"),g=l("a-space"),S=l("a-table"),D=l("a-form");return k(),P("div",ye,[a(pe,{title:I.value?s.$t("task.group.editTitle"):s.$t("task.group.createTitle"),back:!0,class:"page-header"},null,8,["title"]),O("div",null,[a(D,{ref_key:"formRef",ref:N,model:T,rules:E,"label-col":{span:3},"wrapper-col":{span:19},layout:"horizontal"},{default:t(()=>[a(m,{label:s.$t("task.group.name")},{default:t(()=>[a(i,{value:T.taskGroupName,"onUpdate:value":n[0]||(n[0]=p=>T.taskGroupName=p),placeholder:s.$t("common.inputPlaceholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(m,{label:s.$t("task.group.reward")},{default:t(()=>[a(e,{value:T.taskGroupReward,"onUpdate:value":n[1]||(n[1]=p=>T.taskGroupReward=p),min:0,precision:2,step:.1,placeholder:s.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(m,{label:s.$t("task.group.relatedTask")},{default:t(()=>[O("div",null,[a(d,{type:"primary",onClick:h},{default:t(()=>[v(c(s.$t("task.group.selectTaskBtnText",{count:u.value.length})),1)]),_:1}),a(S,{columns:H.value,"data-source":r.value,loading:C.value,pagination:!1,style:{"margin-top":"10px"}},{bodyCell:t(({column:p,record:R})=>[p.key==="taskName"?(k(),B(g,{key:0},{default:t(()=>[a(b,{src:R.channelIcon},null,8,["src"]),v(" "+c(R.taskName),1)]),_:2},1024)):U("",!0),p.key==="taskStatus"?(k(),P(x,{key:1},[v(c(ne($).getEnumText("TaskStatus",R.taskStatus)),1)],64)):U("",!0)]),_:1},8,["columns","data-source","loading"])])]),_:1},8,["label"]),a(m,{"wrapper-col":{span:16,offset:4}},{default:t(()=>[a(g,null,{default:t(()=>[a(d,{type:"primary",onClick:Q},{default:t(()=>[v(c(s.$t("common.submit")),1)]),_:1}),a(d,{onClick:W},{default:t(()=>[v(c(s.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),a(ge,{visible:G.value,"onUpdate:visible":n[2]||(n[2]=p=>G.value=p),selectedId:u.value,onConfirm:j},null,8,["visible","selectedId"])])}}},we=ae(Te,[["__scopeId","data-v-3e413df0"]]);export{we as default};
