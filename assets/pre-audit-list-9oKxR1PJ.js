import{_ as _e,i as ke,j as ge,r as v,a as F,k as ye,b as g,d as p,c as n,w as a,e as s,l as D,m as c,f as be,o as u,F as A,n as U,p as _,h as i,t as r,q as k,g as W,D as we,M as Se,z as G}from"./index-DfdbcBxU.js";import{d as he}from"./download-CHU6dqCT.js";const Ce={class:"task-audit content-container"},xe={class:"table-container"},Ae={class:"table-header"},Te={style:{width:"100%",display:"flex","justify-content":"space-between"}},Ne={key:3},Pe={class:"group-name"},Re=["onClick"],Ie={__name:"pre-audit-list",setup(Oe){const N=ke(),K=ge(()=>N.loaded?N.getEnumOptions("TaskPreAuditStatus"):[]),q=be(),P=v(!1),M=v(!1),w=v(!1),Y=v(!1),y=v(""),S=v(null),f=v([]),o=F({taskName:"",channelId:void 0,taskPreAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),B=v([]),E=v([]),J=[{title:"任务名称",key:"taskName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskPreAuditStatus",key:"taskPreAuditStatus"},{title:"初审员",key:"preWaiterName"},{title:"操作",key:"action",fixed:"right",width:180}],R=v([]),b=F({current:1,pageSize:10,total:0}),Q={selectedRowKeys:f,onChange:l=>{f.value=l},getCheckboxProps:l=>({disabled:l.taskPreAuditStatus!=="pending"})},L=()=>{b.current=1,h()},X=()=>{Object.assign(o,{taskName:"",channelId:void 0,taskPreAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),L()},Z=l=>{Object.assign(b,l),h()},ee=l=>{q.push(`/submitted-tasks/detail/${l.id}?type=pre`)},te=async l=>{f.value=[l.id],V()},V=async()=>{if(!f.value.length){c.warning("请选择要通过的任务");return}const l=await G("taskSubmitted.batchPreAuditApprove",{ids:f.value});l.code===0?(c.success("批量审核通过成功"),f.value=[],h()):c.error(l.message)},ae=l=>{f.value=[l.id],y.value="",w.value=!0},ne=async()=>{if(!y.value){c.error("请输入拒绝原因");return}Y.value=!0;const l=await G("taskSubmitted.batchPreAuditReject",{ids:f.value,reason:y.value});l.code===0?(c.success("审核拒绝成功"),w.value=!1,h()):c.error(l.message)},le=()=>{if(!f.value.length){c.warning("请选择要拒绝的任务");return}y.value="",w.value=!0},oe=async()=>{const l=await D("channel.list");l.code===0&&(B.value=l.data.list)},se=()=>{Se.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const l=c.loading("正在导出数据，请稍候...",0),t={...o};await he("taskSubmitted.preAuditExport",t,`初审列表_${new Date().toLocaleDateString()}.xlsx`),l(),c.success("导出成功")}catch(l){console.error("导出失败:",l),c.error("导出失败，请稍后重试")}}})},ue=async(l="")=>{try{const t=await D("group.list",{params:{page:1,pageSize:50,keyword:l}});t.code===0&&(E.value=t.data.list||[])}catch{c.error("获取群组列表失败")}},h=async()=>{var l,t;P.value=!0;try{const I={page:b.current,pageSize:b.pageSize,taskName:o.taskName,channelId:o.channelId,taskPreAuditStatus:o.taskPreAuditStatus,groupId:o.groupId,submitStartTime:(l=o.submitTimeRange)==null?void 0:l[0],submitEndTime:(t=o.submitTimeRange)==null?void 0:t[1],completedTaskCount:o.completedTaskCount},m=await D("taskSubmitted.preAuditList",{...I});m.code===0?(R.value=m.data.list,b.total=m.data.total):c.error(m.message)}finally{P.value=!1}};return ye(()=>{h(),ue(),oe()}),(l,t)=>{const I=s("a-input"),m=s("a-form-item"),O=s("a-select-option"),j=s("a-select"),ie=s("a-range-picker"),re=s("a-input-number"),de=s("a-form"),C=s("a-button"),T=s("a-space"),pe=s("a-avatar"),ce=s("a-tag"),z=s("a-popconfirm"),me=s("a-table"),x=s("a-descriptions-item"),ve=s("a-descriptions"),H=s("a-modal"),fe=s("a-textarea");return u(),g("div",Ce,[p("div",xe,[p("div",Ae,[n(de,{layout:"inline",model:o},{default:a(()=>[n(m,{label:"任务名称"},{default:a(()=>[n(I,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=e=>o.taskName=e),placeholder:"请输入任务名称","allow-clear":"",style:{width:"140px"}},null,8,["value"])]),_:1}),n(m,{label:"平台渠道"},{default:a(()=>[n(j,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=e=>o.channelId=e),placeholder:"请选择平台渠道","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),g(A,null,U(B.value,e=>(u(),_(O,{key:e.id,value:e.id},{default:a(()=>[i(r(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(m,{label:"初审状态"},{default:a(()=>[n(j,{value:o.taskPreAuditStatus,"onUpdate:value":t[2]||(t[2]=e=>o.taskPreAuditStatus=e),placeholder:"请选择初审状态","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),g(A,null,U(K.value,e=>(u(),_(O,{key:e.value,value:e.value},{default:a(()=>[i(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(m,{label:"所属群组"},{default:a(()=>[n(j,{value:o.groupId,"onUpdate:value":t[3]||(t[3]=e=>o.groupId=e),placeholder:"请选择群组","allow-clear":""},{default:a(()=>[(u(!0),g(A,null,U(E.value,e=>(u(),_(O,{key:e.id,value:e.id},{default:a(()=>[i(r(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(m,{label:"提交时间"},{default:a(()=>[n(ie,{value:o.submitTimeRange,"onUpdate:value":t[4]||(t[4]=e=>o.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1}),n(m,{label:"已完成任务"},{default:a(()=>[n(re,{value:o.completedTaskCount,"onUpdate:value":t[5]||(t[5]=e=>o.completedTaskCount=e),min:0,max:9999,"addon-after":"次",style:{width:"100px!important"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),p("div",Te,[p("div",null,[n(T,null,{default:a(()=>[n(C,{type:"primary",onClick:L},{default:a(()=>t[9]||(t[9]=[i("查询")])),_:1}),n(C,{onClick:X},{default:a(()=>t[10]||(t[10]=[i("重置")])),_:1})]),_:1})]),p("div",null,[n(T,null,{default:a(()=>[R.value.length?(u(),_(C,{key:0,onClick:se},{icon:a(()=>[n(W(we))]),default:a(()=>[t[11]||(t[11]=i(" 导出 "))]),_:1})):k("",!0),n(C,{type:"primary",onClick:V},{default:a(()=>t[12]||(t[12]=[i("批量通过")])),_:1}),n(C,{danger:"",onClick:le},{default:a(()=>t[13]||(t[13]=[i("批量拒绝")])),_:1})]),_:1})])])]),n(me,{columns:J,"data-source":R.value,loading:P.value,pagination:b,"row-selection":Q,rowKey:"id",onChange:Z},{bodyCell:a(({column:e,record:d})=>[e.key==="taskName"?(u(),_(T,{key:0},{default:a(()=>[n(pe,{src:d.channelIcon,size:"small"},null,8,["src"]),p("span",null,r(d.taskName),1)]),_:2},1024)):k("",!0),e.key==="taskPreAuditStatus"?(u(),g(A,{key:1},[i(r(W(N).getEnumText("TaskPreAuditStatus",d.taskPreAuditStatus)),1)],64)):k("",!0),e.key==="preWaiterName"?(u(),g(A,{key:2},[i(r(d.preWaiterName||"--"),1)],64)):k("",!0),e.key==="member"?(u(),g("div",Ne,[p("div",null,r(d.memberNickname),1),p("div",Pe,[p("span",null,r(d.groupName),1),d.isGroupOwner?(u(),_(ce,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>t[14]||(t[14]=[i("群主")])),_:1})):k("",!0)])])):k("",!0),e.key==="action"?(u(),_(T,{key:4},{default:a(()=>[p("a",{onClick:$=>ee(d)},"查看",8,Re),d.taskPreAuditStatus==="pending"?(u(),_(z,{key:0,title:"确定要通过该任务吗？",onConfirm:$=>te(d)},{default:a(()=>t[15]||(t[15]=[p("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):k("",!0),d.taskPreAuditStatus==="pending"?(u(),_(z,{key:1,title:"确定要拒绝该任务吗？",onConfirm:$=>ae(d)},{default:a(()=>t[16]||(t[16]=[p("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):k("",!0)]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading","pagination"])]),n(H,{open:M.value,"onUpdate:open":t[6]||(t[6]=e=>M.value=e),title:"任务详情",footer:null},{default:a(()=>[n(ve,{column:1},{default:a(()=>[n(x,{label:"任务名称"},{default:a(()=>{var e;return[i(r((e=S.value)==null?void 0:e.taskName),1)]}),_:1}),n(x,{label:"任务类型"},{default:a(()=>{var e;return[i(r((e=S.value)==null?void 0:e.taskType),1)]}),_:1}),n(x,{label:"任务描述"},{default:a(()=>{var e;return[i(r((e=S.value)==null?void 0:e.description),1)]}),_:1}),n(x,{label:"任务奖励"},{default:a(()=>{var e;return[i(r((e=S.value)==null?void 0:e.reward),1)]}),_:1}),n(x,{label:"创建时间"},{default:a(()=>{var e;return[i(r((e=S.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),n(H,{open:w.value,"onUpdate:open":t[8]||(t[8]=e=>w.value=e),title:"拒绝原因",onOk:ne,confirmLoading:Y.value},{default:a(()=>[n(fe,{value:y.value,"onUpdate:value":t[7]||(t[7]=e=>y.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ue=_e(Ie,[["__scopeId","data-v-e9995bdc"]]);export{Ue as default};
