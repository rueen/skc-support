import{_ as ue,i as re,j as V,r as q,v as de,a as ie,k as me,b as p,c as t,d as m,w as l,e as r,l as F,m as f,x as v,f as pe,o as i,F as Y,n as U,p as _,h as u,t as N,q as z,g as G,Q as fe,P as ve,y as ce,z as _e}from"./index-D-NyEYsv.js";import{P as ge}from"./index-KThUC32V.js";const ke={class:"task-form content-container"},ye={class:"form-container"},be={class:"group-select"},Te={key:1,class:"group-tip"},we={class:"user-range"},qe={key:0,class:"task-count"},Ye={class:"quota-container"},Ue={class:"custom-fields"},Me={__name:"detail",setup(Ie){const P=re(),L=V(()=>P.loaded?P.getEnumOptions("TaskType"):[]),M=de(),I=pe(),O=q(),R=V(()=>M.name==="TaskEdit"),a=ie({taskName:"",channelId:void 0,category:void 0,taskType:void 0,reward:void 0,brand:"",groupIds:[],groupMode:0,customFields:[{title:"",type:"input"}],startTime:null,endTime:null,quota:void 0,unlimitedQuota:!0,fansRequired:void 0,contentRequirement:"",taskInfo:"",notice:`1.请尽快完成发布，填写发布链接。
2.任务结束后无法填写，不能结算。
3.发布内容不符合要求，将无法审核通过。
4.填写链接无法访问或其他无关链接，视为放弃结算。`,userRange:0,taskCount:0}),$={taskName:[{required:!0,message:"请输入任务名称"}],channelId:[{required:!0,message:"请选择平台渠道"}],category:[{required:!0,message:"请输入达人领域"}],taskType:[{required:!0,message:"请选择任务类型"}],reward:[{required:!0,message:"请输入任务奖励"}],fansRequired:[{required:!0,message:"请输入粉丝要求"}],groupIds:[{validator:(s,e)=>a.groupMode===1&&(!e||e.length===0)?Promise.reject("请选择指定群组"):Promise.resolve()}],taskCount:[{validator:(s,e)=>a.userRange===1&&e==null?Promise.reject("请输入完成任务次数"):Promise.resolve()}]},Q=q([]),S=q([]),A=()=>{a.customFields.length<10&&a.customFields.push({title:"",type:"input"})},J=s=>{a.customFields.splice(s,1)},K=s=>{s.target.value===0&&(a.groupIds=[])},W=async()=>{try{g.value=!0;const s={...a,groupIds:a.groupMode===0?[]:a.groupIds,startTime:a.startTime?v(a.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:a.endTime?v(a.endTime).format("YYYY-MM-DD HH:mm:ss"):null},e=await _e("task.add",s);e.code===0?(f.success("提交成功"),I.back()):f.error(e.message)}catch(s){console.log(s)}finally{g.value=!1}},X=async()=>{try{g.value=!0;const s={...a,groupIds:a.groupMode===0?[]:a.groupIds,startTime:a.startTime?v(a.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:a.endTime?v(a.endTime).format("YYYY-MM-DD HH:mm:ss"):null},e=await ce("task.edit",{...s},{urlParams:{id:M.params.id}});e.code===0?(f.success("提交成功"),I.back()):f.error(e.message)}catch(s){console.log(s)}finally{g.value=!1}},g=q(!1),Z=()=>{O.value.validate().then(async()=>{R.value?await X():await W()})},ee=()=>{I.back()},ae=async s=>{try{const e=await F("task.detail",{},{urlParams:{id:s}});if(e.code===0){let d={};for(let o in e.data)o!=="groups"&&(d[o]=e.data[o]);d.startTime&&(d.startTime=v(d.startTime)),d.endTime&&(d.endTime=v(d.endTime)),Object.assign(a,d)}}catch(e){console.log(e),f.error(e)}},te=async()=>{const s=await F("channel.list");s.code===0&&(Q.value=s.data.list)},j=async(s="")=>{try{const e=await F("group.list",{page:1,pageSize:50,groupName:s});e.code===0&&(S.value=e.data.list||[])}catch{f.error("获取群组列表失败")}};return me(()=>{te(),j(),R.value&&ae(M.params.id)}),(s,e)=>{const d=r("a-input"),o=r("a-form-item"),c=r("a-select-option"),k=r("a-select"),y=r("a-input-number"),E=r("a-date-picker"),C=r("a-col"),le=r("a-row"),b=r("a-radio"),h=r("a-radio-group"),B=r("a-form-item-rest"),ne=r("a-tooltip"),oe=r("a-checkbox"),D=r("a-space"),T=r("a-button"),H=r("a-textarea"),se=r("a-form");return i(),p("div",ke,[t(ge,{title:R.value?"编辑任务":"新建任务",back:!0,class:"page-header"},null,8,["title"]),m("div",ye,[t(se,{ref_key:"formRef",ref:O,model:a,rules:$,"label-col":{span:3},"wrapper-col":{span:20},layout:"horizontal"},{default:l(()=>[t(o,{label:"任务名称",name:"taskName"},{default:l(()=>[t(d,{value:a.taskName,"onUpdate:value":e[0]||(e[0]=n=>a.taskName=n),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),t(o,{label:"平台渠道",name:"channelId"},{default:l(()=>[t(k,{value:a.channelId,"onUpdate:value":e[1]||(e[1]=n=>a.channelId=n),placeholder:"请选择平台渠道"},{default:l(()=>[(i(!0),p(Y,null,U(Q.value,n=>(i(),_(c,{key:n.id,value:n.id},{default:l(()=>[u(N(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(o,{label:"达人领域",name:"category"},{default:l(()=>[t(d,{value:a.category,"onUpdate:value":e[2]||(e[2]=n=>a.category=n),placeholder:"请输入达人领域"},null,8,["value"])]),_:1}),t(o,{label:"任务类型",name:"taskType"},{default:l(()=>[t(k,{value:a.taskType,"onUpdate:value":e[3]||(e[3]=n=>a.taskType=n),placeholder:"请选择任务类型"},{default:l(()=>[(i(!0),p(Y,null,U(L.value,n=>(i(),_(c,{key:n.value,value:n.value},{default:l(()=>[u(N(n.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(o,{label:"任务奖励",name:"reward"},{default:l(()=>[t(y,{value:a.reward,"onUpdate:value":e[4]||(e[4]=n=>a.reward=n),min:0,precision:2,step:.1,placeholder:"请输入任务奖励"},null,8,["value"])]),_:1}),t(o,{label:"粉丝要求",name:"fansRequired"},{default:l(()=>[t(y,{value:a.fansRequired,"onUpdate:value":e[5]||(e[5]=n=>a.fansRequired=n),min:0,step:1,placeholder:"请输入粉丝要求"},null,8,["value"])]),_:1}),t(o,{label:"任务时间",required:""},{default:l(()=>[t(le,{gutter:8},{default:l(()=>[t(C,{span:11},{default:l(()=>[t(o,{name:"startTime",rules:[{required:!0,message:"请选择开始时间"}]},{default:l(()=>[t(E,{value:a.startTime,"onUpdate:value":e[6]||(e[6]=n=>a.startTime=n),"show-time":"",style:{width:"100%"},placeholder:"开始时间",format:"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1})]),_:1}),t(C,{span:2,class:"text-center"},{default:l(()=>e[18]||(e[18]=[m("span",null,"至",-1)])),_:1}),t(C,{span:11},{default:l(()=>[t(o,{name:"endTime",rules:[{required:!0,message:"请选择结束时间"}]},{default:l(()=>[t(E,{value:a.endTime,"onUpdate:value":e[7]||(e[7]=n=>a.endTime=n),"show-time":"",style:{width:"100%"},placeholder:"结束时间",format:"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1}),t(o,{label:"指定群组",name:"groupIds"},{default:l(()=>[m("div",be,[t(h,{value:a.groupMode,"onUpdate:value":e[8]||(e[8]=n=>a.groupMode=n),onChange:K},{default:l(()=>[t(b,{value:0},{default:l(()=>e[19]||(e[19]=[u("不指定")])),_:1}),t(b,{value:1},{default:l(()=>e[20]||(e[20]=[u("指定群组")])),_:1})]),_:1},8,["value"]),t(B,null,{default:l(()=>[a.groupMode===1?(i(),_(k,{key:0,value:a.groupIds,"onUpdate:value":e[9]||(e[9]=n=>a.groupIds=n),"show-search":"","filter-option":!1,mode:"multiple",placeholder:"请选择群组",style:{width:"100%","margin-top":"8px"},onSearch:j},{default:l(()=>[(i(!0),p(Y,null,U(S.value,n=>(i(),_(c,{key:n.id,value:n.id},{default:l(()=>[u(N(n.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])):(i(),p("div",Te," 所有群组的会员都可以接取该任务 "))]),_:1})])]),_:1}),t(o,{label:"用户范围",name:"userRange"},{default:l(()=>[m("div",we,[t(h,{value:a.userRange,"onUpdate:value":e[10]||(e[10]=n=>a.userRange=n)},{default:l(()=>[t(b,{value:0},{default:l(()=>e[21]||(e[21]=[u("全部用户")])),_:1}),t(b,{value:1},{default:l(()=>e[22]||(e[22]=[u("完成任务次数")])),_:1})]),_:1},8,["value"]),t(B,null,{default:l(()=>[a.userRange===1?(i(),p("div",qe,[t(o,{name:"taskCount"},{default:l(()=>[t(y,{value:a.taskCount,"onUpdate:value":e[11]||(e[11]=n=>a.taskCount=n),min:0,precision:0,placeholder:"请输入次数","addon-after":"次"},null,8,["value"])]),_:1}),t(ne,null,{title:l(()=>e[23]||(e[23]=[u(" 举例："),m("br",null,null,-1),u(" 0：表示新人即从未完成过任务的会员可显示并参与"),m("br",null,null,-1),u(" 2：表示仅完成过0次/1次/2次的会员可显示并参与"),m("br",null,null,-1),u(" 5：表示完成过0/1/2/3/4/5次任务的会员可显示并参与 ")])),default:l(()=>[t(G(fe))]),_:1})])):z("",!0)]),_:1})])]),_:1}),t(o,{label:"任务名额"},{default:l(()=>[m("div",Ye,[t(D,{align:"baseline"},{default:l(()=>[t(o,{name:"quota"},{default:l(()=>[t(y,{value:a.quota,"onUpdate:value":e[12]||(e[12]=n=>a.quota=n),min:0,precision:0,disabled:a.unlimitedQuota,placeholder:"请输入任务名额"},null,8,["value","disabled"])]),_:1}),t(oe,{checked:a.unlimitedQuota,"onUpdate:checked":e[13]||(e[13]=n=>a.unlimitedQuota=n)},{default:l(()=>e[24]||(e[24]=[u(" 不限制 ")])),_:1},8,["checked"])]),_:1})])]),_:1}),t(o,{label:"品牌",name:"brand"},{default:l(()=>[t(d,{value:a.brand,"onUpdate:value":e[14]||(e[14]=n=>a.brand=n),placeholder:"请输入品牌名称"},null,8,["value"])]),_:1}),t(o,{label:"提交信息字段"},{default:l(()=>[m("div",Ue,[(i(!0),p(Y,null,U(a.customFields,(n,x)=>(i(),p("div",{key:x,class:"field-item"},[t(D,{align:"baseline"},{default:l(()=>[t(o,{name:["customFields",x,"title"],rules:[{required:!0,message:"请输入字段标题"}]},{default:l(()=>[t(d,{value:n.title,"onUpdate:value":w=>n.title=w,placeholder:"请输入字段标题"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),t(k,{value:n.type,"onUpdate:value":w=>n.type=w,style:{width:"120px"}},{default:l(()=>[t(c,{value:"input"},{default:l(()=>e[25]||(e[25]=[u("输入框")])),_:1}),t(c,{value:"image"},{default:l(()=>e[26]||(e[26]=[u("上传图片")])),_:1})]),_:2},1032,["value","onUpdate:value"]),t(T,{type:"link",danger:"",onClick:w=>J(x)},{default:l(()=>e[27]||(e[27]=[u(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]))),128)),a.customFields.length<10?(i(),_(T,{key:0,type:"dashed",block:"",onClick:A},{default:l(()=>[t(G(ve)),e[28]||(e[28]=u("添加字段 "))]),_:1})):z("",!0)])]),_:1}),t(o,{label:"作品要求",name:"contentRequirement"},{default:l(()=>[t(H,{value:a.contentRequirement,"onUpdate:value":e[15]||(e[15]=n=>a.contentRequirement=n),rows:4,placeholder:"请输入作品要求"},null,8,["value"])]),_:1}),t(o,{label:"任务信息",name:"taskInfo"},{default:l(()=>[t(H,{value:a.taskInfo,"onUpdate:value":e[16]||(e[16]=n=>a.taskInfo=n),rows:4,placeholder:"请输入任务信息"},null,8,["value"])]),_:1}),t(o,{label:"温馨提示",name:"notice"},{default:l(()=>[t(H,{value:a.notice,"onUpdate:value":e[17]||(e[17]=n=>a.notice=n),rows:4,placeholder:"请输入温馨提示"},null,8,["value"])]),_:1}),t(o,{"wrapper-col":{span:16,offset:4}},{default:l(()=>[t(D,null,{default:l(()=>[t(T,{type:"primary",onClick:Z},{default:l(()=>e[29]||(e[29]=[u("提交")])),_:1}),t(T,{onClick:ee},{default:l(()=>e[30]||(e[30]=[u("取消")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},De=ue(Me,[["__scopeId","data-v-3c134368"]]);export{De as default};
