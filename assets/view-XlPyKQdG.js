import{_ as Be,c as Pe,a as Ue,r as v,e as T,d as ze,D as De,p as Ne,z as Ee,f as b,h as a,g as i,t as s,w as t,i as r,F as A,l as G,q as f,j as qe,o as d,n as _,x as g,k as m,m as j,M as Fe,y as Me,v as k,C as te}from"./index-BJg42wI2.js";import{P as Ge}from"./PageHeader-BrPkT9ND.js";import{_ as V}from"./CopyContent-CQm-3NHT.js";import{G as je}from"./GroupOwner-BtmPB2Z6.js";const Ve={class:"member-view content-container"},He={class:"detail-container"},We={class:"section"},Je={class:"section-title"},Ke={key:0},Qe={key:0},Xe={style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},Ye={class:"section"},Ze={class:"section-title"},xe={class:"account-list"},ea={class:"link-text-container",style:{"max-width":"300px"}},aa=["href"],ta={class:"section",style:{"padding-bottom":"24px"}},na={class:"section-title"},la={class:"section",style:{"padding-bottom":"24px"}},sa={class:"section-title"},oa={class:"section"},ra={class:"section-title"},ia={key:1},ua={__name:"view",setup(ma){const{t:w}=Pe(),R=Ue(),B=Ee(),H=qe(),p=v(""),o=T({}),W=v([]),ne=ze(()=>`${De.h5Url}?inviteCode=${o.inviteCode}`),P=T({}),U=T({}),z=T({}),J=v(),h=v(!1),I=v("grant"),c=T({amount:"",remark:"",relatedTaskId:null}),O=v(!1),le=v({amount:[{required:!0,message:w("member.view.amountRequired")}],remark:[{required:!0,message:w("member.view.remarkRequired")}]}),se=()=>{const e={};B.query.filters&&(e.filters=B.query.filters),H.push({name:"MemberList",query:e})},oe=async()=>{const e=await f("member.detail",{},{urlParams:{id:p.value}});e.code===0&&Object.assign(o,e.data||{})},D=async()=>{const e=await f("member.balance",{},{urlParams:{memberId:p.value}});e.code===0&&(o.balance=e.data.balance)},re=async()=>{const e=await f("member.withdrawalsAccount",{},{urlParams:{memberId:p.value}});e.code===0&&(o.withdrawalsAccount=e.data[0]||{})},K=async()=>{const e=await f("account.list",{memberId:p.value});e.code===0&&(W.value=e.data.list||[])},ie=e=>{H.push({name:"AccountEdit",params:{id:e.id}})},ue=e=>{Fe.confirm({content:w("common.deleteConfirm"),onOk:async()=>{const l=await Me("account.delete",{},{urlParams:{id:e.id}});l.code===0?(k.success(l.message),K()):k.error(l.message)}})},me=async()=>{const e=await f("member.taskStats",{},{urlParams:{memberId:p.value}});e.code===0&&Object.assign(P,e.data||{})},de=async()=>{const e=await f("member.inviteStats",{},{urlParams:{memberId:p.value}});e.code===0&&Object.assign(U,e.data||{})},ce=async()=>{const e=await f("member.groupsStats",{},{urlParams:{memberId:p.value}});e.code===0&&Object.assign(z,e.data||{})},Q=v([]),N=async(e="")=>{const l=await f("taskSubmitted.preAuditList",{page:1,pageSize:30,keyword:o.account,taskName:e,sorterField:"preAuditTime",sorterOrder:"descend"});l.code===0&&(Q.value=l.data.list||[])},pe=()=>{h.value=!0,I.value="grant",N()},ve=()=>{h.value=!0,I.value="deduct",N()},E=v(!1),be=v([{title:w("member.view.balanceLogs.beforeBalance"),dataIndex:"beforeBalance",key:"beforeBalance",width:120},{title:w("member.view.balanceLogs.amount"),dataIndex:"amount",key:"amount",width:120},{title:w("member.view.balanceLogs.afterBalance"),dataIndex:"afterBalance",key:"afterBalance",width:120},{title:w("member.view.balanceLogs.transactionType"),key:"transactionType"},{title:w("member.view.balanceLogs.createTime"),dataIndex:"createTime",key:"createTime"}]),X=v([]),S=T({current:1,pageSize:10,total:0}),fe=e=>{Object.assign(S,e),Y()},Y=async()=>{E.value=!0;const e=await f("member.balanceLogs",{page:S.current,pageSize:S.pageSize},{urlParams:{memberId:p.value}});e.code===0&&(X.value=e.data.list||[],S.total=e.data.total||0)},we=async()=>{O.value=!0;try{const e={memberId:p.value,amount:c.amount,remark:c.remark};c.relatedTaskId&&(e.taskId=c.relatedTaskId);const l=await te("member.grantReward",{...e});l.code===0?(k.success("奖励发放成功"),h.value=!1,D()):k.error(l.message)}catch{k.error("奖励发放失败")}finally{O.value=!1}},_e=async()=>{O.value=!0;try{const e={memberId:p.value,amount:c.amount,remark:c.remark};c.relatedTaskId&&(e.taskId=c.relatedTaskId);const l=await te("member.deductReward",{...e},{urlParams:{memberId:p.value}});l.code===0?(k.success("奖励扣除成功"),h.value=!1,D()):k.error(l.message)}catch{k.error("奖励扣除失败")}finally{O.value=!1}},ge=async()=>{try{switch(await J.value.validate(),I.value){case"grant":we();break;case"deduct":_e();break}}catch(e){console.log(e)}};return Ne(()=>{p.value=B.params.id,oe(),D(),K(),me(),de(),ce(),re()}),(e,l)=>{const ke=r("UserOutlined"),Z=r("a-avatar"),x=r("a-tag"),L=r("a-space"),u=r("a-descriptions-item"),q=r("a-button"),ye=r("PlusOutlined"),he=r("MinusOutlined"),ee=r("a-descriptions"),$e=r("EditOutlined"),Ce=r("DeleteOutlined"),$=r("a-statistic"),C=r("a-col"),F=r("a-row"),Te=r("a-input"),M=r("a-form-item"),Ie=r("a-select-option"),Oe=r("a-select"),Se=r("a-textarea"),Le=r("a-form"),ae=r("a-modal"),Ae=r("a-typography-text"),Re=r("a-table");return d(),b("div",Ve,[a(Ge,{title:e.$t("member.view.pageTitle"),back:!0,useDefaultBack:!1,onBack:se},null,8,["title"]),i("div",He,[i("div",We,[i("div",Je,s(e.$t("member.view.memberInfo")),1),a(ee,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[a(u,{label:e.$t("member.view.memberNickname")},{default:t(()=>[a(L,null,{default:t(()=>[a(Z,{src:o.avatar,size:"small"},{icon:t(()=>[a(ke)]),_:1},8,["src"]),i("span",null,s(o.nickname),1),o.isNew?(d(),_(x,{key:0,color:"green"},{default:t(()=>l[8]||(l[8]=[m("new")])),_:1})):g("",!0)]),_:1})]),_:1},8,["label"]),a(u,{label:e.$t("member.view.memberAccount")},{default:t(()=>[m(s(o.account),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.gender")},{default:t(()=>[m(s(j(R).getEnumText("GenderType",o.gender)),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.occupation")},{default:t(()=>[m(s(j(R).getEnumText("OccupationType",o.occupation))+" ",1),o.occupation===null?(d(),b("span",Ke," - ")):g("",!0)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.email")},{default:t(()=>[m(s(o.email||"-"),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.phone")},{default:t(()=>[m(s(o.phone||"-"),1)]),_:1},8,["label"]),a(u,{label:"Telegram"},{default:t(()=>[m(s(o.telegram||"-"),1)]),_:1}),a(u,{label:e.$t("member.view.group")},{default:t(()=>[(d(!0),b(A,null,G(o.groups,n=>(d(),_(L,{key:n.id},{default:t(()=>[m(s(n.groupName)+" ",1),n.isOwner?(d(),_(je,{key:0})):g("",!0)]),_:2},1024))),128)),!o.groups||!o.groups.length?(d(),b("span",Qe," - ")):g("",!0)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.inviter")},{default:t(()=>[m(s(o.inviterNickname||"-"),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.inviteUrl")},{default:t(()=>[a(V,{content:ne.value},null,8,["content"])]),_:1},8,["label"]),a(u,{label:e.$t("member.view.withdrawalsAccount")},{default:t(()=>[a(L,null,{default:t(()=>{var n,y;return[i("span",null,s(((n=o==null?void 0:o.withdrawalsAccount)==null?void 0:n.paymentChannelName)||"-"),1),i("span",null,s(((y=o==null?void 0:o.withdrawalsAccount)==null?void 0:y.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),a(u,{label:e.$t("member.view.balance")},{default:t(()=>[i("div",Xe,[i("span",null,s(o.balance),1),a(q,{type:"link",size:"small",onClick:l[0]||(l[0]=n=>Y())},{default:t(()=>[m(s(e.$t("member.view.balanceLogs.view")),1)]),_:1}),a(q,{type:"primary",size:"small",onClick:l[1]||(l[1]=n=>pe()),style:{"margin-left":"16px"}},{default:t(()=>[a(ye),m(" "+s(e.$t("member.view.rewardGrant")),1)]),_:1}),a(q,{size:"small",danger:"",onClick:l[2]||(l[2]=n=>ve()),style:{"margin-left":"16px"}},{default:t(()=>[a(he),m(" "+s(e.$t("member.view.rewardDeduct")),1)]),_:1})])]),_:1},8,["label"])]),_:1})]),i("div",Ye,[i("div",Ze,s(e.$t("member.view.accountInfo")),1),i("div",xe,[(d(!0),b(A,null,G(W.value,n=>(d(),b("div",{key:n.channelId},[a(ee,{column:1},{default:t(()=>[a(u,{label:e.$t("member.view.account")},{default:t(()=>[a(L,{size:24},{default:t(()=>[a(L,null,{default:t(()=>[a(Z,{src:n.channelIcon,size:"small"},null,8,["src"]),i("span",null,s(n.account),1),a(x,{color:"warning"},{default:t(()=>[m(s(j(R).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024),a($e,{onClick:y=>ie(n)},null,8,["onClick"]),a(Ce,{onClick:y=>ue(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),a(u,{label:e.$t("member.view.homepage")},{default:t(()=>[a(V,{content:n.homeUrl},{default:t(()=>[i("div",ea,[i("a",{href:n.homeUrl,target:"_blank",class:"link-text"},s(n.homeUrl),9,aa)])]),_:2},1032,["content"])]),_:2},1032,["label"]),a(u,{label:"uid"},{default:t(()=>[a(V,{content:n.uid},null,8,["content"])]),_:2},1024),n.channelCustomFields.includes("fansCount")?(d(),_(u,{key:0,label:e.$t("member.view.fansCount")},{default:t(()=>[m(s(n.fansCount),1)]),_:2},1032,["label"])):g("",!0),n.channelCustomFields.includes("friendsCount")?(d(),_(u,{key:1,label:e.$t("member.view.friendsCount")},{default:t(()=>[m(s(n.friendsCount),1)]),_:2},1032,["label"])):g("",!0),n.channelCustomFields.includes("postsCount")?(d(),_(u,{key:2,label:e.$t("member.view.postsCount")},{default:t(()=>[m(s(n.postsCount),1)]),_:2},1032,["label"])):g("",!0)]),_:2},1024)]))),128))])]),i("div",ta,[i("div",na,s(e.$t("member.view.taskStats")),1),a(F,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.completedTaskCount"),value:P.completedTaskCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.taskReward"),value:P.totalTaskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),i("div",la,[i("div",sa,s(e.$t("member.view.inviteStats")),1),a(F,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.inviteCount"),value:U.inviteCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.inviteReward"),value:U.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),i("div",oa,[i("div",ra,s(e.$t("member.view.groupStats")),1),a(F,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.groupCount"),value:z.groupCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.groupEarnings"),value:z.totalCommission},null,8,["title","value"])]),_:1})]),_:1})])]),a(ae,{open:h.value,"onUpdate:open":l[6]||(l[6]=n=>h.value=n),title:I.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:ge,confirmLoading:O.value},{default:t(()=>[a(Le,{ref_key:"rewardFormRef",ref:J,model:c,rules:le.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:t(()=>[a(M,{label:I.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:t(()=>[a(Te,{value:c.amount,"onUpdate:value":l[3]||(l[3]=n=>c.amount=n)},null,8,["value"])]),_:1},8,["label"]),a(M,{label:e.$t("member.view.relatedTask")},{default:t(()=>[a(Oe,{value:c.relatedTaskId,"onUpdate:value":l[4]||(l[4]=n=>c.relatedTaskId=n),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:N},{default:t(()=>[(d(!0),b(A,null,G(Q.value,n=>(d(),_(Ie,{key:n.taskId,value:n.taskId},{default:t(()=>[m(s(n.taskName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(M,{label:e.$t("member.view.remark"),name:"remark"},{default:t(()=>[a(Se,{value:c.remark,"onUpdate:value":l[5]||(l[5]=n=>c.remark=n),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"]),a(ae,{open:E.value,"onUpdate:open":l[7]||(l[7]=n=>E.value=n),title:e.$t("member.view.balanceLogs.title"),width:800},{default:t(()=>[a(Re,{size:"small",columns:be.value,"data-source":X.value,pagination:S,scroll:{y:400},onChange:fe},{bodyCell:t(({column:n,record:y})=>[n.key==="transactionType"?(d(),b(A,{key:0},[y.transactionType==="withdrawal_refund"?(d(),_(Ae,{key:0,type:"danger"},{default:t(()=>l[9]||(l[9]=[m("余额退还")])),_:1})):(d(),b("span",ia,s(y.transactionType),1))],64)):g("",!0)]),_:1},8,["columns","data-source","pagination"])]),_:1},8,["open","title"])])}}},ba=Be(ua,[["__scopeId","data-v-221f71f9"]]);export{ba as default};
