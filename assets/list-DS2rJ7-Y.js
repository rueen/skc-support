import{_ as ue,a as me,b as pe,r as C,c as F,x as _e,j as ve,k as fe,d as _,e as c,f as n,s as f,w as t,g as i,l as S,m as y,h as ke,o as s,F as w,n as I,p as k,i as m,t as r,q as he,M as ge,v as be}from"./index-_Ujq24cd.js";import{_ as V}from"./CopyContent-fKf3UCmO.js";import{G as ye}from"./GroupOwner-D_0O_wQf.js";import{d as we}from"./download-BETrgU0z.js";const Ce={class:"member-list content-container"},Ie={class:"table-container"},Te={class:"table-header"},$e={class:"left"},Se={class:"right"},De={class:"link-text-container"},Ne={class:"label"},Oe=["href"],Re={key:1},Me={style:{color:"#999","font-size":"12px"}},xe={key:0},ze=["onClick"],Ae=["onClick"],Ue={class:"danger"},Ee={key:0,class:"count-container"},Ye={__name:"list",setup(He){const j=me(),{t:p}=pe(),D=ke(),G=_e(),N=C(!1),l=F({keyword:"",channelId:void 0,groupId:G.query.groupId,inviterId:void 0,completedTaskCount:void 0,createTimeRange:[]}),O=C([]),z=C(0),h=F({current:1,pageSize:10,total:0}),A=C([]),q=ve(()=>[{title:p("member.list.memberNickname"),key:"nickname"},{title:p("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:p("member.list.accounts"),key:"accountList"},{title:p("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:p("member.list.inviter"),key:"inviterNickname"},{title:p("member.list.group"),key:"groups"},{title:p("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:p("member.list.action"),key:"action",fixed:"right",width:150}]),U=()=>{h.current=1,T()},J=()=>{Object.assign(l,{keyword:"",channelId:void 0,groupId:void 0,inviterId:void 0,completedTaskCount:void 0,createTimeRange:[]}),U()},K=e=>{h.current=e.current,h.pageSize=e.pageSize,T()},Q=()=>{D.push("/member/create")},W=e=>{D.push(`/member/edit/${e.id}`)},E=e=>{D.push(`/member/view/${e}`)},X=async e=>{const a=await be("member.delete",{},{urlParams:{id:e.id}});a.code===0?(y.success("删除成功"),T()):y.error(a.message)},T=async()=>{var e,a;N.value=!0;try{const g={page:h.current,pageSize:h.pageSize,keyword:l.keyword,channelId:l.channelId,groupId:l.groupId,inviterId:l.inviterId,completedTaskCount:l.completedTaskCount,createStartTime:(e=l.createTimeRange)==null?void 0:e[0],createEndTime:(a=l.createTimeRange)==null?void 0:a[1]},d=await S("member.list",g);d.code===0?(O.value=d.data.list,h.total=d.data.total,z.value=d.data.totalApproved):y.error(d.message)}finally{N.value=!1}},Y=async(e="")=>{try{const a=await S("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(A.value=a.data.list||[])}catch{y.error("获取群组列表失败")}},Z=()=>{ge.confirm({title:p("common.export"),content:p("common.confirmExportContent"),onOk:async()=>{var e,a;try{const g=y.loading(p("common.exporting"),0),d={keyword:l.keyword,channelId:l.channelId,groupId:l.groupId,inviterId:l.inviterId,completedTaskCount:l.completedTaskCount,createStartTime:(e=l.createTimeRange)==null?void 0:e[0],createEndTime:(a=l.createTimeRange)==null?void 0:a[1]};await we("member.export",d,`会员列表_${new Date().toLocaleDateString()}.xlsx`),g(),y.success(p("common.exportSuccess"))}catch(g){console.error("导出失败:",g),y.error(p("common.exportFailed"))}}})},H=C([]),B=async(e="")=>{const a=await S("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(H.value=a.data.list||[])},R=C([]),ee=async()=>{if(!R.value.length)try{const e=await S("channel.list");e.code===0&&(R.value=e.data.list)}catch(e){console.error(e)}};return fe(()=>{T(),Y(),ee(),B()}),(e,a)=>{const g=i("a-input"),d=i("a-form-item"),M=i("a-select-option"),x=i("a-select"),te=i("a-input-number"),ae=i("a-range-picker"),$=i("a-button"),b=i("a-space"),ne=i("a-form"),oe=i("DownloadOutlined"),le=i("plus-outlined"),L=i("a-tag"),se=i("a-avatar"),re=i("a-typography-link"),ie=i("a-popconfirm"),ce=i("a-table"),P=i("a-descriptions-item"),de=i("a-descriptions");return s(),_("div",Ce,[c("div",Ie,[c("div",Te,[c("div",$e,[n(ne,{layout:"inline",model:l},{default:t(()=>[n(d,{label:e.$t("member.search.keyword")},{default:t(()=>[n(g,{value:l.keyword,"onUpdate:value":a[0]||(a[0]=o=>l.keyword=o),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(d,{label:e.$t("common.channel")},{default:t(()=>[n(x,{value:l.channelId,"onUpdate:value":a[1]||(a[1]=o=>l.channelId=o),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(s(!0),_(w,null,I(R.value,o=>(s(),k(M,{key:o.id,value:o.id},{default:t(()=>[m(r(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(d,{label:e.$t("member.search.group")},{default:t(()=>[n(x,{value:l.groupId,"onUpdate:value":a[2]||(a[2]=o=>l.groupId=o),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:Y,style:{width:"200px"}},{default:t(()=>[(s(!0),_(w,null,I(A.value,o=>(s(),k(M,{key:o.id,value:o.id},{default:t(()=>[m(r(o.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(d,{label:e.$t("member.list.inviter")},{default:t(()=>[n(x,{value:l.inviterId,"onUpdate:value":a[3]||(a[3]=o=>l.inviterId=o),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:B},{default:t(()=>[(s(!0),_(w,null,I(H.value,o=>(s(),k(M,{key:o.id,value:o.id},{default:t(()=>[m(r(o.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(d,{label:e.$t("member.list.completedTaskCount")},{default:t(()=>[n(te,{value:l.completedTaskCount,"onUpdate:value":a[4]||(a[4]=o=>l.completedTaskCount=o),min:0,max:9999,style:{width:"100px!important"}},null,8,["value"])]),_:1},8,["label"]),n(d,{label:e.$t("member.search.createTime")},{default:t(()=>[n(ae,{value:l.createTimeRange,"onUpdate:value":a[5]||(a[5]=o=>l.createTimeRange=o),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),n(d,null,{default:t(()=>[n(b,null,{default:t(()=>[n($,{type:"primary",onClick:U},{default:t(()=>[m(r(e.$t("common.search")),1)]),_:1}),n($,{onClick:J},{default:t(()=>[m(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",Se,[n(b,null,{default:t(()=>[O.value.length?(s(),k($,{key:0,onClick:Z},{icon:t(()=>[n(oe)]),default:t(()=>[m(" "+r(e.$t("common.export")),1)]),_:1})):f("",!0),n($,{type:"primary",onClick:Q},{icon:t(()=>[n(le)]),default:t(()=>[m(" "+r(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),n(ce,{columns:q.value,"data-source":O.value,loading:N.value,pagination:h,onChange:K},{bodyCell:t(({column:o,record:v})=>[o.key==="nickname"?(s(),k(b,{key:0},{default:t(()=>[c("span",null,r(v.nickname),1),v.isNew?(s(),k(L,{key:0,color:"green"},{default:t(()=>a[6]||(a[6]=[m("new")])),_:1})):f("",!0)]),_:2},1024)):f("",!0),o.key==="accountList"?(s(),k(b,{key:1,direction:"vertical"},{default:t(()=>[(s(!0),_(w,null,I(v.accountList,u=>(s(),_("div",null,[c("div",null,[n(b,null,{default:t(()=>[m(r(e.$t("member.list.account"))+"：",1),n(se,{src:u.channelIcon,size:"small"},null,8,["src"]),m(" "+r(u.account)+" ",1),n(L,{color:"warning"},{default:t(()=>[m(r(he(j).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),c("div",De,[c("span",Ne,r(e.$t("member.list.homepage"))+"：",1),n(V,{content:u.homeUrl},{default:t(()=>[c("a",{href:u.homeUrl,target:"_blank",class:"link-text"},r(u.homeUrl),9,Oe)]),_:2},1032,["content"])]),c("div",null,[a[7]||(a[7]=c("span",{class:"label"},"uid：",-1)),n(V,{content:u.uid},null,8,["content"])])]))),256))]),_:2},1024)):f("",!0),o.key==="inviterNickname"?(s(),_(w,{key:2},[v.inviterId?(s(),k(re,{key:0,onClick:u=>E(v.inviterId)},{default:t(()=>[m(r(v.inviterNickname),1)]),_:2},1032,["onClick"])):(s(),_("span",Re,"--"))],64)):f("",!0),o.key==="groups"?(s(),_(w,{key:3},[(s(!0),_(w,null,I(v.groups,u=>(s(),_("div",null,[n(b,null,{default:t(()=>[c("span",null,r(u.groupName),1),u.isOwner?(s(),k(ye,{key:0})):f("",!0)]),_:2},1024),c("div",Me,r(u.joinTime),1)]))),256)),!v.groups||v.groups.length===0?(s(),_("span",xe,"--")):f("",!0)],64)):f("",!0),o.key==="action"?(s(),k(b,{key:4},{default:t(()=>[c("a",{onClick:u=>W(v)},r(e.$t("member.list.edit")),9,ze),c("a",{onClick:u=>E(v.id)},r(e.$t("member.list.view")),9,Ae),n(ie,{title:e.$t("member.list.deleteConfirm"),onConfirm:u=>X(v)},{default:t(()=>[c("a",Ue,r(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):f("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),h.total?(s(),_("div",Ee,[n(de,{column:2},{default:t(()=>[n(P,{label:e.$t("common.totalCount"),style:{width:"125px"}},{default:t(()=>[m(r(h.total),1)]),_:1},8,["label"]),n(P,{label:e.$t("member.list.totalApproved")},{default:t(()=>[m(r(z.value),1)]),_:1},8,["label"])]),_:1})])):f("",!0)])])}}},Ve=ue(Ye,[["__scopeId","data-v-8ad09d19"]]);export{Ve as default};
