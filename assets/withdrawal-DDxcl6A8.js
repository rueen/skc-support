import{_ as fe,b as ke,a as ge,j as W,r as v,c as x,k as be,d as y,e as g,f as a,s as _,w as t,g as i,l as z,m as w,h as Ce,o as u,F as $,n as K,p as S,i as d,t as s,q as j,M as q,A as G}from"./index-MPDKbte8.js";import{d as Ne}from"./download-BEyPBkFI.js";const $e={class:"withdrawal content-container"},Se={class:"table-container"},Re={class:"table-header"},Ie={class:"left"},Te={class:"right"},je=["onClick"],De={key:0,class:"count-container"},Me={__name:"withdrawal",setup(Oe){const{t:c}=ke(),R=Ce(),D=ge(),J=W(()=>D.loaded?D.getEnumOptions("WithdrawalStatus"):[]),M=v([]),O=v(!1),b=v(!1),Y=v(!1),k=v(""),n=x({billNo:"",memberNickname:"",withdrawalStatus:"pending",paymentChannelId:null,timeRange:[]}),Q=W(()=>[{title:c("withdrawal.list.billNo"),dataIndex:"billNo",key:"billNo"},{title:c("withdrawal.list.memberNickname"),key:"nickname"},{title:c("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:c("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:c("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:c("withdrawal.list.name"),dataIndex:"withdrawalName",key:"withdrawalName"},{title:c("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:c("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:c("withdrawal.list.operator"),key:"waiterName"},{title:c("withdrawal.list.action"),key:"action",width:150}]),p=v([]),X={selectedRowKeys:p,onChange:e=>{p.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},P=v([]),U=v(0),h=x({current:1,pageSize:10,total:0}),E=()=>{h.current=1,C()},Z=()=>{Object.assign(n,{billNo:"",memberNickname:"",withdrawalStatus:void 0,paymentChannelId:null,timeRange:[]}),E()},ee=e=>{Object.assign(h,e),C()},ae=()=>{q.confirm({title:c("common.export"),content:c("common.confirmExportContent"),onOk:async()=>{var f,r;const e=w.loading("正在导出数据，请稍候...",0),o={billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,paymentChannelId:n.paymentChannelId,startTime:(f=n.timeRange)==null?void 0:f[0],endTime:(r=n.timeRange)==null?void 0:r[1]};try{await Ne("withdrawals.export",o,`提现列表_${new Date().toLocaleDateString()}.xlsx`),w.success(c("common.exportSuccess"))}catch(I){console.error("导出失败:",I),w.error(c("common.exportFailed"))}finally{e()}}})},te=e=>{R.push(`/member/view/${e.memberId}`)},le=e=>{q.error({content:e.rejectReason})},ne=async e=>{p.value=[e.id],H()},H=async()=>{if(!p.value.length){w.warning("请选择要操作的记录");return}const e=await G("withdrawals.batchResolve",{ids:p.value});e.code===0?(w.success("操作成功"),p.value=[],C()):w.error(e.message)},oe=e=>{p.value=[e.id],k.value="",b.value=!0},ie=()=>{if(!p.value.length){w.warning("请选择要操作的记录");return}k.value="",b.value=!0},se=async()=>{if(!k.value){w.error("请输入打款失败原因");return}Y.value=!0;try{await G("withdrawals.batchReject",{rejectReason:k.value,ids:p.value}),w.success("操作成功"),b.value=!1,p.value=[],C()}catch(e){w.error(e.message)}finally{Y.value=!1}},C=async()=>{var e,o;O.value=!0;try{const f={page:h.current,pageSize:h.pageSize,billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,paymentChannelId:n.paymentChannelId,startTime:(e=n.timeRange)==null?void 0:e[0],endTime:(o=n.timeRange)==null?void 0:o[1]},r=await z("withdrawals.list",{...f});r.code===0?(P.value=r.data.list||[],h.total=r.data.total||0,U.value=r.data.totalAmount):w.error(r.message)}finally{O.value=!1}},re=async()=>{if(!M.value.length)try{const e=await z("paymentChannels.list");e.code===0&&(M.value=e.data)}catch(e){console.error(e)}};return be(()=>{C(),re()}),(e,o)=>{const f=i("a-input"),r=i("a-form-item"),I=i("a-select-option"),F=i("a-select"),de=i("a-range-picker"),N=i("a-button"),L=i("RightOutlined"),A=i("a-typography-link"),B=i("a-space"),ce=i("a-form"),ue=i("download-outlined"),me=i("info-circle-outlined"),we=i("a-popconfirm"),pe=i("a-typography-text"),he=i("a-table"),V=i("a-descriptions-item"),ve=i("a-descriptions"),ye=i("a-textarea"),_e=i("a-modal");return u(),y("div",$e,[g("div",Se,[g("div",Re,[g("div",Ie,[a(ce,{layout:"inline",model:n},{default:t(()=>[a(r,{label:e.$t("withdrawal.list.billNo")},{default:t(()=>[a(f,{value:n.billNo,"onUpdate:value":o[0]||(o[0]=l=>n.billNo=l),placeholder:e.$t("withdrawal.list.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(f,{value:n.memberNickname,"onUpdate:value":o[1]||(o[1]=l=>n.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(F,{value:n.withdrawalStatus,"onUpdate:value":o[2]||(o[2]=l=>n.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),"allow-clear":""},{default:t(()=>[(u(!0),y($,null,K(J.value,l=>(u(),S(I,{key:l.value,value:l.value},{default:t(()=>[d(s(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.accountType")},{default:t(()=>[a(F,{value:n.paymentChannelId,"onUpdate:value":o[3]||(o[3]=l=>n.paymentChannelId=l),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:t(()=>[(u(!0),y($,null,K(M.value,l=>(u(),S(I,{key:l.id,value:l.id},{default:t(()=>[d(s(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(de,{value:n.timeRange,"onUpdate:value":o[4]||(o[4]=l=>n.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(r,null,{default:t(()=>[a(B,null,{default:t(()=>[a(N,{type:"primary",onClick:E},{default:t(()=>[d(s(e.$t("common.search")),1)]),_:1}),a(N,{onClick:Z},{default:t(()=>[d(s(e.$t("common.reset")),1)]),_:1}),a(A,{class:"mobile-only",onClick:o[5]||(o[5]=l=>j(R).push("/payment-transactions"))},{default:t(()=>[d(s(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(L)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),g("div",Te,[a(B,null,{default:t(()=>[a(A,{class:"desktop-only",onClick:o[6]||(o[6]=l=>j(R).push("/payment-transactions"))},{default:t(()=>[d(s(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(L)]),_:1}),a(N,{onClick:ae},{icon:t(()=>[a(ue)]),default:t(()=>[d(" "+s(e.$t("withdrawal.list.export")),1)]),_:1}),a(N,{type:"primary",onClick:H},{default:t(()=>[d(s(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(N,{danger:"",onClick:ie},{default:t(()=>[d(s(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(he,{columns:Q.value,"data-source":P.value,loading:O.value,pagination:h,rowKey:"id","row-selection":X,onChange:ee},{bodyCell:t(({column:l,record:m})=>[l.key==="nickname"?(u(),S(A,{key:0,onClick:T=>te(m)},{default:t(()=>[d(s(m.nickname),1)]),_:2},1032,["onClick"])):_("",!0),l.key==="withdrawalStatus"?(u(),y($,{key:1},[d(s(j(D).getEnumText("WithdrawalStatus",m.withdrawalStatus))+" ",1),m.withdrawalStatus==="failed"?(u(),S(me,{key:0,class:"danger",onClick:T=>le(m)},null,8,["onClick"])):_("",!0)],64)):_("",!0),l.key==="waiterName"?(u(),y($,{key:2},[d(s(m.waiterName||"--"),1)],64)):_("",!0),l.key==="action"?(u(),y($,{key:3},[m.withdrawalStatus==="pending"?(u(),S(B,{key:0},{default:t(()=>[a(we,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:T=>ne(m)},{default:t(()=>[g("a",null,s(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),g("a",null,[a(pe,{type:"danger",onClick:T=>oe(m)},{default:t(()=>[d(s(e.$t("withdrawal.list.reject")),1)]),_:2},1032,["onClick"])])]),_:2},1024)):_("",!0),m.withdrawalStatus==="failed"?(u(),y("a",{key:1,onClick:T=>j(R).push(`/payment-transactions?withdrawalId=${m.id}`)},"查看交易记录",8,je)):_("",!0)],64)):_("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),h.total?(u(),y("div",De,[a(ve,{column:2},{default:t(()=>[a(V,{label:e.$t("common.totalCount")},{default:t(()=>[d(s(h.total),1)]),_:1},8,["label"]),a(V,{label:e.$t("common.totalAmount")},{default:t(()=>[d(s(U.value),1)]),_:1},8,["label"])]),_:1})])):_("",!0)]),a(_e,{open:b.value,"onUpdate:open":o[8]||(o[8]=l=>b.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:se,confirmLoading:Y.value},{default:t(()=>[a(ye,{value:k.value,"onUpdate:value":o[7]||(o[7]=l=>k.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Be=fe(Me,[["__scopeId","data-v-14589ea9"]]);export{Be as default};
