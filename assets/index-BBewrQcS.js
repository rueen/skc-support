import{g as G,p as k}from"./request-DxnL66JX.js";import{_ as H,r as c,a as B,p as J,j as K,b,d as r,c as t,w as o,e as s,o as v,h as Q,n as C,m as X,g as Y,P as Z,k as l}from"./index-CrTl1_Bc.js";const ee={class:"channel content-container"},ae={class:"table-container"},te={class:"table-header"},ne={class:"right"},oe=["src"],se=["onClick"],le={key:0},ie={__name:"index",setup(ce){const g=c(!1),d=c(!1),y=c(!1),f=c("add"),x=c(),u=c([]),n=B({name:"",icon:""}),I={name:[{required:!0,message:"请输入渠道名称"}],icon:[{required:!0,message:"请上传渠道图标"}]},V=[{title:"渠道图标",dataIndex:"icon",key:"icon",width:100},{title:"渠道名称",dataIndex:"name",key:"name"},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt"},{title:"操作",key:"action",width:200}],w=c([]),m=B({current:1,pageSize:10,total:0}),z=J(()=>({add:"添加渠道",edit:"编辑渠道"})[f.value]),D=e=>{Object.assign(m,e),p()},M=()=>{f.value="add",n.name="",n.icon="",u.value=[],d.value=!0},N=e=>{f.value="edit",n.name=e.name,n.icon=e.icon,u.value=[{uid:"-1",name:"image.png",status:"done",url:e.icon}],d.value=!0},O=async e=>{try{const a=await k("channel.delete",{id:e.id});a.success?(l.success("删除成功"),p()):l.error(a.message)}catch{l.error("删除失败")}},T=e=>{const a=e.type.startsWith("image/");a||l.error("只能上传图片文件！");const _=e.size/1024/1024<2;return _||l.error("图片必须小于 2MB！"),a&&_},U=async()=>{const e=await k("channel.add",n);e.success?(l.success("添加成功"),d.value=!1,p()):l.error(e.message)},A=async()=>{const e=await k("channel.edit",n);e.success?(l.success("编辑成功"),d.value=!1,p()):l.error(e.message)},S=async()=>{try{switch(await x.value.validate(),y.value=!0,f.value){case"add":U();break;case"edit":A();break}}catch(e){console.error(e)}finally{y.value=!1}},p=async()=>{g.value=!0;try{const e=await G("channel.list",{page:m.current,pageSize:m.pageSize});w.value=e.data.list,m.total=e.data.total}finally{g.value=!1}};return K(()=>{p()}),(e,a)=>{const _=s("a-button"),j=s("a-popconfirm"),q=s("a-space"),E=s("a-table"),P=s("a-upload"),L=s("a-form-item"),R=s("a-input"),$=s("a-form"),W=s("a-modal");return v(),b("div",ee,[r("div",ae,[r("div",te,[a[4]||(a[4]=r("div",{class:"left"},null,-1)),r("div",ne,[t(_,{type:"primary",onClick:M},{default:o(()=>a[3]||(a[3]=[Q(" 添加渠道 ")])),_:1})])]),t(E,{columns:V,"data-source":w.value,loading:g.value,pagination:m,onChange:D},{bodyCell:o(({column:i,record:h})=>[i.key==="icon"?(v(),b("img",{key:0,src:h.icon,alt:"渠道图标",class:"channel-icon"},null,8,oe)):C("",!0),i.key==="action"?(v(),X(q,{key:1},{default:o(()=>[r("a",{onClick:F=>N(h)},"编辑",8,se),t(j,{title:"确定要删除该渠道吗？",onConfirm:F=>O(h)},{default:o(()=>a[5]||(a[5]=[r("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading","pagination"])]),t(W,{open:d.value,"onUpdate:open":a[2]||(a[2]=i=>d.value=i),title:z.value,confirmLoading:y.value,onOk:S},{default:o(()=>[t($,{ref_key:"formRef",ref:x,model:n,rules:I,"label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[t(L,{label:"渠道图标",name:"icon"},{default:o(()=>[t(P,{"file-list":u.value,"onUpdate:fileList":a[0]||(a[0]=i=>u.value=i),"before-upload":T,accept:"image/*","list-type":"picture-card","max-count":1},{default:o(()=>[u.value.length?C("",!0):(v(),b("div",le,[t(Y(Z)),a[6]||(a[6]=r("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list"])]),_:1}),t(L,{label:"渠道名称",name:"name"},{default:o(()=>[t(R,{value:n.name,"onUpdate:value":a[1]||(a[1]=i=>n.name=i),placeholder:"请输入渠道名称"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},ue=H(ie,[["__scopeId","data-v-1e2710f8"]]);export{ue as default};
