import{_ as te,a as ae,b as oe,r as D,c as O,x as ne,j as le,k as se,d as _,e as s,f as o,w as t,g as u,l as Y,m as b,h as re,o as r,F as w,n as N,p as v,i as g,t as n,s as f,q as ie,M as ce,v as me}from"./index-B3Ng1Odc.js";import{_ as z}from"./CopyContent-DRVsZ1t3.js";import{G as ue}from"./GroupOwner-CGcagicz.js";import{d as de}from"./download-BCqt4Xb4.js";const pe={class:"member-list content-container"},_e={class:"table-container"},ge={class:"table-header"},fe={class:"left"},ke={class:"right"},he={class:"link-text-container"},ye={class:"label"},be=["href"],ve={style:{color:"#999","font-size":"12px"}},we={key:0},Te=["onClick"],$e=["onClick"],Ce={class:"danger"},Se={__name:"list",setup(Ie){const A=ae(),{t:c}=oe(),C=re(),H=ne(),S=D(!1),l=O({keyword:"",groupId:H.query.groupId,createTimeRange:[]}),I=D([]),k=O({current:1,pageSize:10,total:0}),x=D([]),U=le(()=>[{title:c("member.list.memberNickname"),key:"nickname"},{title:c("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:c("member.list.accounts"),key:"accountList"},{title:c("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:c("member.list.inviter"),key:"inviterNickname"},{title:c("member.list.group"),key:"groups"},{title:c("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:c("member.list.action"),key:"action",fixed:"right",width:150}]),R=()=>{k.current=1,T()},B=()=>{Object.assign(l,{keyword:"",groupId:void 0,createTimeRange:[]}),R()},L=e=>{k.current=e.current,k.pageSize=e.pageSize,T()},V=()=>{C.push("/member/create")},F=e=>{C.push(`/member/edit/${e.id}`)},j=e=>{C.push(`/member/view/${e.id}`)},G=async e=>{const a=await me("member.delete",{},{urlParams:{id:e.id}});a.code===0?(b.success("删除成功"),T()):b.error(a.message)},T=async()=>{var e,a;S.value=!0;try{const h={page:k.current,pageSize:k.pageSize,keyword:l.keyword,groupId:l.groupId,createStartTime:(e=l.createTimeRange)==null?void 0:e[0],createEndTime:(a=l.createTimeRange)==null?void 0:a[1]},d=await Y("member.list",h);d.code===0?(I.value=d.data.list,k.total=d.data.total):b.error(d.message)}finally{S.value=!1}},E=async(e="")=>{try{const a=await Y("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(x.value=a.data.list||[])}catch{b.error("获取群组列表失败")}},P=()=>{ce.confirm({title:c("common.export"),content:c("common.confirmExportContent"),onOk:async()=>{var e,a;try{const h=b.loading(c("common.exporting"),0),d={keyword:l.keyword,groupId:l.groupId,createStartTime:(e=l.createTimeRange)==null?void 0:e[0],createEndTime:(a=l.createTimeRange)==null?void 0:a[1]};await de("member.export",d,`会员列表_${new Date().toLocaleDateString()}.xlsx`),h(),b.success(c("common.exportSuccess"))}catch(h){console.error("导出失败:",h),b.error(c("common.exportFailed"))}}})};return se(()=>{T(),E()}),(e,a)=>{const h=u("a-input"),d=u("a-form-item"),q=u("a-select-option"),J=u("a-select"),K=u("a-range-picker"),$=u("a-button"),y=u("a-space"),Q=u("a-form"),W=u("DownloadOutlined"),X=u("plus-outlined"),M=u("a-tag"),Z=u("a-popconfirm"),ee=u("a-table");return r(),_("div",pe,[s("div",_e,[s("div",ge,[s("div",fe,[o(Q,{layout:"inline",model:l},{default:t(()=>[o(d,{label:e.$t("member.search.keyword")},{default:t(()=>[o(h,{value:l.keyword,"onUpdate:value":a[0]||(a[0]=i=>l.keyword=i),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(d,{label:e.$t("member.search.group")},{default:t(()=>[o(J,{value:l.groupId,"onUpdate:value":a[1]||(a[1]=i=>l.groupId=i),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:E,style:{width:"200px"}},{default:t(()=>[(r(!0),_(w,null,N(x.value,i=>(r(),v(q,{key:i.id,value:i.id},{default:t(()=>[g(n(i.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(d,{label:e.$t("member.search.createTime")},{default:t(()=>[o(K,{value:l.createTimeRange,"onUpdate:value":a[2]||(a[2]=i=>l.createTimeRange=i),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(d,null,{default:t(()=>[o(y,null,{default:t(()=>[o($,{type:"primary",onClick:R},{default:t(()=>[g(n(e.$t("common.search")),1)]),_:1}),o($,{onClick:B},{default:t(()=>[g(n(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",ke,[o(y,null,{default:t(()=>[I.value.length?(r(),v($,{key:0,onClick:P},{icon:t(()=>[o(W)]),default:t(()=>[g(" "+n(e.$t("common.export")),1)]),_:1})):f("",!0),o($,{type:"primary",onClick:V},{icon:t(()=>[o(X)]),default:t(()=>[g(" "+n(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),o(ee,{columns:U.value,"data-source":I.value,loading:S.value,pagination:k,onChange:L},{bodyCell:t(({column:i,record:p})=>[i.key==="nickname"?(r(),v(y,{key:0},{default:t(()=>[s("span",null,n(p.nickname),1),p.isNew?(r(),v(M,{key:0,color:"green"},{default:t(()=>a[3]||(a[3]=[g("new")])),_:1})):f("",!0)]),_:2},1024)):f("",!0),i.key==="accountList"?(r(),v(y,{key:1,direction:"vertical"},{default:t(()=>[(r(!0),_(w,null,N(p.accountList,m=>(r(),_("div",null,[s("div",null,[o(y,null,{default:t(()=>[g(n(e.$t("member.list.account"))+"："+n(m.account)+" ",1),o(M,{color:"warning"},{default:t(()=>[g(n(ie(A).getEnumText("AccountAuditStatus",m.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),s("div",he,[s("span",ye,n(e.$t("member.list.homepage"))+"：",1),o(z,{content:m.homeUrl},{default:t(()=>[s("a",{href:m.homeUrl,target:"_blank",class:"link-text"},n(m.homeUrl),9,be)]),_:2},1032,["content"])]),s("div",null,[a[4]||(a[4]=s("span",{class:"label"},"uid：",-1)),o(z,{content:m.uid},null,8,["content"])])]))),256))]),_:2},1024)):f("",!0),i.key==="inviterNickname"?(r(),_(w,{key:2},[g(n(p.inviterNickname||"--"),1)],64)):f("",!0),i.key==="groups"?(r(),_(w,{key:3},[(r(!0),_(w,null,N(p.groups,m=>(r(),_("div",null,[o(y,null,{default:t(()=>[s("span",null,n(m.groupName),1),m.isOwner?(r(),v(ue,{key:0})):f("",!0)]),_:2},1024),s("div",ve,n(m.joinTime),1)]))),256)),!p.groups||p.groups.length===0?(r(),_("span",we,"--")):f("",!0)],64)):f("",!0),i.key==="action"?(r(),v(y,{key:4},{default:t(()=>[s("a",{onClick:m=>F(p)},n(e.$t("member.list.edit")),9,Te),s("a",{onClick:m=>j(p)},n(e.$t("member.list.view")),9,$e),o(Z,{title:e.$t("member.list.deleteConfirm"),onConfirm:m=>G(p)},{default:t(()=>[s("a",Ce,n(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):f("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Ee=te(Se,[["__scopeId","data-v-1fc6d79a"]]);export{Ee as default};
