import{_ as de,b as ie,a as ne,x as ue,j as oe,c as q,r as y,k as re,d as p,f as a,e as c,w as t,g as b,t as s,F as I,n as w,p as m,s as k,l as R,m as f,h as ce,o as u,i,q as P,A as V}from"./index-QyF0JL28.js";import{P as me}from"./PageHeader-DZMsOZSf.js";import{_ as be}from"./CopyContent-BbvB_JPC.js";import{G as ke}from"./GroupOwner-D4a-IMLW.js";const pe={class:"task-audit-detail content-container"},fe={class:"detail-container"},_e={key:0},Te={key:1},ve={class:"detail-section"},he={class:"section-title"},ge={key:0},$e={class:"link-text-container"},ye=["href"],Ie={class:"detail-section"},Ce={class:"section-title"},Se={class:"detail-section"},Ae={class:"section-title"},je={class:"footer-btns"},we={class:"left"},Re={class:"right"},Pe={__name:"detail",setup(Ne){const{t:B}=ie(),C=ne(),F=ue(),D=ce(),N=F.query.type,L=oe(()=>n.taskPreAuditStatus==="approved"?"confirm":"pre"),S=y(!1),E=y(!1),v=y(""),_=y(null),n=q({submitContent:{}}),r=q({}),T=q({}),M=async()=>{const e=L.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",o=await V(e,{ids:[_.value]});o.code===0?(f.success(B("submittedTasks.detail.resolveSuccess")),h()):f.error(o.message)},G=()=>{v.value="",S.value=!0},z=async()=>{if(!v.value){f.error($t("submittedTasks.detail.rejectReasonRequired"));return}E.value=!0;const e=L.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject",o=await V(e,{ids:[_.value],reason:v.value});o.code===0?(f.success($t("submittedTasks.detail.rejectSuccess")),S.value=!1,h()):f.error(o.message)},H=()=>{D.push(`/submitted-tasks/detail/${n.prevTaskId}?type=${N}`),_.value=n.prevTaskId,h()},Q=()=>{D.push(`/submitted-tasks/detail/${n.nextTaskId}?type=${N}`),_.value=n.nextTaskId,h()},W=async e=>{try{const o=await R("task.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(r,o.data):f.error(o.message)}catch{f.error($t("submittedTasks.detail.getTaskDetailFailed"))}},J=async e=>{try{const o=await R("member.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(T,o.data):f.error(o.message)}catch{f.error($t("submittedTasks.detail.getMemberDetailFailed"))}},h=async()=>{try{const e=await R("taskSubmitted.detail",{auditType:N},{urlParams:{id:_.value}});e.code===0&&(Object.assign(n,e.data),e.data.taskId!=null&&await W(e.data.taskId),e.data.memberId!=null&&await J(e.data.memberId),e.data.taskId!=null&&e.data.memberId!=null&&await K())}catch{f.error($t("submittedTasks.detail.getDetailFailed"))}},O=y([]),K=async()=>{const e=await R("account.list",{taskId:n.taskId,memberId:n.memberId,channelId:r.channelId});e.code===0&&(O.value=e.data.list||[])};return re(async()=>{_.value=F.params.id,await h()}),(e,o)=>{const U=b("a-avatar"),g=b("a-space"),l=b("a-descriptions-item"),$=b("a-descriptions"),X=b("a-collapse-panel"),Y=b("a-collapse"),Z=b("a-tag"),x=b("a-image"),A=b("a-button"),ee=b("a-textarea"),te=b("a-modal");return u(),p("div",pe,[a(me,{title:e.$t("submittedTasks.detail.title"),back:!0},null,8,["title"]),c("div",fe,[a(Y,{ghost:"",class:"collapse"},{default:t(()=>[a(X,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(g,null,{default:t(()=>[a(U,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(r.taskName),1)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[i(s(r.category),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[i(s(P(C).getEnumText("TaskType",r.taskType)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[i(s(r.reward),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[i(s(r.brand),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var d;return[r.groupMode===0?(u(),p("span",_e,s(e.$t("submittedTasks.detail.noSpecify")),1)):(u(),p("span",Te,s((d=r.groupNames)==null?void 0:d.join("ã€")),1))]}),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[i(s(r.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(r.endTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[i(s(r.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):r.quota),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[i(s(r.fansRequired),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[i(s(r.contentRequirement),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[i(s(r.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),c("div",ve,[c("div",he,s(e.$t("submittedTasks.detail.memberInfo")),1),a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[i(s(T.nickname),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[i(s(T.account),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(u(!0),p(I,null,w(T.groups,d=>(u(),m(g,null,{default:t(()=>[c("span",null,s(d.groupName),1),d.isOwner?(u(),m(ke,{key:0})):k("",!0)]),_:2},1024))),256)),!T.groups||T.groups.length===0?(u(),p("span",ge,"--")):k("",!0)]),_:1},8,["label"])]),_:1}),(u(!0),p(I,null,w(O.value,d=>(u(),p("div",{key:d.channelId},[a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(g,null,{default:t(()=>[a(U,{src:d.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(d.account),1),a(Z,{color:"warning"},{default:t(()=>[i(s(P(C).getEnumText("AccountAuditStatus",d.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(l,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(be,{content:d.homeUrl},{default:t(()=>[c("div",$e,[c("a",{href:d.homeUrl,target:"_blank",class:"link-text"},s(d.homeUrl),9,ye)])]),_:2},1032,["content"])]),_:2},1032,["label"]),d.channelCustomFields.includes("fansCount")?(u(),m(l,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[i(s(d.fansCount),1)]),_:2},1032,["label"])):k("",!0),d.channelCustomFields.includes("friendsCount")?(u(),m(l,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[i(s(d.friendsCount),1)]),_:2},1032,["label"])):k("",!0),d.channelCustomFields.includes("postsCount")?(u(),m(l,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[i(s(d.postsCount),1)]),_:2},1032,["label"])):k("",!0)]),_:2},1024)]))),128))]),c("div",Ie,[c("div",Ce,s(e.$t("submittedTasks.detail.submitInfo")),1),a($,{column:2},{default:t(()=>{var d;return[(u(!0),p(I,null,w((d=n==null?void 0:n.submitContent)==null?void 0:d.customFields,(j,ae)=>(u(),m(l,{key:ae,label:j.title},{default:t(()=>[j.type==="image"?(u(!0),p(I,{key:0},w(j.value,(se,le)=>(u(),m(x,{src:se.url,width:60,key:le},null,8,["src"]))),128)):(u(),p(I,{key:1},[i(s(j.value),1)],64))]),_:2},1032,["label"]))),128))]}),_:1})]),c("div",Se,[c("div",Ae,s(e.$t("submittedTasks.detail.auditInfo")),1),a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[i(s(n.submitTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[i(s(P(C).getEnumText("TaskPreAuditStatus",n.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[i(s(n.preWaiterName),1)]),_:1},8,["label"]),n.taskPreAuditStatus==="approved"?(u(),m(l,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[i(s(P(C).getEnumText("TaskAuditStatus",n.taskAuditStatus)),1)]),_:1},8,["label"])):k("",!0),n.taskPreAuditStatus==="approved"?(u(),m(l,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[i(s(n.waiterName),1)]),_:1},8,["label"])):k("",!0),n.auditStatus==="rejected"?(u(),m(l,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[i(s(n.rejectReason),1)]),_:1},8,["label"])):k("",!0)]),_:1})]),c("div",je,[c("div",we,[n.auditStatus==="pending"?(u(),m(g,{key:0},{default:t(()=>[a(A,{type:"primary",onClick:M},{default:t(()=>[i(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(A,{danger:"",onClick:G},{default:t(()=>[i(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):k("",!0)]),c("div",Re,[a(g,null,{default:t(()=>[n.prevTaskId&&n.prevTaskId!==n.nextTaskId?(u(),m(A,{key:0,onClick:H},{default:t(()=>[i(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):k("",!0),n.nextTaskId?(u(),m(A,{key:1,onClick:Q},{default:t(()=>[i(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):k("",!0)]),_:1})])])]),a(te,{open:S.value,"onUpdate:open":o[1]||(o[1]=d=>S.value=d),title:e.$t("submittedTasks.detail.rejectReason"),onOk:z,confirmLoading:E.value},{default:t(()=>[a(ee,{value:v.value,"onUpdate:value":o[0]||(o[0]=d=>v.value=d),placeholder:e.$t("submittedTasks.detail.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Ee=de(Pe,[["__scopeId","data-v-115841eb"]]);export{Ee as default};
