import{g as Q,p as w}from"./request-DpAzyv0l.js";import{_ as X,r as m,a as C,p as Y,j as Z,b,d as p,c as o,w as n,e as r,o as _,h as D,m as B,n as y,F as ee,l as ae,t as te,k as i}from"./index-DCqgSKVo.js";const se={class:"waiter content-container"},oe={class:"table-container"},ne={class:"table-header"},re={class:"right"},ie=["onClick"],le={__name:"index",setup(me){const k=m(!1),l=m(!1),g=m(!1),d=m("add"),h=m(),t=C({username:"",password:"",remarks:"",permissions:[]}),V={username:[{required:!0,message:"请输入用户名"}],password:[{required:!0,message:"请输入密码",trigger:"change"}]},A=[{title:"task",permissions:"task:list"},{title:"taskCreate",permissions:"task:create"},{title:"taskEdit",permissions:"task:edit"},{title:"account",permissions:"account:list"},{title:"taskAudit",permissions:"task:audit"},{title:"taskAuditDetail",permissions:"task:auditDetail"},{title:"member",permissions:"member:list"},{title:"memberCreate",permissions:"member:create"},{title:"memberEdit",permissions:"member:edit"},{title:"memberView",permissions:"member:view"},{title:"channel",permissions:"channel:list"},{title:"group",permissions:"group:list"},{title:"withdrawal",permissions:"settlement:withdrawal"},{title:"otherBills",permissions:"settlement:otherBills"},{title:"waiter",permissions:"waiter:list"},{title:"article",permissions:"article:list"}],U=[{title:"账号名称",dataIndex:"username",key:"username"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"操作",key:"action",width:200}],x=m([]),c=C({current:1,pageSize:10,total:0}),q=Y(()=>d.value==="add"?"添加账号":"编辑账号"),E=e=>{Object.assign(c,e),u()},L=()=>{d.value="add",t.username="",t.password="",t.remarks="",t.permissions=[],l.value=!0},N=e=>{d.value="edit",t.username=e.username,t.password="",t.remarks=e.remarks,t.permissions=e.permissions,l.value=!0},O=async e=>{try{const a=await w("waiter.delete",{id:e.id});a.code===0?(i.success("删除成功"),u()):i.error(a.message)}catch{i.error("删除失败")}},S=async()=>{const e=await w("waiter.add",t);e.code===0?(i.success("添加成功"),l.value=!1,u()):i.error(e.message)},T=async()=>{const e=await w("waiter.edit",t);e.code===0?(i.success("编辑成功"),l.value=!1,u()):i.error(e.message)},z=async()=>{try{switch(await h.value.validate(),g.value=!0,d.value){case"add":S();break;case"edit":T();break}}catch(e){console.error(e)}finally{g.value=!1}},u=async()=>{k.value=!0;try{const e=await Q("waiter.list",{page:c.current,pageSize:c.pageSize});x.value=e.data.list,c.total=e.data.total}finally{k.value=!1}};return Z(()=>{u()}),(e,a)=>{const F=r("a-button"),I=r("a-popconfirm"),$=r("a-space"),j=r("a-table"),R=r("a-input"),f=r("a-form-item"),W=r("a-input-password"),M=r("a-textarea"),G=r("a-checkbox"),H=r("a-checkbox-group"),J=r("a-form"),K=r("a-modal");return _(),b("div",se,[p("div",oe,[p("div",ne,[a[6]||(a[6]=p("div",{class:"left"},null,-1)),p("div",re,[o(F,{type:"primary",onClick:L},{default:n(()=>a[5]||(a[5]=[D(" 添加账号 ")])),_:1})])]),o(j,{columns:U,"data-source":x.value,loading:k.value,pagination:c,onChange:E},{bodyCell:n(({column:s,record:v})=>[s.key==="action"?(_(),B($,{key:0},{default:n(()=>[v.isAdmin?y("",!0):(_(),b("a",{key:0,onClick:P=>N(v)},"编辑",8,ie)),v.isAdmin?y("",!0):(_(),B(I,{key:1,title:"确定要删除该账号吗？",onConfirm:P=>O(v)},{default:n(()=>a[7]||(a[7]=[p("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"]))]),_:2},1024)):y("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(K,{open:l.value,"onUpdate:open":a[4]||(a[4]=s=>l.value=s),title:q.value,confirmLoading:g.value,onOk:z},{default:n(()=>[o(J,{ref_key:"formRef",ref:h,model:t,rules:V,"label-col":{span:6},"wrapper-col":{span:16}},{default:n(()=>[o(f,{label:"用户名",name:"username"},{default:n(()=>[o(R,{value:t.username,"onUpdate:value":a[0]||(a[0]=s=>t.username=s),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),o(f,{label:"密码",name:"password",required:d.value==="add"},{default:n(()=>[o(W,{value:t.password,"onUpdate:value":a[1]||(a[1]=s=>t.password=s),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["required"]),o(f,{label:"备注",name:"remarks"},{default:n(()=>[o(M,{value:t.remarks,"onUpdate:value":a[2]||(a[2]=s=>t.remarks=s),placeholder:"请输入备注",rows:3},null,8,["value"])]),_:1}),o(f,{label:"权限",name:"permissions"},{default:n(()=>[o(H,{value:t.permissions,"onUpdate:value":a[3]||(a[3]=s=>t.permissions=s)},{default:n(()=>[(_(),b(ee,null,ae(A,s=>o(G,{key:s.title,value:s.permissions},{default:n(()=>[D(te(e.$t("menu."+s.title)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},ue=X(le,[["__scopeId","data-v-9272dec3"]]);export{ue as default};
