import{b as de,r as i,c as P,j,k as ie,d as w,e as p,f as o,w as a,g as r,l as F,m as d,h as pe,o as c,F as D,n as A,p as b,i as m,t as s,s as E,v as ce,z as me,A as ge}from"./index-C_vAxHhQ.js";import{_ as fe}from"./CopyContent--2BlH1Es.js";const _e={class:"content-container"},ve={class:"table-container"},ke={class:"table-header"},he={class:"left"},ye={class:"right"},we=["onClick"],be={class:"link-text-container"},Ne=["href"],Ie={__name:"index",setup(Le){const{t:u}=de(),G=pe(),N=i(!1),_=i(!1),L=i(!1),y=i("add"),O=i(),g=P({groupName:"",ownerId:void 0}),l=P({groupName:"",groupLink:"",ownerId:void 0}),R=i(void 0),H={groupName:[{required:!0,message:u("group.groupNameRequired")}],groupLink:[{required:!0,message:u("group.groupLinkRequired")}]},$=i([]),J=j(()=>[{title:"ID",dataIndex:"id",key:"id",width:100},{title:u("group.groupName"),dataIndex:"groupName",key:"groupName"},{title:u("group.groupLink"),dataIndex:"groupLink",key:"groupLink",ellipsis:!0},{title:u("group.owner"),dataIndex:"ownerName",key:"ownerName"},{title:u("group.memberCount"),key:"memberCount",align:"right"},{title:u("group.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:u("group.action"),key:"action",width:200}]),U=i([]),v=P({current:1,pageSize:10,total:0}),K=j(()=>({add:u("group.addTitle"),edit:u("group.editTitle")})[y.value]),V=()=>{v.current=1,k()},Q=()=>{Object.assign(g,{name:"",ownerId:void 0}),V()},W=e=>{Object.assign(v,e),k()},X=()=>{y.value="add",l.groupName="",l.groupLink="",l.ownerId=void 0,_.value=!0},Y=e=>{G.push(`/member?groupId=${e.id}`)},Z=e=>{R.value=e.id,y.value="edit",l.groupName=e.groupName,l.groupLink=e.groupLink,l.ownerId=e.ownerId,_.value=!0},x=async e=>{try{const n=await ce("group.delete",{id:e.id},{urlParams:{id:e.id}});n.code===0?(d.success("删除成功"),k()):d.error(n.message)}catch{d.error("删除失败")}},ee=async()=>{const e=await ge("group.add",l);e.code===0?(d.success("添加成功"),_.value=!1,k()):d.error(e.message)},ae=async()=>{const e=await me("group.edit",l,{urlParams:{id:R.value}});e.code===0?(d.success("编辑成功"),_.value=!1,k()):d.error(e.message)},oe=async()=>{try{switch(await O.value.validate(),L.value=!0,y.value){case"add":await ee();break;case"edit":await ae();break}}catch(e){console.error(e)}finally{L.value=!1}},k=async()=>{N.value=!0;try{const e=await F("group.list",{page:v.current,pageSize:v.pageSize,...g});e.code===0?(U.value=e.data.list,v.total=e.data.total):d.error(e.message)}finally{N.value=!1}},C=async(e="")=>{try{const n=await F("member.list",{page:1,pageSize:50,memberNickname:e});n.code===0&&($.value=n.data.list||[])}catch{d.error("获取会员列表失败")}};return ie(()=>{k(),C()}),(e,n)=>{const I=r("a-input"),h=r("a-form-item"),z=r("a-select-option"),q=r("a-select"),T=r("a-button"),S=r("a-space"),B=r("a-form"),te=r("plus-outlined"),ne=r("a-typography-link"),le=r("a-typography-text"),re=r("a-popconfirm"),ue=r("a-table"),se=r("a-modal");return c(),w("div",_e,[p("div",ve,[p("div",ke,[p("div",he,[o(B,{layout:"inline",model:g},{default:a(()=>[o(h,{label:e.$t("group.groupName")},{default:a(()=>[o(I,{value:g.groupName,"onUpdate:value":n[0]||(n[0]=t=>g.groupName=t),placeholder:e.$t("group.groupNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(h,{label:e.$t("group.owner")},{default:a(()=>[o(q,{value:g.ownerId,"onUpdate:value":n[1]||(n[1]=t=>g.ownerId=t),placeholder:e.$t("group.ownerPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:C},{default:a(()=>[(c(!0),w(D,null,A($.value,t=>(c(),b(z,{key:t.id,value:t.id},{default:a(()=>[m(s(t.memberNickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(h,null,{default:a(()=>[o(S,null,{default:a(()=>[o(T,{type:"primary",onClick:V},{default:a(()=>[m(s(e.$t("common.search")),1)]),_:1}),o(T,{onClick:Q},{default:a(()=>[m(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",ye,[o(S,null,{default:a(()=>[o(T,{type:"primary",onClick:X},{icon:a(()=>[o(te)]),default:a(()=>[m(" "+s(e.$t("group.add")),1)]),_:1})]),_:1})])]),o(ue,{columns:J.value,"data-source":U.value,loading:N.value,pagination:v,onChange:W},{bodyCell:a(({column:t,record:f})=>[t.key==="memberCount"?(c(),w(D,{key:0},[m(s(f.memberCount)+" ",1),o(ne,{onClick:M=>Y(f)},{default:a(()=>[m(s(e.$t("group.view")),1)]),_:2},1032,["onClick"])],64)):E("",!0),t.key==="action"?(c(),b(S,{key:1},{default:a(()=>[p("a",{onClick:M=>Z(f)},s(e.$t("group.edit")),9,we),o(re,{title:e.$t("group.deleteConfirm"),onConfirm:M=>x(f)},{default:a(()=>[p("a",null,[o(le,{type:"danger"},{default:a(()=>[m(s(e.$t("group.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):t.key==="groupLink"?(c(),b(fe,{key:2,content:f.groupLink},{default:a(()=>[p("div",be,[p("a",{href:f.groupLink,target:"_blank",class:"link-text"},s(f.groupLink),9,Ne)])]),_:2},1032,["content"])):E("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),o(se,{open:_.value,"onUpdate:open":n[5]||(n[5]=t=>_.value=t),title:K.value,confirmLoading:L.value,onOk:oe},{default:a(()=>[o(B,{ref_key:"formRef",ref:O,model:l,rules:H,"label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[o(h,{label:e.$t("group.groupName"),name:"groupName"},{default:a(()=>[o(I,{value:l.groupName,"onUpdate:value":n[2]||(n[2]=t=>l.groupName=t),placeholder:e.$t("group.groupNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(h,{label:e.$t("group.groupLink"),name:"groupLink"},{default:a(()=>[o(I,{value:l.groupLink,"onUpdate:value":n[3]||(n[3]=t=>l.groupLink=t),placeholder:e.$t("group.groupLinkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(h,{label:e.$t("group.owner"),name:"ownerId"},{default:a(()=>[o(q,{value:l.ownerId,"onUpdate:value":n[4]||(n[4]=t=>l.ownerId=t),placeholder:e.$t("group.ownerPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:C},{default:a(()=>[(c(!0),w(D,null,A($.value,t=>(c(),b(z,{key:t.id,value:t.id},{default:a(()=>[m(s(t.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}};export{Ie as default};
