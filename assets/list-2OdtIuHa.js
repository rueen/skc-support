import{_ as se,a as re,b as ie,r as $,c as L,x as ce,j as ue,k as de,d as _,e as i,f as o,w as a,g as c,l as M,m as h,h as me,o as s,F as w,n as I,p as f,i as k,t as r,s as g,q as pe,M as _e,v as ke}from"./index-DKN7kQx8.js";import{_ as B}from"./CopyContent-BRSViOOY.js";import{G as fe}from"./GroupOwner-C_MxMMXv.js";import{d as ge}from"./download-4uepy7Vu.js";const ve={class:"member-list content-container"},ye={class:"table-container"},be={class:"table-header"},he={class:"left"},we={class:"right"},Ce={class:"link-text-container"},Te={class:"label"},$e=["href"],Ie={key:1},Se={style:{color:"#999","font-size":"12px"}},De={key:0},Ne=["onClick"],xe=["onClick"],Me={class:"danger"},Oe={__name:"list",setup(Re){const F=re(),{t:d}=ie(),S=me(),P=ce(),D=$(!1),n=L({keyword:"",groupId:P.query.groupId,inviterId:void 0,completedTaskCount:void 0,createTimeRange:[]}),N=$([]),v=L({current:1,pageSize:10,total:0}),O=$([]),V=ue(()=>[{title:d("member.list.memberNickname"),key:"nickname"},{title:d("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:d("member.list.accounts"),key:"accountList"},{title:d("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:d("member.list.inviter"),key:"inviterNickname"},{title:d("member.list.group"),key:"groups"},{title:d("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:d("member.list.action"),key:"action",fixed:"right",width:150}]),R=()=>{v.current=1,C()},j=()=>{Object.assign(n,{keyword:"",groupId:void 0,inviterId:void 0,completedTaskCount:void 0,createTimeRange:[]}),R()},G=e=>{v.current=e.current,v.pageSize=e.pageSize,C()},q=()=>{S.push("/member/create")},J=e=>{S.push(`/member/edit/${e.id}`)},z=e=>{S.push(`/member/view/${e}`)},K=async e=>{const t=await ke("member.delete",{},{urlParams:{id:e.id}});t.code===0?(h.success("删除成功"),C()):h.error(t.message)},C=async()=>{var e,t;D.value=!0;try{const y={page:v.current,pageSize:v.pageSize,keyword:n.keyword,groupId:n.groupId,inviterId:n.inviterId,completedTaskCount:n.completedTaskCount,createStartTime:(e=n.createTimeRange)==null?void 0:e[0],createEndTime:(t=n.createTimeRange)==null?void 0:t[1]},m=await M("member.list",y);m.code===0?(N.value=m.data.list,v.total=m.data.total):h.error(m.message)}finally{D.value=!1}},E=async(e="")=>{try{const t=await M("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(O.value=t.data.list||[])}catch{h.error("获取群组列表失败")}},Q=()=>{_e.confirm({title:d("common.export"),content:d("common.confirmExportContent"),onOk:async()=>{var e,t;try{const y=h.loading(d("common.exporting"),0),m={keyword:n.keyword,groupId:n.groupId,inviterId:n.inviterId,completedTaskCount:n.completedTaskCount,createStartTime:(e=n.createTimeRange)==null?void 0:e[0],createEndTime:(t=n.createTimeRange)==null?void 0:t[1]};await ge("member.export",m,`会员列表_${new Date().toLocaleDateString()}.xlsx`),y(),h.success(d("common.exportSuccess"))}catch(y){console.error("导出失败:",y),h.error(d("common.exportFailed"))}}})},x=$([]),W=async()=>{x.value.length||await U()},U=async(e="")=>{const t=await M("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(x.value=t.data.list||[])};return de(()=>{C(),E()}),(e,t)=>{const y=c("a-input"),m=c("a-form-item"),Y=c("a-select-option"),A=c("a-select"),X=c("a-input-number"),Z=c("a-range-picker"),T=c("a-button"),b=c("a-space"),ee=c("a-form"),te=c("DownloadOutlined"),ae=c("plus-outlined"),H=c("a-tag"),oe=c("a-typography-link"),ne=c("a-popconfirm"),le=c("a-table");return s(),_("div",ve,[i("div",ye,[i("div",be,[i("div",he,[o(ee,{layout:"inline",model:n},{default:a(()=>[o(m,{label:e.$t("member.search.keyword")},{default:a(()=>[o(y,{value:n.keyword,"onUpdate:value":t[0]||(t[0]=l=>n.keyword=l),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("member.search.group")},{default:a(()=>[o(A,{value:n.groupId,"onUpdate:value":t[1]||(t[1]=l=>n.groupId=l),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:E,style:{width:"200px"}},{default:a(()=>[(s(!0),_(w,null,I(O.value,l=>(s(),f(Y,{key:l.id,value:l.id},{default:a(()=>[k(r(l.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("member.list.inviter")},{default:a(()=>[o(A,{value:n.inviterId,"onUpdate:value":t[2]||(t[2]=l=>n.inviterId=l),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onFocus:W,onSearch:U},{default:a(()=>[(s(!0),_(w,null,I(x.value,l=>(s(),f(Y,{key:l.id,value:l.id},{default:a(()=>[k(r(l.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("member.list.completedTaskCount")},{default:a(()=>[o(X,{value:n.completedTaskCount,"onUpdate:value":t[3]||(t[3]=l=>n.completedTaskCount=l),min:0,max:9999,style:{width:"100px!important"}},null,8,["value"])]),_:1},8,["label"]),o(m,{label:e.$t("member.search.createTime")},{default:a(()=>[o(Z,{value:n.createTimeRange,"onUpdate:value":t[4]||(t[4]=l=>n.createTimeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(m,null,{default:a(()=>[o(b,null,{default:a(()=>[o(T,{type:"primary",onClick:R},{default:a(()=>[k(r(e.$t("common.search")),1)]),_:1}),o(T,{onClick:j},{default:a(()=>[k(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",we,[o(b,null,{default:a(()=>[N.value.length?(s(),f(T,{key:0,onClick:Q},{icon:a(()=>[o(te)]),default:a(()=>[k(" "+r(e.$t("common.export")),1)]),_:1})):g("",!0),o(T,{type:"primary",onClick:q},{icon:a(()=>[o(ae)]),default:a(()=>[k(" "+r(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),o(le,{columns:V.value,"data-source":N.value,loading:D.value,pagination:v,onChange:G},{bodyCell:a(({column:l,record:p})=>[l.key==="nickname"?(s(),f(b,{key:0},{default:a(()=>[i("span",null,r(p.nickname),1),p.isNew?(s(),f(H,{key:0,color:"green"},{default:a(()=>t[5]||(t[5]=[k("new")])),_:1})):g("",!0)]),_:2},1024)):g("",!0),l.key==="accountList"?(s(),f(b,{key:1,direction:"vertical"},{default:a(()=>[(s(!0),_(w,null,I(p.accountList,u=>(s(),_("div",null,[i("div",null,[o(b,null,{default:a(()=>[k(r(e.$t("member.list.account"))+"："+r(u.account)+" ",1),o(H,{color:"warning"},{default:a(()=>[k(r(pe(F).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),i("div",Ce,[i("span",Te,r(e.$t("member.list.homepage"))+"：",1),o(B,{content:u.homeUrl},{default:a(()=>[i("a",{href:u.homeUrl,target:"_blank",class:"link-text"},r(u.homeUrl),9,$e)]),_:2},1032,["content"])]),i("div",null,[t[6]||(t[6]=i("span",{class:"label"},"uid：",-1)),o(B,{content:u.uid},null,8,["content"])])]))),256))]),_:2},1024)):g("",!0),l.key==="inviterNickname"?(s(),_(w,{key:2},[p.inviterId?(s(),f(oe,{key:0,onClick:u=>z(p.inviterId)},{default:a(()=>[k(r(p.inviterNickname),1)]),_:2},1032,["onClick"])):(s(),_("span",Ie,"--"))],64)):g("",!0),l.key==="groups"?(s(),_(w,{key:3},[(s(!0),_(w,null,I(p.groups,u=>(s(),_("div",null,[o(b,null,{default:a(()=>[i("span",null,r(u.groupName),1),u.isOwner?(s(),f(fe,{key:0})):g("",!0)]),_:2},1024),i("div",Se,r(u.joinTime),1)]))),256)),!p.groups||p.groups.length===0?(s(),_("span",De,"--")):g("",!0)],64)):g("",!0),l.key==="action"?(s(),f(b,{key:4},{default:a(()=>[i("a",{onClick:u=>J(p)},r(e.$t("member.list.edit")),9,Ne),i("a",{onClick:u=>z(p.id)},r(e.$t("member.list.view")),9,xe),o(ne,{title:e.$t("member.list.deleteConfirm"),onConfirm:u=>K(p)},{default:a(()=>[i("a",Me,r(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):g("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Ae=se(Oe,[["__scopeId","data-v-89f9774c"]]);export{Ae as default};
