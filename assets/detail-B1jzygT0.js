import{_ as F,r as i,i as D,p as H,q as J,a as K,j as Q,b as m,c as o,d as W,w as s,e as l,k as c,f as X,o as u,F as k,l as I,m as O,h as d,t as x,g as Y}from"./index-CUxxoPlX.js";import{P as ee}from"./index-HCny0Who.js";import{O as ae,i as te}from"./enums-BRJzZuqT.js";import{g as h,p as z}from"./request-BwrBeGQu.js";const oe={class:"member-form content-container"},se={class:"form-container"},ne={__name:"detail",setup(re){const L=J(),f=X(),C=i(),{t:le,locale:G}=D(),v=H(()=>!!L.params.id),n=K({name:"",account:"",occupation:void 0,groupId:void 0,isGroupOwner:!1,inviterId:void 0}),P={name:[{required:!0,message:"请输入会员名称"}],account:[{required:!0,message:"请输入账号"},{validator:(a,e)=>{const p=/^1[3-9]\d{9}$/,r=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!e||p.test(e)||r.test(e)?Promise.resolve():Promise.reject("请输入正确的手机号或邮箱格式")}}],groupId:[{required:!0,message:"请选择所属群"}],inviterId:[{required:!0,message:"请选择邀请人"}]},_=i(!1),R=i([]),g=i(!1),U=i([]),S=(a,e)=>e.children.toLowerCase().indexOf(a.toLowerCase())>=0,T=async()=>{_.value=!0;try{const a=await h("group.list",{params:{page:1,pageSize:50,keyword:""}});a.success&&(R.value=a.data.list||[])}finally{_.value=!1}},j=async()=>{g.value=!0;try{const a=await h("member.list",{params:{page:1,pageSize:50}});a.success&&(U.value=a.data.list||[])}finally{g.value=!1}},B=async()=>{if(v.value)try{const a=await h("member.detail",{params:{id:L.params.id}});a.success&&Object.assign(n,a.data)}catch{c.error("加载会员信息失败"),f.back()}},M=async()=>{const a=await z("member.add",n);a.success?(c.success("提交成功"),f.back()):c.error(a.message)},$=async()=>{const a=await z("member.edit",n);a.success?(c.success("提交成功"),f.back()):c.error(a.message)},b=i(!1),A=()=>{C.value.validate().then(async()=>{try{b.value=!0,v.value?$():M()}catch{c.error("提交失败")}finally{b.value=!1}})},N=a=>{var e;return((e=te[a])==null?void 0:e[G.value])||a};return Q(()=>{T(),j(),B()}),(a,e)=>{const p=l("a-input"),r=l("a-form-item"),y=l("a-select-option"),w=l("a-select"),V=l("a-switch"),q=l("a-button"),Z=l("a-space"),E=l("a-form");return u(),m("div",oe,[o(ee,{title:v.value?"编辑会员":"新增会员",back:!0,class:"page-header"},null,8,["title"]),W("div",se,[o(E,{ref_key:"formRef",ref:C,model:n,rules:P,"label-col":{span:4},"wrapper-col":{span:16}},{default:s(()=>[o(r,{label:"会员名称",name:"name"},{default:s(()=>[o(p,{value:n.name,"onUpdate:value":e[0]||(e[0]=t=>n.name=t),placeholder:"请输入会员名称"},null,8,["value"])]),_:1}),o(r,{label:"账号",name:"account"},{default:s(()=>[o(p,{value:n.account,"onUpdate:value":e[1]||(e[1]=t=>n.account=t),placeholder:"请输入账号（手机号/邮箱）"},null,8,["value"])]),_:1}),o(r,{label:"所属群",name:"groupId"},{default:s(()=>[o(w,{value:n.groupId,"onUpdate:value":e[2]||(e[2]=t=>n.groupId=t),placeholder:"请选择所属群",loading:_.value},{default:s(()=>[(u(!0),m(k,null,I(R.value,t=>(u(),O(y,{key:t.id,value:t.id},{default:s(()=>[d(x(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(r,{label:"邀请人",name:"inviterId"},{default:s(()=>[o(w,{value:n.inviterId,"onUpdate:value":e[3]||(e[3]=t=>n.inviterId=t),placeholder:"请选择邀请人",loading:g.value,"show-search":"","filter-option":S},{default:s(()=>[(u(!0),m(k,null,I(U.value,t=>(u(),O(y,{key:t.id,value:t.id},{default:s(()=>[d(x(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(r,{label:"职业",name:"occupation"},{default:s(()=>[o(w,{value:n.occupation,"onUpdate:value":e[4]||(e[4]=t=>n.occupation=t),placeholder:"请选择职业",style:{width:"200px"}},{default:s(()=>[(u(!0),m(k,null,I(Object.values(Y(ae)),t=>(u(),O(y,{key:t,value:t},{default:s(()=>[d(x(N(t)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(r,{label:"群主标识",name:"isGroupOwner"},{default:s(()=>[o(V,{checked:n.isGroupOwner,"onUpdate:checked":e[5]||(e[5]=t=>n.isGroupOwner=t)},null,8,["checked"])]),_:1}),o(r,{"wrapper-col":{offset:4}},{default:s(()=>[o(Z,null,{default:s(()=>[o(q,{type:"primary",loading:b.value,onClick:A},{default:s(()=>e[7]||(e[7]=[d(" 提交 ")])),_:1},8,["loading"]),o(q,{onClick:e[6]||(e[6]=t=>a.$router.back())},{default:s(()=>e[8]||(e[8]=[d("取消")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},pe=F(ne,[["__scopeId","data-v-7e5eca77"]]);export{pe as default};
