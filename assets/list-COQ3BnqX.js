import{_ as ce,i as pe,j as me,r as c,a as q,k as ve,b as y,d as p,c as l,w as a,e as o,l as T,m as i,f as _e,o as d,F as N,n as U,p as _,h as u,t as r,q as b,g as fe,z as V}from"./index-CRuMulyI.js";const ke={class:"task-audit content-container"},ge={class:"table-container"},ye={class:"table-header"},be={class:"left"},he={class:"right"},we={key:1},Se={class:"group-name"},Ce=["onClick"],xe={__name:"list",setup(Ne){const A=pe(),M=me(()=>A.loaded?A.getEnumOptions("TaskAuditStatus"):[]),P=_e(),I=c(!1),B=c(!1),h=c(!1),z=c(!1),f=c(""),w=c(null),v=c([]),s=q({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0}),E=c([]),L=c([]),H=[{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"平台渠道",dataIndex:"channelName",key:"channelName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:"操作",key:"action",fixed:"right",width:180}],$=c([]),k=q({current:1,pageSize:10,total:0}),J={selectedRowKeys:v,onChange:n=>{v.value=n},getCheckboxProps:n=>({disabled:n.taskAuditStatus!=="pending"})},D=()=>{k.current=1,g()},Q=()=>{s.taskName="",s.channelId=void 0,s.taskAuditStatus=void 0,s.groupId=void 0,D()},W=n=>{Object.assign(k,n),g()},X=n=>{P.push(`/task-submitted/detail/${n.id}`)},Y=async n=>{const t=await V("taskSubmitted.batchResolve",{ids:[n.id]});t.code===0?(i.success("审核通过成功"),g()):i.error(t.message)},Z=async()=>{if(!v.value.length){i.warning("请选择要通过的任务");return}const n=await V("taskSubmitted.batchResolve",{ids:v.value});n.code===0?(i.success("批量审核通过成功"),v.value=[],g()):i.error(n.message)},ee=n=>{v.value=[n.id],f.value="",h.value=!0},te=async()=>{if(!f.value){i.error("请输入拒绝原因");return}z.value=!0;const n=await V("taskSubmitted.batchReject",{ids:v.value,reason:f.value});n.code===0?(i.success("审核拒绝成功"),h.value=!1,g()):i.error(n.message)},ae=()=>{if(!v.value.length){i.warning("请选择要拒绝的任务");return}f.value="",h.value=!0},ne=async()=>{const n=await T("channel.list");n.code===0&&(E.value=n.data.list)},le=async(n="")=>{try{const t=await T("group.list",{params:{page:1,pageSize:50,keyword:n}});t.code===0&&(L.value=t.data.list||[])}catch{i.error("获取群组列表失败")}},g=async()=>{I.value=!0;try{const n=await T("taskSubmitted.list",{page:k.current,pageSize:k.pageSize,...s});n.code===0?($.value=n.data.list,k.total=n.data.total):i.error(n.message)}finally{I.value=!1}};return ve(()=>{g(),le(),ne()}),(n,t)=>{const se=o("a-input"),S=o("a-form-item"),R=o("a-select-option"),j=o("a-select"),x=o("a-button"),O=o("a-space"),oe=o("a-form"),ue=o("a-tag"),F=o("a-popconfirm"),de=o("a-table"),C=o("a-descriptions-item"),ie=o("a-descriptions"),G=o("a-modal"),re=o("a-textarea");return d(),y("div",ke,[p("div",ge,[p("div",ye,[p("div",be,[l(oe,{layout:"inline",model:s},{default:a(()=>[l(S,{label:"任务名称"},{default:a(()=>[l(se,{value:s.taskName,"onUpdate:value":t[0]||(t[0]=e=>s.taskName=e),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),l(S,{label:"平台渠道"},{default:a(()=>[l(j,{value:s.channelId,"onUpdate:value":t[1]||(t[1]=e=>s.channelId=e),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(d(!0),y(N,null,U(E.value,e=>(d(),_(R,{key:e.id,value:e.id},{default:a(()=>[u(r(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(S,{label:"审核状态"},{default:a(()=>[l(j,{value:s.taskAuditStatus,"onUpdate:value":t[2]||(t[2]=e=>s.taskAuditStatus=e),placeholder:"请选择审核状态",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(d(!0),y(N,null,U(M.value,e=>(d(),_(R,{key:e.value,value:e.value},{default:a(()=>[u(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(S,{label:"所属群组"},{default:a(()=>[l(j,{value:s.groupId,"onUpdate:value":t[3]||(t[3]=e=>s.groupId=e),placeholder:"请选择群组",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(d(!0),y(N,null,U(L.value,e=>(d(),_(R,{key:e.id,value:e.id},{default:a(()=>[u(r(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(S,null,{default:a(()=>[l(O,null,{default:a(()=>[l(x,{type:"primary",onClick:D},{default:a(()=>t[7]||(t[7]=[u("查询")])),_:1}),l(x,{onClick:Q},{default:a(()=>t[8]||(t[8]=[u("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",he,[l(O,null,{default:a(()=>[l(x,{type:"primary",onClick:Z},{default:a(()=>t[9]||(t[9]=[u("批量通过")])),_:1}),l(x,{danger:"",onClick:ae},{default:a(()=>t[10]||(t[10]=[u("批量拒绝")])),_:1})]),_:1})])]),l(de,{columns:H,"data-source":$.value,loading:I.value,pagination:k,"row-selection":J,rowKey:"id",onChange:W},{bodyCell:a(({column:e,record:m})=>[e.key==="taskAuditStatus"?(d(),y(N,{key:0},[u(r(fe(A).getEnumText("TaskAuditStatus",m.taskAuditStatus)),1)],64)):b("",!0),e.key==="member"?(d(),y("div",we,[p("div",null,r(m.memberNickname),1),p("div",Se,[p("span",null,r(m.groupName),1),m.isGroupOwner?(d(),_(ue,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>t[11]||(t[11]=[u("群主")])),_:1})):b("",!0)])])):b("",!0),e.key==="action"?(d(),_(O,{key:2},{default:a(()=>[p("a",{onClick:K=>X(m)},"查看",8,Ce),m.taskAuditStatus==="pending"?(d(),_(F,{key:0,title:"确定要通过该任务吗？",onConfirm:K=>Y(m)},{default:a(()=>t[12]||(t[12]=[p("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):b("",!0),m.taskAuditStatus==="pending"?(d(),_(F,{key:1,title:"确定要拒绝该任务吗？",onConfirm:K=>ee(m)},{default:a(()=>t[13]||(t[13]=[p("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):b("",!0)]),_:2},1024)):b("",!0)]),_:1},8,["data-source","loading","pagination"])]),l(G,{open:B.value,"onUpdate:open":t[4]||(t[4]=e=>B.value=e),title:"任务详情",footer:null},{default:a(()=>[l(ie,{column:1},{default:a(()=>[l(C,{label:"任务名称"},{default:a(()=>{var e;return[u(r((e=w.value)==null?void 0:e.taskName),1)]}),_:1}),l(C,{label:"任务类型"},{default:a(()=>{var e;return[u(r((e=w.value)==null?void 0:e.taskType),1)]}),_:1}),l(C,{label:"任务描述"},{default:a(()=>{var e;return[u(r((e=w.value)==null?void 0:e.description),1)]}),_:1}),l(C,{label:"任务奖励"},{default:a(()=>{var e;return[u(r((e=w.value)==null?void 0:e.reward),1)]}),_:1}),l(C,{label:"创建时间"},{default:a(()=>{var e;return[u(r((e=w.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),l(G,{open:h.value,"onUpdate:open":t[6]||(t[6]=e=>h.value=e),title:"拒绝原因",onOk:te,confirmLoading:z.value},{default:a(()=>[l(re,{value:f.value,"onUpdate:value":t[5]||(t[5]=e=>f.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ie=ce(xe,[["__scopeId","data-v-b98910e4"]]);export{Ie as default};
