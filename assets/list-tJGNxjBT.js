import{_ as Se,a as Ie,b as Re,j as Q,r as v,c as X,k as je,d as i,e as r,f as o,s as h,w as n,g as d,x as Ae,h as Te,l as N,m as _,o as s,F as g,n as I,p as b,i as p,t as l,q as Oe,A as Z,M as Ne,v as Fe}from"./index-_KmhQP4-.js";import{_ as x}from"./CopyContent-DcYHtTGQ.js";import{G as Ue}from"./GroupOwner-CG1DvtRA.js";import{d as Pe,e as ze}from"./routeParamsEncryption-BKFTaOaF.js";const De={class:"account content-container"},Me={class:"table-container"},Ee={class:"table-header"},Ye={style:{width:"100%",display:"flex","justify-content":"space-between"}},Be={class:"right"},He={key:0,class:"account-info"},qe={class:"link-text-container"},Ve={class:"label"},Le=["href"],Ge={class:"stats"},We={key:0,class:"stat-item"},Ke={key:1,class:"stat-item"},Je={key:2,class:"stat-item"},Qe={key:1},Xe={key:1},Ze={class:"danger"},xe=["onClick"],et={class:"danger"},tt={key:0,class:"count-container"},at={__name:"list",setup(nt){const F=Te(),U=Ae(),P=Ie(),{t:f}=Re(),ee=Q(()=>P.loaded?P.getEnumOptions("AccountAuditStatus"):[]),z=v(!1),y=v([]),R=v(!1),D=v(!1),$=v(""),Y=v(null),te=()=>{const e=U.query.filters;if(e){Y.value=Pe(e),Object.assign(u,{accountAuditStatus:null},Y.value);const a={...U.query};delete a.filters,F.replace({path:U.path,query:a})}},u=X({keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),B=v([]),H=v([]),q=v([]),M=v([]),ae=Q(()=>[{title:f("account.list.accountInfo"),key:"accountInfo",width:500},{title:f("account.list.memberInfo"),key:"member"},{title:f("account.list.submitTime"),dataIndex:"submitTime",key:"submitTime"},{title:f("account.list.auditStatus"),dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:f("account.list.rejectReason"),key:"rejectReason"},{title:f("account.list.waiterName"),key:"waiterName"},{title:f("account.list.auditTime"),key:"auditTime"},{title:f("account.list.action"),key:"action"}]),ne={selectedRowKeys:y,onChange:e=>{y.value=e},getCheckboxProps:e=>({disabled:e.accountAuditStatus!=="pending"})},V=v([]),k=X({current:1,pageSize:10,total:0}),L=()=>{k.current=1,S()},oe=()=>{Object.assign(u,{keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),L()},le=e=>{F.push(`/member/view/${e.memberId}`)},se=e=>{var w,m;const a=ze({...u,submitStartTime:(w=u.submitTimeRange)==null?void 0:w[0],submitEndTime:(m=u.submitTimeRange)==null?void 0:m[1],submitTimeRange:void 0});F.push({name:"AccountEdit",params:{id:e.id},query:{filters:a}})},ue=()=>{F.push("/account/old")},ce=e=>{Object.assign(k,{current:e.current,pageSize:e.pageSize}),S()},ie=async e=>{y.value=[e.id],G()},G=async()=>{if(!y.value.length){_.warning(f("account.list.message.selectAccount"));return}const e=await Z("account.batchResolve",{ids:y.value});if(e.code===0){const a=e.data.failed.map(w=>w.reason).join(",");a?Ne.error({title:f("account.list.batchRejectFailedTitle"),content:`成功 ${e.data.successCount} 条，失败 ${e.data.failedCount} 条，失败原因：${a}`}):(_.success(f("account.list.message.success")),y.value=[],S())}else _.error(e.message)},re=async()=>{if(!y.value.length){_.warning(f("account.list.message.selectAccount"));return}$.value="",R.value=!0},de=e=>{y.value=[e.id],$.value="",R.value=!0},me=async()=>{if(!$.value){_.error(f("account.list.message.rejectReason"));return}D.value=!0;try{const e=await Z("account.batchReject",{ids:y.value,rejectReason:$.value});e.code===0?(_.success(f("account.list.message.success")),y.value=[],R.value=!1,S()):_.error(e.message)}catch(e){console.log(e)}finally{D.value=!1}},S=async()=>{var e,a;z.value=!0;try{const w={page:k.current,pageSize:k.pageSize,keyword:u.keyword,channelId:u.channelId,accountAuditStatus:u.accountAuditStatus,waiterId:u.waiterId,groupId:u.groupId,memberId:u.memberId,submitStartTime:(e=u.submitTimeRange)==null?void 0:e[0],submitEndTime:(a=u.submitTimeRange)==null?void 0:a[1]},m=await N("account.list",{...w});m.code===0?(V.value=m.data.list,k.total=m.data.total):_.error(m.message)}finally{z.value=!1}},pe=async()=>{const e=await N("channel.list");e.code===0&&(B.value=e.data.list)},W=async(e="")=>{try{const a=await N("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(H.value=a.data.list||[])}catch{_.error("获取群组列表失败")}},K=async(e="")=>{const a=await N("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(q.value=a.data.list||[])},fe=async e=>{const a=await Fe("account.delete",{},{urlParams:{id:e.id}});a.code===0?(_.success(a.message),S()):_.error(a.message)},he=async()=>{if(M.value.length)return;const e=await N("waiter.list",{page:1,pageSize:100});if(e.code===0){const a={id:0,username:"无"};M.value=[a,...e.data.list]}};return je(()=>{te(),S(),W(),pe(),K(),he()}),(e,a)=>{const w=d("a-input"),m=d("a-form-item"),j=d("a-select-option"),A=d("a-select"),ve=d("a-range-picker"),T=d("a-button"),O=d("a-space"),_e=d("a-form"),ye=d("a-avatar"),J=d("a-typography-link"),ge=d("a-typography-text"),E=d("a-popconfirm"),be=d("a-table"),ke=d("a-descriptions-item"),we=d("a-descriptions"),Ce=d("a-textarea"),$e=d("a-modal");return s(),i("div",De,[r("div",Me,[r("div",Ee,[o(_e,{layout:"inline",model:u},{default:n(()=>[o(m,{label:e.$t("account.search.account")},{default:n(()=>[o(w,{value:u.keyword,"onUpdate:value":a[0]||(a[0]=t=>u.keyword=t),placeholder:e.$t("account.search.accountPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.channel")},{default:n(()=>[o(A,{value:u.channelId,"onUpdate:value":a[1]||(a[1]=t=>u.channelId=t),placeholder:e.$t("account.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(s(!0),i(g,null,I(B.value,t=>(s(),b(j,{key:t.id,value:t.id},{default:n(()=>[p(l(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.submitTime")},{default:n(()=>[o(ve,{value:u.submitTimeRange,"onUpdate:value":a[2]||(a[2]=t=>u.submitTimeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.auditStatus")},{default:n(()=>[o(A,{value:u.accountAuditStatus,"onUpdate:value":a[3]||(a[3]=t=>u.accountAuditStatus=t),placeholder:e.$t("account.search.auditStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(s(!0),i(g,null,I(ee.value,t=>(s(),b(j,{key:t.value,value:t.value},{default:n(()=>[p(l(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.auditor")},{default:n(()=>[o(A,{value:u.waiterId,"onUpdate:value":a[4]||(a[4]=t=>u.waiterId=t),placeholder:e.$t("account.search.auditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:n(()=>[(s(!0),i(g,null,I(M.value,t=>(s(),b(j,{key:t.id,value:t.id},{default:n(()=>[p(l(t.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.group")},{default:n(()=>[o(A,{value:u.groupId,"onUpdate:value":a[5]||(a[5]=t=>u.groupId=t),placeholder:e.$t("account.search.groupPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:W},{default:n(()=>[(s(!0),i(g,null,I(H.value,t=>(s(),b(j,{key:t.id,value:t.id},{default:n(()=>[p(l(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("account.search.member")},{default:n(()=>[o(A,{value:u.memberId,"onUpdate:value":a[6]||(a[6]=t=>u.memberId=t),placeholder:e.$t("account.search.memberPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:K},{default:n(()=>[(s(!0),i(g,null,I(q.value,t=>(s(),b(j,{key:t.id,value:t.id},{default:n(()=>[p(l(t.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,null,{default:n(()=>[o(O,null,{default:n(()=>[o(T,{type:"primary",onClick:L},{default:n(()=>[p(l(e.$t("common.search")),1)]),_:1}),o(T,{onClick:oe},{default:n(()=>[p(l(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),r("div",Ye,[o(T,{onClick:ue},{default:n(()=>[p(l(e.$t("account.list.oldAccount")),1)]),_:1}),r("div",Be,[o(O,null,{default:n(()=>[o(T,{type:"primary",onClick:G},{default:n(()=>[p(l(e.$t("common.batchResolve")),1)]),_:1}),o(T,{danger:"",onClick:re},{default:n(()=>[p(l(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),o(be,{columns:ae.value,"data-source":V.value,loading:z.value,pagination:k,"row-selection":ne,rowKey:"id",onChange:ce},{bodyCell:n(({column:t,record:c})=>[t.key==="accountInfo"?(s(),i("div",He,[o(O,null,{default:n(()=>[o(ye,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,l(c.account),1)]),_:2},1024),r("div",null,[r("div",qe,[r("span",Ve,l(e.$t("account.list.homepage"))+"：",1),o(x,{content:c.homeUrl},{default:n(()=>[o(J,null,{default:n(()=>[r("a",{href:c.homeUrl,target:"_blank"},l(c.homeUrl),9,Le)]),_:2},1024)]),_:2},1032,["content"])])]),r("div",null,[a[9]||(a[9]=r("span",{class:"label"},"uid：",-1)),o(x,{content:c.uid},null,8,["content"])]),r("div",Ge,[c.channelCustomFields.includes("fansCount")?(s(),i("div",We,l(e.$t("account.list.fansCount"))+"："+l(c.fansCount),1)):h("",!0),c.channelCustomFields.includes("friendsCount")?(s(),i("div",Ke,l(e.$t("account.list.friendsCount"))+"："+l(c.friendsCount),1)):h("",!0),c.channelCustomFields.includes("postsCount")?(s(),i("div",Je,l(e.$t("account.list.postsCount"))+"："+l(c.postsCount),1)):h("",!0)])])):h("",!0),t.key==="member"?(s(),i("div",Qe,[r("div",null,[o(J,{onClick:C=>le(c)},{default:n(()=>[p(l(c.memberNickname),1)]),_:2},1032,["onClick"])]),(s(!0),i(g,null,I(c.groups,C=>(s(),i("div",null,[o(O,null,{default:n(()=>[r("span",null,l(C.groupName),1),C.isOwner?(s(),b(Ue,{key:0})):h("",!0)]),_:2},1024)]))),256))])):h("",!0),t.key==="accountAuditStatus"?(s(),i(g,{key:2},[p(l(Oe(P).getEnumText("AccountAuditStatus",c.accountAuditStatus)),1)],64)):h("",!0),t.key==="rejectReason"?(s(),i(g,{key:3},[c.rejectReason?(s(),b(ge,{key:0,type:"danger"},{default:n(()=>[p(l(c.rejectReason),1)]),_:2},1024)):(s(),i("span",Xe,"--"))],64)):h("",!0),t.key==="waiterName"?(s(),i(g,{key:4},[p(l(c.waiterName||"--"),1)],64)):h("",!0),t.key==="auditTime"?(s(),i(g,{key:5},[p(l(c.auditTime||"--"),1)],64)):h("",!0),t.key==="action"?(s(),b(O,{key:6},{default:n(()=>[c.accountAuditStatus==="pending"?(s(),b(E,{key:0,title:e.$t("account.list.resolveConfirm"),onConfirm:C=>ie(c)},{default:n(()=>[r("a",null,l(e.$t("account.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),c.accountAuditStatus==="pending"?(s(),b(E,{key:1,title:e.$t("account.list.rejectConfirm"),onConfirm:C=>de(c)},{default:n(()=>[r("a",Ze,l(e.$t("account.list.reject")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),r("a",{onClick:C=>se(c)},l(e.$t("common.edit")),9,xe),o(E,{title:e.$t("common.deleteConfirm"),onConfirm:C=>fe(c)},{default:n(()=>[r("a",et,l(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),k.total?(s(),i("div",tt,[o(we,{column:2},{default:n(()=>[o(ke,{label:e.$t("common.totalCount")},{default:n(()=>[p(l(k.total),1)]),_:1},8,["label"])]),_:1})])):h("",!0)]),o($e,{open:R.value,"onUpdate:open":a[8]||(a[8]=t=>R.value=t),title:e.$t("account.list.rejectReason"),onOk:me,confirmLoading:D.value},{default:n(()=>[o(Ce,{value:$.value,"onUpdate:value":a[7]||(a[7]=t=>$.value=t),placeholder:e.$t("account.list.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},ct=Se(at,[["__scopeId","data-v-aefa0d9b"]]);export{ct as default};
