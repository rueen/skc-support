import{_ as ue,b as me,a as we,j as E,r as f,c as L,k as he,d as S,e as g,f as a,w as t,g as i,l as pe,m as s,h as ve,o as w,F as M,n as _e,p as N,i as h,t as r,q as O,s as k,M as P,A as V}from"./index--h0FIZuv.js";import{d as fe}from"./download-BGoVpBkH.js";const ge={class:"withdrawal content-container"},ke={class:"table-container"},ye={class:"table-header"},be={class:"left"},Ce={class:"right"},Se=["onClick"],$e=["onClick"],Ne={__name:"withdrawal",setup(Re){const{t:m}=me(),R=ve(),j=we(),x=E(()=>j.loaded?j.getEnumOptions("WithdrawalStatus"):[]),T=f(!1),y=f(!1),D=f(!1),p=f(""),o=L({billNo:"",memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),A=E(()=>[{title:m("withdrawal.list.billNo"),dataIndex:"billNo",key:"billNo"},{title:m("withdrawal.list.memberNickname"),key:"nickname"},{title:m("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:m("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:m("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:m("withdrawal.list.name"),dataIndex:"name",key:"name"},{title:m("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:m("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:m("withdrawal.list.action"),key:"action",width:150}]),d=f([]),F={selectedRowKeys:d,onChange:e=>{d.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},Y=f([]),v=L({current:1,pageSize:10,total:0}),B=()=>{v.current=1,b()},W=()=>{Object.assign(o,{billNo:"",memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),B()},z=e=>{Object.assign(v,e),b()},K=()=>{P.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const e=s.loading("正在导出数据，请稍候...",0),n={...o};try{await fe("withdrawals.export",n,`提现列表_${new Date().toLocaleDateString()}.xlsx`),s.success("导出成功")}catch(_){console.error("导出失败:",_),s.error("导出失败，请稍后重试")}finally{e()}}})},q=e=>{R.push(`/member/view/${e.memberId}`)},G=e=>{P.error({content:e.rejectReason})},J=async e=>{d.value=[e.id],H()},H=async()=>{if(!d.value.length){s.warning("请选择要操作的记录");return}const e=await V("withdrawals.batchResolve",{ids:d.value});e.code===0?(s.success("操作成功"),d.value=[],b()):s.error(e.message)},Q=e=>{d.value=[e.id],p.value="",y.value=!0},X=()=>{if(!d.value.length){s.warning("请选择要操作的记录");return}p.value="",y.value=!0},Z=async()=>{if(!p.value){s.error("请输入打款失败原因");return}D.value=!0;const e=await V("withdrawals.batchReject",{rejectReason:p.value,ids:d.value});D.value=!1,e.code===0?(s.success("操作成功"),y.value=!1,d.value=[],b()):s.error(e.message)},b=async()=>{var e,n;T.value=!0;try{const _={page:v.current,pageSize:v.pageSize,billNo:o.billNo,memberNickname:o.memberNickname,withdrawalStatus:o.withdrawalStatus,startTime:(e=o.timeRange)==null?void 0:e[0],endTime:(n=o.timeRange)==null?void 0:n[1]},c=await pe("withdrawals.list",{..._});c.code===0?(Y.value=c.data.list||[],v.total=c.data.total||0):s.error(c.message)}finally{T.value=!1}};return he(()=>{b()}),(e,n)=>{const _=i("a-input"),c=i("a-form-item"),ee=i("a-select-option"),ae=i("a-select"),te=i("a-range-picker"),C=i("a-button"),I=i("a-space"),le=i("a-form"),ne=i("RightOutlined"),U=i("a-typography-link"),oe=i("download-outlined"),ie=i("info-circle-outlined"),se=i("a-popconfirm"),re=i("a-table"),de=i("a-textarea"),ce=i("a-modal");return w(),S("div",ge,[g("div",ke,[g("div",ye,[g("div",be,[a(le,{layout:"inline",model:o},{default:t(()=>[a(c,{label:e.$t("withdrawal.list.billNo")},{default:t(()=>[a(_,{value:o.billNo,"onUpdate:value":n[0]||(n[0]=l=>o.billNo=l),placeholder:e.$t("withdrawal.list.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(_,{value:o.memberNickname,"onUpdate:value":n[1]||(n[1]=l=>o.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(ae,{value:o.withdrawalStatus,"onUpdate:value":n[2]||(n[2]=l=>o.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(w(!0),S(M,null,_e(x.value,l=>(w(),N(ee,{key:l.value,value:l.value},{default:t(()=>[h(r(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(c,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(te,{value:o.timeRange,"onUpdate:value":n[3]||(n[3]=l=>o.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(c,null,{default:t(()=>[a(I,null,{default:t(()=>[a(C,{type:"primary",onClick:B},{default:t(()=>[h(r(e.$t("common.search")),1)]),_:1}),a(C,{onClick:W},{default:t(()=>[h(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),g("div",Ce,[a(I,null,{default:t(()=>[a(U,{onClick:n[4]||(n[4]=l=>O(R).push("/payment-transactions"))},{default:t(()=>[h(r(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(ne)]),_:1}),a(C,{onClick:K},{icon:t(()=>[a(oe)]),default:t(()=>[h(" "+r(e.$t("withdrawal.list.export")),1)]),_:1}),a(C,{type:"primary",onClick:H},{default:t(()=>[h(r(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(C,{danger:"",onClick:X},{default:t(()=>[h(r(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(re,{columns:A.value,"data-source":Y.value,loading:T.value,pagination:v,rowKey:"id","row-selection":F,onChange:z},{bodyCell:t(({column:l,record:u})=>[l.key==="nickname"?(w(),N(U,{key:0,onClick:$=>q(u)},{default:t(()=>[h(r(u.nickname),1)]),_:2},1032,["onClick"])):k("",!0),l.key==="withdrawalStatus"?(w(),S(M,{key:1},[h(r(O(j).getEnumText("WithdrawalStatus",u.withdrawalStatus))+" ",1),u.withdrawalStatus==="failed"?(w(),N(ie,{key:0,class:"danger",onClick:$=>G(u)},null,8,["onClick"])):k("",!0)],64)):k("",!0),l.key==="action"?(w(),S(M,{key:2},[u.withdrawalStatus==="pending"?(w(),N(I,{key:0},{default:t(()=>[a(se,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:$=>J(u)},{default:t(()=>[g("a",null,r(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),g("a",{class:"danger",onClick:$=>Q(u)},r(e.$t("withdrawal.list.reject")),9,Se)]),_:2},1024)):k("",!0),u.withdrawalStatus==="failed"?(w(),S("a",{key:1,onClick:$=>O(R).push(`/payment-transactions?withdrawalId=${u.id}`)},"查看交易记录",8,$e)):k("",!0)],64)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),a(ce,{open:y.value,"onUpdate:open":n[6]||(n[6]=l=>y.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:Z,confirmLoading:D.value},{default:t(()=>[a(de,{value:p.value,"onUpdate:value":n[5]||(n[5]=l=>p.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},De=ue(Ne,[["__scopeId","data-v-d7260c94"]]);export{De as default};
