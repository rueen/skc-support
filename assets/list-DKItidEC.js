import{_ as _e,i as ke,j as ge,r as v,a as G,k as be,b as w,d as r,c as n,w as a,e as o,l as U,m as d,f as ye,o as u,F as N,n as M,p as f,h as i,t as c,q as k,g as K,D as we,M as Se,z as Y}from"./index-BCP0ziDU.js";import{d as he}from"./download-CHkekVyS.js";const Ce={class:"task-audit content-container"},xe={class:"table-container"},Te={class:"table-header"},Ne={style:{width:"100%",display:"flex","justify-content":"space-between"}},Re={key:2},Ae={class:"group-name"},Ie=["onClick"],Oe={__name:"list",setup(je){const R=ke(),q=ge(()=>R.loaded?R.getEnumOptions("TaskAuditStatus"):[]),P=ye(),A=v(!1),B=v(!1),S=v(!1),V=v(!1),g=v(""),h=v(null),_=v([]),s=G({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),z=v([]),E=v([]),J=[{title:"任务名称",key:"taskName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:"审核员",dataIndex:"waiterName",key:"waiterName"},{title:"操作",key:"action",fixed:"right",width:180}],I=v([]),b=G({current:1,pageSize:10,total:0}),Q={selectedRowKeys:_,onChange:l=>{_.value=l},getCheckboxProps:l=>({disabled:l.taskAuditStatus!=="pending"})},H=()=>{b.current=1,y()},W=()=>{Object.assign(s,{taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),H()},X=l=>{Object.assign(b,l),y()},Z=l=>{P.push(`/submitted-tasks/detail/${l.id}`)},ee=async l=>{const t=await Y("taskSubmitted.batchResolve",{ids:[l.id]});t.code===0?(d.success("审核通过成功"),y()):d.error(t.message)},te=async()=>{if(!_.value.length){d.warning("请选择要通过的任务");return}const l=await Y("taskSubmitted.batchResolve",{ids:_.value});l.code===0?(d.success("批量审核通过成功"),_.value=[],y()):d.error(l.message)},ae=l=>{_.value=[l.id],g.value="",S.value=!0},ne=async()=>{if(!g.value){d.error("请输入拒绝原因");return}V.value=!0;const l=await Y("taskSubmitted.batchReject",{ids:_.value,reason:g.value});l.code===0?(d.success("审核拒绝成功"),S.value=!1,y()):d.error(l.message)},le=()=>{if(!_.value.length){d.warning("请选择要拒绝的任务");return}g.value="",S.value=!0},se=async()=>{const l=await U("channel.list");l.code===0&&(z.value=l.data.list)},oe=()=>{Se.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const l=d.loading("正在导出数据，请稍候...",0),t={...s};await he("taskSubmitted.export",t,`已提交任务列表_${new Date().toLocaleDateString()}.xlsx`),l(),d.success("导出成功")}catch(l){console.error("导出失败:",l),d.error("导出失败，请稍后重试")}}})},ue=async(l="")=>{try{const t=await U("group.list",{params:{page:1,pageSize:50,keyword:l}});t.code===0&&(E.value=t.data.list||[])}catch{d.error("获取群组列表失败")}},y=async()=>{var l,t;A.value=!0;try{const O={page:b.current,pageSize:b.pageSize,taskName:s.taskName,channelId:s.channelId,taskAuditStatus:s.taskAuditStatus,groupId:s.groupId,submitStartTime:(l=s.submitTimeRange)==null?void 0:l[0],submitEndTime:(t=s.submitTimeRange)==null?void 0:t[1],completedTaskCount:s.completedTaskCount},p=await U("taskSubmitted.list",{...O});p.code===0?(I.value=p.data.list,b.total=p.data.total):d.error(p.message)}finally{A.value=!1}};return be(()=>{y(),ue(),se()}),(l,t)=>{const O=o("a-input"),p=o("a-form-item"),j=o("a-select-option"),D=o("a-select"),ie=o("a-range-picker"),de=o("a-input-number"),re=o("a-form"),C=o("a-button"),T=o("a-space"),ce=o("a-avatar"),pe=o("a-tag"),L=o("a-popconfirm"),me=o("a-table"),x=o("a-descriptions-item"),ve=o("a-descriptions"),$=o("a-modal"),fe=o("a-textarea");return u(),w("div",Ce,[r("div",xe,[r("div",Te,[n(re,{layout:"inline",model:s},{default:a(()=>[n(p,{label:"任务名称"},{default:a(()=>[n(O,{value:s.taskName,"onUpdate:value":t[0]||(t[0]=e=>s.taskName=e),placeholder:"请输入任务名称","allow-clear":"",style:{width:"140px"}},null,8,["value"])]),_:1}),n(p,{label:"平台渠道"},{default:a(()=>[n(D,{value:s.channelId,"onUpdate:value":t[1]||(t[1]=e=>s.channelId=e),placeholder:"请选择平台渠道","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),w(N,null,M(z.value,e=>(u(),f(j,{key:e.id,value:e.id},{default:a(()=>[i(c(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(p,{label:"审核状态"},{default:a(()=>[n(D,{value:s.taskAuditStatus,"onUpdate:value":t[2]||(t[2]=e=>s.taskAuditStatus=e),placeholder:"请选择审核状态","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),w(N,null,M(q.value,e=>(u(),f(j,{key:e.value,value:e.value},{default:a(()=>[i(c(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(p,{label:"所属群组"},{default:a(()=>[n(D,{value:s.groupId,"onUpdate:value":t[3]||(t[3]=e=>s.groupId=e),placeholder:"请选择群组","allow-clear":""},{default:a(()=>[(u(!0),w(N,null,M(E.value,e=>(u(),f(j,{key:e.id,value:e.id},{default:a(()=>[i(c(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(p,{label:"提交时间"},{default:a(()=>[n(ie,{value:s.submitTimeRange,"onUpdate:value":t[4]||(t[4]=e=>s.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1}),n(p,{label:"已完成任务"},{default:a(()=>[n(de,{value:s.completedTaskCount,"onUpdate:value":t[5]||(t[5]=e=>s.completedTaskCount=e),min:0,max:9999,"addon-after":"次",style:{width:"100px!important"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),r("div",Ne,[r("div",null,[n(T,null,{default:a(()=>[n(C,{type:"primary",onClick:H},{default:a(()=>t[9]||(t[9]=[i("查询")])),_:1}),n(C,{onClick:W},{default:a(()=>t[10]||(t[10]=[i("重置")])),_:1})]),_:1})]),r("div",null,[n(T,null,{default:a(()=>[I.value.length?(u(),f(C,{key:0,onClick:oe},{icon:a(()=>[n(K(we))]),default:a(()=>[t[11]||(t[11]=i(" 导出 "))]),_:1})):k("",!0),n(C,{type:"primary",onClick:te},{default:a(()=>t[12]||(t[12]=[i("批量通过")])),_:1}),n(C,{danger:"",onClick:le},{default:a(()=>t[13]||(t[13]=[i("批量拒绝")])),_:1})]),_:1})])])]),n(me,{columns:J,"data-source":I.value,loading:A.value,pagination:b,"row-selection":Q,rowKey:"id",onChange:X},{bodyCell:a(({column:e,record:m})=>[e.key==="taskName"?(u(),f(T,{key:0},{default:a(()=>[n(ce,{src:m.channelIcon,size:"small"},null,8,["src"]),r("span",null,c(m.taskName),1)]),_:2},1024)):k("",!0),e.key==="taskAuditStatus"?(u(),w(N,{key:1},[i(c(K(R).getEnumText("TaskAuditStatus",m.taskAuditStatus)),1)],64)):k("",!0),e.key==="member"?(u(),w("div",Re,[r("div",null,c(m.memberNickname),1),r("div",Ae,[r("span",null,c(m.groupName),1),m.isGroupOwner?(u(),f(pe,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>t[14]||(t[14]=[i("群主")])),_:1})):k("",!0)])])):k("",!0),e.key==="action"?(u(),f(T,{key:3},{default:a(()=>[r("a",{onClick:F=>Z(m)},"查看",8,Ie),m.taskAuditStatus==="pending"?(u(),f(L,{key:0,title:"确定要通过该任务吗？",onConfirm:F=>ee(m)},{default:a(()=>t[15]||(t[15]=[r("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):k("",!0),m.taskAuditStatus==="pending"?(u(),f(L,{key:1,title:"确定要拒绝该任务吗？",onConfirm:F=>ae(m)},{default:a(()=>t[16]||(t[16]=[r("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):k("",!0)]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading","pagination"])]),n($,{open:B.value,"onUpdate:open":t[6]||(t[6]=e=>B.value=e),title:"任务详情",footer:null},{default:a(()=>[n(ve,{column:1},{default:a(()=>[n(x,{label:"任务名称"},{default:a(()=>{var e;return[i(c((e=h.value)==null?void 0:e.taskName),1)]}),_:1}),n(x,{label:"任务类型"},{default:a(()=>{var e;return[i(c((e=h.value)==null?void 0:e.taskType),1)]}),_:1}),n(x,{label:"任务描述"},{default:a(()=>{var e;return[i(c((e=h.value)==null?void 0:e.description),1)]}),_:1}),n(x,{label:"任务奖励"},{default:a(()=>{var e;return[i(c((e=h.value)==null?void 0:e.reward),1)]}),_:1}),n(x,{label:"创建时间"},{default:a(()=>{var e;return[i(c((e=h.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),n($,{open:S.value,"onUpdate:open":t[8]||(t[8]=e=>S.value=e),title:"拒绝原因",onOk:ne,confirmLoading:V.value},{default:a(()=>[n(fe,{value:g.value,"onUpdate:value":t[7]||(t[7]=e=>g.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Me=_e(Oe,[["__scopeId","data-v-8ab8a9cc"]]);export{Me as default};
