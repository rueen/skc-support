import{_ as ce,a as ve,i as be,r as b,b as C,j as pe,B as _e,k as we,x as fe,c as p,e as t,d as r,t as n,w as a,f as i,F as M,n as H,l as _,o as c,h as u,q as F,s as k,p as S,A as W,m as h}from"./index-BEbd6ZPR.js";import{P as ge}from"./PageHeader-MZrL5PQD.js";import{_ as N}from"./CopyContent-Cfju3aCD.js";const ke={class:"member-view content-container"},he={class:"detail-container"},$e={class:"section"},ye={class:"section-title"},Ce={key:0},Re={key:0},Se={class:"section"},Ie={class:"section-title"},Ae={class:"account-list"},Te={class:"link-text-container",style:{"max-width":"300px"}},Ue=["href"],Oe={class:"section",style:{"padding-bottom":"24px"}},Pe={class:"section-title"},Fe={class:"section",style:{"padding-bottom":"24px"}},Ne={class:"section-title"},Ee={class:"section"},Be={class:"section-title"},De={__name:"view",setup(Le){const{t:E}=ve(),I=be(),J=fe(),d=b(""),s=C({}),B=b([]),K=pe(()=>`${_e.h5Url}?inviteCode=${s.inviteCode}`),A=C({}),T=C({}),U=C({}),D=b(),w=b(!1),$=b("grant"),v=C({amount:"",remark:""}),y=b(!1),Q=b({amount:[{required:!0,message:E("member.view.amountRequired")}],remark:[{required:!0,message:E("member.view.remarkRequired")}]}),X=async()=>{const e=await _("member.detail",{},{urlParams:{id:d.value}});e.code===0&&Object.assign(s,e.data||{})},O=async()=>{const e=await _("member.balance",{},{urlParams:{memberId:d.value}});e.code===0&&(s.balance=e.data.balance)},Y=async()=>{const e=await _("member.withdrawalsAccount",{},{urlParams:{memberId:d.value}});e.code===0&&(s.withdrawalsAccount=e.data[0]||{})},Z=async()=>{const e=await _("account.list",{memberId:d.value});e.code===0&&(B.value=e.data.list||[])},x=async()=>{const e=await _("member.taskStats",{},{urlParams:{memberId:d.value}});e.code===0&&Object.assign(A,e.data||{})},ee=async()=>{const e=await _("member.inviteStats",{},{urlParams:{memberId:d.value}});e.code===0&&Object.assign(T,e.data||{})},te=async()=>{const e=await _("member.groupsStats",{},{urlParams:{memberId:d.value}});e.code===0&&Object.assign(U,e.data||{})},ae=()=>{w.value=!0,$.value="grant"},le=()=>{w.value=!0,$.value="deduct"},ne=async()=>{y.value=!0;try{const e=await W("member.grantReward",{memberId:d.value,amount:v.amount,remark:v.remark});e.code===0?(h.success("奖励发放成功"),w.value=!1,O()):h.error(e.message)}catch{h.error("奖励发放失败")}finally{y.value=!1}},se=async()=>{y.value=!0;try{const e=await W("member.deductReward",{memberId:d.value,amount:v.amount,remark:v.remark},{urlParams:{memberId:d.value}});e.code===0?(h.success("奖励扣除成功"),w.value=!1,O()):h.error(e.message)}catch{h.error("奖励扣除失败")}finally{y.value=!1}},re=async()=>{try{switch(await D.value.validate(),$.value){case"grant":ne();break;case"deduct":se();break}}catch(e){console.log(e)}};return we(()=>{d.value=J.params.id,X(),O(),Z(),x(),ee(),te(),Y()}),(e,m)=>{const oe=i("UserOutlined"),L=i("a-avatar"),R=i("a-space"),o=i("a-descriptions-item"),j=i("a-tag"),q=i("a-button"),G=i("a-descriptions"),f=i("a-statistic"),g=i("a-col"),P=i("a-row"),ie=i("a-input"),V=i("a-form-item"),ue=i("a-textarea"),me=i("a-form"),de=i("a-modal");return c(),p("div",ke,[t(ge,{title:e.$t("member.view.pageTitle"),back:!0},null,8,["title"]),r("div",he,[r("div",$e,[r("div",ye,n(e.$t("member.view.memberInfo")),1),t(G,{column:2},{default:a(()=>[t(o,{label:e.$t("member.view.memberNickname")},{default:a(()=>[t(R,null,{default:a(()=>[t(L,{src:s.avatar,size:"small"},{icon:a(()=>[t(oe)]),_:1},8,["src"]),r("span",null,n(s.nickname),1)]),_:1})]),_:1},8,["label"]),t(o,{label:e.$t("member.view.memberAccount")},{default:a(()=>[u(n(s.account),1)]),_:1},8,["label"]),t(o,{label:e.$t("member.view.gender")},{default:a(()=>[u(n(F(I).getEnumText("GenderType",s.gender)),1)]),_:1},8,["label"]),t(o,{label:e.$t("member.view.occupation")},{default:a(()=>[u(n(F(I).getEnumText("OccupationType",s.occupation))+" ",1),s.occupation===null?(c(),p("span",Ce," - ")):k("",!0)]),_:1},8,["label"]),t(o,{label:e.$t("member.view.email")},{default:a(()=>[u(n(s.email||"-"),1)]),_:1},8,["label"]),t(o,{label:e.$t("member.view.phone")},{default:a(()=>[u(n(s.phone||"-"),1)]),_:1},8,["label"]),t(o,{label:"Telegram"},{default:a(()=>[u(n(s.telegram||"-"),1)]),_:1}),t(o,{label:e.$t("member.view.group")},{default:a(()=>[(c(!0),p(M,null,H(s.groups,l=>(c(),p("div",{key:l.id},[u(n(l.groupName)+" ",1),l.isOwner?(c(),S(j,{key:0,color:"blue",style:{"margin-left":"8px"}},{default:a(()=>m[5]||(m[5]=[u("群主")])),_:1})):k("",!0)]))),128)),!s.groups||!s.groups.length?(c(),p("span",Re," - ")):k("",!0)]),_:1},8,["label"]),t(o,{label:e.$t("member.view.inviter")},{default:a(()=>[u(n(s.inviterNickname||"-"),1)]),_:1},8,["label"]),t(o,{label:e.$t("member.view.inviteUrl")},{default:a(()=>[t(N,{content:K.value},null,8,["content"])]),_:1},8,["label"]),t(o,{label:e.$t("member.view.withdrawalsAccount")},{default:a(()=>[t(R,null,{default:a(()=>{var l,z;return[r("span",null,n(((l=s==null?void 0:s.withdrawalsAccount)==null?void 0:l.paymentChannelName)||"-"),1),r("span",null,n(((z=s==null?void 0:s.withdrawalsAccount)==null?void 0:z.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),t(o,{label:e.$t("member.view.balance")},{default:a(()=>[t(R,null,{default:a(()=>[r("span",null,n(s.balance),1),t(q,{type:"link",size:"small",onClick:m[0]||(m[0]=l=>ae())},{default:a(()=>[u(n(e.$t("member.view.rewardGrant")),1)]),_:1}),t(q,{type:"link",size:"small",onClick:m[1]||(m[1]=l=>le())},{default:a(()=>[u(n(e.$t("member.view.rewardDeduct")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),r("div",Se,[r("div",Ie,n(e.$t("member.view.accountInfo")),1),r("div",Ae,[(c(!0),p(M,null,H(B.value,l=>(c(),p("div",{key:l.channelId},[t(G,{column:1},{default:a(()=>[t(o,{label:e.$t("member.view.account")},{default:a(()=>[t(R,null,{default:a(()=>[t(L,{src:l.channelIcon,size:"small"},null,8,["src"]),r("span",null,n(l.account),1),t(j,{color:"warning"},{default:a(()=>[u(n(F(I).getEnumText("AccountAuditStatus",l.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),t(o,{label:e.$t("member.view.homepage")},{default:a(()=>[t(N,{content:l.homeUrl},{default:a(()=>[r("div",Te,[r("a",{href:l.homeUrl,target:"_blank",class:"link-text"},n(l.homeUrl),9,Ue)])]),_:2},1032,["content"])]),_:2},1032,["label"]),t(o,{label:"uid"},{default:a(()=>[t(N,{content:l.uid},null,8,["content"])]),_:2},1024),l.channelCustomFields.includes("fansCount")?(c(),S(o,{key:0,label:e.$t("member.view.fansCount")},{default:a(()=>[u(n(l.fansCount),1)]),_:2},1032,["label"])):k("",!0),l.channelCustomFields.includes("friendsCount")?(c(),S(o,{key:1,label:e.$t("member.view.friendsCount")},{default:a(()=>[u(n(l.friendsCount),1)]),_:2},1032,["label"])):k("",!0),l.channelCustomFields.includes("postsCount")?(c(),S(o,{key:2,label:e.$t("member.view.postsCount")},{default:a(()=>[u(n(l.postsCount),1)]),_:2},1032,["label"])):k("",!0)]),_:2},1024)]))),128))])]),r("div",Oe,[r("div",Pe,n(e.$t("member.view.taskStats")),1),t(P,{gutter:16},{default:a(()=>[t(g,{span:6},{default:a(()=>[t(f,{title:e.$t("member.view.completedTaskCount"),value:A.completedTaskCount},null,8,["title","value"])]),_:1}),t(g,{span:6},{default:a(()=>[t(f,{title:e.$t("member.view.taskReward"),value:A.taskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),r("div",Fe,[r("div",Ne,n(e.$t("member.view.inviteStats")),1),t(P,null,{default:a(()=>[t(g,{span:6},{default:a(()=>[t(f,{title:e.$t("member.view.inviteCount"),value:T.inviteCount},null,8,["title","value"])]),_:1}),t(g,{span:6},{default:a(()=>[t(f,{title:e.$t("member.view.inviteReward"),value:T.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),r("div",Ee,[r("div",Be,n(e.$t("member.view.groupStats")),1),t(P,null,{default:a(()=>[t(g,{span:6},{default:a(()=>[t(f,{title:e.$t("member.view.groupCount"),value:U.groupCount},null,8,["title","value"])]),_:1}),t(g,{span:6},{default:a(()=>[t(f,{title:e.$t("member.view.groupEarnings"),value:U.totalEarnings},null,8,["title","value"])]),_:1})]),_:1})])]),t(de,{open:w.value,"onUpdate:open":m[4]||(m[4]=l=>w.value=l),title:$.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:re,confirmLoading:y.value},{default:a(()=>[t(me,{ref_key:"rewardFormRef",ref:D,model:v,rules:Q.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:a(()=>[t(V,{label:$.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:a(()=>[t(ie,{value:v.amount,"onUpdate:value":m[2]||(m[2]=l=>v.amount=l)},null,8,["value"])]),_:1},8,["label"]),t(V,{label:e.$t("member.view.remark"),name:"remark"},{default:a(()=>[t(ue,{value:v.remark,"onUpdate:value":m[3]||(m[3]=l=>v.remark=l),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"])])}}},Ve=ce(De,[["__scopeId","data-v-349a1cb0"]]);export{Ve as default};
