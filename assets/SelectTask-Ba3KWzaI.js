import{_ as oe,a as de,b as ie,r as p,c as z,j as A,D as q,k as ce,p as C,o as r,w as n,e as B,d as h,s as y,f as o,g as c,n as M,F,i as b,t as f,q as ue,l as x,m as re}from"./index-tCeVsuJW.js";const me={class:"select-task-modal table-container"},fe={class:"filter-form"},ve={key:0,class:"selected-info"},ke={key:1,class:"selected-info"},pe={key:1},he={__name:"SelectTask",props:{visible:{type:Boolean,default:!1},selectedId:{type:[Array,Number,String],default:()=>[]},selectedTaskInfo:{type:Object,default:()=>({})},mode:{type:String,default:"multiple",validator:I=>["multiple","single"].includes(I)}},emits:["update:visible","confirm","cancel"],setup(I,{emit:G}){const N=de(),{t:S}=ie(),t=I,T=G,$=p(!1),H=p(!1),s=p([]),u=p(null),d=z({taskName:"",channelId:void 0,taskStatus:void 0}),O=p([]),J=A(()=>N.loaded?N.getEnumOptions("TaskStatus"):[]),Q=A(()=>[{title:S("task.list.name"),key:"taskName",width:200},{title:S("task.list.status"),key:"taskStatus",width:100},{title:S("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:S("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0}]),g=p([]),v=z({current:1,pageSize:10,total:0}),j=z({sorterField:void 0,sorterOrder:void 0}),W=A(()=>t.mode==="single"?{type:"radio",selectedRowKeys:s.value,onChange:(e,a)=>{X(e,a)},getCheckboxProps:e=>({disabled:!1})}:{selectedRowKeys:s.value,onChange:(e,a)=>{Y(e)},getCheckboxProps:e=>({disabled:!1})}),X=(e,a)=>{s.value=e||[],u.value=a&&a.length>0?a[0]:null},Y=(e,a)=>{const i=g.value.map(k=>k.id),m=s.value.filter(k=>!i.includes(k));s.value=[...m,...e]},D=()=>{v.current=1,w()},Z=()=>{d.taskName="",d.channelId=void 0,d.taskStatus=void 0,D()},ee=(e,a,i)=>{Object.assign(v,e),Object.assign(j,{sorterField:i.field,sorterOrder:i.order}),w()},te=()=>{t.mode==="single"?T("confirm",{taskId:s.value[0]||null,task:u.value}):T("confirm",{taskIds:s.value}),E()},E=()=>{T("update:visible",!1),T("cancel")},w=async()=>{$.value=!0;try{const e=await x("task.list",{page:v.current,pageSize:v.pageSize,...j,...d});if(e.code===0){if(g.value=e.data.list,v.total=e.data.total,t.mode==="single"&&s.value.length>0&&!u.value){const a=s.value[0],i=g.value.find(m=>m.id===a);i&&(u.value=i)}}else re.error(e.message)}finally{$.value=!1}},V=async()=>{const e=await x("channel.list");e.code===0&&(O.value=e.data.list)},P=()=>{if(t.mode==="single"){let e=null;if(Array.isArray(t.selectedId)?e=t.selectedId.length>0?t.selectedId[0]:null:e=t.selectedId,e!=null&&e!==""){s.value=[e];const a=g.value.find(i=>i.id===e);a?u.value=a:u.value=t.selectedTaskInfo}else s.value=[],u.value=null}else t.selectedId&&t.selectedId.length>0?s.value=Array.isArray(t.selectedId)?[...t.selectedId]:[t.selectedId]:s.value=[]};return q(()=>t.visible,e=>{e?(w(),O.value.length||V(),P()):(s.value=[],t.mode==="single"&&(u.value=null),v.current=1)}),q(()=>t.selectedId,()=>{t.visible&&P()},{deep:!0}),ce(()=>{t.visible&&(w(),V(),P())}),(e,a)=>{const i=c("a-input"),m=c("a-form-item"),k=c("a-select-option"),K=c("a-select"),R=c("a-button"),U=c("a-space"),ae=c("a-form"),L=c("a-alert"),le=c("a-avatar"),se=c("a-table"),ne=c("a-modal");return r(),C(ne,{open:I.visible,title:e.$t("task.selectTask.title"),width:900,"confirm-loading":H.value,onOk:te,onCancel:E},{default:n(()=>[B("div",me,[B("div",fe,[o(ae,{layout:"inline",model:d},{default:n(()=>[o(m,{label:e.$t("task.search.taskName")},{default:n(()=>[o(i,{value:d.taskName,"onUpdate:value":a[0]||(a[0]=l=>d.taskName=l),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("task.search.channelId")},{default:n(()=>[o(K,{value:d.channelId,"onUpdate:value":a[1]||(a[1]=l=>d.channelId=l),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:n(()=>[(r(!0),h(F,null,M(O.value,l=>(r(),C(k,{key:l.id,value:l.id},{default:n(()=>[b(f(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("task.search.taskStatus")},{default:n(()=>[o(K,{value:d.taskStatus,"onUpdate:value":a[2]||(a[2]=l=>d.taskStatus=l),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:n(()=>[(r(!0),h(F,null,M(J.value,l=>(r(),C(k,{key:l.value,value:l.value},{default:n(()=>[b(f(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,null,{default:n(()=>[o(U,null,{default:n(()=>[o(R,{type:"primary",onClick:D},{default:n(()=>[b(f(e.$t("common.search")),1)]),_:1}),o(R,{onClick:Z},{default:n(()=>[b(f(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),t.mode==="multiple"?(r(),h("div",ve,[o(L,{message:e.$t("task.selectTask.selectedCount",{count:s.value.length}),type:"info","show-icon":""},null,8,["message"])])):y("",!0),t.mode==="single"&&u.value?(r(),h("div",ke,[o(L,{message:e.$t("task.selectTask.selectedTask",{name:u.value.taskName}),type:"info","show-icon":""},null,8,["message"])])):y("",!0),o(se,{columns:Q.value,"data-source":g.value,loading:$.value,pagination:v,"row-selection":W.value,rowKey:"id",onChange:ee,size:"middle"},{bodyCell:n(({column:l,record:_})=>[l.key==="taskName"?(r(),C(U,{key:0},{default:n(()=>[o(le,{src:_.channelIcon,size:"small"},null,8,["src"]),B("span",null,f(_.taskName),1)]),_:2},1024)):y("",!0),l.key==="taskTime"?(r(),h("div",pe,f(_.startTime)+" - "+f(_.endTime),1)):y("",!0),l.key==="taskStatus"?(r(),h(F,{key:2},[b(f(ue(N).getEnumText("TaskStatus",_.taskStatus)),1)],64)):y("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])])]),_:1},8,["open","title","confirm-loading"])}}},_e=oe(he,[["__scopeId","data-v-b4f134d7"]]);export{_e as S};
