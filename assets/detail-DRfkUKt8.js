import{_ as re,a as ue,b as ie,j as L,r as R,x as me,c as pe,k as ce,d as c,f as a,e as v,w as s,g as d,l as H,m as f,y as g,h as fe,o as p,F as w,n as I,p as b,i as u,t as r,s as V,q as z,Q as ke,P as ve,z as ge,A as be}from"./index-Dv0BEhZ1.js";import{P as ye}from"./PageHeader-5f2Xx4xM.js";const he={class:"task-form content-container"},Te={class:"form-container"},_e={class:"group-select"},$e={key:1,class:"group-tip"},qe={class:"user-range"},Re={key:0,class:"task-count"},we=["innerHTML"],Ie={class:"quota-container"},Pe={class:"custom-fields"},Ye={__name:"detail",setup(Me){const N=ue(),{t:i}=ie(),A=L(()=>N.loaded?N.getEnumOptions("TaskType"):[]),P=me(),Y=fe(),O=R(),M=L(()=>P.name==="TaskEdit"),t=pe({taskName:"",channelId:void 0,category:void 0,taskType:void 0,reward:void 0,brand:"",groupIds:[],groupMode:0,customFields:[{title:"",type:"post"}],startTime:null,endTime:null,quota:void 0,unlimitedQuota:!0,fansRequired:void 0,contentRequirement:"",taskInfo:"",notice:`1.请尽快完成发布，填写发布链接。
2.任务结束后无法填写，不能结算。
3.发布内容不符合要求，将无法审核通过。
4.填写链接无法访问或其他无关链接，视为放弃结算。`,userRange:0,taskCount:0}),J={taskName:[{required:!0,message:i("task.detail.validation.taskNameRequired")}],channelId:[{required:!0,message:i("task.detail.validation.channelRequired")}],category:[{required:!0,message:i("task.detail.validation.categoryRequired")}],taskType:[{required:!0,message:i("task.detail.validation.taskTypeRequired")}],reward:[{required:!0,message:i("task.detail.validation.rewardRequired")}],fansRequired:[{required:!0,message:i("task.detail.validation.fansRequired")}],groupIds:[{validator:(e,l)=>t.groupMode===1&&(!l||l.length===0)?Promise.reject(i("task.detail.validation.groupRequired")):Promise.resolve()}],taskCount:[{validator:(e,l)=>t.userRange===1&&l==null?Promise.reject(i("task.detail.validation.taskCountRequired")):Promise.resolve()}]},S=R([]),Q=R([]),K=()=>{t.customFields.length<10&&t.customFields.push({title:"",type:"group"})},W=e=>{t.customFields.splice(e,1)},X=e=>{e.target.value===0&&(t.groupIds=[])},Z=async()=>{try{y.value=!0;const e={...t,groupIds:t.groupMode===0?[]:t.groupIds,startTime:t.startTime?g(t.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:t.endTime?g(t.endTime).format("YYYY-MM-DD HH:mm:ss"):null},l=await be("task.add",e);l.code===0?(f.success(i("common.submitSuccess")),Y.back()):f.error(l.message)}catch(e){console.log(e),f.error(i("common.submitFailed"))}finally{y.value=!1}},x=async()=>{try{y.value=!0;const e={...t,groupIds:t.groupMode===0?[]:t.groupIds,startTime:t.startTime?g(t.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:t.endTime?g(t.endTime).format("YYYY-MM-DD HH:mm:ss"):null},l=await ge("task.edit",{...e},{urlParams:{id:P.params.id}});l.code===0?(f.success(i("common.submitSuccess")),Y.back()):f.error(l.message)}catch(e){console.log(e),f.error(i("common.submitFailed"))}finally{y.value=!1}},y=R(!1),ee=()=>{O.value.validate().then(async()=>{M.value?await x():await Z()})},ae=()=>{Y.back()},te=async e=>{try{const l=await H("task.detail",{},{urlParams:{id:e}});if(l.code===0){let m={};for(let n in l.data)n!=="groups"&&(m[n]=l.data[n]);m.startTime&&(m.startTime=g(m.startTime)),m.endTime&&(m.endTime=g(m.endTime)),Object.assign(t,m)}}catch(l){console.log(l),f.error(l)}},le=async()=>{const e=await H("channel.list");e.code===0&&(S.value=e.data.list)},j=async(e="")=>{try{const l=await H("group.list",{page:1,pageSize:50,groupName:e});l.code===0&&(Q.value=l.data.list||[])}catch{f.error(i("task.detail.loadGroupFailed"))}};return ce(()=>{le(),j(),M.value&&te(P.params.id)}),(e,l)=>{const m=d("a-input"),n=d("a-form-item"),k=d("a-select-option"),h=d("a-select"),T=d("a-input-number"),E=d("a-date-picker"),U=d("a-col"),se=d("a-row"),_=d("a-radio"),G=d("a-radio-group"),B=d("a-form-item-rest"),oe=d("a-tooltip"),ne=d("a-checkbox"),C=d("a-space"),$=d("a-button"),D=d("a-textarea"),de=d("a-form");return p(),c("div",he,[a(ye,{title:M.value?e.$t("task.detail.editTitle"):e.$t("task.detail.createTitle"),back:!0,class:"page-header"},null,8,["title"]),v("div",Te,[a(de,{ref_key:"formRef",ref:O,model:t,rules:J,"label-col":{span:5},"wrapper-col":{span:18},layout:"horizontal"},{default:s(()=>[a(n,{label:e.$t("task.detail.taskName"),name:"taskName"},{default:s(()=>[a(m,{value:t.taskName,"onUpdate:value":l[0]||(l[0]=o=>t.taskName=o),placeholder:e.$t("task.detail.taskNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.channelId"),name:"channelId"},{default:s(()=>[a(h,{value:t.channelId,"onUpdate:value":l[1]||(l[1]=o=>t.channelId=o),placeholder:e.$t("task.detail.channelPlaceholder")},{default:s(()=>[(p(!0),c(w,null,I(S.value,o=>(p(),b(k,{key:o.id,value:o.id},{default:s(()=>[u(r(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.category"),name:"category"},{default:s(()=>[a(m,{value:t.category,"onUpdate:value":l[2]||(l[2]=o=>t.category=o),placeholder:e.$t("task.detail.categoryPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.taskType"),name:"taskType"},{default:s(()=>[a(h,{value:t.taskType,"onUpdate:value":l[3]||(l[3]=o=>t.taskType=o),placeholder:e.$t("task.detail.taskTypePlaceholder")},{default:s(()=>[(p(!0),c(w,null,I(A.value,o=>(p(),b(k,{key:o.value,value:o.value},{default:s(()=>[u(r(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.reward"),name:"reward"},{default:s(()=>[a(T,{value:t.reward,"onUpdate:value":l[4]||(l[4]=o=>t.reward=o),min:0,precision:2,step:.1,placeholder:e.$t("task.detail.rewardPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.fansRequired"),name:"fansRequired"},{default:s(()=>[a(T,{value:t.fansRequired,"onUpdate:value":l[5]||(l[5]=o=>t.fansRequired=o),min:0,step:1,placeholder:e.$t("task.detail.fansRequiredPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.taskTime"),required:""},{default:s(()=>[a(se,{gutter:8},{default:s(()=>[a(U,{span:11},{default:s(()=>[a(n,{name:"startTime",rules:[{required:!0,message:e.$t("task.detail.validation.startTimeRequired")}]},{default:s(()=>[a(E,{value:t.startTime,"onUpdate:value":l[6]||(l[6]=o=>t.startTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("task.detail.startTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1},8,["rules"])]),_:1}),a(U,{span:2,class:"text-center"},{default:s(()=>l[18]||(l[18]=[v("span",null,"至",-1)])),_:1}),a(U,{span:11},{default:s(()=>[a(n,{name:"endTime",rules:[{required:!0,message:e.$t("task.detail.validation.endTimeRequired")}]},{default:s(()=>[a(E,{value:t.endTime,"onUpdate:value":l[7]||(l[7]=o=>t.endTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("task.detail.endTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.specifyGroup"),name:"groupIds"},{default:s(()=>[v("div",_e,[a(G,{value:t.groupMode,"onUpdate:value":l[8]||(l[8]=o=>t.groupMode=o),onChange:X},{default:s(()=>[a(_,{value:0},{default:s(()=>[u(r(e.$t("task.detail.noSpecify")),1)]),_:1}),a(_,{value:1},{default:s(()=>[u(r(e.$t("task.detail.specifyGroups")),1)]),_:1})]),_:1},8,["value"]),a(B,null,{default:s(()=>[t.groupMode===1?(p(),b(h,{key:0,value:t.groupIds,"onUpdate:value":l[9]||(l[9]=o=>t.groupIds=o),"show-search":"","filter-option":!1,mode:"multiple",placeholder:e.$t("task.detail.groupPlaceholder"),style:{width:"100%","margin-top":"8px"},onSearch:j},{default:s(()=>[(p(!0),c(w,null,I(Q.value,o=>(p(),b(k,{key:o.id,value:o.id},{default:s(()=>[u(r(o.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(p(),c("div",$e,r(e.$t("task.detail.groupTip")),1))]),_:1})])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.userRange"),name:"userRange"},{default:s(()=>[v("div",qe,[a(G,{value:t.userRange,"onUpdate:value":l[10]||(l[10]=o=>t.userRange=o)},{default:s(()=>[a(_,{value:0},{default:s(()=>[u(r(e.$t("task.detail.allUsers")),1)]),_:1}),a(_,{value:1},{default:s(()=>[u(r(e.$t("task.detail.taskCompletionCount")),1)]),_:1})]),_:1},8,["value"]),a(B,null,{default:s(()=>[t.userRange===1?(p(),c("div",Re,[a(n,{name:"taskCount"},{default:s(()=>[a(T,{value:t.taskCount,"onUpdate:value":l[11]||(l[11]=o=>t.taskCount=o),min:0,precision:0,placeholder:e.$t("task.detail.countPlaceholder"),"addon-after":e.$t("task.detail.times")},null,8,["value","placeholder","addon-after"])]),_:1}),a(oe,null,{title:s(()=>[v("div",{innerHTML:e.$t("task.detail.countTip")},null,8,we)]),default:s(()=>[a(z(ke))]),_:1})])):V("",!0)]),_:1})])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.quota")},{default:s(()=>[v("div",Ie,[a(C,{align:"baseline"},{default:s(()=>[a(n,{name:"quota"},{default:s(()=>[a(T,{value:t.quota,"onUpdate:value":l[12]||(l[12]=o=>t.quota=o),min:0,precision:0,disabled:t.unlimitedQuota,placeholder:e.$t("task.detail.quotaPlaceholder")},null,8,["value","disabled","placeholder"])]),_:1}),a(ne,{checked:t.unlimitedQuota,"onUpdate:checked":l[13]||(l[13]=o=>t.unlimitedQuota=o)},{default:s(()=>[u(r(e.$t("task.detail.unlimited")),1)]),_:1},8,["checked"])]),_:1})])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.brand"),name:"brand"},{default:s(()=>[a(m,{value:t.brand,"onUpdate:value":l[14]||(l[14]=o=>t.brand=o),placeholder:e.$t("task.detail.brandPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.customFields")},{default:s(()=>[v("div",Pe,[(p(!0),c(w,null,I(t.customFields,(o,F)=>(p(),c("div",{key:F,class:"field-item"},[a(C,{align:"baseline"},{default:s(()=>[a(n,{name:["customFields",F,"title"],rules:[{required:!0,message:e.$t("task.detail.validation.fieldTitleRequired")}]},{default:s(()=>[a(m,{value:o.title,"onUpdate:value":q=>o.title=q,placeholder:e.$t("task.detail.fieldTitlePlaceholder")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","rules"]),a(h,{value:o.type,"onUpdate:value":q=>o.type=q,style:{width:"120px"}},{default:s(()=>[a(k,{value:"post"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.post")),1)]),_:1}),a(k,{value:"group"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.group")),1)]),_:1}),a(k,{value:"input"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.input")),1)]),_:1}),a(k,{value:"image"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.image")),1)]),_:1})]),_:2},1032,["value","onUpdate:value"]),a($,{type:"link",danger:"",onClick:q=>W(F)},{default:s(()=>[u(r(e.$t("task.detail.deleteField")),1)]),_:2},1032,["onClick"])]),_:2},1024)]))),128)),t.customFields.length<10?(p(),b($,{key:0,type:"dashed",block:"",onClick:K},{default:s(()=>[a(z(ve)),u(r(e.$t("task.detail.addField")),1)]),_:1})):V("",!0)])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.contentRequirement"),name:"contentRequirement"},{default:s(()=>[a(D,{value:t.contentRequirement,"onUpdate:value":l[15]||(l[15]=o=>t.contentRequirement=o),rows:4,placeholder:e.$t("task.detail.contentRequirementPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.taskInfo"),name:"taskInfo"},{default:s(()=>[a(D,{value:t.taskInfo,"onUpdate:value":l[16]||(l[16]=o=>t.taskInfo=o),rows:4,placeholder:e.$t("task.detail.taskInfoPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.notice"),name:"notice"},{default:s(()=>[a(D,{value:t.notice,"onUpdate:value":l[17]||(l[17]=o=>t.notice=o),rows:4,placeholder:e.$t("task.detail.noticePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{"wrapper-col":{span:16,offset:4}},{default:s(()=>[a(C,null,{default:s(()=>[a($,{type:"primary",onClick:ee},{default:s(()=>[u(r(e.$t("common.submit")),1)]),_:1}),a($,{onClick:ae},{default:s(()=>[u(r(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},De=re(Ye,[["__scopeId","data-v-39a9b277"]]);export{De as default};
