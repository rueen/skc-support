import{_ as ue,b as de,r as i,c as P,j,k as ie,d as w,e as p,f as t,w as a,g as r,l as F,m as d,h as pe,o as c,F as D,n as A,p as b,i as f,t as u,s as E,v as ce,z as me,A as ge}from"./index-BP635qNQ.js";import{_ as fe}from"./CopyContent-DgFI5kkJ.js";const _e={class:"group content-container"},ve={class:"table-container"},ke={class:"table-header"},he={class:"left"},ye={class:"right"},we=["onClick"],be={class:"danger"},Ne={class:"link-text-container"},Le=["href"],$e={__name:"index",setup(Ie){const{t:s}=de(),G=pe(),N=i(!1),_=i(!1),L=i(!1),y=i("add"),O=i(),m=P({groupName:"",ownerId:void 0}),l=P({groupName:"",groupLink:"",ownerId:void 0}),R=i(void 0),H={groupName:[{required:!0,message:s("group.groupNameRequired")}],groupLink:[{required:!0,message:s("group.groupLinkRequired")}]},$=i([]),J=j(()=>[{title:"ID",dataIndex:"id",key:"id",width:100},{title:s("group.groupName"),dataIndex:"groupName",key:"groupName"},{title:s("group.groupLink"),dataIndex:"groupLink",key:"groupLink",ellipsis:!0},{title:s("group.owner"),dataIndex:"ownerName",key:"ownerName"},{title:s("group.memberCount"),key:"memberCount",align:"right"},{title:s("group.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:s("group.action"),key:"action",width:200}]),U=i([]),v=P({current:1,pageSize:10,total:0}),K=j(()=>({add:s("group.addTitle"),edit:s("group.editTitle")})[y.value]),V=()=>{v.current=1,k()},Q=()=>{Object.assign(m,{name:"",ownerId:void 0}),V()},W=e=>{Object.assign(v,e),k()},X=()=>{y.value="add",l.groupName="",l.groupLink="",l.ownerId=void 0,_.value=!0},Y=e=>{G.push(`/member?groupId=${e.id}`)},Z=e=>{R.value=e.id,y.value="edit",l.groupName=e.groupName,l.groupLink=e.groupLink,l.ownerId=e.ownerId,_.value=!0},x=async e=>{try{const n=await ce("group.delete",{id:e.id},{urlParams:{id:e.id}});n.code===0?(d.success("删除成功"),k()):d.error(n.message)}catch{d.error("删除失败")}},ee=async()=>{const e=await ge("group.add",l);e.code===0?(d.success("添加成功"),_.value=!1,k()):d.error(e.message)},ae=async()=>{const e=await me("group.edit",l,{urlParams:{id:R.value}});e.code===0?(d.success("编辑成功"),_.value=!1,k()):d.error(e.message)},oe=async()=>{try{switch(await O.value.validate(),L.value=!0,y.value){case"add":await ee();break;case"edit":await ae();break}}catch(e){console.error(e)}finally{L.value=!1}},k=async()=>{N.value=!0;try{const e=await F("group.list",{page:v.current,pageSize:v.pageSize,...m});e.code===0?(U.value=e.data.list,v.total=e.data.total):d.error(e.message)}finally{N.value=!1}},I=async(e="")=>{try{const n=await F("member.list",{page:1,pageSize:50,memberNickname:e});n.code===0&&($.value=n.data.list||[])}catch{d.error("获取会员列表失败")}};return ie(()=>{k(),I()}),(e,n)=>{const C=r("a-input"),h=r("a-form-item"),z=r("a-select-option"),q=r("a-select"),T=r("a-button"),S=r("a-space"),B=r("a-form"),te=r("plus-outlined"),ne=r("a-typography-link"),le=r("a-popconfirm"),re=r("a-table"),se=r("a-modal");return c(),w("div",_e,[p("div",ve,[p("div",ke,[p("div",he,[t(B,{layout:"inline",model:m},{default:a(()=>[t(h,{label:e.$t("group.groupName")},{default:a(()=>[t(C,{value:m.groupName,"onUpdate:value":n[0]||(n[0]=o=>m.groupName=o),placeholder:e.$t("group.groupNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{label:e.$t("group.owner")},{default:a(()=>[t(q,{value:m.ownerId,"onUpdate:value":n[1]||(n[1]=o=>m.ownerId=o),placeholder:e.$t("group.ownerPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:I,style:{width:"200px"}},{default:a(()=>[(c(!0),w(D,null,A($.value,o=>(c(),b(z,{key:o.id,value:o.id},{default:a(()=>[f(u(o.memberNickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(h,null,{default:a(()=>[t(S,null,{default:a(()=>[t(T,{type:"primary",onClick:V},{default:a(()=>[f(u(e.$t("common.search")),1)]),_:1}),t(T,{onClick:Q},{default:a(()=>[f(u(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",ye,[t(S,null,{default:a(()=>[t(T,{type:"primary",onClick:X},{icon:a(()=>[t(te)]),default:a(()=>[f(" "+u(e.$t("group.add")),1)]),_:1})]),_:1})])]),t(re,{columns:J.value,"data-source":U.value,loading:N.value,pagination:v,onChange:W},{bodyCell:a(({column:o,record:g})=>[o.key==="memberCount"?(c(),w(D,{key:0},[f(u(g.memberCount)+" ",1),t(ne,{onClick:M=>Y(g)},{default:a(()=>[f(u(e.$t("group.view")),1)]),_:2},1032,["onClick"])],64)):E("",!0),o.key==="action"?(c(),b(S,{key:1},{default:a(()=>[p("a",{onClick:M=>Z(g)},u(e.$t("group.edit")),9,we),t(le,{title:e.$t("group.deleteConfirm"),onConfirm:M=>x(g)},{default:a(()=>[p("a",be,u(e.$t("group.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):o.key==="groupLink"?(c(),b(fe,{key:2,content:g.groupLink},{default:a(()=>[p("div",Ne,[p("a",{href:g.groupLink,target:"_blank",class:"link-text"},u(g.groupLink),9,Le)])]),_:2},1032,["content"])):E("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),t(se,{open:_.value,"onUpdate:open":n[5]||(n[5]=o=>_.value=o),title:K.value,confirmLoading:L.value,onOk:oe},{default:a(()=>[t(B,{ref_key:"formRef",ref:O,model:l,rules:H,"label-col":{span:6},"wrapper-col":{span:16}},{default:a(()=>[t(h,{label:e.$t("group.groupName"),name:"groupName"},{default:a(()=>[t(C,{value:l.groupName,"onUpdate:value":n[2]||(n[2]=o=>l.groupName=o),placeholder:e.$t("group.groupNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{label:e.$t("group.groupLink"),name:"groupLink"},{default:a(()=>[t(C,{value:l.groupLink,"onUpdate:value":n[3]||(n[3]=o=>l.groupLink=o),placeholder:e.$t("group.groupLinkPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{label:e.$t("group.owner"),name:"ownerId"},{default:a(()=>[t(q,{value:l.ownerId,"onUpdate:value":n[4]||(n[4]=o=>l.ownerId=o),placeholder:e.$t("group.ownerPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:I},{default:a(()=>[(c(!0),w(D,null,A($.value,o=>(c(),b(z,{key:o.id,value:o.id},{default:a(()=>[f(u(o.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},Se=ue($e,[["__scopeId","data-v-82f483e5"]]);export{Se as default};
