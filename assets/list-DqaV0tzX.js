import{r as C,a as ae,b as se,c as w,j as V,k as le,d as p,e as k,f as s,w as a,g as u,l as O,m as $,h as ne,o as n,F as h,n as P,p as _,i,t as o,q,P as oe,s as v,v as ue}from"./index-C7WthnMs.js";const re={class:"content-container"},de={class:"table-container"},ie={class:"table-header"},ce={class:"left"},pe={class:"right"},ke={key:0},me={key:1},_e=["onClick"],ve={__name:"list",setup(fe){const E=ne(),N=C(!1),y=ae(),{t:c}=se(),r=w({taskName:"",channelId:void 0,taskStatus:void 0,taskGroupId:void 0}),F=C([]),j=C([]),Q=V(()=>y.loaded?y.getEnumOptions("TaskStatus"):[]),R=V(()=>[{title:c("task.list.name"),key:"taskName"},{title:c("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:e})=>y.getEnumText("TaskStatus",e)},{title:c("task.list.quota"),key:"taskQuota"},{title:c("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:c("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0},{title:c("task.list.action"),key:"action"}]),z=C([]),m=w({current:1,pageSize:10,total:0}),B=w({sorterField:void 0,sorterOrder:void 0}),D=()=>{m.current=1,g()},A=()=>{Object.assign(r,{taskName:"",channelId:void 0,taskStatus:void 0,taskGroupId:void 0}),D()},L=(e,l,S)=>{Object.assign(m,e),Object.assign(B,{sorterField:S.field,sorterOrder:S.order}),g()},M=()=>{E.push("/task/create")},H=e=>{E.push(`/task/edit/${e.id}`)},J=async e=>{try{const l=await ue("task.delete",{},{urlParams:{id:e.id}});l.code===0?($.success(c("common.deleteSuccess")),g()):$.error(l.message)}catch{$.error(c("common.deleteFailed"))}},g=async()=>{N.value=!0;try{const e=await O("task.list",{page:m.current,pageSize:m.pageSize,...B,...r});e.code===0?(z.value=e.data.list,m.total=e.data.total):$.error(e.message)}finally{N.value=!1}},K=async()=>{const e=await O("channel.list");e.code===0&&(F.value=e.data.list)},U=async(e="")=>{const l=await O("taskGroup.list",{page:1,pageSize:50,taskGroupName:e});l.code===0&&(j.value=l.data.list||[])};return le(async()=>{g(),K(),U()}),(e,l)=>{const S=u("a-input"),f=u("a-form-item"),T=u("a-select-option"),I=u("a-select"),G=u("a-button"),b=u("a-space"),W=u("a-form"),X=u("a-avatar"),Y=u("a-tag"),Z=u("a-typography-text"),x=u("a-popconfirm"),ee=u("a-table");return n(),p("div",re,[k("div",de,[k("div",ie,[k("div",ce,[s(W,{layout:"inline",model:r},{default:a(()=>[s(f,{label:e.$t("task.search.taskName")},{default:a(()=>[s(S,{value:r.taskName,"onUpdate:value":l[0]||(l[0]=t=>r.taskName=t),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.channelId")},{default:a(()=>[s(I,{value:r.channelId,"onUpdate:value":l[1]||(l[1]=t=>r.channelId=t),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:a(()=>[(n(!0),p(h,null,P(F.value,t=>(n(),_(T,{key:t.id,value:t.id},{default:a(()=>[i(o(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.taskStatus")},{default:a(()=>[s(I,{value:r.taskStatus,"onUpdate:value":l[2]||(l[2]=t=>r.taskStatus=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:""},{default:a(()=>[(n(!0),p(h,null,P(Q.value,t=>(n(),_(T,{key:t.value,value:t.value},{default:a(()=>[i(o(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.taskGroup")},{default:a(()=>[s(I,{value:r.taskGroupId,"onUpdate:value":l[3]||(l[3]=t=>r.taskGroupId=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:"","show-search":"","filter-option":!1,onSearch:U},{default:a(()=>[(n(!0),p(h,null,P(j.value,t=>(n(),_(T,{key:t.id,value:t.id},{default:a(()=>[i(o(t.taskGroupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(b,null,{default:a(()=>[s(G,{type:"primary",onClick:D},{default:a(()=>[i(o(e.$t("common.search")),1)]),_:1}),s(G,{onClick:A},{default:a(()=>[i(o(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),k("div",pe,[s(b,null,{default:a(()=>[s(G,{type:"primary",onClick:M},{icon:a(()=>[s(q(oe))]),default:a(()=>[i(" "+o(e.$t("task.list.create")),1)]),_:1})]),_:1})])]),s(ee,{columns:R.value,"data-source":z.value,loading:N.value,pagination:m,showSorterTooltip:!1,onChange:L},{bodyCell:a(({column:t,record:d})=>[t.key==="taskName"?(n(),_(b,{key:0},{default:a(()=>[s(X,{src:d.channelIcon},null,8,["src"]),i(" "+o(d.taskName)+" ",1),d.taskGroup?(n(),_(Y,{key:0,color:"orange"},{default:a(()=>[i(o(d.taskGroup.taskGroupName),1)]),_:2},1024)):v("",!0)]),_:2},1024)):v("",!0),t.key==="taskQuota"?(n(),p(h,{key:1},[d.unlimitedQuota?(n(),p("span",ke,o(e.$t("task.list.unlimited")),1)):(n(),p("span",me,o(d.quota),1)),k("span",null," / "+o(d.submittedCount),1)],64)):v("",!0),t.key==="taskStatus"?(n(),p(h,{key:2},[i(o(q(y).getEnumText("TaskStatus",d.taskStatus)),1)],64)):v("",!0),t.key==="action"?(n(),_(b,{key:3},{default:a(()=>[k("a",{onClick:te=>H(d)},o(e.$t("task.list.edit")),9,_e),s(x,{title:e.$t("task.list.deleteConfirm"),onConfirm:te=>J(d)},{default:a(()=>[k("a",null,[s(Z,{type:"danger"},{default:a(()=>[i(o(e.$t("task.list.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}};export{ve as default};
