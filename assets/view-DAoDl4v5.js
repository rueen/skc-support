import{_ as Ie,b as Le,a as Oe,r as v,c as O,j as Ae,B as Re,k as Se,x as Be,d as f,f as t,e as i,t as l,w as a,g as r,F as q,n as Y,l as w,h as Pe,o as d,p as y,s as _,i as m,q as z,M as Ue,v as De,m as g,A as Z}from"./index-Cfr3vlO8.js";import{P as Ee}from"./PageHeader-BvdwLlI9.js";import{_ as M}from"./CopyContent-D3uuoqvB.js";import{G as Ne}from"./GroupOwner-BoWlyXlS.js";const qe={class:"member-view content-container"},ze={class:"detail-container"},Me={class:"section"},Fe={class:"section-title"},Ge={key:0},Ve={key:0},je={class:"section"},He={class:"section-title"},We={class:"account-list"},Je={class:"link-text-container",style:{"max-width":"300px"}},Ke=["href"],Qe={class:"section",style:{"padding-bottom":"24px"}},Xe={class:"section-title"},Ye={class:"section",style:{"padding-bottom":"24px"}},Ze={class:"section-title"},xe={class:"section"},et={class:"section-title"},tt={key:1},at={__name:"view",setup(nt){const{t:p}=Le(),A=Oe(),R=Be(),F=Pe(),c=v(""),s=O({}),G=v([]),x=Ae(()=>`${Re.h5Url}?inviteCode=${s.inviteCode}`),S=O({}),B=O({}),P=O({}),V=v(),h=v(!1),I=v("grant"),b=O({amount:"",remark:""}),L=v(!1),ee=v({amount:[{required:!0,message:p("member.view.amountRequired")}],remark:[{required:!0,message:p("member.view.remarkRequired")}]}),te=()=>{const e={};R.query.filters&&(e.filters=R.query.filters),F.push({name:"MemberList",query:e})},ae=async()=>{const e=await w("member.detail",{},{urlParams:{id:c.value}});e.code===0&&Object.assign(s,e.data||{})},U=async()=>{const e=await w("member.balance",{},{urlParams:{memberId:c.value}});e.code===0&&(s.balance=e.data.balance)},ne=async()=>{const e=await w("member.withdrawalsAccount",{},{urlParams:{memberId:c.value}});e.code===0&&(s.withdrawalsAccount=e.data[0]||{})},j=async()=>{const e=await w("account.list",{memberId:c.value});e.code===0&&(G.value=e.data.list||[])},le=e=>{F.push({name:"AccountEdit",params:{id:e.id}})},se=e=>{Ue.confirm({content:p("common.deleteConfirm"),onOk:async()=>{const o=await De("account.delete",{},{urlParams:{id:e.id}});o.code===0?(g.success(o.message),j()):g.error(o.message)}})},oe=async()=>{const e=await w("member.taskStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(S,e.data||{})},re=async()=>{const e=await w("member.inviteStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(B,e.data||{})},ie=async()=>{const e=await w("member.groupsStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(P,e.data||{})},ue=()=>{h.value=!0,I.value="grant"},me=()=>{h.value=!0,I.value="deduct"},D=v(!1),de=v([{title:p("member.view.balanceLogs.beforeBalance"),dataIndex:"beforeBalance",key:"beforeBalance",width:120},{title:p("member.view.balanceLogs.amount"),dataIndex:"amount",key:"amount",width:120},{title:p("member.view.balanceLogs.afterBalance"),dataIndex:"afterBalance",key:"afterBalance",width:120},{title:p("member.view.balanceLogs.transactionType"),key:"transactionType"},{title:p("member.view.balanceLogs.createTime"),dataIndex:"createTime",key:"createTime"}]),H=v([]),ce=async()=>{D.value=!0;const e=await w("member.balanceLogs",{pageSize:3e3,pageNum:1},{urlParams:{memberId:c.value}});e.code===0&&(H.value=e.data.list||[])},ve=async()=>{L.value=!0;try{const e=await Z("member.grantReward",{memberId:c.value,amount:b.amount,remark:b.remark});e.code===0?(g.success("奖励发放成功"),h.value=!1,U()):g.error(e.message)}catch{g.error("奖励发放失败")}finally{L.value=!1}},be=async()=>{L.value=!0;try{const e=await Z("member.deductReward",{memberId:c.value,amount:b.amount,remark:b.remark},{urlParams:{memberId:c.value}});e.code===0?(g.success("奖励扣除成功"),h.value=!1,U()):g.error(e.message)}catch{g.error("奖励扣除失败")}finally{L.value=!1}},pe=async()=>{try{switch(await V.value.validate(),I.value){case"grant":ve();break;case"deduct":be();break}}catch(e){console.log(e)}};return Se(()=>{c.value=R.params.id,ae(),U(),j(),oe(),re(),ie(),ne()}),(e,o)=>{const fe=r("UserOutlined"),W=r("a-avatar"),J=r("a-tag"),$=r("a-space"),u=r("a-descriptions-item"),E=r("a-button"),we=r("PlusOutlined"),_e=r("MinusOutlined"),K=r("a-descriptions"),ge=r("EditOutlined"),ke=r("DeleteOutlined"),C=r("a-statistic"),T=r("a-col"),N=r("a-row"),ye=r("a-input"),Q=r("a-form-item"),he=r("a-textarea"),$e=r("a-form"),X=r("a-modal"),Ce=r("a-typography-text"),Te=r("a-table");return d(),f("div",qe,[t(Ee,{title:e.$t("member.view.pageTitle"),back:!0,useDefaultBack:!1,onBack:te},null,8,["title"]),i("div",ze,[i("div",Me,[i("div",Fe,l(e.$t("member.view.memberInfo")),1),t(K,{column:2},{default:a(()=>[t(u,{label:e.$t("member.view.memberNickname")},{default:a(()=>[t($,null,{default:a(()=>[t(W,{src:s.avatar,size:"small"},{icon:a(()=>[t(fe)]),_:1},8,["src"]),i("span",null,l(s.nickname),1),s.isNew?(d(),y(J,{key:0,color:"green"},{default:a(()=>o[7]||(o[7]=[m("new")])),_:1})):_("",!0)]),_:1})]),_:1},8,["label"]),t(u,{label:e.$t("member.view.memberAccount")},{default:a(()=>[m(l(s.account),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.gender")},{default:a(()=>[m(l(z(A).getEnumText("GenderType",s.gender)),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.occupation")},{default:a(()=>[m(l(z(A).getEnumText("OccupationType",s.occupation))+" ",1),s.occupation===null?(d(),f("span",Ge," - ")):_("",!0)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.email")},{default:a(()=>[m(l(s.email||"-"),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.phone")},{default:a(()=>[m(l(s.phone||"-"),1)]),_:1},8,["label"]),t(u,{label:"Telegram"},{default:a(()=>[m(l(s.telegram||"-"),1)]),_:1}),t(u,{label:e.$t("member.view.group")},{default:a(()=>[(d(!0),f(q,null,Y(s.groups,n=>(d(),y($,{key:n.id},{default:a(()=>[m(l(n.groupName)+" ",1),n.isOwner?(d(),y(Ne,{key:0})):_("",!0)]),_:2},1024))),128)),!s.groups||!s.groups.length?(d(),f("span",Ve," - ")):_("",!0)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.inviter")},{default:a(()=>[m(l(s.inviterNickname||"-"),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.inviteUrl")},{default:a(()=>[t(M,{content:x.value},null,8,["content"])]),_:1},8,["label"]),t(u,{label:e.$t("member.view.withdrawalsAccount")},{default:a(()=>[t($,null,{default:a(()=>{var n,k;return[i("span",null,l(((n=s==null?void 0:s.withdrawalsAccount)==null?void 0:n.paymentChannelName)||"-"),1),i("span",null,l(((k=s==null?void 0:s.withdrawalsAccount)==null?void 0:k.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),t(u,{label:e.$t("member.view.balance")},{default:a(()=>[t($,{size:16},{default:a(()=>[i("span",null,l(s.balance),1),t(E,{type:"link",size:"small",onClick:o[0]||(o[0]=n=>ce())},{default:a(()=>[m(l(e.$t("member.view.balanceLogs.view")),1)]),_:1}),t(E,{type:"primary",size:"small",onClick:o[1]||(o[1]=n=>ue())},{default:a(()=>[t(we),m(" "+l(e.$t("member.view.rewardGrant")),1)]),_:1}),t(E,{size:"small",danger:"",onClick:o[2]||(o[2]=n=>me())},{default:a(()=>[t(_e),m(" "+l(e.$t("member.view.rewardDeduct")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),i("div",je,[i("div",He,l(e.$t("member.view.accountInfo")),1),i("div",We,[(d(!0),f(q,null,Y(G.value,n=>(d(),f("div",{key:n.channelId},[t(K,{column:1},{default:a(()=>[t(u,{label:e.$t("member.view.account")},{default:a(()=>[t($,{size:24},{default:a(()=>[t($,null,{default:a(()=>[t(W,{src:n.channelIcon,size:"small"},null,8,["src"]),i("span",null,l(n.account),1),t(J,{color:"warning"},{default:a(()=>[m(l(z(A).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024),t(ge,{onClick:k=>le(n)},null,8,["onClick"]),t(ke,{onClick:k=>se(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),t(u,{label:e.$t("member.view.homepage")},{default:a(()=>[t(M,{content:n.homeUrl},{default:a(()=>[i("div",Je,[i("a",{href:n.homeUrl,target:"_blank",class:"link-text"},l(n.homeUrl),9,Ke)])]),_:2},1032,["content"])]),_:2},1032,["label"]),t(u,{label:"uid"},{default:a(()=>[t(M,{content:n.uid},null,8,["content"])]),_:2},1024),n.channelCustomFields.includes("fansCount")?(d(),y(u,{key:0,label:e.$t("member.view.fansCount")},{default:a(()=>[m(l(n.fansCount),1)]),_:2},1032,["label"])):_("",!0),n.channelCustomFields.includes("friendsCount")?(d(),y(u,{key:1,label:e.$t("member.view.friendsCount")},{default:a(()=>[m(l(n.friendsCount),1)]),_:2},1032,["label"])):_("",!0),n.channelCustomFields.includes("postsCount")?(d(),y(u,{key:2,label:e.$t("member.view.postsCount")},{default:a(()=>[m(l(n.postsCount),1)]),_:2},1032,["label"])):_("",!0)]),_:2},1024)]))),128))])]),i("div",Qe,[i("div",Xe,l(e.$t("member.view.taskStats")),1),t(N,{gutter:16},{default:a(()=>[t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.completedTaskCount"),value:S.completedTaskCount},null,8,["title","value"])]),_:1}),t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.taskReward"),value:S.totalTaskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),i("div",Ye,[i("div",Ze,l(e.$t("member.view.inviteStats")),1),t(N,null,{default:a(()=>[t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.inviteCount"),value:B.inviteCount},null,8,["title","value"])]),_:1}),t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.inviteReward"),value:B.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),i("div",xe,[i("div",et,l(e.$t("member.view.groupStats")),1),t(N,null,{default:a(()=>[t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.groupCount"),value:P.groupCount},null,8,["title","value"])]),_:1}),t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.groupEarnings"),value:P.totalCommission},null,8,["title","value"])]),_:1})]),_:1})])]),t(X,{open:h.value,"onUpdate:open":o[5]||(o[5]=n=>h.value=n),title:I.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:pe,confirmLoading:L.value},{default:a(()=>[t($e,{ref_key:"rewardFormRef",ref:V,model:b,rules:ee.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:a(()=>[t(Q,{label:I.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:a(()=>[t(ye,{value:b.amount,"onUpdate:value":o[3]||(o[3]=n=>b.amount=n)},null,8,["value"])]),_:1},8,["label"]),t(Q,{label:e.$t("member.view.remark"),name:"remark"},{default:a(()=>[t(he,{value:b.remark,"onUpdate:value":o[4]||(o[4]=n=>b.remark=n),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"]),t(X,{open:D.value,"onUpdate:open":o[6]||(o[6]=n=>D.value=n),title:e.$t("member.view.balanceLogs.title"),width:800},{default:a(()=>[t(Te,{size:"small",columns:de.value,"data-source":H.value,pagination:!1,scroll:{y:400}},{bodyCell:a(({column:n,record:k})=>[n.key==="transactionType"?(d(),f(q,{key:0},[k.transactionType==="withdrawal_refund"?(d(),y(Ce,{key:0,type:"danger"},{default:a(()=>o[8]||(o[8]=[m("余额退还")])),_:1})):(d(),f("span",tt,l(k.transactionType),1))],64)):_("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open","title"])])}}},it=Ie(at,[["__scopeId","data-v-fa75e537"]]);export{it as default};
