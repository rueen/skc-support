import{_ as ie,a as ce,b as de,r as C,c as L,x as ue,j as me,k as pe,d as _,e as i,f as l,w as t,g as c,l as S,m as b,h as _e,o as s,F as w,n as I,p as k,i as f,t as r,s as h,q as fe,M as ke,v as he}from"./index-D-HAHOvD.js";import{_ as B}from"./CopyContent-BBJ-hHKu.js";import{G as ge}from"./GroupOwner-CsVm6W59.js";import{d as ve}from"./download-Bp_ICamd.js";const ye={class:"member-list content-container"},be={class:"table-container"},we={class:"table-header"},Ce={class:"left"},Ie={class:"right"},Te={class:"link-text-container"},$e={class:"label"},Se=["href"],De={key:1},Ne={style:{color:"#999","font-size":"12px"}},Oe={key:0},Me=["onClick"],Re=["onClick"],xe={class:"danger"},Ue={__name:"list",setup(ze){const P=ce(),{t:m}=de(),D=_e(),V=ue(),N=C(!1),o=L({keyword:"",channelId:void 0,groupId:V.query.groupId,inviterId:void 0,completedTaskCount:void 0,createTimeRange:[]}),O=C([]),g=L({current:1,pageSize:10,total:0}),z=C([]),j=me(()=>[{title:m("member.list.memberNickname"),key:"nickname"},{title:m("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:m("member.list.accounts"),key:"accountList"},{title:m("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:m("member.list.inviter"),key:"inviterNickname"},{title:m("member.list.group"),key:"groups"},{title:m("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:m("member.list.action"),key:"action",fixed:"right",width:150}]),E=()=>{g.current=1,T()},G=()=>{Object.assign(o,{keyword:"",channelId:void 0,groupId:void 0,inviterId:void 0,completedTaskCount:void 0,createTimeRange:[]}),E()},q=e=>{g.current=e.current,g.pageSize=e.pageSize,T()},J=()=>{D.push("/member/create")},K=e=>{D.push(`/member/edit/${e.id}`)},Y=e=>{D.push(`/member/view/${e}`)},Q=async e=>{const a=await he("member.delete",{},{urlParams:{id:e.id}});a.code===0?(b.success("删除成功"),T()):b.error(a.message)},T=async()=>{var e,a;N.value=!0;try{const v={page:g.current,pageSize:g.pageSize,keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviterId:o.inviterId,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(a=o.createTimeRange)==null?void 0:a[1]},d=await S("member.list",v);d.code===0?(O.value=d.data.list,g.total=d.data.total):b.error(d.message)}finally{N.value=!1}},A=async(e="")=>{try{const a=await S("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(z.value=a.data.list||[])}catch{b.error("获取群组列表失败")}},W=()=>{ke.confirm({title:m("common.export"),content:m("common.confirmExportContent"),onOk:async()=>{var e,a;try{const v=b.loading(m("common.exporting"),0),d={keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviterId:o.inviterId,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(a=o.createTimeRange)==null?void 0:a[1]};await ve("member.export",d,`会员列表_${new Date().toLocaleDateString()}.xlsx`),v(),b.success(m("common.exportSuccess"))}catch(v){console.error("导出失败:",v),b.error(m("common.exportFailed"))}}})},M=C([]),X=async()=>{M.value.length||await F()},F=async(e="")=>{const a=await S("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(M.value=a.data.list||[])},R=C([]),Z=async()=>{if(!R.value.length)try{const e=await S("channel.list");e.code===0&&(R.value=e.data.list)}catch(e){console.error(e)}};return pe(()=>{T(),A()}),(e,a)=>{const v=c("a-input"),d=c("a-form-item"),x=c("a-select-option"),U=c("a-select"),ee=c("a-input-number"),te=c("a-range-picker"),$=c("a-button"),y=c("a-space"),ae=c("a-form"),ne=c("DownloadOutlined"),oe=c("plus-outlined"),H=c("a-tag"),le=c("a-typography-link"),se=c("a-popconfirm"),re=c("a-table");return s(),_("div",ye,[i("div",be,[i("div",we,[i("div",Ce,[l(ae,{layout:"inline",model:o},{default:t(()=>[l(d,{label:e.$t("member.search.keyword")},{default:t(()=>[l(v,{value:o.keyword,"onUpdate:value":a[0]||(a[0]=n=>o.keyword=n),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("common.channel")},{default:t(()=>[l(U,{value:o.channelId,"onUpdate:value":a[1]||(a[1]=n=>o.channelId=n),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":"",onFocus:Z},{default:t(()=>[(s(!0),_(w,null,I(R.value,n=>(s(),k(x,{key:n.id,value:n.id},{default:t(()=>[f(r(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("member.search.group")},{default:t(()=>[l(U,{value:o.groupId,"onUpdate:value":a[2]||(a[2]=n=>o.groupId=n),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:A,style:{width:"200px"}},{default:t(()=>[(s(!0),_(w,null,I(z.value,n=>(s(),k(x,{key:n.id,value:n.id},{default:t(()=>[f(r(n.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("member.list.inviter")},{default:t(()=>[l(U,{value:o.inviterId,"onUpdate:value":a[3]||(a[3]=n=>o.inviterId=n),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onFocus:X,onSearch:F},{default:t(()=>[(s(!0),_(w,null,I(M.value,n=>(s(),k(x,{key:n.id,value:n.id},{default:t(()=>[f(r(n.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("member.list.completedTaskCount")},{default:t(()=>[l(ee,{value:o.completedTaskCount,"onUpdate:value":a[4]||(a[4]=n=>o.completedTaskCount=n),min:0,max:9999,style:{width:"100px!important"}},null,8,["value"])]),_:1},8,["label"]),l(d,{label:e.$t("member.search.createTime")},{default:t(()=>[l(te,{value:o.createTimeRange,"onUpdate:value":a[5]||(a[5]=n=>o.createTimeRange=n),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),l(d,null,{default:t(()=>[l(y,null,{default:t(()=>[l($,{type:"primary",onClick:E},{default:t(()=>[f(r(e.$t("common.search")),1)]),_:1}),l($,{onClick:G},{default:t(()=>[f(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",Ie,[l(y,null,{default:t(()=>[O.value.length?(s(),k($,{key:0,onClick:W},{icon:t(()=>[l(ne)]),default:t(()=>[f(" "+r(e.$t("common.export")),1)]),_:1})):h("",!0),l($,{type:"primary",onClick:J},{icon:t(()=>[l(oe)]),default:t(()=>[f(" "+r(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),l(re,{columns:j.value,"data-source":O.value,loading:N.value,pagination:g,onChange:q},{bodyCell:t(({column:n,record:p})=>[n.key==="nickname"?(s(),k(y,{key:0},{default:t(()=>[i("span",null,r(p.nickname),1),p.isNew?(s(),k(H,{key:0,color:"green"},{default:t(()=>a[6]||(a[6]=[f("new")])),_:1})):h("",!0)]),_:2},1024)):h("",!0),n.key==="accountList"?(s(),k(y,{key:1,direction:"vertical"},{default:t(()=>[(s(!0),_(w,null,I(p.accountList,u=>(s(),_("div",null,[i("div",null,[l(y,null,{default:t(()=>[f(r(e.$t("member.list.account"))+"："+r(u.account)+" ",1),l(H,{color:"warning"},{default:t(()=>[f(r(fe(P).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),i("div",Te,[i("span",$e,r(e.$t("member.list.homepage"))+"：",1),l(B,{content:u.homeUrl},{default:t(()=>[i("a",{href:u.homeUrl,target:"_blank",class:"link-text"},r(u.homeUrl),9,Se)]),_:2},1032,["content"])]),i("div",null,[a[7]||(a[7]=i("span",{class:"label"},"uid：",-1)),l(B,{content:u.uid},null,8,["content"])])]))),256))]),_:2},1024)):h("",!0),n.key==="inviterNickname"?(s(),_(w,{key:2},[p.inviterId?(s(),k(le,{key:0,onClick:u=>Y(p.inviterId)},{default:t(()=>[f(r(p.inviterNickname),1)]),_:2},1032,["onClick"])):(s(),_("span",De,"--"))],64)):h("",!0),n.key==="groups"?(s(),_(w,{key:3},[(s(!0),_(w,null,I(p.groups,u=>(s(),_("div",null,[l(y,null,{default:t(()=>[i("span",null,r(u.groupName),1),u.isOwner?(s(),k(ge,{key:0})):h("",!0)]),_:2},1024),i("div",Ne,r(u.joinTime),1)]))),256)),!p.groups||p.groups.length===0?(s(),_("span",Oe,"--")):h("",!0)],64)):h("",!0),n.key==="action"?(s(),k(y,{key:4},{default:t(()=>[i("a",{onClick:u=>K(p)},r(e.$t("member.list.edit")),9,Me),i("a",{onClick:u=>Y(p.id)},r(e.$t("member.list.view")),9,Re),l(se,{title:e.$t("member.list.deleteConfirm"),onConfirm:u=>Q(p)},{default:t(()=>[i("a",xe,r(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},He=ie(Ue,[["__scopeId","data-v-26a469c2"]]);export{He as default};
