import{_ as Z,a as ee,b as te,r as x,c as A,x as ae,j as oe,k as ne,d,e as i,f as a,w as t,g as c,l as E,m as f,h as se,o,F as y,n as I,p as b,i as p,t as n,s as _,q as le,M as re,v as ie}from"./index-BWNwRArP.js";import{_ as ce}from"./CopyContent-B0Lhq1wv.js";import{G as me}from"./GroupOwner-S1ZWUDFo.js";import{d as ue}from"./download-DpfGYDWL.js";const de={class:"member-list content-container"},pe={class:"table-container"},_e={class:"table-header"},ge={class:"left"},ke={class:"right"},fe={key:1,style:{display:"inline-block"}},he={class:"link-text-container"},be={class:"label"},ye=["href"],ve={key:0},we=["onClick"],Ce=["onClick"],$e={class:"danger"},Ne={__name:"list",setup(Se){const B=ee(),{t:l}=te(),C=se(),L=ae(),$=x(!1),g=A({memberNickname:"",groupId:L.query.groupId}),N=x([]),k=A({current:1,pageSize:10,total:0}),T=x([]),U=oe(()=>[{title:l("member.list.memberNickname"),key:"nickname"},{title:l("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:l("member.list.accounts"),key:"accountList"},{title:l("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:l("member.list.inviter"),key:"inviterNickname"},{title:l("member.list.group"),key:"groups"},{title:l("member.list.updateTime"),dataIndex:"updateTime",key:"updateTime",width:180},{title:l("member.list.action"),key:"action",fixed:"right",width:150}]),D=()=>{k.current=1,v()},V=()=>{Object.assign(g,{memberNickname:"",groupId:void 0}),D()},F=e=>{k.current=e.current,k.pageSize=e.pageSize,v()},M=()=>{C.push("/member/create")},G=e=>{C.push(`/member/edit/${e.id}`)},P=e=>{C.push(`/member/view/${e.id}`)},R=async e=>{const s=await ie("member.delete",{},{urlParams:{id:e.id}});s.code===0?(f.success("删除成功"),v()):f.error(s.message)},v=async()=>{$.value=!0;try{const e=await E("member.list",{page:k.current,pageSize:k.pageSize,...g});e.code===0?(N.value=e.data.list,k.total=e.data.total):f.error(e.message)}finally{$.value=!1}},O=async(e="")=>{try{const s=await E("group.list",{page:1,pageSize:50,groupName:e});s.code===0&&(T.value=s.data.list||[])}catch{f.error("获取群组列表失败")}},j=()=>{re.confirm({title:l("common.export"),content:l("common.confirmExportContent"),onOk:async()=>{try{const e=f.loading(l("common.exporting"),0),s={...g};await ue("member.export",s,`会员列表_${new Date().toLocaleDateString()}.xlsx`),e(),f.success(l("common.exportSuccess"))}catch(e){console.error("导出失败:",e),f.error(l("common.exportFailed"))}}})};return ne(()=>{v(),O()}),(e,s)=>{const q=c("a-input"),S=c("a-form-item"),H=c("a-select-option"),J=c("a-select"),w=c("a-button"),h=c("a-space"),K=c("a-form"),Q=c("DownloadOutlined"),W=c("plus-outlined"),z=c("a-tag"),X=c("a-popconfirm"),Y=c("a-table");return o(),d("div",de,[i("div",pe,[i("div",_e,[i("div",ge,[a(K,{layout:"inline",model:g},{default:t(()=>[a(S,{label:e.$t("member.search.memberNickname")},{default:t(()=>[a(q,{value:g.memberNickname,"onUpdate:value":s[0]||(s[0]=r=>g.memberNickname=r),placeholder:e.$t("member.search.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(S,{label:e.$t("member.search.group")},{default:t(()=>[a(J,{value:g.groupId,"onUpdate:value":s[1]||(s[1]=r=>g.groupId=r),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:O,style:{width:"200px"}},{default:t(()=>[(o(!0),d(y,null,I(T.value,r=>(o(),b(H,{key:r.id,value:r.id},{default:t(()=>[p(n(r.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(S,null,{default:t(()=>[a(h,null,{default:t(()=>[a(w,{type:"primary",onClick:D},{default:t(()=>[p(n(e.$t("common.search")),1)]),_:1}),a(w,{onClick:V},{default:t(()=>[p(n(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",ke,[a(h,null,{default:t(()=>[N.value.length?(o(),b(w,{key:0,onClick:j},{icon:t(()=>[a(Q)]),default:t(()=>[p(" "+n(e.$t("common.export")),1)]),_:1})):_("",!0),a(w,{type:"primary",onClick:M},{icon:t(()=>[a(W)]),default:t(()=>[p(" "+n(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),a(Y,{columns:U.value,"data-source":N.value,loading:$.value,pagination:k,onChange:F},{bodyCell:t(({column:r,record:u})=>[r.key==="nickname"?(o(),b(h,{key:0},{default:t(()=>[i("span",null,n(u.nickname),1),u.isNew?(o(),b(z,{key:0,color:"green"},{default:t(()=>s[2]||(s[2]=[p("new")])),_:1})):_("",!0)]),_:2},1024)):_("",!0),r.key==="accountList"?(o(),d("div",fe,[(o(!0),d(y,null,I(u.accountList,m=>(o(),d("div",null,[i("div",null,[a(h,null,{default:t(()=>[p(n(e.$t("member.list.account"))+"："+n(m.account)+" ",1),a(z,{color:"warning"},{default:t(()=>[p(n(le(B).getEnumText("AccountAuditStatus",m.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),i("div",he,[i("span",be,n(e.$t("member.list.homepage"))+"：",1),a(ce,{content:m.homeUrl},{default:t(()=>[i("a",{href:m.homeUrl,target:"_blank",class:"link-text"},n(m.homeUrl),9,ye)]),_:2},1032,["content"])])]))),256))])):_("",!0),r.key==="inviterNickname"?(o(),d(y,{key:2},[p(n(u.inviterNickname||"--"),1)],64)):_("",!0),r.key==="groups"?(o(),d(y,{key:3},[(o(!0),d(y,null,I(u.groups,m=>(o(),d("div",null,[a(h,null,{default:t(()=>[i("span",null,n(m.groupName),1),m.isOwner?(o(),b(me,{key:0})):_("",!0)]),_:2},1024)]))),256)),!u.groups||u.groups.length===0?(o(),d("span",ve,"--")):_("",!0)],64)):_("",!0),r.key==="action"?(o(),b(h,{key:4},{default:t(()=>[i("a",{onClick:m=>G(u)},n(e.$t("member.list.edit")),9,we),i("a",{onClick:m=>P(u)},n(e.$t("member.list.view")),9,Ce),a(X,{title:e.$t("member.list.deleteConfirm"),onConfirm:m=>R(u)},{default:t(()=>[i("a",$e,n(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Oe=Z(Ne,[["__scopeId","data-v-aa2e1980"]]);export{Oe as default};
