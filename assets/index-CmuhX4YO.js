import{g as X,c as Y,d as Z,b as ee,p as ae}from"./request-oNTjVa74.js";import{_ as te,r as c,a as U,q as ne,l as oe,b as L,d,c as o,w as i,e as s,o as _,h as se,n as B,p as k,g as le,P as ie,i as t}from"./index-DxDHjWNo.js";const re={class:"channel content-container"},ce={class:"table-container"},de={class:"table-header"},ue={class:"right"},me=["onClick"],pe={key:0},fe={__name:"index",setup(_e){const v=c(!1),u=c(!1),g=c(!1),f=c("add"),b=c(),l=c([]),C={action:Y.imageUploadUrl,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},n=U({name:"",icon:""}),h=c(),S={name:[{required:!0,message:"请输入渠道名称"}],icon:[{required:!0,message:"请上传渠道图标"}]},T=[{title:"渠道图标",dataIndex:"icon",key:"icon",width:100},{title:"渠道名称",dataIndex:"name",key:"name"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",key:"action",width:200}],w=c([]),m=U({current:1,pageSize:10,total:0}),z=ne(()=>({add:"添加渠道",edit:"编辑渠道"})[f.value]),M=e=>{Object.assign(m,e),p()},V=()=>{f.value="add",n.name="",n.icon="",l.value=[],u.value=!0},D=e=>{f.value="edit",h.value=e.id,n.name=e.name,n.icon=e.icon,l.value=e.icon?[{uid:"-1",name:"image.png",status:"done",url:e.icon}]:[],u.value=!0},E=async e=>{try{const a=await Z("channel.delete",{},{urlParams:{id:e.id}});a.code===0?(t.success("删除成功"),p()):t.error(a.message)}catch{t.error("删除失败")}},N=e=>{e.code===0?(n.icon=e.data.url,l.value=[{uid:"-1",name:"image.png",status:"done",url:n.icon}],t.success("上传成功")):(t.error(response.message||"上传失败"),l.value=l.value.filter(a=>a.uid!==file.uid))},O=()=>{t.error("上传失败"),l.value=[]},P=e=>e.type.startsWith("image/")?e.size/1024/1024<1?!0:(t.error("图片必须小于 1MB！"),!1):(t.error("只能上传图片文件！"),!1),q=async()=>{const e=await ae("channel.add",n);e.code===0?(t.success("添加成功"),u.value=!1,p()):t.error(e.message)},$=async()=>{const e=await ee("channel.edit",{...n,id:h.value},{urlParams:{id:h.value}});e.code===0?(t.success("编辑成功"),u.value=!1,p()):t.error(e.message)},A=async()=>{try{switch(await b.value.validate(),g.value=!0,f.value){case"add":q();break;case"edit":$();break}}catch(e){console.error(e)}finally{g.value=!1}},p=async()=>{v.value=!0;try{const e=await X("channel.list",{page:m.current,pageSize:m.pageSize});w.value=e.data.list,m.total=e.data.total}finally{v.value=!1}};return oe(()=>{p()}),(e,a)=>{const x=s("a-button"),R=s("a-image"),j=s("a-popconfirm"),W=s("a-space"),F=s("a-table"),G=s("a-upload"),I=s("a-form-item"),H=s("a-input"),J=s("a-form"),K=s("a-modal");return _(),L("div",re,[d("div",ce,[d("div",de,[a[4]||(a[4]=d("div",{class:"left"},null,-1)),d("div",ue,[o(x,{type:"primary",onClick:V},{default:i(()=>a[3]||(a[3]=[se(" 添加渠道 ")])),_:1})])]),o(F,{columns:T,"data-source":w.value,loading:v.value,pagination:m,onChange:M},{bodyCell:i(({column:r,record:y})=>[r.key==="icon"?(_(),B(R,{key:0,width:40,height:40,src:y.icon},null,8,["src"])):k("",!0),r.key==="action"?(_(),B(W,{key:1},{default:i(()=>[d("a",{onClick:Q=>D(y)},"编辑",8,me),o(j,{title:"确定要删除该渠道吗？",onConfirm:Q=>E(y)},{default:i(()=>a[5]||(a[5]=[d("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(K,{open:u.value,"onUpdate:open":a[2]||(a[2]=r=>u.value=r),title:z.value,confirmLoading:g.value,onOk:A},{default:i(()=>[o(J,{ref_key:"formRef",ref:b,model:n,rules:S,"label-col":{span:6},"wrapper-col":{span:16}},{default:i(()=>[o(I,{label:"渠道图标",name:"icon"},{default:i(()=>[o(G,{"file-list":l.value,"onUpdate:fileList":a[0]||(a[0]=r=>l.value=r),action:C.action,headers:C.headers,"before-upload":P,onSuccess:N,onError:O,accept:"image/*","list-type":"picture-card","max-count":1},{default:i(()=>[l.value.length?k("",!0):(_(),L("div",pe,[o(le(ie)),a[6]||(a[6]=d("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list","action","headers"])]),_:1}),o(I,{label:"渠道名称",name:"name"},{default:i(()=>[o(H,{value:n.name,"onUpdate:value":a[1]||(a[1]=r=>n.name=r),placeholder:"请输入渠道名称"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},he=te(fe,[["__scopeId","data-v-6d162f9a"]]);export{he as default};
