import{g as P,p as b}from"./request-CVyLGzBl.js";import{_ as Q,r as m,a as C,n as W,b as w,d as p,c as o,w as n,e as i,o as _,h as D,k as V,l as y,F as X,j as Y,t as Z,m as r}from"./index-B8LRHCPB.js";const ee={class:"account content-container"},se={class:"table-container"},ae={class:"table-header"},te={class:"right"},oe=["onClick"],ne={__name:"index",setup(ie){const k=m(!1),l=m(!1),g=m(!1),u=m("add"),h=m(),e=C({username:"",password:"",remarks:"",permissions:[]}),A={username:[{required:!0,message:"请输入用户名"}],password:[{required:!0,message:"请输入密码",trigger:"change"}]},B=[{title:"task",permissions:"task:list"},{title:"taskCreate",permissions:"task:create"},{title:"taskEdit",permissions:"task:edit"},{title:"taskView",permissions:"task:view"},{title:"accountAudit",permissions:"account:audit"},{title:"taskAudit",permissions:"task:audit"},{title:"taskAuditDetail",permissions:"task:auditDetail"},{title:"member",permissions:"member:list"},{title:"memberCreate",permissions:"member:create"},{title:"memberEdit",permissions:"member:edit"},{title:"memberView",permissions:"member:view"},{title:"channel",permissions:"channel:list"},{title:"group",permissions:"group:list"},{title:"withdrawal",permissions:"settlement:withdrawal"},{title:"otherBills",permissions:"settlement:otherBills"},{title:"account",permissions:"account:list"},{title:"article",permissions:"article:list"}],U=[{title:"账号名称",dataIndex:"username",key:"username"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"操作",key:"action",width:200}],x=m([]),c=C({current:1,pageSize:10,total:0}),q=W(()=>u.value==="add"?"添加账号":"编辑账号"),E=s=>{Object.assign(c,s),d()},L=()=>{u.value="add",e.username="",e.password="",e.remarks="",e.permissions=[],l.value=!0},N=s=>{u.value="edit",e.username=s.username,e.password="",e.remarks=s.remarks,e.permissions=s.permissions,l.value=!0},O=async s=>{try{const a=await b("account.delete",{id:s.id});a.success?(r.success("删除成功"),d()):r.error(a.message)}catch{r.error("删除失败")}},S=async()=>{console.log(e);try{if(await h.value.validate(),g.value=!0,u.value==="add"){const s=await b("account.add",e);s.success?(r.success("添加成功"),l.value=!1,d()):r.error(s.message)}else{const s=await b("account.edit",e);s.success?(r.success("编辑成功"),l.value=!1,d()):r.error(s.message)}}catch(s){console.error(s)}finally{g.value=!1}},d=async()=>{k.value=!0;try{const s=await P("account.list",{page:c.current,pageSize:c.pageSize});x.value=s.data.list,c.total=s.data.total}finally{k.value=!1}};return d(),(s,a)=>{const T=i("a-button"),z=i("a-popconfirm"),F=i("a-space"),I=i("a-table"),$=i("a-input"),f=i("a-form-item"),j=i("a-input-password"),R=i("a-textarea"),G=i("a-checkbox"),H=i("a-checkbox-group"),J=i("a-form"),K=i("a-modal");return _(),w("div",ee,[p("div",se,[p("div",ae,[a[6]||(a[6]=p("div",{class:"left"},null,-1)),p("div",te,[o(T,{type:"primary",onClick:L},{default:n(()=>a[5]||(a[5]=[D(" 添加账号 ")])),_:1})])]),o(I,{columns:U,"data-source":x.value,loading:k.value,pagination:c,onChange:E},{bodyCell:n(({column:t,record:v})=>[t.key==="action"?(_(),V(F,{key:0},{default:n(()=>[v.isAdmin?y("",!0):(_(),w("a",{key:0,onClick:M=>N(v)},"编辑",8,oe)),v.isAdmin?y("",!0):(_(),V(z,{key:1,title:"确定要删除该账号吗？",onConfirm:M=>O(v)},{default:n(()=>a[7]||(a[7]=[p("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"]))]),_:2},1024)):y("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(K,{open:l.value,"onUpdate:open":a[4]||(a[4]=t=>l.value=t),title:q.value,confirmLoading:g.value,onOk:S},{default:n(()=>[o(J,{ref_key:"formRef",ref:h,model:e,rules:A,"label-col":{span:6},"wrapper-col":{span:16}},{default:n(()=>[o(f,{label:"用户名",name:"username"},{default:n(()=>[o($,{value:e.username,"onUpdate:value":a[0]||(a[0]=t=>e.username=t),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),o(f,{label:"密码",name:"password",required:u.value==="add"},{default:n(()=>[o(j,{value:e.password,"onUpdate:value":a[1]||(a[1]=t=>e.password=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["required"]),o(f,{label:"备注",name:"remarks"},{default:n(()=>[o(R,{value:e.remarks,"onUpdate:value":a[2]||(a[2]=t=>e.remarks=t),placeholder:"请输入备注",rows:3},null,8,["value"])]),_:1}),o(f,{label:"权限",name:"permissions"},{default:n(()=>[o(H,{value:e.permissions,"onUpdate:value":a[3]||(a[3]=t=>e.permissions=t)},{default:n(()=>[(_(),w(X,null,Y(B,t=>o(G,{key:t.title,value:t.permissions},{default:n(()=>[D(Z(s.$t("menu."+t.title)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},me=Q(ne,[["__scopeId","data-v-f60bdd00"]]);export{me as default};
