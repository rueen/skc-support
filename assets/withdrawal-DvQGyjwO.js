import{_ as ae,i as te,j as ne,r as p,a as T,k as oe,b as S,d as _,c as t,w as n,e as s,l as le,m as r,o as h,F as M,n as se,p as Y,h as d,t as y,g as B,D as re,q as I,M as ie,z as O}from"./index-DO2_8iIg.js";import{d as ce}from"./download-DunbwWMZ.js";const de={class:"withdrawal content-container"},ue={class:"table-container"},me={class:"table-header"},pe={class:"left"},_e={class:"right"},fe=["onClick"],ve={__name:"withdrawal",setup(we){const k=te(),H=ne(()=>k.loaded?k.getEnumOptions("WithdrawalStatus"):[]),b=p(!1),i=p([]),f=p(!1),R=p(!1),u=p(""),l=T({memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),A=[{title:"会员昵称",dataIndex:"member_nickname",key:"member_nickname"},{title:"提现账户",dataIndex:"memberAccount",key:"memberAccount"},{title:"账户类型",dataIndex:"memberAccountType",key:"memberAccountType"},{title:"申请提现金额",dataIndex:"amount",key:"amount",align:"right"},{title:"姓名",dataIndex:"name",key:"name"},{title:"申请时间",dataIndex:"applyTime",key:"applyTime"},{title:"提现状态",key:"withdrawal_status"},{title:"操作",key:"action",width:150}],D=p([]),m=T({current:1,pageSize:10,total:0}),N=()=>{m.current=1,v()},E=()=>{Object.assign(l,{memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),N()},L=a=>{Object.assign(m,a),v()},U=a=>{i.value=a},V=()=>{ie.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const a=r.loading("正在导出数据，请稍候...",0),e={...l};try{await ce("withdrawals.export",e,`提现列表_${new Date().toLocaleDateString()}.xlsx`),r.success("导出成功")}catch(w){console.error("导出失败:",w),r.error("导出失败，请稍后重试")}finally{a()}}})},$=async a=>{i.value=[a.id],j()},j=async()=>{if(!i.value.length){r.warning("请选择要操作的记录");return}const a=await O("withdrawals.batchResolve",{ids:i.value});a.code===0?(r.success("操作成功"),i.value=[],v()):r.error(a.message)},z=a=>{i.value=[a.id],u.value="",f.value=!0},F=()=>{if(!i.value.length){r.warning("请选择要操作的记录");return}u.value="",f.value=!0},K=async()=>{if(!u.value){r.error("请输入打款失败原因");return}R.value=!0;const a=await O("withdrawals.batchReject",{rejectReason:u.value,ids:i.value});a.code===0?(r.success("操作成功"),f.value=!1,i.value=[],v()):r.error(a.message)},v=async()=>{var a,e;b.value=!0;try{const w={page:m.current,pageSize:m.pageSize,memberNickname:l.memberNickname,withdrawalStatus:l.withdrawalStatus,startTime:(a=l.timeRange)==null?void 0:a[0],endTime:(e=l.timeRange)==null?void 0:e[1]},c=await le("withdrawals.list",{...w});c.code===0?(D.value=c.data.list||[],m.total=c.data.total||0):r.error(c.message)}finally{b.value=!1}};return oe(()=>{v()}),(a,e)=>{const w=s("a-input"),c=s("a-form-item"),W=s("a-select-option"),q=s("a-select"),G=s("a-range-picker"),g=s("a-button"),x=s("a-space"),J=s("a-form"),P=s("a-popconfirm"),Q=s("a-table"),X=s("a-textarea"),Z=s("a-modal");return h(),S("div",de,[_("div",ue,[_("div",me,[_("div",pe,[t(J,{layout:"inline",model:l},{default:n(()=>[t(c,{label:"会员昵称"},{default:n(()=>[t(w,{value:l.memberNickname,"onUpdate:value":e[0]||(e[0]=o=>l.memberNickname=o),placeholder:"请输入会员昵称","allow-clear":""},null,8,["value"])]),_:1}),t(c,{label:"提现状态"},{default:n(()=>[t(q,{value:l.withdrawalStatus,"onUpdate:value":e[1]||(e[1]=o=>l.withdrawalStatus=o),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:n(()=>[(h(!0),S(M,null,se(H.value,o=>(h(),Y(W,{key:o.value,value:o.value},{default:n(()=>[d(y(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(c,{label:"申请时间"},{default:n(()=>[t(G,{value:l.timeRange,"onUpdate:value":e[2]||(e[2]=o=>l.timeRange=o),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1}),t(c,null,{default:n(()=>[t(x,null,{default:n(()=>[t(g,{type:"primary",onClick:N},{default:n(()=>[d(y(a.$t("common.search")),1)]),_:1}),t(g,{onClick:E},{default:n(()=>[d(y(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",_e,[t(x,null,{default:n(()=>[t(g,{onClick:V},{icon:n(()=>[t(B(re))]),default:n(()=>[e[5]||(e[5]=d(" 导出 "))]),_:1}),t(g,{type:"primary",onClick:j},{default:n(()=>e[6]||(e[6]=[d("批量已打款")])),_:1}),t(g,{danger:"",onClick:F},{default:n(()=>e[7]||(e[7]=[d("批量打款失败")])),_:1})]),_:1})])]),t(Q,{columns:A,"data-source":D.value,loading:b.value,pagination:m,rowKey:"id","row-selection":{selectedRowKeys:i.value,onChange:U},onChange:L},{bodyCell:n(({column:o,record:C})=>[o.key==="withdrawal_status"?(h(),S(M,{key:0},[d(y(B(k).getEnumText("WithdrawalStatus",C.withdrawal_status)),1)],64)):I("",!0),o.key==="action"?(h(),Y(x,{key:1},{default:n(()=>[t(P,{title:"确定要标记为已打款吗？",onConfirm:ee=>$(C)},{default:n(()=>e[8]||(e[8]=[_("a",null,"已打款",-1)])),_:2},1032,["onConfirm"]),_("a",{class:"danger",onClick:ee=>z(C)},"打款失败",8,fe)]),_:2},1024)):I("",!0)]),_:1},8,["data-source","loading","pagination","row-selection"])]),t(Z,{open:f.value,"onUpdate:open":e[4]||(e[4]=o=>f.value=o),title:"打款失败原因",onOk:K,confirmLoading:R.value},{default:n(()=>[t(X,{value:u.value,"onUpdate:value":e[3]||(e[3]=o=>u.value=o),placeholder:"请输入打款失败原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},ye=ae(ve,[["__scopeId","data-v-497fdf62"]]);export{ye as default};
