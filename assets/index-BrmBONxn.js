import{_ as ee,b as ae,r,c as ne,j as T,k as te,d as B,e as u,f as t,w as c,g as o,l as oe,o as v,i as le,t as k,p as L,s as C,B as se,v as ie,m as l,z as ce,A as de}from"./index-fiN95LW_.js";const re={class:"channel content-container"},ue={class:"table-container"},me={class:"table-header"},pe={class:"right"},fe=["onClick"],ve={class:"danger"},he={key:0},_e={__name:"index",setup(ge){const{t:s}=ae(),h=r(!1),m=r(!1),_=r(!1),p=r("add"),w=r(),d=r([]),N=r([{label:s("channel.fansCount"),value:"fansCount"},{label:s("channel.friendsCount"),value:"friendsCount"},{label:s("channel.postsCount"),value:"postsCount"}]),I={action:se.imageUploadUrl,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},n=ne({name:"",icon:"",customFields:["fansCount"]}),g=r(),x={name:[{required:!0,message:s("channel.nameRequired")}],icon:[{required:!0,message:s("channel.iconRequired")}]},F=T(()=>[{title:s("channel.channelIcon"),dataIndex:"icon",key:"icon",width:120},{title:s("channel.channelName"),dataIndex:"name",key:"name"},{title:s("channel.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:s("channel.action"),key:"action",width:200}]),$=r([]),D=T(()=>({add:s("channel.addTitle"),edit:s("channel.editTitle")})[p.value]),M=()=>{p.value="add",n.name="",n.icon="",d.value=[],m.value=!0},S=e=>{p.value="edit",g.value=e.id,n.name=e.name,n.icon=e.icon,d.value=e.icon?[{uid:"-1",name:"image.png",status:"done",url:e.icon}]:[],m.value=!0},V=async e=>{try{const a=await ie("channel.delete",{},{urlParams:{id:e.id}});a.code===0?(l.success("删除成功"),f()):l.error(a.message)}catch{l.error("删除失败")}},q=e=>{e.code===0?(n.icon=e.data.url,d.value=[{uid:"-1",name:"image.png",status:"done",url:n.icon}],l.success("上传成功")):(l.error(response.message||"上传失败"),d.value=d.value.filter(a=>a.uid!==file.uid))},z=()=>{l.error("上传失败"),d.value=[]},E=e=>e.type.startsWith("image/")?e.size/1024/1024<1?!0:(l.error("图片必须小于 1MB！"),!1):(l.error("只能上传图片文件！"),!1),R=async()=>{const e=await de("channel.add",n);e.code===0?(l.success("添加成功"),m.value=!1,f()):l.error(e.message)},A=async()=>{const e=await ce("channel.edit",{...n,id:g.value},{urlParams:{id:g.value}});e.code===0?(l.success("编辑成功"),m.value=!1,f()):l.error(e.message)},O=async()=>{try{switch(await w.value.validate(),_.value=!0,p.value){case"add":R();break;case"edit":A();break}}catch(e){console.error(e)}finally{_.value=!1}},f=async()=>{h.value=!0;try{const e=await oe("channel.list",{page:1,pageSize:200});$.value=e.data.list}finally{h.value=!1}};return te(()=>{f()}),(e,a)=>{const U=o("a-button"),P=o("a-image"),j=o("a-popconfirm"),W=o("a-space"),G=o("a-table"),H=o("plus-outlined"),J=o("a-upload"),y=o("a-form-item"),K=o("a-input"),Q=o("a-checkbox-group"),X=o("a-form"),Y=o("a-modal");return v(),B("div",re,[u("div",ue,[u("div",me,[a[4]||(a[4]=u("div",{class:"left"},null,-1)),u("div",pe,[t(U,{type:"primary",onClick:M},{default:c(()=>[le(k(e.$t("channel.add")),1)]),_:1})])]),t(G,{columns:F.value,"data-source":$.value,loading:h.value,pagination:!1},{bodyCell:c(({column:i,record:b})=>[i.key==="icon"?(v(),L(P,{key:0,width:40,height:40,src:b.icon},null,8,["src"])):C("",!0),i.key==="action"?(v(),L(W,{key:1},{default:c(()=>[u("a",{onClick:Z=>S(b)},k(e.$t("channel.edit")),9,fe),t(j,{title:e.$t("channel.deleteConfirm"),onConfirm:Z=>V(b)},{default:c(()=>[u("a",ve,k(e.$t("channel.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["columns","data-source","loading"])]),t(Y,{open:m.value,"onUpdate:open":a[3]||(a[3]=i=>m.value=i),title:D.value,confirmLoading:_.value,onOk:O},{default:c(()=>[t(X,{ref_key:"formRef",ref:w,model:n,rules:x,"label-col":{span:6},"wrapper-col":{span:16}},{default:c(()=>[t(y,{label:e.$t("channel.channelIcon"),name:"icon"},{default:c(()=>[t(J,{"file-list":d.value,"onUpdate:fileList":a[0]||(a[0]=i=>d.value=i),action:I.action,headers:I.headers,"before-upload":E,onSuccess:q,onError:z,accept:"image/*","list-type":"picture-card","max-count":1},{default:c(()=>[d.value.length?C("",!0):(v(),B("div",he,[t(H),a[5]||(a[5]=u("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list","action","headers"])]),_:1},8,["label"]),t(y,{label:e.$t("channel.channelName"),name:"name"},{default:c(()=>[t(K,{value:n.name,"onUpdate:value":a[1]||(a[1]=i=>n.name=i),placeholder:e.$t("channel.channelNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(y,{label:e.$t("channel.customFields"),name:"customFields"},{default:c(()=>[t(Q,{value:n.customFields,"onUpdate:value":a[2]||(a[2]=i=>n.customFields=i),options:N.value},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},be=ee(_e,[["__scopeId","data-v-86ed156b"]]);export{be as default};
