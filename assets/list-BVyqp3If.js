import{_ as ce,i as de,j as re,r as m,a as G,k as pe,b as p,d as i,c as l,w as n,e as c,l as U,m as v,o as s,F as h,n as B,p as g,h as f,t as d,q as r,g as fe,z as K,M as ve}from"./index-BCP0ziDU.js";const _e={class:"account content-container"},me={class:"table-container"},ge={class:"table-header"},ye={class:"left"},ke={class:"right"},he={key:1,class:"account-info"},Ce={class:"home-url"},Se={class:"link-text-container"},be=["href"],we={class:"stats"},xe={key:0,class:"stat-item"},Ae={key:1,class:"stat-item"},je={key:2,class:"stat-item"},Re={key:2},Ie={class:"group-name"},Ne={__name:"list",setup(ze){const A=de(),q=re(()=>A.loaded?A.getEnumOptions("AccountAuditStatus"):[]),j=m(!1),_=m([]),C=m(!1),R=m(!1),y=m(""),u=G({account:"",channelId:void 0,accountAuditStatus:"pending",groupId:void 0}),F=m([]),V=m([]),I=[{title:"账号名称",key:"account"},{title:"账号详情",key:"accountInfo"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:"审核员",key:"waiterName"}],P=[...I,{title:"操作",key:"action"}],H=[...I,{title:"拒绝原因",key:"rejectReason"}],J={selectedRowKeys:_,onChange:t=>{_.value=t},getCheckboxProps:t=>({disabled:t.accountAuditStatus!=="pending"})},E=m([]),k=G({current:1,pageSize:10,total:0}),L=()=>{k.current=1,S()},Q=()=>{u.account="",u.channelId=void 0,u.accountAuditStatus=void 0,u.groupId=void 0,L()},W=t=>{Object.assign(k,{current:t.current,pageSize:t.pageSize}),S()},X=async t=>{_.value=[t.id],T()},T=async()=>{if(!_.value.length){v.warning("请选择要通过的账号");return}const t=await K("account.batchResolve",{ids:_.value});if(t.code===0){const e=t.data.failed.map(N=>N.reason).join(",");e?ve.error({title:"操作失败，失败原因",content:e}):(v.success("操作成功"),_.value=[],S())}else v.error(t.message)},Y=async()=>{if(!_.value.length){v.warning("请选择要拒绝的账号");return}y.value="",C.value=!0},Z=t=>{_.value=[t.id],y.value="",C.value=!0},ee=async()=>{if(!y.value){v.error("请输入拒绝原因");return}R.value=!0;try{const t=await K("account.batchReject",{ids:_.value,rejectReason:y.value});t.code===0?(v.success("操作成功"),_.value=[],C.value=!1,S()):v.error(t.message)}catch(t){console.log(t)}finally{R.value=!1}},S=async()=>{j.value=!0;try{const t=await U("account.list",{page:k.current,pageSize:k.pageSize,...u});t.code===0?(E.value=t.data.list,k.total=t.data.total):v.error(t.message)}finally{j.value=!1}},te=async()=>{const t=await U("channel.list");t.code===0&&(F.value=t.data.list)},D=async(t="")=>{try{const e=await U("group.list",{page:1,pageSize:50,groupName:t});e.code===0&&(V.value=e.data.list||[])}catch{v.error("获取群组列表失败")}},ae=t=>{navigator.clipboard.writeText(t).then(()=>{v.success("复制成功")}).catch(()=>{v.error("复制失败")})};return pe(()=>{S(),D(),te()}),(t,e)=>{const N=c("a-input"),b=c("a-form-item"),z=c("a-select-option"),O=c("a-select"),w=c("a-button"),x=c("a-space"),ne=c("a-form"),oe=c("a-avatar"),le=c("a-tag"),M=c("a-popconfirm"),se=c("a-table"),ue=c("a-textarea"),ie=c("a-modal");return s(),p("div",_e,[i("div",me,[i("div",ge,[i("div",ye,[l(ne,{layout:"inline",model:u},{default:n(()=>[l(b,{label:"账号"},{default:n(()=>[l(N,{value:u.account,"onUpdate:value":e[0]||(e[0]=a=>u.account=a),placeholder:"请输入账号","allow-clear":""},null,8,["value"])]),_:1}),l(b,{label:"平台渠道"},{default:n(()=>[l(O,{value:u.channelId,"onUpdate:value":e[1]||(e[1]=a=>u.channelId=a),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:n(()=>[(s(!0),p(h,null,B(F.value,a=>(s(),g(z,{key:a.id,value:a.id},{default:n(()=>[f(d(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(b,{label:"审核状态"},{default:n(()=>[l(O,{value:u.accountAuditStatus,"onUpdate:value":e[2]||(e[2]=a=>u.accountAuditStatus=a),placeholder:"请选择审核状态",style:{width:"120px"},"allow-clear":""},{default:n(()=>[(s(!0),p(h,null,B(q.value,a=>(s(),g(z,{key:a.value,value:a.value},{default:n(()=>[f(d(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(b,{label:"所属群组"},{default:n(()=>[l(O,{value:u.groupId,"onUpdate:value":e[3]||(e[3]=a=>u.groupId=a),placeholder:"请选择群组",style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:D},{default:n(()=>[(s(!0),p(h,null,B(V.value,a=>(s(),g(z,{key:a.id,value:a.id},{default:n(()=>[f(d(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(b,null,{default:n(()=>[l(x,null,{default:n(()=>[l(w,{type:"primary",onClick:L},{default:n(()=>e[6]||(e[6]=[f("查询")])),_:1}),l(w,{onClick:Q},{default:n(()=>e[7]||(e[7]=[f("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",ke,[l(x,null,{default:n(()=>[l(w,{type:"primary",onClick:T},{default:n(()=>e[8]||(e[8]=[f("批量通过")])),_:1}),l(w,{danger:"",onClick:Y},{default:n(()=>e[9]||(e[9]=[f("批量拒绝")])),_:1})]),_:1})])]),l(se,{columns:u.accountAuditStatus==="rejected"?H:u.accountAuditStatus==="pending"?P:I,"data-source":E.value,loading:j.value,pagination:k,"row-selection":J,rowKey:"id",onChange:W},{bodyCell:n(({column:a,record:o})=>[a.key==="account"?(s(),g(x,{key:0},{default:n(()=>[l(oe,{src:o.channelIcon,size:"small"},null,8,["src"]),i("span",null,d(o.account),1)]),_:2},1024)):r("",!0),a.key==="accountInfo"?(s(),p("div",he,[i("div",Ce,[i("div",Se,[e[11]||(e[11]=i("span",{class:"label"},"主页：",-1)),i("a",{href:o.homeUrl,target:"_blank",class:"link-text"},d(o.homeUrl),9,be),l(w,{type:"link",size:"small",onClick:$=>ae(o.homeUrl)},{default:n(()=>e[10]||(e[10]=[f(" 复制 ")])),_:2},1032,["onClick"])])]),i("div",we,[o.channelCustomFields.includes("fansCount")?(s(),p("div",xe,"粉丝数："+d(o.fansCount),1)):r("",!0),o.channelCustomFields.includes("friendsCount")?(s(),p("div",Ae,"好友数："+d(o.friendsCount),1)):r("",!0),o.channelCustomFields.includes("postsCount")?(s(),p("div",je,"发帖数："+d(o.postsCount),1)):r("",!0)])])):r("",!0),a.key==="member"?(s(),p("div",Re,[i("div",null,d(o.memberNickname),1),i("div",Ie,[i("span",null,d(o.groupName),1),o.isGroupOwner?(s(),g(le,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:n(()=>e[12]||(e[12]=[f("群主")])),_:1})):r("",!0)])])):r("",!0),a.key==="accountAuditStatus"?(s(),p(h,{key:3},[f(d(fe(A).getEnumText("AccountAuditStatus",o.accountAuditStatus)),1)],64)):r("",!0),a.key==="waiterName"?(s(),p(h,{key:4},[f(d(o.waiterName||"--"),1)],64)):r("",!0),a.key==="action"?(s(),g(x,{key:5},{default:n(()=>[o.accountAuditStatus==="pending"?(s(),g(M,{key:0,title:"确定要通过该账号吗？",onConfirm:$=>X(o)},{default:n(()=>e[13]||(e[13]=[i("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):r("",!0),o.accountAuditStatus==="pending"?(s(),g(M,{key:1,title:"确定要拒绝该账号吗？",onConfirm:$=>Z(o)},{default:n(()=>e[14]||(e[14]=[i("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):r("",!0)]),_:2},1024)):r("",!0),a.key==="rejectReason"?(s(),p(h,{key:6},[f(d(o.rejectReason),1)],64)):r("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),l(ie,{open:C.value,"onUpdate:open":e[5]||(e[5]=a=>C.value=a),title:"拒绝原因",onOk:ee,confirmLoading:R.value},{default:n(()=>[l(ue,{value:y.value,"onUpdate:value":e[4]||(e[4]=a=>y.value=a),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ue=ce(Ne,[["__scopeId","data-v-e894f3e9"]]);export{Ue as default};
