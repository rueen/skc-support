import{_ as se,a as le,b as ne,r as g,c as K,j as z,B as ae,k as oe,p as P,o as f,w as s,e as $,f as t,g as n,d as O,n as te,F as H,i as y,t as u,s as D,q as re,l as M,m as p,x as de,h as ue,z as me,A as pe}from"./index-By25O0OS.js";import{P as ke}from"./PageHeader-CaiTP2yj.js";const fe={class:"select-task-modal"},ve={class:"filter-form"},_e={class:"selected-info"},he={key:1},ge={__name:"SelectTask",props:{visible:{type:Boolean,default:!1},selectedId:{type:Array,default:()=>[]}},emits:["update:visible","confirm","cancel"],setup(J,{emit:c}){const N=le(),{t:w}=ne(),v=J,E=c,I=g(!1),F=g(!1),d=g([]),r=K({taskName:"",channelId:void 0,taskStatus:void 0}),C=g([]),Q=z(()=>N.loaded?N.getEnumOptions("TaskStatus"):[]),k=z(()=>[{title:w("task.list.name"),key:"taskName",width:200},{title:w("task.list.status"),key:"taskStatus",width:100},{title:w("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:w("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0}]),B=g([]),b=K({current:1,pageSize:10,total:0}),U=K({sorterField:void 0,sorterOrder:void 0}),W=z(()=>({selectedRowKeys:d.value,onChange:(a,m)=>{X(a)},getCheckboxProps:a=>({disabled:!1})})),X=(a,m)=>{const h=B.value.map(T=>T.id),S=d.value.filter(T=>!h.includes(T));d.value=[...S,...a]},j=()=>{b.current=1,e()},R=()=>{r.taskName="",r.channelId=void 0,r.taskStatus=void 0,j()},Y=(a,m,h)=>{Object.assign(b,a),Object.assign(U,{sorterField:h.field,sorterOrder:h.order}),e()},Z=()=>{E("confirm",{taskIds:d.value}),q()},q=()=>{E("update:visible",!1),E("cancel")},e=async()=>{I.value=!0;try{const a=await M("task.list",{page:b.current,pageSize:b.pageSize,...U,...r});a.code===0?(B.value=a.data.list,b.total=a.data.total):p.error(a.message)}finally{I.value=!1}},l=async()=>{const a=await M("channel.list");a.code===0&&(C.value=a.data.list)},i=()=>{v.selectedId&&v.selectedId.length>0&&(d.value=[...v.selectedId])};return ae(()=>v.visible,a=>{a?(e(),C.value.length||l(),i()):(d.value=[],b.current=1)}),ae(()=>v.selectedId,()=>{v.visible&&i()},{deep:!0}),oe(()=>{v.visible&&(e(),l(),i())}),(a,m)=>{const h=n("a-input"),S=n("a-form-item"),T=n("a-select-option"),x=n("a-select"),L=n("a-button"),A=n("a-space"),_=n("a-form"),G=n("a-alert"),ee=n("a-avatar"),ie=n("a-table"),ce=n("a-modal");return f(),P(ce,{open:J.visible,title:a.$t("task.selectTask.title"),width:900,"confirm-loading":F.value,onOk:Z,onCancel:q},{default:s(()=>[$("div",fe,[$("div",ve,[t(_,{layout:"inline",model:r},{default:s(()=>[t(S,{label:a.$t("task.search.taskName")},{default:s(()=>[t(h,{value:r.taskName,"onUpdate:value":m[0]||(m[0]=o=>r.taskName=o),placeholder:a.$t("common.inputPlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),t(S,{label:a.$t("task.search.channelId")},{default:s(()=>[t(x,{value:r.channelId,"onUpdate:value":m[1]||(m[1]=o=>r.channelId=o),placeholder:a.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:s(()=>[(f(!0),O(H,null,te(C.value,o=>(f(),P(T,{key:o.id,value:o.id},{default:s(()=>[y(u(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(S,{label:a.$t("task.search.taskStatus")},{default:s(()=>[t(x,{value:r.taskStatus,"onUpdate:value":m[2]||(m[2]=o=>r.taskStatus=o),placeholder:a.$t("common.selectPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:s(()=>[(f(!0),O(H,null,te(Q.value,o=>(f(),P(T,{key:o.value,value:o.value},{default:s(()=>[y(u(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(S,null,{default:s(()=>[t(A,null,{default:s(()=>[t(L,{type:"primary",onClick:j},{default:s(()=>[y(u(a.$t("common.search")),1)]),_:1}),t(L,{onClick:R},{default:s(()=>[y(u(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),$("div",_e,[t(G,{message:a.$t("task.selectTask.selectedCount",{count:d.value.length}),type:"info","show-icon":""},null,8,["message"])]),t(ie,{columns:k.value,"data-source":B.value,loading:I.value,pagination:b,"row-selection":W.value,rowKey:"id",onChange:Y,size:"middle"},{bodyCell:s(({column:o,record:V})=>[o.key==="taskName"?(f(),P(A,{key:0},{default:s(()=>[t(ee,{src:V.channelIcon,size:"small"},null,8,["src"]),$("span",null,u(V.taskName),1)]),_:2},1024)):D("",!0),o.key==="taskTime"?(f(),O("div",he,u(V.startTime)+" - "+u(V.endTime),1)):D("",!0),o.key==="taskStatus"?(f(),O(H,{key:2},[y(u(re(N).getEnumText("TaskStatus",V.taskStatus)),1)],64)):D("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])])]),_:1},8,["open","title","confirm-loading"])}}},ye=se(ge,[["__scopeId","data-v-16074623"]]),be={class:"task-form content-container"},Te={class:"danger"},we={__name:"detail",setup(J){const{t:c}=ne(),N=le(),w=de(),v=ue(),E=g(),I=z(()=>w.name==="TaskGroupEdit"),F=g(!1),d=g([]),r=z(()=>d.value.map(e=>e.id)),C=g(!1),Q=z(()=>[{title:"ID",dataIndex:"id",key:"id"},{title:c("task.list.name"),key:"taskName"},{title:c("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:e})=>N.getEnumText("TaskStatus",e)},{title:c("task.list.startTime"),dataIndex:"startTime",key:"startTime"},{title:c("task.list.endTime"),dataIndex:"endTime",key:"endTime"},{title:c("task.list.createTime"),dataIndex:"createTime",key:"createTime"},{title:c("task.list.action"),key:"action",fixed:"right",width:180}]),k=K({taskGroupName:"",taskGroupReward:0}),B=()=>{F.value=!0},b=({taskIds:e})=>{U(e)},U=async(e,l=!1)=>{if(!(!e||!e.length))try{C.value=!0;const i=await M("task.list",{page:1,pageSize:100,sorterField:"createTime",sorterOrder:"ascend",taskIds:e});i.code===0?l?d.value=e.map(a=>i.data.list.find(m=>m.id===a)):d.value=i.data.list:p.error(i.message)}catch(i){p.error(i)}finally{C.value=!1}},W=e=>{d.value=d.value.filter(l=>l.id!==e.id)},X=async()=>{try{R.value=!0;const e={...k,relatedTasks:r.value},l=await pe("taskGroup.add",e);l.code===0?(p.success(c("common.submitSuccess")),v.back()):p.error(l.message)}catch{p.error(c("common.submitFailed"))}finally{R.value=!1}},j=async()=>{try{R.value=!0;const e={...k},l=await me("taskGroup.edit",{...e,relatedTasks:r.value},{urlParams:{id:w.params.id}});l.code===0?(p.success(c("common.submitSuccess")),v.back()):p.error(l.message)}catch{p.error(c("common.submitFailed"))}finally{R.value=!1}},R=g(!1),Y=async()=>{if(!k.taskGroupName){p.error(c("task.group.validation.taskGroupNameRequired"));return}if(!k.taskGroupReward){p.error(c("task.group.validation.taskGroupRewardRequired"));return}if(!r.value.length){p.error(c("task.group.validation.relatedTaskRequired"));return}I.value?await j():await X()},Z=()=>{v.back()},q=async e=>{try{const l=await M("taskGroup.detail",{},{urlParams:{id:e}});if(l.code===0){const i=l.data;Object.assign(k,{taskGroupName:i.taskGroupName,taskGroupReward:i.taskGroupReward}),U(i.relatedTasks,!0)}}catch(l){p.error(l)}};return oe(()=>{I.value&&q(w.params.id)}),(e,l)=>{const i=n("a-input"),a=n("a-form-item"),m=n("a-input-number"),h=n("a-button"),S=n("a-avatar"),T=n("a-space"),x=n("a-popconfirm"),L=n("a-table"),A=n("a-form");return f(),O("div",be,[t(ke,{title:I.value?e.$t("task.group.editTitle"):e.$t("task.group.createTitle"),back:!0,class:"page-header"},null,8,["title"]),$("div",null,[t(A,{ref_key:"formRef",ref:E,model:k,"label-col":{span:3},"wrapper-col":{span:19},layout:"horizontal"},{default:s(()=>[t(a,{label:e.$t("task.group.name")},{default:s(()=>[t(i,{value:k.taskGroupName,"onUpdate:value":l[0]||(l[0]=_=>k.taskGroupName=_),placeholder:e.$t("common.inputPlaceholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),t(a,{label:e.$t("task.group.reward")},{default:s(()=>[t(m,{value:k.taskGroupReward,"onUpdate:value":l[1]||(l[1]=_=>k.taskGroupReward=_),min:0,precision:2,step:1,placeholder:e.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(a,{label:e.$t("task.group.relatedTask")},{default:s(()=>[$("div",null,[t(h,{type:"primary",onClick:B},{default:s(()=>[y(u(e.$t("task.group.selectTaskBtnText",{count:d.value.length})),1)]),_:1}),t(L,{columns:Q.value,"data-source":d.value,loading:C.value,pagination:!1,style:{"margin-top":"10px"}},{bodyCell:s(({column:_,record:G})=>[_.key==="taskName"?(f(),P(T,{key:0},{default:s(()=>[t(S,{src:G.channelIcon},null,8,["src"]),y(" "+u(G.taskName),1)]),_:2},1024)):D("",!0),_.key==="taskStatus"?(f(),O(H,{key:1},[y(u(re(N).getEnumText("TaskStatus",G.taskStatus)),1)],64)):D("",!0),_.key==="action"?(f(),P(x,{key:2,title:e.$t("common.deleteConfirm"),onConfirm:ee=>W(G)},{default:s(()=>[$("a",Te,u(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])):D("",!0)]),_:1},8,["columns","data-source","loading"])])]),_:1},8,["label"]),t(a,{"wrapper-col":{span:16,offset:3}},{default:s(()=>[t(T,null,{default:s(()=>[t(h,{type:"primary",onClick:Y},{default:s(()=>[y(u(e.$t("common.submit")),1)]),_:1}),t(h,{onClick:Z},{default:s(()=>[y(u(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),t(ye,{visible:F.value,"onUpdate:visible":l[2]||(l[2]=_=>F.value=_),selectedId:r.value,onConfirm:b},null,8,["visible","selectedId"])])}}},Ce=se(we,[["__scopeId","data-v-d4173d37"]]);export{Ce as default};
