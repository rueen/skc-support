import{c as ne,r as u,e as te,d as T,o as oe,f as x,g as r,h as t,w as s,i as o,p as le,k as h,l as B,t as k,n as L,x as C,D as se,y as ie,q as i,B as ce,C as de}from"./index-BepA_qxU.js";const ue={class:"content-container"},re={class:"table-container"},me={class:"table-header"},pe={class:"right"},fe=["onClick"],he={key:0},ge={__name:"index",setup(ve){const{t:l}=ne(),v=u(!1),m=u(!1),_=u(!1),p=u("add"),w=u(),d=u([]),N=u([{label:l("channel.fansCount"),value:"fansCount"},{label:l("channel.friendsCount"),value:"friendsCount"},{label:l("channel.postsCount"),value:"postsCount"}]),$={action:se.imageUploadUrl,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},n=te({name:"",icon:"",customFields:["fansCount"]}),g=u(),D={name:[{required:!0,message:l("channel.nameRequired")}],icon:[{required:!0,message:l("channel.iconRequired")}]},F=T(()=>[{title:l("channel.channelIcon"),dataIndex:"icon",key:"icon",width:120},{title:l("channel.channelName"),dataIndex:"name",key:"name"},{title:l("channel.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:l("channel.action"),key:"action",width:200}]),I=u([]),q=T(()=>({add:l("channel.addTitle"),edit:l("channel.editTitle")})[p.value]),M=()=>{p.value="add",n.name="",n.icon="",d.value=[],m.value=!0},S=e=>{p.value="edit",g.value=e.id,n.name=e.name,n.icon=e.icon,d.value=e.icon?[{uid:"-1",name:"image.png",status:"done",url:e.icon}]:[],m.value=!0},V=async e=>{const a=await ie("channel.delete",{},{urlParams:{id:e.id}});a.code===0?(i.success(a.message),f()):i.error(a.message)},E=e=>{e.code===0?(n.icon=e.data.url,d.value=[{uid:"-1",name:"image.png",status:"done",url:n.icon}],i.success("上传成功")):(i.error(response.message||"上传失败"),d.value=d.value.filter(a=>a.uid!==file.uid))},R=()=>{i.error("上传失败"),d.value=[]},z=e=>e.type.startsWith("image/")?e.size/1024/1024<1?!0:(i.error("图片必须小于 1MB！"),!1):(i.error("只能上传图片文件！"),!1),O=async()=>{const e=await de("channel.add",n);e.code===0?(i.success("添加成功"),m.value=!1,f()):i.error(e.message)},P=async()=>{const e=await ce("channel.edit",{...n,id:g.value},{urlParams:{id:g.value}});e.code===0?(i.success("编辑成功"),m.value=!1,f()):i.error(e.message)},A=async()=>{try{switch(await w.value.validate(),_.value=!0,p.value){case"add":O();break;case"edit":P();break}}catch(e){console.error(e)}finally{_.value=!1}},f=async()=>{v.value=!0;try{const e=await le("channel.list",{page:1,pageSize:200});I.value=e.data.list}finally{v.value=!1}};return oe(()=>{f()}),(e,a)=>{const U=o("a-button"),W=o("a-image"),j=o("a-typography-text"),G=o("a-popconfirm"),H=o("a-space"),J=o("a-table"),K=o("plus-outlined"),Q=o("a-upload"),y=o("a-form-item"),X=o("a-input"),Y=o("a-checkbox-group"),Z=o("a-form"),ee=o("a-modal");return h(),x("div",ue,[r("div",re,[r("div",me,[a[4]||(a[4]=r("div",{class:"left"},null,-1)),r("div",pe,[t(U,{type:"primary",onClick:M},{default:s(()=>[B(k(e.$t("channel.add")),1)]),_:1})])]),t(J,{columns:F.value,"data-source":I.value,loading:v.value,pagination:!1},{bodyCell:s(({column:c,record:b})=>[c.key==="icon"?(h(),L(W,{key:0,width:40,height:40,src:b.icon},null,8,["src"])):C("",!0),c.key==="action"?(h(),L(H,{key:1},{default:s(()=>[r("a",{onClick:ae=>S(b)},k(e.$t("channel.edit")),9,fe),t(G,{title:e.$t("channel.deleteConfirm"),onConfirm:ae=>V(b)},{default:s(()=>[r("a",null,[t(j,{type:"danger"},{default:s(()=>[B(k(e.$t("channel.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["columns","data-source","loading"])]),t(ee,{open:m.value,"onUpdate:open":a[3]||(a[3]=c=>m.value=c),title:q.value,confirmLoading:_.value,onOk:A},{default:s(()=>[t(Z,{ref_key:"formRef",ref:w,model:n,rules:D,"label-col":{span:6},"wrapper-col":{span:16}},{default:s(()=>[t(y,{label:e.$t("channel.channelIcon"),name:"icon"},{default:s(()=>[t(Q,{"file-list":d.value,"onUpdate:fileList":a[0]||(a[0]=c=>d.value=c),action:$.action,headers:$.headers,"before-upload":z,onSuccess:E,onError:R,accept:"image/*","list-type":"picture-card","max-count":1},{default:s(()=>[d.value.length?C("",!0):(h(),x("div",he,[t(K),a[5]||(a[5]=r("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list","action","headers"])]),_:1},8,["label"]),t(y,{label:e.$t("channel.channelName"),name:"name"},{default:s(()=>[t(X,{value:n.name,"onUpdate:value":a[1]||(a[1]=c=>n.name=c),placeholder:e.$t("channel.channelNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(y,{label:e.$t("channel.customFields"),name:"customFields"},{default:s(()=>[t(Y,{value:n.customFields,"onUpdate:value":a[2]||(a[2]=c=>n.customFields=c),options:N.value},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}};export{ge as default};
