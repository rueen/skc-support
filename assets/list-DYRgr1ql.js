import{_ as Ae,a as Oe,b as Te,j as x,r as C,c as z,k as Ue,d as c,e as r,f as o,s as v,w as n,g as d,y as ee,x as Me,h as Ye,l as U,m as g,o as l,F as y,n as R,p as _,i as m,t as s,q as Ne,A as te,M as Fe,v as De}from"./index-my5s4XYN.js";import{_ as ae}from"./CopyContent-D29fi_ps.js";import{G as Pe}from"./GroupOwner-CYkDXm1y.js";import{d as He,e as Ee}from"./routeParamsEncryption-BKFTaOaF.js";const ze={class:"account content-container"},Be={class:"table-container"},qe={class:"table-header"},Le={class:"left"},Ve={class:"right"},We={key:0,class:"account-info"},Ge={class:"link-text-container"},Ke={class:"label"},Je=["href"],Qe={class:"stats"},Xe={key:0,class:"stat-item"},Ze={key:1,class:"stat-item"},xe={key:2,class:"stat-item"},et={key:1},tt={key:1},at={key:1},nt={class:"danger"},ot=["onClick"],lt={class:"danger"},st={key:0,class:"count-container"},it={__name:"list",setup(ut){const M=Ye(),Y=Me(),N=Oe(),{t:f}=Te(),ne=x(()=>N.loaded?N.getEnumOptions("AccountAuditStatus"):[]),F=C(!1),k=C([]),j=C(!1),D=C(!1),I=C(""),B=()=>{const e=ee().startOf("month").format("YYYY-MM-DD HH:mm:ss"),t=ee().endOf("month").format("YYYY-MM-DD HH:mm:ss");return[e,t]},oe=e=>!e||e.startsWith("http://")||e.startsWith("https://")?e:e.toLowerCase().includes("tiktok.com")?`https://${e.replace(/^(.*?)tiktok\.com/i,"www.tiktok.com")}`:`https://${e}`,le=()=>{const e=Y.query.filters;if(e){const t={},h=He(e);Object.keys(h).forEach(w=>{w==="current"?b.current=h[w]:t[w]=h[w]}),Object.assign(u,{accountAuditStatus:null},t);const p={...Y.query};delete p.filters,M.replace({path:Y.path,query:p})}},u=z({keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:B(),inviter:""}),q=C([]),L=C([]),V=C([]),P=C([]),se=x(()=>[{title:f("account.list.accountInfo"),key:"accountInfo",width:500},{title:f("account.list.memberInfo"),key:"member"},{title:f("member.list.inviter"),key:"inviter"},{title:f("account.list.submitTime"),dataIndex:"submitTime",key:"submitTime",sorter:!0},{title:f("account.list.auditStatus"),dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:f("account.list.rejectReason"),key:"rejectReason"},{title:f("account.list.rejectTimes"),dataIndex:"rejectTimes",key:"rejectTimes"},{title:f("account.list.waiterName"),key:"waiterName"},{title:f("account.list.auditTime"),dataIndex:"auditTime",key:"auditTime",sorter:!0},{title:f("account.list.action"),key:"action"}]),ie={selectedRowKeys:k,onChange:e=>{k.value=e},getCheckboxProps:e=>({disabled:e.accountAuditStatus!=="pending"})},W=C([]),b=z({current:1,pageSize:10,total:0}),G=z({sorterField:void 0,sorterOrder:void 0}),K=()=>{b.current=1,S()},ue=()=>{Object.assign(u,{keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:B(),inviter:""}),K()},J=e=>{M.push(`/member/view/${e}`)},ce=e=>{const t=Ee({...u,current:b.current});M.push({name:"AccountEdit",params:{id:e.id},query:{filters:t}})},re=()=>{M.push("/account/old")},de=(e,t,h)=>{Object.assign(b,e),Object.assign(G,{sorterField:h.field,sorterOrder:h.order}),S()},me=async e=>{k.value=[e.id],Q()},Q=async()=>{if(!k.value.length){g.warning(f("account.list.message.selectAccount"));return}const e=await te("account.batchResolve",{ids:k.value});if(e.code===0){const t=e.data.failed.map(h=>h.reason).join(",");t?Fe.error({title:f("account.list.batchRejectFailedTitle"),content:`成功 ${e.data.successCount} 条，失败 ${e.data.failedCount} 条，失败原因：${t}`}):(g.success(f("account.list.message.success")),k.value=[],S())}else g.error(e.message)},pe=async()=>{if(!k.value.length){g.warning(f("account.list.message.selectAccount"));return}I.value="",j.value=!0},fe=e=>{k.value=[e.id],I.value="",j.value=!0},ve=async()=>{if(!I.value){g.error(f("account.list.message.rejectReason"));return}D.value=!0;try{const e=await te("account.batchReject",{ids:k.value,rejectReason:I.value});e.code===0?(g.success(f("account.list.message.success")),k.value=[],j.value=!1,S()):g.error(e.message)}catch(e){console.log(e)}finally{D.value=!1}},S=async()=>{var e,t;F.value=!0;try{const h={page:b.current,pageSize:b.pageSize,keyword:u.keyword,channelId:u.channelId,accountAuditStatus:u.accountAuditStatus,waiterId:u.waiterId,groupId:u.groupId,memberId:u.memberId,submitStartTime:(e=u.submitTimeRange)==null?void 0:e[0],submitEndTime:(t=u.submitTimeRange)==null?void 0:t[1],inviter:u.inviter},p=await U("account.list",{...h,...G});p.code===0?(W.value=p.data.list,b.total=p.data.total):g.error(p.message)}finally{F.value=!1}},he=async()=>{const e=await U("channel.list");e.code===0&&(q.value=e.data.list)},X=async(e="")=>{try{const t=await U("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(L.value=t.data.list||[])}catch{g.error("获取群组列表失败")}},Z=async(e="")=>{const t=await U("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(V.value=t.data.list||[])},_e=async e=>{const t=await De("account.delete",{},{urlParams:{id:e.id}});t.code===0?(g.success(t.message),S()):g.error(t.message)},ge=async()=>{if(P.value.length)return;const e=await U("waiter.list",{page:1,pageSize:100});if(e.code===0){const t={id:0,username:"无"};P.value=[t,...e.data.list]}};return Ue(()=>{le(),S(),X(),he(),Z(),ge()}),(e,t)=>{const h=d("a-input"),p=d("a-form-item"),w=d("a-select-option"),A=d("a-select"),ye=d("a-range-picker"),O=d("a-button"),T=d("a-space"),ke=d("a-form"),be=d("a-avatar"),we=d("a-tag"),H=d("a-typography-link"),Ce=d("a-typography-text"),E=d("a-popconfirm"),$e=d("a-table"),Ie=d("a-descriptions-item"),Se=d("a-descriptions"),Re=d("a-textarea"),je=d("a-modal");return l(),c("div",ze,[r("div",Be,[r("div",qe,[r("div",Le,[o(ke,{layout:"inline",model:u},{default:n(()=>[o(p,{label:e.$t("account.search.account")},{default:n(()=>[o(h,{value:u.keyword,"onUpdate:value":t[0]||(t[0]=a=>u.keyword=a),placeholder:e.$t("account.search.accountPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.channel")},{default:n(()=>[o(A,{value:u.channelId,"onUpdate:value":t[1]||(t[1]=a=>u.channelId=a),placeholder:e.$t("account.search.channelPlaceholder"),"allow-clear":""},{default:n(()=>[(l(!0),c(y,null,R(q.value,a=>(l(),_(w,{key:a.id,value:a.id},{default:n(()=>[m(s(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.submitTime")},{default:n(()=>[o(ye,{value:u.submitTimeRange,"onUpdate:value":t[2]||(t[2]=a=>u.submitTimeRange=a),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.auditStatus")},{default:n(()=>[o(A,{value:u.accountAuditStatus,"onUpdate:value":t[3]||(t[3]=a=>u.accountAuditStatus=a),placeholder:e.$t("account.search.auditStatusPlaceholder"),"allow-clear":""},{default:n(()=>[(l(!0),c(y,null,R(ne.value,a=>(l(),_(w,{key:a.value,value:a.value},{default:n(()=>[m(s(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.auditor")},{default:n(()=>[o(A,{value:u.waiterId,"onUpdate:value":t[4]||(t[4]=a=>u.waiterId=a),placeholder:e.$t("account.search.auditorPlaceholder"),"allow-clear":""},{default:n(()=>[(l(!0),c(y,null,R(P.value,a=>(l(),_(w,{key:a.id,value:a.id},{default:n(()=>[m(s(a.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.group")},{default:n(()=>[o(A,{value:u.groupId,"onUpdate:value":t[5]||(t[5]=a=>u.groupId=a),placeholder:e.$t("account.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:X},{default:n(()=>[(l(!0),c(y,null,R(L.value,a=>(l(),_(w,{key:a.id,value:a.id},{default:n(()=>[m(s(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.member")},{default:n(()=>[o(A,{value:u.memberId,"onUpdate:value":t[6]||(t[6]=a=>u.memberId=a),placeholder:e.$t("account.search.memberPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:Z},{default:n(()=>[(l(!0),c(y,null,R(V.value,a=>(l(),_(w,{key:a.id,value:a.id},{default:n(()=>[m(s(a.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("account.search.inviter")},{default:n(()=>[o(h,{value:u.inviter,"onUpdate:value":t[7]||(t[7]=a=>u.inviter=a),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(p,null,{default:n(()=>[o(T,null,{default:n(()=>[o(O,{type:"primary",onClick:K},{default:n(()=>[m(s(e.$t("common.search")),1)]),_:1}),o(O,{onClick:ue},{default:n(()=>[m(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),r("div",Ve,[o(T,null,{default:n(()=>[o(O,{onClick:re},{default:n(()=>[m(s(e.$t("account.list.oldAccount")),1)]),_:1}),o(O,{type:"primary",onClick:Q},{default:n(()=>[m(s(e.$t("common.batchResolve")),1)]),_:1}),o(O,{danger:"",onClick:pe},{default:n(()=>[m(s(e.$t("common.batchReject")),1)]),_:1})]),_:1})])]),o($e,{columns:se.value,"data-source":W.value,loading:F.value,pagination:b,showSorterTooltip:!1,"row-selection":ie,rowKey:"id",onChange:de},{bodyCell:n(({column:a,record:i})=>[a.key==="accountInfo"?(l(),c("div",We,[o(T,null,{default:n(()=>[o(be,{src:i.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(i.account),1),i.isNew?(l(),_(we,{key:0,color:"green"},{default:n(()=>t[10]||(t[10]=[m("new")])),_:1})):v("",!0)]),_:2},1024),r("div",null,[r("div",Ge,[r("span",Ke,s(e.$t("account.list.homepage"))+"：",1),o(ae,{content:i.homeUrl},{default:n(()=>[o(H,null,{default:n(()=>[r("a",{href:oe(i.homeUrl),target:"_blank"},s(i.homeUrl),9,Je)]),_:2},1024)]),_:2},1032,["content"])])]),r("div",null,[t[11]||(t[11]=r("span",{class:"label"},"uid：",-1)),o(ae,{content:i.uid},null,8,["content"])]),r("div",Qe,[i.channelCustomFields.includes("fansCount")?(l(),c("div",Xe,s(e.$t("account.list.fansCount"))+"："+s(i.fansCount),1)):v("",!0),i.channelCustomFields.includes("friendsCount")?(l(),c("div",Ze,s(e.$t("account.list.friendsCount"))+"："+s(i.friendsCount),1)):v("",!0),i.channelCustomFields.includes("postsCount")?(l(),c("div",xe,s(e.$t("account.list.postsCount"))+"："+s(i.postsCount),1)):v("",!0)])])):v("",!0),a.key==="member"?(l(),c("div",et,[r("div",null,[o(H,{onClick:$=>J(i.memberId)},{default:n(()=>[m(s(i.memberNickname),1)]),_:2},1032,["onClick"])]),(l(!0),c(y,null,R(i.groups,$=>(l(),c("div",null,[o(T,null,{default:n(()=>[r("span",null,s($.groupName),1),$.isOwner?(l(),_(Pe,{key:0})):v("",!0)]),_:2},1024)]))),256))])):v("",!0),a.key==="inviter"?(l(),c(y,{key:2},[i.inviterId?(l(),_(H,{key:0,onClick:$=>J(i.inviterId)},{default:n(()=>[m(s(i.inviterNickname),1)]),_:2},1032,["onClick"])):(l(),c("span",tt,"--"))],64)):v("",!0),a.key==="accountAuditStatus"?(l(),c(y,{key:3},[m(s(Ne(N).getEnumText("AccountAuditStatus",i.accountAuditStatus)),1)],64)):v("",!0),a.key==="rejectReason"?(l(),c(y,{key:4},[i.rejectReason?(l(),_(Ce,{key:0,type:"danger"},{default:n(()=>[m(s(i.rejectReason),1)]),_:2},1024)):(l(),c("span",at,"--"))],64)):v("",!0),a.key==="waiterName"?(l(),c(y,{key:5},[m(s(i.waiterName||"--"),1)],64)):v("",!0),a.key==="auditTime"?(l(),c(y,{key:6},[m(s(i.auditTime||"--"),1)],64)):v("",!0),a.key==="action"?(l(),_(T,{key:7},{default:n(()=>[i.accountAuditStatus==="pending"?(l(),_(E,{key:0,title:e.$t("account.list.resolveConfirm"),onConfirm:$=>me(i)},{default:n(()=>[r("a",null,s(e.$t("account.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):v("",!0),i.accountAuditStatus==="pending"?(l(),_(E,{key:1,title:e.$t("account.list.rejectConfirm"),onConfirm:$=>fe(i)},{default:n(()=>[r("a",nt,s(e.$t("account.list.reject")),1)]),_:2},1032,["title","onConfirm"])):v("",!0),r("a",{onClick:$=>ce(i)},s(e.$t("common.edit")),9,ot),o(E,{title:e.$t("common.deleteConfirm"),onConfirm:$=>_e(i)},{default:n(()=>[r("a",lt,s(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),b.total?(l(),c("div",st,[o(Se,{column:2},{default:n(()=>[o(Ie,{label:e.$t("common.totalCount")},{default:n(()=>[m(s(b.total),1)]),_:1},8,["label"])]),_:1})])):v("",!0)]),o(je,{open:j.value,"onUpdate:open":t[9]||(t[9]=a=>j.value=a),title:e.$t("account.list.rejectReason"),onOk:ve,confirmLoading:D.value},{default:n(()=>[o(Re,{value:I.value,"onUpdate:value":t[8]||(t[8]=a=>I.value=a),placeholder:e.$t("account.list.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},pt=Ae(it,[["__scopeId","data-v-2166d63c"]]);export{pt as default};
