import{_ as _e,a as fe,b as ve,r as C,c as j,x as ge,j as ke,k as he,d as g,e as u,f as n,s as k,w as a,g as i,h as ye,l as D,m as w,o as r,F as T,n as N,p as h,i as m,t as s,q as be,M as we,v as Ce}from"./index-KT69dcRx.js";import{_ as x}from"./CopyContent-BafntqRJ.js";import{G as Te}from"./GroupOwner-BPzckwJd.js";import{d as $e}from"./download-nlMQ7KsZ.js";import{d as Ie,e as B}from"./routeParamsEncryption-BKFTaOaF.js";const Se={class:"content-container"},Oe={class:"table-container"},De={class:"table-header"},Ne={class:"left"},Me={class:"right"},Re={class:"link-text-container"},Ee={class:"label"},Fe=["href"],ze={key:1},Ae={style:{color:"#999","font-size":"12px"}},Ue={key:0},Ye=["onClick"],qe=["onClick"],He={key:0,class:"count-container"},Pe={__name:"list",setup(je){const L=fe(),{t:p}=ve(),$=ye(),I=ge(),M=C(!1),o=j({keyword:"",channelId:void 0,groupId:I.query.groupId,inviter:"",completedTaskCount:void 0,createTimeRange:[]}),R=C([]),F=C(0),_=j({current:1,pageSize:10,total:0}),z=C([]),V=ke(()=>[{title:p("member.list.memberNickname"),key:"nickname"},{title:p("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:p("member.list.accounts"),key:"accountList"},{title:p("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:p("member.list.inviter"),key:"inviterNickname"},{title:p("member.list.group"),key:"groups"},{title:p("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:p("member.list.action"),key:"action",width:150}]),G=()=>{const e=I.query.filters;if(e){const t={},f=Ie(e);Object.keys(f).forEach(y=>{y==="current"?_.current=f[y]:t[y]=f[y]}),Object.assign(o,{},t);const c={...I.query};delete c.filters,$.replace({path:I.path,query:c})}},A=()=>{_.current=1,S()},J=()=>{Object.assign(o,{keyword:"",channelId:void 0,groupId:void 0,inviter:"",completedTaskCount:void 0,createTimeRange:[]}),A()},K=e=>{_.current=e.current,_.pageSize=e.pageSize,S()},Q=()=>{$.push("/member/create")},W=e=>{const t=B({...o,current:_.current});$.push({name:"MemberEdit",params:{id:e.id},query:{filters:t}})},U=e=>{const t=B({...o,current:_.current});$.push({name:"MemberView",params:{id:e},query:{filters:t}})},X=async e=>{const t=await Ce("member.delete",{},{urlParams:{id:e.id}});t.code===0?(w.success("删除成功"),S()):w.error(t.message)},S=async()=>{var e,t;M.value=!0;try{const f={page:_.current,pageSize:_.pageSize,keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviter:o.inviter,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(t=o.createTimeRange)==null?void 0:t[1]},c=await D("member.list",f);c.code===0?(R.value=c.data.list,_.total=c.data.total,F.value=c.data.totalApproved):w.error(c.message)}finally{M.value=!1}},Y=async(e="")=>{try{const t=await D("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(z.value=t.data.list||[])}catch{w.error("获取群组列表失败")}},Z=()=>{we.confirm({title:p("common.export"),content:p("common.confirmExportContent"),onOk:async()=>{var e,t;try{const f=w.loading(p("common.exporting"),0),c={keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviter:o.inviter,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(t=o.createTimeRange)==null?void 0:t[1]};await $e("member.export",c,`会员列表_${new Date().toLocaleDateString()}.xlsx`),f(),w.success(p("common.exportSuccess"))}catch(f){console.error("导出失败:",f),w.error(p("common.exportFailed"))}}})},ee=C([]),te=async(e="")=>{const t=await D("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(ee.value=t.data.list||[])},E=C([]),ae=async()=>{if(!E.value.length)try{const e=await D("channel.list");e.code===0&&(E.value=e.data.list)}catch(e){console.error(e)}};return he(()=>{G(),S(),Y(),ae(),te()}),(e,t)=>{const f=i("a-input"),c=i("a-form-item"),y=i("a-select-option"),q=i("a-select"),ne=i("a-input-number"),oe=i("a-range-picker"),O=i("a-button"),b=i("a-space"),le=i("a-form"),re=i("DownloadOutlined"),se=i("plus-outlined"),H=i("a-tag"),ie=i("a-avatar"),ce=i("a-typography-link"),ue=i("a-typography-text"),de=i("a-popconfirm"),me=i("a-table"),P=i("a-descriptions-item"),pe=i("a-descriptions");return r(),g("div",Se,[u("div",Oe,[u("div",De,[u("div",Ne,[n(le,{layout:"inline",model:o},{default:a(()=>[n(c,{label:e.$t("member.search.keyword")},{default:a(()=>[n(f,{value:o.keyword,"onUpdate:value":t[0]||(t[0]=l=>o.keyword=l),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:e.$t("common.channel")},{default:a(()=>[n(q,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=l=>o.channelId=l),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:a(()=>[(r(!0),g(T,null,N(E.value,l=>(r(),h(y,{key:l.id,value:l.id},{default:a(()=>[m(s(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:e.$t("member.search.group")},{default:a(()=>[n(q,{value:o.groupId,"onUpdate:value":t[2]||(t[2]=l=>o.groupId=l),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:Y},{default:a(()=>[(r(!0),g(T,null,N(z.value,l=>(r(),h(y,{key:l.id,value:l.id},{default:a(()=>[m(s(l.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:e.$t("member.search.inviter")},{default:a(()=>[n(f,{value:o.inviter,"onUpdate:value":t[3]||(t[3]=l=>o.inviter=l),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(c,{label:e.$t("member.list.completedTaskCount")},{default:a(()=>[n(ne,{value:o.completedTaskCount,"onUpdate:value":t[4]||(t[4]=l=>o.completedTaskCount=l),min:0,max:9999},null,8,["value"])]),_:1},8,["label"]),n(c,{label:e.$t("member.search.createTime")},{default:a(()=>[n(oe,{value:o.createTimeRange,"onUpdate:value":t[5]||(t[5]=l=>o.createTimeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),n(c,null,{default:a(()=>[n(b,null,{default:a(()=>[n(O,{type:"primary",onClick:A},{default:a(()=>[m(s(e.$t("common.search")),1)]),_:1}),n(O,{onClick:J},{default:a(()=>[m(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",Me,[n(b,null,{default:a(()=>[R.value.length?(r(),h(O,{key:0,onClick:Z},{icon:a(()=>[n(re)]),default:a(()=>[m(" "+s(e.$t("common.export")),1)]),_:1})):k("",!0),n(O,{type:"primary",onClick:Q},{icon:a(()=>[n(se)]),default:a(()=>[m(" "+s(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),n(me,{columns:V.value,"data-source":R.value,loading:M.value,pagination:_,onChange:K},{bodyCell:a(({column:l,record:v})=>[l.key==="nickname"?(r(),h(b,{key:0},{default:a(()=>[u("span",null,s(v.nickname),1),v.isNew?(r(),h(H,{key:0,color:"green"},{default:a(()=>t[6]||(t[6]=[m("new")])),_:1})):k("",!0)]),_:2},1024)):k("",!0),l.key==="accountList"?(r(),h(b,{key:1,direction:"vertical"},{default:a(()=>[(r(!0),g(T,null,N(v.accountList,d=>(r(),g("div",null,[u("div",null,[n(b,null,{default:a(()=>[m(s(e.$t("member.list.account"))+"：",1),n(ie,{src:d.channelIcon,size:"small"},null,8,["src"]),m(" "+s(d.account)+" ",1),n(H,{color:"warning"},{default:a(()=>[m(s(be(L).getEnumText("AccountAuditStatus",d.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),u("div",Re,[u("span",Ee,s(e.$t("member.list.homepage"))+"：",1),n(x,{content:d.homeUrl},{default:a(()=>[u("a",{href:d.homeUrl,target:"_blank",class:"link-text"},s(d.homeUrl),9,Fe)]),_:2},1032,["content"])]),u("div",null,[t[7]||(t[7]=u("span",{class:"label"},"uid：",-1)),n(x,{content:d.uid},null,8,["content"])])]))),256))]),_:2},1024)):k("",!0),l.key==="inviterNickname"?(r(),g(T,{key:2},[v.inviterId?(r(),h(ce,{key:0,onClick:d=>U(v.inviterId)},{default:a(()=>[m(s(v.inviterNickname),1)]),_:2},1032,["onClick"])):(r(),g("span",ze,"--"))],64)):k("",!0),l.key==="groups"?(r(),g(T,{key:3},[(r(!0),g(T,null,N(v.groups,d=>(r(),g("div",null,[n(b,null,{default:a(()=>[u("span",null,s(d.groupName),1),d.isOwner?(r(),h(Te,{key:0})):k("",!0)]),_:2},1024),u("div",Ae,s(d.joinTime),1)]))),256)),!v.groups||v.groups.length===0?(r(),g("span",Ue,"--")):k("",!0)],64)):k("",!0),l.key==="action"?(r(),h(b,{key:4},{default:a(()=>[u("a",{onClick:d=>W(v)},s(e.$t("member.list.edit")),9,Ye),u("a",{onClick:d=>U(v.id)},s(e.$t("member.list.view")),9,qe),n(de,{title:e.$t("member.list.deleteConfirm"),onConfirm:d=>X(v)},{default:a(()=>[u("a",null,[n(ue,{type:"danger"},{default:a(()=>[m(s(e.$t("member.list.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),_.total?(r(),g("div",He,[n(pe,{column:2},{default:a(()=>[n(P,{label:e.$t("common.totalCount"),style:{width:"125px"}},{default:a(()=>[m(s(_.total),1)]),_:1},8,["label"]),n(P,{label:e.$t("member.list.totalApproved")},{default:a(()=>[m(s(F.value),1)]),_:1},8,["label"])]),_:1})])):k("",!0)])])}}},Je=_e(Pe,[["__scopeId","data-v-53d9efd0"]]);export{Je as default};
