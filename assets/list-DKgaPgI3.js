import{_ as Y,r as N,a as Z,b as x,c as B,j as D,k as tt,d,e as m,f as s,w as a,g as c,l as F,m as S,h as et,o as l,F as _,n as V,p as b,i as r,t as n,q,P as at,s as h,v as st}from"./index-DnOUOQCB.js";const nt={class:"task content-container"},lt={class:"table-container"},ot={class:"table-header"},ut={class:"left"},it={class:"right"},ct={key:0},dt={key:1},rt=["onClick"],kt={class:"danger"},mt={__name:"list",setup(pt){const T=et(),C=N(!1),f=Z(),{t:k}=x(),o=B({taskName:"",channelId:void 0,taskStatus:void 0}),w=N([]),z=D(()=>f.loaded?f.getEnumOptions("TaskStatus"):[]),Q=D(()=>[{title:k("task.list.name"),key:"taskName"},{title:k("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:t})=>f.getEnumText("TaskStatus",t)},{title:k("task.list.quota"),key:"taskQuota"},{title:k("task.list.time"),key:"taskTime"},{title:k("task.list.action"),key:"action",fixed:"right",width:180}]),I=N([]),p=B({current:1,pageSize:10,total:0}),E=()=>{p.current=1,v()},R=()=>{o.taskName="",o.channelId=void 0,o.taskStatus=void 0,E()},U=t=>{Object.assign(p,t),v()},j=()=>{T.push("/task/create")},A=t=>{T.push(`/task/edit/${t.id}`)},L=async t=>{try{const u=await st("task.delete",{},{urlParams:{id:t.id}});u.code===0?(S.success(k("common.deleteSuccess")),v()):S.error(u.message)}catch{S.error(k("common.deleteFailed"))}},v=async()=>{C.value=!0;try{const t=await F("task.list",{page:p.current,pageSize:p.pageSize,...o});t.code===0?(I.value=t.data.list,p.total=t.data.total):S.error(t.message)}finally{C.value=!1}},M=async()=>{const t=await F("channel.list");t.code===0&&(w.value=t.data.list)};return tt(async()=>{v(),M()}),(t,u)=>{const G=c("a-input"),y=c("a-form-item"),O=c("a-select-option"),P=c("a-select"),$=c("a-button"),g=c("a-space"),H=c("a-form"),J=c("a-avatar"),K=c("a-popconfirm"),W=c("a-table");return l(),d("div",nt,[m("div",lt,[m("div",ot,[m("div",ut,[s(H,{layout:"inline",model:o},{default:a(()=>[s(y,{label:t.$t("task.search.taskName")},{default:a(()=>[s(G,{value:o.taskName,"onUpdate:value":u[0]||(u[0]=e=>o.taskName=e),placeholder:t.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(y,{label:t.$t("task.search.channelId")},{default:a(()=>[s(P,{value:o.channelId,"onUpdate:value":u[1]||(u[1]=e=>o.channelId=e),placeholder:t.$t("task.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:a(()=>[(l(!0),d(_,null,V(w.value,e=>(l(),b(O,{key:e.id,value:e.id},{default:a(()=>[r(n(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(y,{label:t.$t("task.search.taskStatus")},{default:a(()=>[s(P,{value:o.taskStatus,"onUpdate:value":u[2]||(u[2]=e=>o.taskStatus=e),placeholder:t.$t("task.search.statusPlaceholder"),allowClear:""},{default:a(()=>[(l(!0),d(_,null,V(z.value,e=>(l(),b(O,{key:e.value,value:e.value},{default:a(()=>[r(n(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(y,null,{default:a(()=>[s(g,null,{default:a(()=>[s($,{type:"primary",onClick:E},{default:a(()=>[r(n(t.$t("common.search")),1)]),_:1}),s($,{onClick:R},{default:a(()=>[r(n(t.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),m("div",it,[s(g,null,{default:a(()=>[s($,{type:"primary",onClick:j},{icon:a(()=>[s(q(at))]),default:a(()=>[r(" "+n(t.$t("task.list.create")),1)]),_:1})]),_:1})])]),s(W,{columns:Q.value,"data-source":I.value,loading:C.value,pagination:p,onChange:U},{bodyCell:a(({column:e,record:i})=>[e.key==="taskName"?(l(),b(g,{key:0},{default:a(()=>[s(J,{src:i.channelIcon},null,8,["src"]),r(" "+n(i.taskName),1)]),_:2},1024)):h("",!0),e.key==="taskTime"?(l(),d(_,{key:1},[r(n(i.startTime)+" - "+n(i.endTime),1)],64)):h("",!0),e.key==="taskQuota"?(l(),d(_,{key:2},[i.unlimitedQuota?(l(),d("span",ct,n(t.$t("task.list.unlimited")),1)):(l(),d("span",dt,n(i.quota),1)),m("span",null," / "+n(i.submittedCount),1)],64)):h("",!0),e.key==="taskStatus"?(l(),d(_,{key:3},[r(n(q(f).getEnumText("TaskStatus",i.taskStatus)),1)],64)):h("",!0),e.key==="action"?(l(),b(g,{key:4},{default:a(()=>[m("a",{onClick:X=>A(i)},n(t.$t("task.list.edit")),9,rt),s(K,{title:t.$t("task.list.deleteConfirm"),onConfirm:X=>L(i)},{default:a(()=>[m("a",kt,n(t.$t("task.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},ht=Y(mt,[["__scopeId","data-v-2270542b"]]);export{ht as default};
