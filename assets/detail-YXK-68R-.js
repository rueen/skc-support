import{_ as ue,a as ie,c as me,d as N,r as w,z as pe,e as ce,o as fe,f,h as a,g as v,w as s,i as d,p as H,q as k,A as g,j as ke,k as c,F as C,m as I,n as y,l as u,t as r,x as z,v as A,Q as ve,P as ge,B as ye,C as be}from"./index-BepA_qxU.js";import{P as he}from"./PageHeader-s2gPEUX5.js";const Te={class:"task-form content-container"},_e={class:"form-container"},$e={class:"group-select"},qe={key:1,class:"group-tip"},Re={class:"user-range"},we={key:0,class:"task-count"},Ce=["innerHTML"],Ie={class:"quota-container"},Pe={class:"custom-fields"},Ye={__name:"detail",setup(Me){const O=ie(),{t:p}=me(),J=N(()=>O.loaded?O.getEnumOptions("TaskType"):[]),b=pe(),P=ke(),S=w(),Y=N(()=>b.name==="TaskEdit"),j=N(()=>b.name==="TaskCopy"),t=ce({taskName:"",channelId:void 0,category:void 0,taskType:void 0,reward:void 0,brand:"",groupIds:[],groupMode:0,customFields:[{title:"",type:"post"}],startTime:null,endTime:null,quota:void 0,unlimitedQuota:!0,fansRequired:void 0,contentRequirement:"",taskInfo:"",notice:`1.请尽快完成发布，填写发布链接。
2.任务结束后无法填写，不能结算。
3.发布内容不符合要求，将无法审核通过。
4.填写链接无法访问或其他无关链接，视为放弃结算。`,userRange:0,taskCount:0}),K={taskName:[{required:!0,message:p("task.detail.validation.taskNameRequired")}],channelId:[{required:!0,message:p("task.detail.validation.channelRequired")}],category:[{required:!0,message:p("task.detail.validation.categoryRequired")}],taskType:[{required:!0,message:p("task.detail.validation.taskTypeRequired")}],reward:[{required:!0,message:p("task.detail.validation.rewardRequired")}],fansRequired:[{required:!0,message:p("task.detail.validation.fansRequired")}],groupIds:[{validator:(e,l)=>t.groupMode===1&&(!l||l.length===0)?Promise.reject(p("task.detail.validation.groupRequired")):Promise.resolve()}],taskCount:[{validator:(e,l)=>t.userRange===1&&l==null?Promise.reject(p("task.detail.validation.taskCountRequired")):Promise.resolve()}]},E=w([]),Q=w([]),W=()=>{t.customFields.length<10&&t.customFields.push({title:"",type:"group"})},X=e=>{t.customFields.splice(e,1)},Z=e=>{e.target.value===0&&(t.groupIds=[])},x=async()=>{try{h.value=!0;const e={...t,groupIds:t.groupMode===0?[]:t.groupIds,startTime:t.startTime?g(t.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:t.endTime?g(t.endTime).format("YYYY-MM-DD HH:mm:ss"):null},l=await be("task.add",e);l.code===0?(k.success(p("common.submitSuccess")),P.back()):k.error(l.message)}catch(e){console.log(e),k.error(p("common.submitFailed"))}finally{h.value=!1}},ee=async()=>{try{h.value=!0;const e={...t,groupIds:t.groupMode===0?[]:t.groupIds,startTime:t.startTime?g(t.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:t.endTime?g(t.endTime).format("YYYY-MM-DD HH:mm:ss"):null},l=await ye("task.edit",{...e},{urlParams:{id:b.params.id}});l.code===0?(k.success(p("common.submitSuccess")),P.back()):k.error(l.message)}catch(e){console.log(e),k.error(p("common.submitFailed"))}finally{h.value=!1}},h=w(!1),ae=()=>{S.value.validate().then(async()=>{Y.value?await ee():await x()})},te=()=>{P.back()},le=async e=>{try{const l=await H("task.detail",{},{urlParams:{id:e}});if(l.code===0){let i={};for(let m in l.data)m!=="groups"&&(i[m]=l.data[m]);i.startTime&&(i.startTime=g(i.startTime)),i.endTime&&(i.endTime=g(i.endTime)),j.value&&(i.taskName=`${i.taskName} - copy`);const n={};Object.keys(t).forEach(m=>{n[m]=i[m]}),Object.assign(t,n)}}catch(l){console.log(l),k.error(l)}},se=async()=>{const e=await H("channel.list");e.code===0&&(E.value=e.data.list)},B=async(e="")=>{try{const l=await H("group.list",{page:1,pageSize:50,groupName:e});l.code===0&&(Q.value=l.data.list||[])}catch{k.error(p("task.detail.loadGroupFailed"))}};return fe(()=>{se(),B(),(Y.value||j.value)&&le(b.params.id)}),(e,l)=>{const i=d("a-input"),n=d("a-form-item"),m=d("a-select-option"),T=d("a-select"),_=d("a-input-number"),G=d("a-date-picker"),M=d("a-col"),oe=d("a-row"),$=d("a-radio"),L=d("a-radio-group"),V=d("a-form-item-rest"),ne=d("a-tooltip"),de=d("a-checkbox"),U=d("a-space"),q=d("a-button"),D=d("a-textarea"),re=d("a-form");return c(),f("div",Te,[a(he,{title:Y.value?e.$t("task.detail.editTitle"):e.$t("task.detail.createTitle"),back:!0,class:"page-header"},null,8,["title"]),v("div",_e,[a(re,{ref_key:"formRef",ref:S,model:t,rules:K,"label-col":{span:5},"wrapper-col":{span:18},layout:"horizontal"},{default:s(()=>[a(n,{label:e.$t("task.detail.taskName"),name:"taskName"},{default:s(()=>[a(i,{value:t.taskName,"onUpdate:value":l[0]||(l[0]=o=>t.taskName=o),placeholder:e.$t("task.detail.taskNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.channelId"),name:"channelId"},{default:s(()=>[a(T,{value:t.channelId,"onUpdate:value":l[1]||(l[1]=o=>t.channelId=o),placeholder:e.$t("task.detail.channelPlaceholder")},{default:s(()=>[(c(!0),f(C,null,I(E.value,o=>(c(),y(m,{key:o.id,value:o.id},{default:s(()=>[u(r(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.category"),name:"category"},{default:s(()=>[a(i,{value:t.category,"onUpdate:value":l[2]||(l[2]=o=>t.category=o),placeholder:e.$t("task.detail.categoryPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.taskType"),name:"taskType"},{default:s(()=>[a(T,{value:t.taskType,"onUpdate:value":l[3]||(l[3]=o=>t.taskType=o),placeholder:e.$t("task.detail.taskTypePlaceholder")},{default:s(()=>[(c(!0),f(C,null,I(J.value,o=>(c(),y(m,{key:o.value,value:o.value},{default:s(()=>[u(r(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.reward"),name:"reward"},{default:s(()=>[a(_,{value:t.reward,"onUpdate:value":l[4]||(l[4]=o=>t.reward=o),min:0,precision:2,step:.1,placeholder:e.$t("task.detail.rewardPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.fansRequired"),name:"fansRequired"},{default:s(()=>[a(_,{value:t.fansRequired,"onUpdate:value":l[5]||(l[5]=o=>t.fansRequired=o),min:0,step:1,placeholder:e.$t("task.detail.fansRequiredPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.taskTime"),required:""},{default:s(()=>[a(oe,{gutter:8},{default:s(()=>[a(M,{span:11},{default:s(()=>[a(n,{name:"startTime",rules:[{required:!0,message:e.$t("task.detail.validation.startTimeRequired")}]},{default:s(()=>[a(G,{value:t.startTime,"onUpdate:value":l[6]||(l[6]=o=>t.startTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("task.detail.startTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1},8,["rules"])]),_:1}),a(M,{span:2,class:"text-center"},{default:s(()=>l[18]||(l[18]=[v("span",null,"至",-1)])),_:1}),a(M,{span:11},{default:s(()=>[a(n,{name:"endTime",rules:[{required:!0,message:e.$t("task.detail.validation.endTimeRequired")}]},{default:s(()=>[a(G,{value:t.endTime,"onUpdate:value":l[7]||(l[7]=o=>t.endTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("task.detail.endTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.specifyGroup"),name:"groupIds"},{default:s(()=>[v("div",$e,[a(L,{value:t.groupMode,"onUpdate:value":l[8]||(l[8]=o=>t.groupMode=o),onChange:Z},{default:s(()=>[a($,{value:0},{default:s(()=>[u(r(e.$t("task.detail.noSpecify")),1)]),_:1}),a($,{value:1},{default:s(()=>[u(r(e.$t("task.detail.specifyGroups")),1)]),_:1})]),_:1},8,["value"]),a(V,null,{default:s(()=>[t.groupMode===1?(c(),y(T,{key:0,value:t.groupIds,"onUpdate:value":l[9]||(l[9]=o=>t.groupIds=o),"show-search":"","filter-option":!1,mode:"multiple",placeholder:e.$t("task.detail.groupPlaceholder"),style:{width:"100%","margin-top":"8px"},onSearch:B},{default:s(()=>[(c(!0),f(C,null,I(Q.value,o=>(c(),y(m,{key:o.id,value:o.id},{default:s(()=>[u(r(o.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(c(),f("div",qe,r(e.$t("task.detail.groupTip")),1))]),_:1})])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.userRange"),name:"userRange"},{default:s(()=>[v("div",Re,[a(L,{value:t.userRange,"onUpdate:value":l[10]||(l[10]=o=>t.userRange=o)},{default:s(()=>[a($,{value:0},{default:s(()=>[u(r(e.$t("task.detail.allUsers")),1)]),_:1}),a($,{value:1},{default:s(()=>[u(r(e.$t("task.detail.taskCompletionCount")),1)]),_:1})]),_:1},8,["value"]),a(V,null,{default:s(()=>[t.userRange===1?(c(),f("div",we,[a(n,{name:"taskCount"},{default:s(()=>[a(_,{value:t.taskCount,"onUpdate:value":l[11]||(l[11]=o=>t.taskCount=o),min:0,precision:0,placeholder:e.$t("task.detail.countPlaceholder"),"addon-after":e.$t("task.detail.times")},null,8,["value","placeholder","addon-after"])]),_:1}),a(ne,null,{title:s(()=>[v("div",{innerHTML:e.$t("task.detail.countTip")},null,8,Ce)]),default:s(()=>[a(A(ve))]),_:1})])):z("",!0)]),_:1})])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.quota")},{default:s(()=>[v("div",Ie,[a(U,{align:"baseline"},{default:s(()=>[a(n,{name:"quota"},{default:s(()=>[a(_,{value:t.quota,"onUpdate:value":l[12]||(l[12]=o=>t.quota=o),min:0,precision:0,disabled:t.unlimitedQuota,placeholder:e.$t("task.detail.quotaPlaceholder")},null,8,["value","disabled","placeholder"])]),_:1}),a(de,{checked:t.unlimitedQuota,"onUpdate:checked":l[13]||(l[13]=o=>t.unlimitedQuota=o)},{default:s(()=>[u(r(e.$t("task.detail.unlimited")),1)]),_:1},8,["checked"])]),_:1})])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.brand"),name:"brand"},{default:s(()=>[a(i,{value:t.brand,"onUpdate:value":l[14]||(l[14]=o=>t.brand=o),placeholder:e.$t("task.detail.brandPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.customFields")},{default:s(()=>[v("div",Pe,[(c(!0),f(C,null,I(t.customFields,(o,F)=>(c(),f("div",{key:F,class:"field-item"},[a(U,{align:"baseline"},{default:s(()=>[a(n,{name:["customFields",F,"title"],rules:[{required:!0,message:e.$t("task.detail.validation.fieldTitleRequired")}]},{default:s(()=>[a(i,{value:o.title,"onUpdate:value":R=>o.title=R,placeholder:e.$t("task.detail.fieldTitlePlaceholder")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","rules"]),a(T,{value:o.type,"onUpdate:value":R=>o.type=R,style:{width:"120px"}},{default:s(()=>[a(m,{value:"post"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.post")),1)]),_:1}),a(m,{value:"group"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.group")),1)]),_:1}),a(m,{value:"input"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.input")),1)]),_:1}),a(m,{value:"image"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.image")),1)]),_:1})]),_:2},1032,["value","onUpdate:value"]),a(q,{type:"link",danger:"",onClick:R=>X(F)},{default:s(()=>[u(r(e.$t("task.detail.deleteField")),1)]),_:2},1032,["onClick"])]),_:2},1024)]))),128)),t.customFields.length<10?(c(),y(q,{key:0,type:"dashed",block:"",onClick:W},{default:s(()=>[a(A(ge)),u(r(e.$t("task.detail.addField")),1)]),_:1})):z("",!0)])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.contentRequirement"),name:"contentRequirement"},{default:s(()=>[a(D,{value:t.contentRequirement,"onUpdate:value":l[15]||(l[15]=o=>t.contentRequirement=o),rows:4,placeholder:e.$t("task.detail.contentRequirementPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.taskInfo"),name:"taskInfo"},{default:s(()=>[a(D,{value:t.taskInfo,"onUpdate:value":l[16]||(l[16]=o=>t.taskInfo=o),rows:4,placeholder:e.$t("task.detail.taskInfoPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{label:e.$t("task.detail.notice"),name:"notice"},{default:s(()=>[a(D,{value:t.notice,"onUpdate:value":l[17]||(l[17]=o=>t.notice=o),rows:4,placeholder:e.$t("task.detail.noticePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(n,{"wrapper-col":{span:16,offset:4}},{default:s(()=>[a(U,null,{default:s(()=>[a(q,{type:"primary",onClick:ae},{default:s(()=>[u(r(e.$t("common.submit")),1)]),_:1}),a(q,{onClick:te},{default:s(()=>[u(r(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},Fe=ue(Ye,[["__scopeId","data-v-6e1c1d86"]]);export{Fe as default};
