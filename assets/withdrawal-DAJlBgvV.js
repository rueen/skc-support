import{_ as ue,b as me,a as we,j as E,r as v,c as L,k as he,d as S,e as f,f as a,w as t,g as o,l as pe,m as s,h as _e,o as m,F as M,n as ve,p as R,i as w,t as r,q as O,s as g,M as U,A as V}from"./index-BWKDvxYJ.js";import{d as fe}from"./download-B3LHDwMp.js";const ge={class:"withdrawal content-container"},ke={class:"table-container"},ye={class:"table-header"},be={class:"left"},Ce={class:"right"},Se=["onClick"],$e=["onClick"],Re={__name:"withdrawal",setup(Ne){const{t:h}=me(),N=_e(),j=we(),A=E(()=>j.loaded?j.getEnumOptions("WithdrawalStatus"):[]),T=v(!1),k=v(!1),D=v(!1),p=v(""),i=L({memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),F=E(()=>[{title:h("withdrawal.list.memberNickname"),key:"nickname"},{title:h("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:h("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:h("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:h("withdrawal.list.name"),dataIndex:"name",key:"name"},{title:h("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:h("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:h("withdrawal.list.action"),key:"action",width:150}]),d=v([]),P={selectedRowKeys:d,onChange:e=>{d.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},Y=v([]),_=L({current:1,pageSize:10,total:0}),B=()=>{_.current=1,y()},W=()=>{Object.assign(i,{memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),B()},z=e=>{Object.assign(_,e),y()},K=()=>{U.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const e=s.loading("正在导出数据，请稍候...",0),n={...i};try{await fe("withdrawals.export",n,`提现列表_${new Date().toLocaleDateString()}.xlsx`),s.success("导出成功")}catch(b){console.error("导出失败:",b),s.error("导出失败，请稍后重试")}finally{e()}}})},q=e=>{N.push(`/member/view/${e.memberId}`)},G=e=>{U.error({content:e.rejectReason})},J=async e=>{d.value=[e.id],H()},H=async()=>{if(!d.value.length){s.warning("请选择要操作的记录");return}const e=await V("withdrawals.batchResolve",{ids:d.value});e.code===0?(s.success("操作成功"),d.value=[],y()):s.error(e.message)},Q=e=>{d.value=[e.id],p.value="",k.value=!0},X=()=>{if(!d.value.length){s.warning("请选择要操作的记录");return}p.value="",k.value=!0},Z=async()=>{if(!p.value){s.error("请输入打款失败原因");return}D.value=!0;const e=await V("withdrawals.batchReject",{rejectReason:p.value,ids:d.value});D.value=!1,e.code===0?(s.success("操作成功"),k.value=!1,d.value=[],y()):s.error(e.message)},y=async()=>{var e,n;T.value=!0;try{const b={page:_.current,pageSize:_.pageSize,memberNickname:i.memberNickname,withdrawalStatus:i.withdrawalStatus,startTime:(e=i.timeRange)==null?void 0:e[0],endTime:(n=i.timeRange)==null?void 0:n[1]},u=await pe("withdrawals.list",{...b});u.code===0?(Y.value=u.data.list||[],_.total=u.data.total||0):s.error(u.message)}finally{T.value=!1}};return he(()=>{y()}),(e,n)=>{const b=o("a-input"),u=o("a-form-item"),ee=o("a-select-option"),ae=o("a-select"),te=o("a-range-picker"),C=o("a-button"),I=o("a-space"),le=o("a-form"),ne=o("RightOutlined"),x=o("a-typography-link"),oe=o("download-outlined"),ie=o("info-circle-outlined"),se=o("a-popconfirm"),re=o("a-table"),de=o("a-textarea"),ce=o("a-modal");return m(),S("div",ge,[f("div",ke,[f("div",ye,[f("div",be,[a(le,{layout:"inline",model:i},{default:t(()=>[a(u,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(b,{value:i.memberNickname,"onUpdate:value":n[0]||(n[0]=l=>i.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(u,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(ae,{value:i.withdrawalStatus,"onUpdate:value":n[1]||(n[1]=l=>i.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(m(!0),S(M,null,ve(A.value,l=>(m(),R(ee,{key:l.value,value:l.value},{default:t(()=>[w(r(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(u,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(te,{value:i.timeRange,"onUpdate:value":n[2]||(n[2]=l=>i.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(u,null,{default:t(()=>[a(I,null,{default:t(()=>[a(C,{type:"primary",onClick:B},{default:t(()=>[w(r(e.$t("common.search")),1)]),_:1}),a(C,{onClick:W},{default:t(()=>[w(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",Ce,[a(I,null,{default:t(()=>[a(x,{onClick:n[3]||(n[3]=l=>O(N).push("/payment-transactions"))},{default:t(()=>[w(r(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(ne)]),_:1}),a(C,{onClick:K},{icon:t(()=>[a(oe)]),default:t(()=>[w(" "+r(e.$t("withdrawal.list.export")),1)]),_:1}),a(C,{type:"primary",onClick:H},{default:t(()=>[w(r(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(C,{danger:"",onClick:X},{default:t(()=>[w(r(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(re,{columns:F.value,"data-source":Y.value,loading:T.value,pagination:_,rowKey:"id","row-selection":P,onChange:z},{bodyCell:t(({column:l,record:c})=>[l.key==="nickname"?(m(),R(x,{key:0,onClick:$=>q(c)},{default:t(()=>[w(r(c.nickname),1)]),_:2},1032,["onClick"])):g("",!0),l.key==="withdrawalStatus"?(m(),S(M,{key:1},[w(r(O(j).getEnumText("WithdrawalStatus",c.withdrawalStatus))+" ",1),c.withdrawalStatus==="failed"?(m(),R(ie,{key:0,class:"danger",onClick:$=>G(c)},null,8,["onClick"])):g("",!0)],64)):g("",!0),l.key==="action"?(m(),S(M,{key:2},[c.withdrawalStatus==="pending"?(m(),R(I,{key:0},{default:t(()=>[a(se,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:$=>J(c)},{default:t(()=>[f("a",null,r(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),f("a",{class:"danger",onClick:$=>Q(c)},r(e.$t("withdrawal.list.reject")),9,Se)]),_:2},1024)):g("",!0),c.withdrawalStatus==="failed"?(m(),S("a",{key:1,onClick:$=>O(N).push(`/payment-transactions?withdrawalId=${c.id}`)},"查看交易记录",8,$e)):g("",!0)],64)):g("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),a(ce,{open:k.value,"onUpdate:open":n[5]||(n[5]=l=>k.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:Z,confirmLoading:D.value},{default:t(()=>[a(de,{value:p.value,"onUpdate:value":n[4]||(n[4]=l=>p.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},De=ue(Re,[["__scopeId","data-v-b1f3d563"]]);export{De as default};
