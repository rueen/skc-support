import{_ as ie,i as re,j as ue,r as w,a as T,k as ce,b as y,d as f,c as t,w as n,e as l,l as de,m as i,f as me,o as d,F as O,n as pe,p as $,h as m,t as C,g as S,D as _e,q as b,M as H,z as E}from"./index-D7zbyf1Z.js";import{d as we}from"./download-BmIvHCEM.js";const fe={class:"withdrawal content-container"},ve={class:"table-container"},ge={class:"table-header"},he={class:"left"},ke={class:"right"},ye=["onClick"],be=["onClick"],Ce={__name:"withdrawal",setup(Se){const I=me(),R=re(),L=ue(()=>R.loaded?R.getEnumOptions("WithdrawalStatus"):[]),x=w(!1),v=w(!1),N=w(!1),p=w(""),s=T({memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),U=[{title:"会员昵称",dataIndex:"nickname",key:"nickname"},{title:"提现账户",dataIndex:"account",key:"account"},{title:"账户类型",dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:"申请提现金额",dataIndex:"amount",key:"amount",align:"right"},{title:"姓名",dataIndex:"name",key:"name"},{title:"申请时间",dataIndex:"createTime",key:"createTime"},{title:"提现状态",key:"withdrawalStatus"},{title:"操作",key:"action",width:150}],r=w([]),V={selectedRowKeys:r,onChange:a=>{r.value=a},getCheckboxProps:a=>({disabled:a.withdrawalStatus!=="pending"})},M=w([]),_=T({current:1,pageSize:10,total:0}),Y=()=>{_.current=1,g()},z=()=>{Object.assign(s,{memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),Y()},F=a=>{Object.assign(_,a),g()},K=()=>{H.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const a=i.loading("正在导出数据，请稍候...",0),e={...s};try{await we("withdrawals.export",e,`提现列表_${new Date().toLocaleDateString()}.xlsx`),i.success("导出成功")}catch(h){console.error("导出失败:",h),i.error("导出失败，请稍后重试")}finally{a()}}})},W=a=>{H.error({title:"结算失败原因",content:a.rejectReason})},q=async a=>{r.value=[a.id],B()},B=async()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}const a=await E("withdrawals.batchResolve",{ids:r.value});a.code===0?(i.success("操作成功"),r.value=[],g()):i.error(a.message)},A=a=>{r.value=[a.id],p.value="",v.value=!0},P=()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}p.value="",v.value=!0},G=async()=>{if(!p.value){i.error("请输入打款失败原因");return}N.value=!0;const a=await E("withdrawals.batchReject",{rejectReason:p.value,ids:r.value});N.value=!1,a.code===0?(i.success("操作成功"),v.value=!1,r.value=[],g()):i.error(a.message)},g=async()=>{var a,e;x.value=!0;try{const h={page:_.current,pageSize:_.pageSize,memberNickname:s.memberNickname,withdrawalStatus:s.withdrawalStatus,startTime:(a=s.timeRange)==null?void 0:a[0],endTime:(e=s.timeRange)==null?void 0:e[1]},u=await de("withdrawals.list",{...h});u.code===0?(M.value=u.data.list||[],_.total=u.data.total||0):i.error(u.message)}finally{x.value=!1}};return ce(()=>{g()}),(a,e)=>{const h=l("a-input"),u=l("a-form-item"),J=l("a-select-option"),Q=l("a-select"),X=l("a-range-picker"),k=l("a-button"),D=l("a-space"),Z=l("a-form"),ee=l("RightOutlined"),ae=l("a-typography-link"),te=l("info-circle-outlined"),ne=l("a-popconfirm"),oe=l("a-table"),le=l("a-textarea"),se=l("a-modal");return d(),y("div",fe,[f("div",ve,[f("div",ge,[f("div",he,[t(Z,{layout:"inline",model:s},{default:n(()=>[t(u,{label:"会员昵称"},{default:n(()=>[t(h,{value:s.memberNickname,"onUpdate:value":e[0]||(e[0]=o=>s.memberNickname=o),placeholder:"请输入会员昵称","allow-clear":""},null,8,["value"])]),_:1}),t(u,{label:"提现状态"},{default:n(()=>[t(Q,{value:s.withdrawalStatus,"onUpdate:value":e[1]||(e[1]=o=>s.withdrawalStatus=o),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:n(()=>[(d(!0),y(O,null,pe(L.value,o=>(d(),$(J,{key:o.value,value:o.value},{default:n(()=>[m(C(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(u,{label:"申请时间"},{default:n(()=>[t(X,{value:s.timeRange,"onUpdate:value":e[2]||(e[2]=o=>s.timeRange=o),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1}),t(u,null,{default:n(()=>[t(D,null,{default:n(()=>[t(k,{type:"primary",onClick:Y},{default:n(()=>[m(C(a.$t("common.search")),1)]),_:1}),t(k,{onClick:z},{default:n(()=>[m(C(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",ke,[t(D,null,{default:n(()=>[t(ae,{onClick:e[3]||(e[3]=o=>S(I).push("/payment-transactions"))},{default:n(()=>[e[6]||(e[6]=m(" 查看提现交易记录")),t(ee)]),_:1}),t(k,{onClick:K},{icon:n(()=>[t(S(_e))]),default:n(()=>[e[7]||(e[7]=m(" 导出 "))]),_:1}),t(k,{type:"primary",onClick:B},{default:n(()=>e[8]||(e[8]=[m("批量打款")])),_:1}),t(k,{danger:"",onClick:P},{default:n(()=>e[9]||(e[9]=[m("批量拒绝")])),_:1})]),_:1})])]),t(oe,{columns:U,"data-source":M.value,loading:x.value,pagination:_,rowKey:"id","row-selection":V,onChange:F},{bodyCell:n(({column:o,record:c})=>[o.key==="withdrawalStatus"?(d(),y(O,{key:0},[m(C(S(R).getEnumText("WithdrawalStatus",c.withdrawalStatus))+" ",1),c.withdrawalStatus==="failed"?(d(),$(te,{key:0,class:"status-icon",onClick:j=>W(c)},null,8,["onClick"])):b("",!0)],64)):b("",!0),o.key==="action"?(d(),y(O,{key:1},[c.withdrawalStatus==="pending"?(d(),$(D,{key:0},{default:n(()=>[t(ne,{title:"确定要标记为已打款吗？",onConfirm:j=>q(c)},{default:n(()=>e[10]||(e[10]=[f("a",null,"打款",-1)])),_:2},1032,["onConfirm"]),f("a",{class:"danger",onClick:j=>A(c)},"拒绝",8,ye)]),_:2},1024)):b("",!0),c.withdrawalStatus==="failed"?(d(),y("a",{key:1,onClick:j=>S(I).push(`/payment-transactions?withdrawalId=${c.id}`)},"查看交易记录",8,be)):b("",!0)],64)):b("",!0)]),_:1},8,["data-source","loading","pagination"])]),t(se,{open:v.value,"onUpdate:open":e[5]||(e[5]=o=>v.value=o),title:"打款失败原因",onOk:G,confirmLoading:N.value},{default:n(()=>[t(le,{value:p.value,"onUpdate:value":e[4]||(e[4]=o=>p.value=o),placeholder:"请输入打款失败原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ne=ie(Ce,[["__scopeId","data-v-d8e87985"]]);export{Ne as default};
