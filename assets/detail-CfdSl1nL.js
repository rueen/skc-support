import{_ as re,b as ce,a as me,x as be,j as ke,c as B,r as $,k as fe,d as k,f as a,e as r,w as t,g as f,t as s,F as q,n as R,p as m,s as b,A as L,m as p,l as E,h as pe,o as n,i as u,q as N}from"./index-BWClX2JU.js";import{P as _e}from"./PageHeader-DAHFIfPM.js";import{_ as W}from"./CopyContent-CYZH0wsH.js";import{G as Te}from"./GroupOwner-C6vNTIKl.js";import{d as he}from"./routeParamsEncryption-BKFTaOaF.js";const ye={class:"task-audit-detail content-container"},ve={class:"detail-container"},ge={key:0},$e={key:1},Ie={class:"detail-section"},Ce={class:"section-title"},Se={key:0},qe={class:"link-text-container"},we=["href"],Ae={class:"detail-section"},je={class:"section-title"},Pe={class:"link-text-container"},Re=["href"],Ne={key:1},Fe={class:"detail-section"},De={class:"section-title"},Be={class:"footer-btns"},Le={class:"left"},Ee={class:"right"},Oe={__name:"detail",setup(Ue){const{t:y}=ce(),w=me(),_=be(),F=pe(),A=_.query.type,O=ke(()=>d.taskPreAuditStatus==="approved"?"confirm":"pre"),j=$(!1),D=$(!1),I=$(""),z=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},v=$(null),d=B({submitContent:{}}),c=B({}),h=B({}),U=$(null),H=()=>{const e=_.query.filters;e&&(U.value=he(e))},Q=async()=>{const e=O.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",o=await L(e,{ids:[v.value]});o.code===0?(p.success(y("submittedTasks.resolveSuccess")),C()):p.error(o.message)},J=()=>{I.value="",j.value=!0},K=async()=>{if(!I.value){p.error(y("submittedTasks.rejectReasonRequired"));return}D.value=!0;try{const e=O.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject";await L(e,{ids:[v.value],reason:I.value}),p.success(y("submittedTasks.rejectSuccess")),j.value=!1,C()}catch(e){p.error(e.message)}finally{D.value=!1}},X=()=>{const e=A==="confirm"?"/confirm-audit-tasks":"/pre-audit-tasks",o={};_.query.filters&&(o.filters=_.query.filters),F.push({path:e,query:o})},Y=()=>{const e={type:A};_.query.filters&&(e.filters=_.query.filters),F.push({path:`/submitted-tasks/detail/${d.prevTaskId}`,query:e}),v.value=d.prevTaskId,C()},Z=()=>{const e={type:A};_.query.filters&&(e.filters=_.query.filters),F.push({path:`/submitted-tasks/detail/${d.nextTaskId}`,query:e}),v.value=d.nextTaskId,C()},x=async e=>{try{const o=await E("task.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(c,o.data):p.error(o.message)}catch{p.error(y("submittedTasks.detail.getTaskDetailFailed"))}},ee=async e=>{try{const o=await E("member.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(h,o.data):p.error(o.message)}catch{p.error(y("submittedTasks.detail.getMemberDetailFailed"))}},C=async()=>{try{const e=await L("taskSubmitted.detail",{auditType:A,id:v.value,filtersParam:U.value});e.code===0&&(Object.assign(d,e.data),e.data.taskId!=null&&await x(e.data.taskId),e.data.memberId!=null&&await ee(e.data.memberId),e.data.taskId!=null&&e.data.memberId!=null&&await te())}catch{p.error(y("submittedTasks.detail.getDetailFailed"))}},V=$([]),te=async()=>{const e=await E("account.list",{taskId:d.taskId,memberId:d.memberId,channelId:c.channelId});e.code===0&&(V.value=e.data.list||[])};return fe(async()=>{v.value=_.params.id,H(),await C()}),(e,o)=>{const G=f("a-avatar"),g=f("a-space"),l=f("a-descriptions-item"),S=f("a-descriptions"),ae=f("a-collapse-panel"),se=f("a-collapse"),M=f("a-tag"),le=f("a-image"),P=f("a-button"),ie=f("a-textarea"),ne=f("a-modal");return n(),k("div",ye,[a(_e,{title:e.$t("submittedTasks.detail.title"),back:!0,useDefaultBack:!1,onBack:X},null,8,["title"]),r("div",ve,[a(se,{ghost:"",class:"collapse"},{default:t(()=>[a(ae,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a(S,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(g,null,{default:t(()=>[a(G,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(c.taskName),1)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[u(s(c.category),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[u(s(N(w).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[u(s(c.reward),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[u(s(c.brand),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var i;return[c.groupMode===0?(n(),k("span",ge,s(e.$t("submittedTasks.detail.noSpecify")),1)):(n(),k("span",$e,s((i=c.groupNames)==null?void 0:i.join("、")),1))]}),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[u(s(c.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(c.endTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[u(s(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[u(s(c.fansRequired),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[u(s(c.contentRequirement),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[u(s(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),r("div",Ie,[r("div",Ce,s(e.$t("submittedTasks.detail.memberInfo")),1),a(S,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[a(g,null,{default:t(()=>[r("span",null,s(h.nickname),1),h.isNew?(n(),m(M,{key:0,color:"green"},{default:t(()=>o[2]||(o[2]=[u("new")])),_:1})):b("",!0)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[u(s(h.account),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(n(!0),k(q,null,R(h.groups,i=>(n(),m(g,null,{default:t(()=>[r("span",null,s(i.groupName),1),i.isOwner?(n(),m(Te,{key:0})):b("",!0)]),_:2},1024))),256)),!h.groups||h.groups.length===0?(n(),k("span",Se,"--")):b("",!0)]),_:1},8,["label"])]),_:1}),(n(!0),k(q,null,R(V.value,i=>(n(),k("div",{key:i.channelId},[a(S,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(g,null,{default:t(()=>[a(G,{src:i.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(i.account),1),a(M,{color:"warning"},{default:t(()=>[u(s(N(w).getEnumText("AccountAuditStatus",i.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(l,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(W,{content:i.homeUrl},{default:t(()=>[r("div",qe,[r("a",{href:i.homeUrl,target:"_blank",class:"link-text"},s(i.homeUrl),9,we)])]),_:2},1032,["content"])]),_:2},1032,["label"]),i.channelCustomFields.includes("fansCount")?(n(),m(l,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[u(s(i.fansCount),1)]),_:2},1032,["label"])):b("",!0),i.channelCustomFields.includes("friendsCount")?(n(),m(l,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[u(s(i.friendsCount),1)]),_:2},1032,["label"])):b("",!0),i.channelCustomFields.includes("postsCount")?(n(),m(l,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[u(s(i.postsCount),1)]),_:2},1032,["label"])):b("",!0)]),_:2},1024)]))),128))]),r("div",Ae,[r("div",je,s(e.$t("submittedTasks.detail.submitInfo")),1),a(S,{column:1},{default:t(()=>{var i;return[(n(!0),k(q,null,R((i=d==null?void 0:d.submitContent)==null?void 0:i.customFields,(T,de)=>(n(),m(l,{key:de,label:T.title},{default:t(()=>[T.type==="image"?(n(!0),k(q,{key:0},R(T.value,(ue,oe)=>(n(),m(le,{src:ue.url,width:60,key:oe},null,8,["src"]))),128)):(n(),k(q,{key:1},[z(T.value)?(n(),m(W,{key:0,content:T.value},{default:t(()=>[r("div",Pe,[r("a",{href:T.value,target:"_blank",class:"link-text"},s(T.value),9,Re)])]),_:2},1032,["content"])):(n(),k("span",Ne,s(T.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),r("div",Fe,[r("div",De,s(e.$t("submittedTasks.detail.auditInfo")),1),a(S,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[u(s(d.submitTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[u(s(N(w).getEnumText("TaskPreAuditStatus",d.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[u(s(d.preWaiterName),1)]),_:1},8,["label"]),d.taskPreAuditStatus==="approved"?(n(),m(l,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[u(s(N(w).getEnumText("TaskAuditStatus",d.taskAuditStatus)),1)]),_:1},8,["label"])):b("",!0),d.taskPreAuditStatus==="approved"?(n(),m(l,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[u(s(d.waiterName),1)]),_:1},8,["label"])):b("",!0),d.auditStatus==="rejected"?(n(),m(l,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[u(s(d.rejectReason),1)]),_:1},8,["label"])):b("",!0)]),_:1})]),r("div",Be,[r("div",Le,[d.auditStatus==="pending"?(n(),m(g,{key:0},{default:t(()=>[a(P,{type:"primary",onClick:Q},{default:t(()=>[u(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(P,{danger:"",onClick:J},{default:t(()=>[u(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):b("",!0)]),r("div",Ee,[a(g,null,{default:t(()=>[d.prevTaskId&&d.prevTaskId!==d.nextTaskId?(n(),m(P,{key:0,onClick:Y},{default:t(()=>[u(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):b("",!0),d.nextTaskId?(n(),m(P,{key:1,onClick:Z},{default:t(()=>[u(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):b("",!0)]),_:1})])])]),a(ne,{open:j.value,"onUpdate:open":o[1]||(o[1]=i=>j.value=i),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:K,confirmLoading:D.value},{default:t(()=>[a(ie,{value:I.value,"onUpdate:value":o[0]||(o[0]=i=>I.value=i),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},He=re(Oe,[["__scopeId","data-v-d2cf8db6"]]);export{He as default};
