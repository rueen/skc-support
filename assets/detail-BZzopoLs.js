import{_ as ne,b as oe,a as ue,x as re,j as ce,c as F,r as C,k as me,d as b,f as a,e as c,w as t,g as k,t as s,F as S,n as R,p as m,s as p,l as P,m as f,h as be,o as n,i as o,q as N,A as B}from"./index-BWNwRArP.js";import{P as ke}from"./PageHeader-GMDXrewo.js";import{_ as M}from"./CopyContent-B0Lhq1wv.js";import{G as pe}from"./GroupOwner-S1ZWUDFo.js";const fe={class:"task-audit-detail content-container"},_e={class:"detail-container"},Te={key:0},ve={key:1},he={class:"detail-section"},ye={class:"section-title"},ge={key:0},$e={class:"link-text-container"},Ie=["href"],Ce={class:"detail-section"},Se={class:"section-title"},Ae={class:"link-text-container"},je=["href"],we={key:1},Re={class:"detail-section"},Pe={class:"section-title"},Ne={class:"footer-btns"},qe={class:"left"},Fe={class:"right"},De={__name:"detail",setup(Le){const{t:T}=oe(),A=ue(),D=re(),L=be(),q=D.query.type,E=ce(()=>d.taskPreAuditStatus==="approved"?"confirm":"pre"),j=C(!1),O=C(!1),y=C(""),G=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},v=C(null),d=F({submitContent:{}}),r=F({}),h=F({}),W=async()=>{const e=E.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",u=await B(e,{ids:[v.value]});u.code===0?(f.success(T("submittedTasks.resolveSuccess")),g()):f.error(u.message)},z=()=>{y.value="",j.value=!0},H=async()=>{if(!y.value){f.error(T("submittedTasks.rejectReasonRequired"));return}O.value=!0;const e=E.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject",u=await B(e,{ids:[v.value],reason:y.value});u.code===0?(f.success(T("submittedTasks.rejectSuccess")),j.value=!1,g()):f.error(u.message)},Q=()=>{L.push(`/submitted-tasks/detail/${d.prevTaskId}?type=${q}`),v.value=d.prevTaskId,g()},J=()=>{L.push(`/submitted-tasks/detail/${d.nextTaskId}?type=${q}`),v.value=d.nextTaskId,g()},K=async e=>{try{const u=await P("task.detail",{},{urlParams:{id:e}});u.code===0?Object.assign(r,u.data):f.error(u.message)}catch{f.error(T("submittedTasks.detail.getTaskDetailFailed"))}},X=async e=>{try{const u=await P("member.detail",{},{urlParams:{id:e}});u.code===0?Object.assign(h,u.data):f.error(u.message)}catch{f.error(T("submittedTasks.detail.getMemberDetailFailed"))}},g=async()=>{try{const e=await P("taskSubmitted.detail",{auditType:q},{urlParams:{id:v.value}});e.code===0&&(Object.assign(d,e.data),e.data.taskId!=null&&await K(e.data.taskId),e.data.memberId!=null&&await X(e.data.memberId),e.data.taskId!=null&&e.data.memberId!=null&&await Y())}catch{f.error(T("submittedTasks.detail.getDetailFailed"))}},U=C([]),Y=async()=>{const e=await P("account.list",{taskId:d.taskId,memberId:d.memberId,channelId:r.channelId});e.code===0&&(U.value=e.data.list||[])};return me(async()=>{v.value=D.params.id,await g()}),(e,u)=>{const V=k("a-avatar"),$=k("a-space"),l=k("a-descriptions-item"),I=k("a-descriptions"),Z=k("a-collapse-panel"),x=k("a-collapse"),ee=k("a-tag"),te=k("a-image"),w=k("a-button"),ae=k("a-textarea"),se=k("a-modal");return n(),b("div",fe,[a(ke,{title:e.$t("submittedTasks.detail.title"),back:!0},null,8,["title"]),c("div",_e,[a(x,{ghost:"",class:"collapse"},{default:t(()=>[a(Z,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a($,null,{default:t(()=>[a(V,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(r.taskName),1)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[o(s(r.category),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[o(s(N(A).getEnumText("TaskType",r.taskType)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[o(s(r.reward),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[o(s(r.brand),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var i;return[r.groupMode===0?(n(),b("span",Te,s(e.$t("submittedTasks.detail.noSpecify")),1)):(n(),b("span",ve,s((i=r.groupNames)==null?void 0:i.join("、")),1))]}),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[o(s(r.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(r.endTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[o(s(r.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):r.quota),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[o(s(r.fansRequired),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[o(s(r.contentRequirement),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[o(s(r.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),c("div",he,[c("div",ye,s(e.$t("submittedTasks.detail.memberInfo")),1),a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[o(s(h.nickname),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[o(s(h.account),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(n(!0),b(S,null,R(h.groups,i=>(n(),m($,null,{default:t(()=>[c("span",null,s(i.groupName),1),i.isOwner?(n(),m(pe,{key:0})):p("",!0)]),_:2},1024))),256)),!h.groups||h.groups.length===0?(n(),b("span",ge,"--")):p("",!0)]),_:1},8,["label"])]),_:1}),(n(!0),b(S,null,R(U.value,i=>(n(),b("div",{key:i.channelId},[a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a($,null,{default:t(()=>[a(V,{src:i.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(i.account),1),a(ee,{color:"warning"},{default:t(()=>[o(s(N(A).getEnumText("AccountAuditStatus",i.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(l,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(M,{content:i.homeUrl},{default:t(()=>[c("div",$e,[c("a",{href:i.homeUrl,target:"_blank",class:"link-text"},s(i.homeUrl),9,Ie)])]),_:2},1032,["content"])]),_:2},1032,["label"]),i.channelCustomFields.includes("fansCount")?(n(),m(l,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[o(s(i.fansCount),1)]),_:2},1032,["label"])):p("",!0),i.channelCustomFields.includes("friendsCount")?(n(),m(l,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[o(s(i.friendsCount),1)]),_:2},1032,["label"])):p("",!0),i.channelCustomFields.includes("postsCount")?(n(),m(l,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[o(s(i.postsCount),1)]),_:2},1032,["label"])):p("",!0)]),_:2},1024)]))),128))]),c("div",Ce,[c("div",Se,s(e.$t("submittedTasks.detail.submitInfo")),1),a(I,{column:2},{default:t(()=>{var i;return[(n(!0),b(S,null,R((i=d==null?void 0:d.submitContent)==null?void 0:i.customFields,(_,le)=>(n(),m(l,{key:le,label:_.title},{default:t(()=>[_.type==="image"?(n(!0),b(S,{key:0},R(_.value,(ie,de)=>(n(),m(te,{src:ie.url,width:60,key:de},null,8,["src"]))),128)):(n(),b(S,{key:1},[G(_.value)?(n(),m(M,{key:0,content:_.value},{default:t(()=>[c("div",Ae,[c("a",{href:_.value,target:"_blank",class:"link-text"},s(_.value),9,je)])]),_:2},1032,["content"])):(n(),b("span",we,s(_.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),c("div",Re,[c("div",Pe,s(e.$t("submittedTasks.detail.auditInfo")),1),a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[o(s(d.submitTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[o(s(N(A).getEnumText("TaskPreAuditStatus",d.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[o(s(d.preWaiterName),1)]),_:1},8,["label"]),d.taskPreAuditStatus==="approved"?(n(),m(l,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[o(s(N(A).getEnumText("TaskAuditStatus",d.taskAuditStatus)),1)]),_:1},8,["label"])):p("",!0),d.taskPreAuditStatus==="approved"?(n(),m(l,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[o(s(d.waiterName),1)]),_:1},8,["label"])):p("",!0),d.auditStatus==="rejected"?(n(),m(l,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[o(s(d.rejectReason),1)]),_:1},8,["label"])):p("",!0)]),_:1})]),c("div",Ne,[c("div",qe,[d.auditStatus==="pending"?(n(),m($,{key:0},{default:t(()=>[a(w,{type:"primary",onClick:W},{default:t(()=>[o(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(w,{danger:"",onClick:z},{default:t(()=>[o(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):p("",!0)]),c("div",Fe,[a($,null,{default:t(()=>[d.prevTaskId&&d.prevTaskId!==d.nextTaskId?(n(),m(w,{key:0,onClick:Q},{default:t(()=>[o(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):p("",!0),d.nextTaskId?(n(),m(w,{key:1,onClick:J},{default:t(()=>[o(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):p("",!0)]),_:1})])])]),a(se,{open:j.value,"onUpdate:open":u[1]||(u[1]=i=>j.value=i),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:H,confirmLoading:O.value},{default:t(()=>[a(ae,{value:y.value,"onUpdate:value":u[0]||(u[0]=i=>y.value=i),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Be=ne(De,[["__scopeId","data-v-93d6ecd9"]]);export{Be as default};
