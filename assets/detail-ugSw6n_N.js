import{_ as H,r as m,c as J,d as K,z as Q,e as W,o as X,f as P,h as r,g as Y,w as o,i,p as A,q as u,j as Z,k as b,F as U,m as C,n as L,l as _,t as h,B as x,C as ee}from"./index-BepA_qxU.js";import{P as ae}from"./PageHeader-s2gPEUX5.js";const le={class:"member-form content-container"},te={class:"form-container"},re={__name:"detail",setup(oe){const c=Q(),M=Z(),B=m(),{t:O}=J(),v=K(()=>!!c.params.id),l=W({memberNickname:"",memberAccount:"",password:"",groupIds:[],inviterId:void 0,isNew:!0}),k={memberAccount:[{required:!0,message:O("member.detail.memberAccountPlaceholder")}]},N=m(!1),g=m([]),y=m(!1),S=m([]),p=()=>{const e={};c.query.filters&&(e.filters=c.query.filters),M.push({name:"MemberList",query:e})},I=async(e="",a=null)=>{N.value=!0;try{const s=await A("group.list",{page:1,pageSize:200,groupName:e,memberId:a});s.code===0&&(g.value=s.data.list||[],l.groupIds.some(d=>g.value.some(w=>w.id===d))||(l.groupIds=[]))}finally{N.value=!1}},R=e=>{g.value=[],I()},q=async(e="")=>{y.value=!0;try{const a=await A("member.list",{page:1,pageSize:20,memberNickname:e});if(a.code===0){let s=a.data.list||[];!s.find(d=>d.id===f.value.inviterId)&&f.value.inviterId&&s.push({id:f.value.inviterId,nickname:f.value.inviterNickname}),S.value=s}}finally{y.value=!1}},f=m({}),z=async()=>{if(v.value)try{const e=await A("member.detail",{},{urlParams:{id:c.params.id}});if(e.code===0){const a=e.data;f.value=a,Object.assign(l,{memberNickname:a.nickname,memberAccount:a.account,groupIds:a.groups.map(s=>s.groupId),inviterId:a.inviterId,isNew:!!a.isNew})}}catch{u.error("load member info failed"),p()}},D=async()=>{l.isNew=l.isNew?1:0;const e=await ee("member.add",l);e.code===0?(u.success(e.message),p()):u.error(e.message)},T=async()=>{l.isNew=l.isNew?1:0;const e=await x("member.edit",l,{urlParams:{id:c.params.id}});e.code===0?(u.success(e.message),p()):u.error(e.message)},$=m(!1),V=()=>{B.value.validate().then(async()=>{try{$.value=!0,v.value?T():D()}catch{u.error("submit failed")}finally{$.value=!1}})};return X(async()=>{await z(),await q(),await I()}),(e,a)=>{const s=i("a-input"),n=i("a-form-item"),d=i("a-select-option"),w=i("a-select"),j=i("a-switch"),E=i("a-button"),F=i("a-space"),G=i("a-form");return b(),P("div",le,[r(ae,{title:v.value?e.$t("member.detail.editTitle"):e.$t("member.detail.addTitle"),back:!0,useDefaultBack:!1,onBack:p},null,8,["title"]),Y("div",te,[r(G,{ref_key:"formRef",ref:B,model:l,rules:k,"label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[r(n,{label:e.$t("member.detail.memberAccount"),name:"memberAccount",rules:k.memberAccount},{default:o(()=>[r(s,{value:l.memberAccount,"onUpdate:value":a[0]||(a[0]=t=>l.memberAccount=t),placeholder:e.$t("member.detail.memberAccountPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(n,{label:e.$t("member.detail.password"),name:"password",rules:[{required:!v.value,message:e.$t("member.detail.passwordPlaceholder")}]},{default:o(()=>[r(s,{value:l.password,"onUpdate:value":a[1]||(a[1]=t=>l.password=t),placeholder:e.$t("member.detail.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(n,{label:e.$t("member.detail.memberNickname"),name:"memberNickname",rules:k.memberNickname},{default:o(()=>[r(s,{value:l.memberNickname,"onUpdate:value":a[2]||(a[2]=t=>l.memberNickname=t),placeholder:e.$t("member.detail.memberNicknamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(n,{label:e.$t("member.detail.inviter"),name:"inviterId"},{default:o(()=>[r(w,{value:l.inviterId,"onUpdate:value":a[3]||(a[3]=t=>l.inviterId=t),placeholder:e.$t("member.detail.inviterPlaceholder"),loading:y.value,"show-search":"","allow-clear":"","filter-option":!1,onSearch:q,onSelect:R},{default:o(()=>[(b(!0),P(U,null,C(S.value,t=>(b(),L(d,{key:t.id,value:t.id},{default:o(()=>[_(h(t.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),r(n,{label:e.$t("member.detail.group"),name:"groupIds"},{default:o(()=>[r(w,{value:l.groupIds,"onUpdate:value":a[4]||(a[4]=t=>l.groupIds=t),placeholder:e.$t("member.detail.groupPlaceholder"),loading:N.value,mode:"multiple","allow-clear":"","show-search":"","filter-option":!1,onSearch:I},{default:o(()=>[(b(!0),P(U,null,C(g.value,t=>(b(),L(d,{key:t.id,value:t.id},{default:o(()=>[_(h(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),r(n,{label:e.$t("member.detail.isNew")},{default:o(()=>[r(j,{checked:l.isNew,"onUpdate:checked":a[5]||(a[5]=t=>l.isNew=t)},null,8,["checked"])]),_:1},8,["label"]),r(n,{"wrapper-col":{offset:4}},{default:o(()=>[r(F,null,{default:o(()=>[r(E,{type:"primary",loading:$.value,onClick:V},{default:o(()=>[_(h(e.$t("common.submit")),1)]),_:1},8,["loading"]),r(E,{onClick:p},{default:o(()=>[_(h(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},ie=H(re,[["__scopeId","data-v-256f13e8"]]);export{ie as default};
