import{b as H,r as v,j as N,x as P,c as C,k as I,d as q,f as s,e as B,w as r,g as m,l as S,y as i,m as n,h as j,o as E,i as T,t as _,z as V,A as z}from"./index-_Ujq24cd.js";import{P as F}from"./PageHeader-DLUk7liS.js";const U={class:"task-form content-container"},A={class:"form-container"},K={__name:"detail",setup(L){const{t:u}=H(),d=P(),p=j(),b=v(),f=N(()=>d.name==="TaskEdit"),e=C({taskGroupName:"",taskGroupReward:0}),y={taskGroupName:[{required:!0,message:u("task.group.validation.taskGroupNameRequired")}],taskGroupReward:[{required:!0,message:u("task.group.validation.taskGroupRewardRequired")}]},Y=async()=>{try{c.value=!0;const a={...e,groupIds:e.groupMode===0?[]:e.groupIds,startTime:e.startTime?i(e.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:e.endTime?i(e.endTime).format("YYYY-MM-DD HH:mm:ss"):null},t=await z("task.add",a);t.code===0?(n.success(u("common.submitSuccess")),p.back()):n.error(t.message)}catch(a){console.log(a),n.error(u("common.submitFailed"))}finally{c.value=!1}},h=async()=>{try{c.value=!0;const a={...e,groupIds:e.groupMode===0?[]:e.groupIds,startTime:e.startTime?i(e.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:e.endTime?i(e.endTime).format("YYYY-MM-DD HH:mm:ss"):null},t=await V("task.edit",{...a},{urlParams:{id:d.params.id}});t.code===0?(n.success(u("common.submitSuccess")),p.back()):n.error(t.message)}catch(a){console.log(a),n.error(u("common.submitFailed"))}finally{c.value=!1}},c=v(!1),w=()=>{b.value.validate().then(async()=>{f.value?await h():await Y()})},D=()=>{p.back()},M=async a=>{try{const t=await S("task.detail",{},{urlParams:{id:a}});if(t.code===0){let o={};for(let l in t.data)l!=="groups"&&(o[l]=t.data[l]);o.startTime&&(o.startTime=i(o.startTime)),o.endTime&&(o.endTime=i(o.endTime)),Object.assign(e,o)}}catch(t){console.log(t),n.error(t)}};return I(()=>{f.value&&M(d.params.id)}),(a,t)=>{const o=m("a-input"),l=m("a-form-item"),R=m("a-input-number"),k=m("a-button"),G=m("a-space"),$=m("a-form");return E(),q("div",U,[s(F,{title:f.value?a.$t("task.group.editTitle"):a.$t("task.group.createTitle"),back:!0,class:"page-header"},null,8,["title"]),B("div",A,[s($,{ref_key:"formRef",ref:b,model:e,rules:y,"label-col":{span:5},"wrapper-col":{span:18},layout:"horizontal"},{default:r(()=>[s(l,{label:a.$t("task.group.name")},{default:r(()=>[s(o,{value:e.taskGroupName,"onUpdate:value":t[0]||(t[0]=g=>e.taskGroupName=g),placeholder:a.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(l,{label:a.$t("task.group.reward")},{default:r(()=>[s(R,{value:e.taskGroupReward,"onUpdate:value":t[1]||(t[1]=g=>e.taskGroupReward=g),min:0,precision:2,step:.1,placeholder:a.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(l,{label:a.$t("task.group.relatedTask")},{default:r(()=>[s(k,{type:"primary"},{default:r(()=>[T(_(a.$t("task.group.selectTaskBtnText")),1)]),_:1})]),_:1},8,["label"]),s(l,{"wrapper-col":{span:16,offset:4}},{default:r(()=>[s(G,null,{default:r(()=>[s(k,{type:"primary",onClick:w},{default:r(()=>[T(_(a.$t("common.submit")),1)]),_:1}),s(k,{onClick:D},{default:r(()=>[T(_(a.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}};export{K as default};
