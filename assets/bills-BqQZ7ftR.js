import{_ as le,b as ne,a as oe,j as $,r as C,c as U,k as se,d,e as I,f as s,w as l,g as c,l as H,m as g,h as ie,o,F as y,n as G,p as _,i as p,t as r,s as k,q as x,M as P}from"./index-6qkheSpP.js";import{d as re}from"./download-DYy-uDC8.js";const ue={class:"other-bill content-container"},de={class:"table-container"},me={class:"table-header"},ce={class:"left"},pe={key:1},be={key:1},ye={key:5,style:{"max-width":"250px"}},ke={key:0},fe={key:1},_e={key:0},ve={key:1},he={__name:"bills",setup(ge){const{t:m}=ne(),f=oe(),R=ie(),F=$(()=>f.loaded?f.getEnumOptions("BillType"):[]),z=$(()=>f.loaded?f.getEnumOptions("SettlementStatus"):[]),N=C(!1),a=U({billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",keyword:"",relatedGroupId:void 0}),V=t=>{P.error({title:"结算失败原因",content:t.failureReason})},j=$(()=>[{title:m("financial.bills.billNo"),dataIndex:"billNo",key:"billNo"},{title:m("financial.bills.memberNickname"),key:"memberNickname"},{title:m("financial.bills.billType"),dataIndex:"billType",key:"billType"},{title:m("financial.bills.relatedTaskName"),key:"taskName"},{title:m("financial.bills.relatedGroupName"),key:"relatedGroupName"},{title:m("financial.bills.amount"),dataIndex:"amount",key:"amount",align:"right"},{title:m("financial.bills.remark"),key:"remark"},{title:m("financial.bills.createTime"),dataIndex:"createTime",key:"createTime"},{title:m("financial.bills.settlementStatus"),key:"settlementStatus"}]),D=C([]),v=U({current:1,pageSize:10,total:0}),E=()=>{v.current=1,w()},L=()=>{Object.assign(a,{billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",keyword:"",relatedGroupId:void 0}),E()},q=t=>{Object.assign(v,t),w()},A=t=>{R.push(`/member/view/${t.memberId}`)},W=t=>{R.push(`/submitted-tasks/detail/${t.submittedId}?type=confirm`)},w=async()=>{var t,n;N.value=!0;try{const b={page:v.current,pageSize:v.pageSize,billNo:a.billNo,billType:a.billType,settlementStatus:a.settlementStatus,startTime:(t=a.timeRange)==null?void 0:t[0],endTime:(n=a.timeRange)==null?void 0:n[1],taskName:a.taskName,keyword:a.keyword,relatedGroupId:a.relatedGroupId},u=await H("finance.bills",{...b});u.code===0?(D.value=u.data.list,v.total=u.data.total):g.error(u.message)}finally{N.value=!1}},M=C([]),O=async(t="")=>{try{const n=await H("group.list",{page:1,pageSize:50,groupName:t});n.code===0&&(M.value=n.data.list||[])}catch{g.error("获取群组列表失败")}},J=()=>{P.confirm({title:m("common.export"),content:m("common.confirmExportContent"),onOk:async()=>{var b,u;const t=g.loading("正在导出数据，请稍候...",0),n={billNo:a.billNo,billType:a.billType,settlementStatus:a.settlementStatus,startTime:(b=a.timeRange)==null?void 0:b[0],endTime:(u=a.timeRange)==null?void 0:u[1],taskName:a.taskName,keyword:a.keyword,relatedGroupId:a.relatedGroupId};try{await re("finance.billsExport",n,`结算账单_${new Date().toLocaleDateString()}.xlsx`),g.success(m("common.exportSuccess"))}catch(h){console.error("导出失败:",h),g.error(m("common.exportFailed"))}finally{t()}}})};return se(()=>{w(),O()}),(t,n)=>{const b=c("a-input"),u=c("a-form-item"),h=c("a-select-option"),T=c("a-select"),K=c("a-range-picker"),S=c("a-button"),Q=c("download-outlined"),X=c("a-space"),Z=c("a-form"),Y=c("a-typography-link"),ee=c("a-typography-text"),ae=c("info-circle-outlined"),te=c("a-table");return o(),d("div",ue,[I("div",de,[I("div",me,[I("div",ce,[s(Z,{layout:"inline",model:a},{default:l(()=>[s(u,{label:t.$t("financial.bills.billNo")},{default:l(()=>[s(b,{value:a.billNo,"onUpdate:value":n[0]||(n[0]=e=>a.billNo=e),placeholder:t.$t("financial.bills.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(u,{label:t.$t("financial.bills.billType")},{default:l(()=>[s(T,{value:a.billType,"onUpdate:value":n[1]||(n[1]=e=>a.billType=e),placeholder:t.$t("financial.bills.billTypePlaceholder"),style:{width:"120px"},"allow-clear":""},{default:l(()=>[(o(!0),d(y,null,G(F.value,e=>(o(),_(h,{key:e.value,value:e.value},{default:l(()=>[p(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(u,{label:t.$t("financial.bills.settlementStatus")},{default:l(()=>[s(T,{value:a.settlementStatus,"onUpdate:value":n[2]||(n[2]=e=>a.settlementStatus=e),placeholder:t.$t("financial.bills.settlementStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:l(()=>[(o(!0),d(y,null,G(z.value,e=>(o(),_(h,{key:e.value,value:e.value},{default:l(()=>[p(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(u,{label:t.$t("financial.bills.createTime")},{default:l(()=>[s(K,{value:a.timeRange,"onUpdate:value":n[3]||(n[3]=e=>a.timeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),s(u,{label:t.$t("financial.bills.relatedTaskName")},{default:l(()=>[s(b,{value:a.taskName,"onUpdate:value":n[4]||(n[4]=e=>a.taskName=e),placeholder:t.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(u,{label:t.$t("financial.bills.memberNickname")},{default:l(()=>[s(b,{value:a.keyword,"onUpdate:value":n[5]||(n[5]=e=>a.keyword=e),placeholder:t.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(u,{label:t.$t("financial.bills.relatedGroupName")},{default:l(()=>[s(T,{value:a.relatedGroupId,"onUpdate:value":n[6]||(n[6]=e=>a.relatedGroupId=e),placeholder:t.$t("financial.bills.relatedGroupNamePlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:O},{default:l(()=>[(o(!0),d(y,null,G(M.value,e=>(o(),_(h,{key:e.id,value:e.id},{default:l(()=>[p(r(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(u,null,{default:l(()=>[s(X,null,{default:l(()=>[s(S,{type:"primary",onClick:E},{default:l(()=>[p(r(t.$t("common.search")),1)]),_:1}),s(S,{onClick:L},{default:l(()=>[p(r(t.$t("common.reset")),1)]),_:1}),s(S,{onClick:J},{icon:l(()=>[s(Q)]),default:l(()=>[p(" "+r(t.$t("common.export")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),s(te,{columns:j.value,"data-source":D.value,loading:N.value,pagination:v,onChange:q},{bodyCell:l(({column:e,record:i})=>[e.key==="memberNickname"?(o(),_(Y,{key:0,onClick:B=>A(i)},{default:l(()=>[p(r(i.memberNickname),1)]),_:2},1032,["onClick"])):k("",!0),e.key==="taskName"?(o(),d(y,{key:1},[i.taskName?(o(),_(Y,{key:0,onClick:B=>W(i)},{default:l(()=>[p(r(i.taskName),1)]),_:2},1032,["onClick"])):(o(),d("span",pe,"--"))],64)):k("",!0),e.key==="relatedGroupName"?(o(),d(y,{key:2},[p(r(i.relatedGroupName||"--"),1)],64)):k("",!0),e.key==="billType"?(o(),d(y,{key:3},[p(r(x(f).getEnumText("BillType",i.billType)),1)],64)):k("",!0),e.key==="amount"?(o(),d(y,{key:4},[i.billType==="reward_deduction"?(o(),_(ee,{key:0,type:"danger"},{default:l(()=>[p(" - "+r(i.amount),1)]),_:2},1024)):(o(),d("span",be,r(i.amount),1))],64)):k("",!0),e.key==="remark"?(o(),d("div",ye,[i.remark?(o(),d("span",ke,r(i.remark)+"("+r(t.$t("financial.bills.operator"))+": "+r(i.waiterName)+")",1)):(o(),d("span",fe,"--"))])):k("",!0),e.key==="settlementStatus"?(o(),d(y,{key:6},[i.billType==="withdrawal"?(o(),d("span",_e,r(x(f).getEnumText("WithdrawalStatus",i.withdrawalStatus)),1)):(o(),d("span",ve,r(x(f).getEnumText("SettlementStatus",i.settlementStatus)),1)),i.settlementStatus==="failed"||i.withdrawalStatus==="failed"?(o(),_(ae,{key:2,class:"status-icon",onClick:B=>V(i)},null,8,["onClick"])):k("",!0)],64)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Te=le(he,[["__scopeId","data-v-aeedbceb"]]);export{Te as default};
