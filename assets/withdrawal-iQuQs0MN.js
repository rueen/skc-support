import{_ as ce,a as ue,i as me,j as H,r as f,b as E,k as we,c as S,d as v,e as a,w as t,f as o,l as he,m as i,g as pe,o as w,F as D,n as _e,p as I,h,t as d,q as M,s as C,M as L,A as U}from"./index-CVJT4XJB.js";import{d as fe}from"./download-MQLYTBbY.js";const ve={class:"withdrawal content-container"},ge={class:"table-container"},ke={class:"table-header"},ye={class:"left"},be={class:"right"},Se=["onClick"],Ce=["onClick"],Re={__name:"withdrawal",setup($e){const{t:u}=ue(),O=pe(),R=me(),V=H(()=>R.loaded?R.getEnumOptions("WithdrawalStatus"):[]),$=f(!1),g=f(!1),N=f(!1),p=f(""),s=E({memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),A=H(()=>[{title:u("withdrawal.list.memberNickname"),dataIndex:"nickname",key:"nickname"},{title:u("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:u("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:u("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:u("withdrawal.list.name"),dataIndex:"name",key:"name"},{title:u("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:u("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:u("withdrawal.list.action"),key:"action",width:150}]),r=f([]),F={selectedRowKeys:r,onChange:e=>{r.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},Y=f([]),_=E({current:1,pageSize:10,total:0}),B=()=>{_.current=1,k()},P=()=>{Object.assign(s,{memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),B()},W=e=>{Object.assign(_,e),k()},z=()=>{L.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const e=i.loading("正在导出数据，请稍候...",0),l={...s};try{await fe("withdrawals.export",l,`提现列表_${new Date().toLocaleDateString()}.xlsx`),i.success("导出成功")}catch(y){console.error("导出失败:",y),i.error("导出失败，请稍后重试")}finally{e()}}})},K=e=>{L.error({title:"结算失败原因",content:e.rejectReason})},q=async e=>{r.value=[e.id],x()},x=async()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}const e=await U("withdrawals.batchResolve",{ids:r.value});e.code===0?(i.success("操作成功"),r.value=[],k()):i.error(e.message)},G=e=>{r.value=[e.id],p.value="",g.value=!0},J=()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}p.value="",g.value=!0},Q=async()=>{if(!p.value){i.error("请输入打款失败原因");return}N.value=!0;const e=await U("withdrawals.batchReject",{rejectReason:p.value,ids:r.value});N.value=!1,e.code===0?(i.success("操作成功"),g.value=!1,r.value=[],k()):i.error(e.message)},k=async()=>{var e,l;$.value=!0;try{const y={page:_.current,pageSize:_.pageSize,memberNickname:s.memberNickname,withdrawalStatus:s.withdrawalStatus,startTime:(e=s.timeRange)==null?void 0:e[0],endTime:(l=s.timeRange)==null?void 0:l[1]},c=await he("withdrawals.list",{...y});c.code===0?(Y.value=c.data.list||[],_.total=c.data.total||0):i.error(c.message)}finally{$.value=!1}};return we(()=>{k()}),(e,l)=>{const y=o("a-input"),c=o("a-form-item"),X=o("a-select-option"),Z=o("a-select"),ee=o("a-range-picker"),b=o("a-button"),j=o("a-space"),ae=o("a-form"),te=o("RightOutlined"),le=o("a-typography-link"),ne=o("download-outlined"),oe=o("info-circle-outlined"),se=o("a-popconfirm"),ie=o("a-table"),re=o("a-textarea"),de=o("a-modal");return w(),S("div",ve,[v("div",ge,[v("div",ke,[v("div",ye,[a(ae,{layout:"inline",model:s},{default:t(()=>[a(c,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(y,{value:s.memberNickname,"onUpdate:value":l[0]||(l[0]=n=>s.memberNickname=n),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(c,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(Z,{value:s.withdrawalStatus,"onUpdate:value":l[1]||(l[1]=n=>s.withdrawalStatus=n),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(w(!0),S(D,null,_e(V.value,n=>(w(),I(X,{key:n.value,value:n.value},{default:t(()=>[h(d(n.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(c,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(ee,{value:s.timeRange,"onUpdate:value":l[2]||(l[2]=n=>s.timeRange=n),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(c,null,{default:t(()=>[a(j,null,{default:t(()=>[a(b,{type:"primary",onClick:B},{default:t(()=>[h(d(e.$t("common.search")),1)]),_:1}),a(b,{onClick:P},{default:t(()=>[h(d(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),v("div",be,[a(j,null,{default:t(()=>[a(le,{onClick:l[3]||(l[3]=n=>M(O).push("/payment-transactions"))},{default:t(()=>[h(d(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(te)]),_:1}),a(b,{onClick:z},{icon:t(()=>[a(ne)]),default:t(()=>[h(" "+d(e.$t("withdrawal.list.export")),1)]),_:1}),a(b,{type:"primary",onClick:x},{default:t(()=>[h(d(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(b,{danger:"",onClick:J},{default:t(()=>[h(d(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(ie,{columns:A.value,"data-source":Y.value,loading:$.value,pagination:_,rowKey:"id","row-selection":F,onChange:W},{bodyCell:t(({column:n,record:m})=>[n.key==="withdrawalStatus"?(w(),S(D,{key:0},[h(d(M(R).getEnumText("WithdrawalStatus",m.withdrawalStatus))+" ",1),m.withdrawalStatus==="failed"?(w(),I(oe,{key:0,class:"status-icon",onClick:T=>K(m)},null,8,["onClick"])):C("",!0)],64)):C("",!0),n.key==="action"?(w(),S(D,{key:1},[m.withdrawalStatus==="pending"?(w(),I(j,{key:0},{default:t(()=>[a(se,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:T=>q(m)},{default:t(()=>[v("a",null,d(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),v("a",{class:"danger",onClick:T=>G(m)},d(e.$t("withdrawal.list.reject")),9,Se)]),_:2},1024)):C("",!0),m.withdrawalStatus==="failed"?(w(),S("a",{key:1,onClick:T=>M(O).push(`/payment-transactions?withdrawalId=${m.id}`)},"查看交易记录",8,Ce)):C("",!0)],64)):C("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),a(de,{open:g.value,"onUpdate:open":l[5]||(l[5]=n=>g.value=n),title:e.$t("withdrawal.list.rejectTitle"),onOk:Q,confirmLoading:N.value},{default:t(()=>[a(re,{value:p.value,"onUpdate:value":l[4]||(l[4]=n=>p.value=n),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Te=ce(Re,[["__scopeId","data-v-bff61f46"]]);export{Te as default};
