import{_ as ue,b as oe,a as re,x as ce,j as me,c as D,r as C,k as be,d as k,f as a,e as r,w as t,g as p,t as s,F as S,n as N,p as m,s as b,l as q,m as f,h as ke,o as i,i as u,q as F,A as M}from"./index-CM_LUiVE.js";import{P as pe}from"./PageHeader-UOtIDoDl.js";import{_ as G}from"./CopyContent-Fn66ssB-.js";import{G as fe}from"./GroupOwner-CeMIcTxz.js";const _e={class:"task-audit-detail content-container"},Te={class:"detail-container"},he={key:0},ve={key:1},ye={class:"detail-section"},ge={class:"section-title"},$e={key:0},Ie={class:"link-text-container"},Ce=["href"],Se={class:"detail-section"},we={class:"section-title"},Ae={class:"link-text-container"},je=["href"],Re={key:1},Pe={class:"detail-section"},Ne={class:"section-title"},qe={class:"footer-btns"},Fe={class:"left"},De={class:"right"},Be={__name:"detail",setup(Le){const{t:h}=oe(),w=re(),B=ce(),A=ke(),j=B.query.type,L=me(()=>d.taskPreAuditStatus==="approved"?"confirm":"pre"),R=C(!1),E=C(!1),g=C(""),W=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},v=C(null),d=D({submitContent:{}}),c=D({}),T=D({}),z=async()=>{const e=L.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",o=await M(e,{ids:[v.value]});o.code===0?(f.success(h("submittedTasks.resolveSuccess")),$()):f.error(o.message)},H=()=>{g.value="",R.value=!0},Q=async()=>{if(!g.value){f.error(h("submittedTasks.rejectReasonRequired"));return}E.value=!0;const e=L.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject",o=await M(e,{ids:[v.value],reason:g.value});o.code===0?(f.success(h("submittedTasks.rejectSuccess")),R.value=!1,$()):f.error(o.message)},J=()=>{switch(j){case"confirm":A.push("/confirm-audit-tasks");break;case"pre":A.push("/pre-audit-tasks");break}},K=()=>{A.push(`/submitted-tasks/detail/${d.prevTaskId}?type=${j}`),v.value=d.prevTaskId,$()},X=()=>{A.push(`/submitted-tasks/detail/${d.nextTaskId}?type=${j}`),v.value=d.nextTaskId,$()},Y=async e=>{try{const o=await q("task.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(c,o.data):f.error(o.message)}catch{f.error(h("submittedTasks.detail.getTaskDetailFailed"))}},Z=async e=>{try{const o=await q("member.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(T,o.data):f.error(o.message)}catch{f.error(h("submittedTasks.detail.getMemberDetailFailed"))}},$=async()=>{try{const e=await q("taskSubmitted.detail",{auditType:j},{urlParams:{id:v.value}});e.code===0&&(Object.assign(d,e.data),e.data.taskId!=null&&await Y(e.data.taskId),e.data.memberId!=null&&await Z(e.data.memberId),e.data.taskId!=null&&e.data.memberId!=null&&await x())}catch{f.error(h("submittedTasks.detail.getDetailFailed"))}},O=C([]),x=async()=>{const e=await q("account.list",{taskId:d.taskId,memberId:d.memberId,channelId:c.channelId});e.code===0&&(O.value=e.data.list||[])};return be(async()=>{v.value=B.params.id,await $()}),(e,o)=>{const U=p("a-avatar"),y=p("a-space"),l=p("a-descriptions-item"),I=p("a-descriptions"),ee=p("a-collapse-panel"),te=p("a-collapse"),V=p("a-tag"),ae=p("a-image"),P=p("a-button"),se=p("a-textarea"),le=p("a-modal");return i(),k("div",_e,[a(pe,{title:e.$t("submittedTasks.detail.title"),back:!0,useDefaultBack:!1,onBack:J},null,8,["title"]),r("div",Te,[a(te,{ghost:"",class:"collapse"},{default:t(()=>[a(ee,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(y,null,{default:t(()=>[a(U,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(c.taskName),1)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[u(s(c.category),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[u(s(F(w).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[u(s(c.reward),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[u(s(c.brand),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var n;return[c.groupMode===0?(i(),k("span",he,s(e.$t("submittedTasks.detail.noSpecify")),1)):(i(),k("span",ve,s((n=c.groupNames)==null?void 0:n.join("、")),1))]}),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[u(s(c.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(c.endTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[u(s(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[u(s(c.fansRequired),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[u(s(c.contentRequirement),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[u(s(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),r("div",ye,[r("div",ge,s(e.$t("submittedTasks.detail.memberInfo")),1),a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[a(y,null,{default:t(()=>[r("span",null,s(T.nickname),1),T.isNew?(i(),m(V,{key:0,color:"green"},{default:t(()=>o[2]||(o[2]=[u("new")])),_:1})):b("",!0)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[u(s(T.account),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(i(!0),k(S,null,N(T.groups,n=>(i(),m(y,null,{default:t(()=>[r("span",null,s(n.groupName),1),n.isOwner?(i(),m(fe,{key:0})):b("",!0)]),_:2},1024))),256)),!T.groups||T.groups.length===0?(i(),k("span",$e,"--")):b("",!0)]),_:1},8,["label"])]),_:1}),(i(!0),k(S,null,N(O.value,n=>(i(),k("div",{key:n.channelId},[a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(y,null,{default:t(()=>[a(U,{src:n.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(n.account),1),a(V,{color:"warning"},{default:t(()=>[u(s(F(w).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(l,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(G,{content:n.homeUrl},{default:t(()=>[r("div",Ie,[r("a",{href:n.homeUrl,target:"_blank",class:"link-text"},s(n.homeUrl),9,Ce)])]),_:2},1032,["content"])]),_:2},1032,["label"]),n.channelCustomFields.includes("fansCount")?(i(),m(l,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[u(s(n.fansCount),1)]),_:2},1032,["label"])):b("",!0),n.channelCustomFields.includes("friendsCount")?(i(),m(l,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[u(s(n.friendsCount),1)]),_:2},1032,["label"])):b("",!0),n.channelCustomFields.includes("postsCount")?(i(),m(l,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[u(s(n.postsCount),1)]),_:2},1032,["label"])):b("",!0)]),_:2},1024)]))),128))]),r("div",Se,[r("div",we,s(e.$t("submittedTasks.detail.submitInfo")),1),a(I,{column:1},{default:t(()=>{var n;return[(i(!0),k(S,null,N((n=d==null?void 0:d.submitContent)==null?void 0:n.customFields,(_,ne)=>(i(),m(l,{key:ne,label:_.title},{default:t(()=>[_.type==="image"?(i(!0),k(S,{key:0},N(_.value,(ie,de)=>(i(),m(ae,{src:ie.url,width:60,key:de},null,8,["src"]))),128)):(i(),k(S,{key:1},[W(_.value)?(i(),m(G,{key:0,content:_.value},{default:t(()=>[r("div",Ae,[r("a",{href:_.value,target:"_blank",class:"link-text"},s(_.value),9,je)])]),_:2},1032,["content"])):(i(),k("span",Re,s(_.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),r("div",Pe,[r("div",Ne,s(e.$t("submittedTasks.detail.auditInfo")),1),a(I,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[u(s(d.submitTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[u(s(F(w).getEnumText("TaskPreAuditStatus",d.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[u(s(d.preWaiterName),1)]),_:1},8,["label"]),d.taskPreAuditStatus==="approved"?(i(),m(l,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[u(s(F(w).getEnumText("TaskAuditStatus",d.taskAuditStatus)),1)]),_:1},8,["label"])):b("",!0),d.taskPreAuditStatus==="approved"?(i(),m(l,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[u(s(d.waiterName),1)]),_:1},8,["label"])):b("",!0),d.auditStatus==="rejected"?(i(),m(l,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[u(s(d.rejectReason),1)]),_:1},8,["label"])):b("",!0)]),_:1})]),r("div",qe,[r("div",Fe,[d.auditStatus==="pending"?(i(),m(y,{key:0},{default:t(()=>[a(P,{type:"primary",onClick:z},{default:t(()=>[u(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(P,{danger:"",onClick:H},{default:t(()=>[u(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):b("",!0)]),r("div",De,[a(y,null,{default:t(()=>[d.prevTaskId&&d.prevTaskId!==d.nextTaskId?(i(),m(P,{key:0,onClick:K},{default:t(()=>[u(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):b("",!0),d.nextTaskId?(i(),m(P,{key:1,onClick:X},{default:t(()=>[u(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):b("",!0)]),_:1})])])]),a(le,{open:R.value,"onUpdate:open":o[1]||(o[1]=n=>R.value=n),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:Q,confirmLoading:E.value},{default:t(()=>[a(se,{value:g.value,"onUpdate:value":o[0]||(o[0]=n=>g.value=n),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Me=ue(Be,[["__scopeId","data-v-8598d5e3"]]);export{Me as default};
