import{_ as re,i as ce,j as de,r as w,b as T,k as ue,c as y,d as f,e as t,w as n,f as l,l as me,m as i,g as pe,o as u,F as D,n as _e,p as $,h as m,t as C,s as I,q as b,M as H,A as E}from"./index-ByCb6rGy.js";import{d as we}from"./download-BdwBcdsb.js";const fe={class:"withdrawal content-container"},ve={class:"table-container"},ge={class:"table-header"},he={class:"left"},ke={class:"right"},ye=["onClick"],be=["onClick"],Ce={__name:"withdrawal",setup(Se){const M=pe(),S=ce(),L=de(()=>S.loaded?S.getEnumOptions("WithdrawalStatus"):[]),R=w(!1),v=w(!1),x=w(!1),p=w(""),s=T({memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),U=[{title:"会员昵称",dataIndex:"nickname",key:"nickname"},{title:"提现账户",dataIndex:"account",key:"account"},{title:"账户类型",dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:"申请提现金额",dataIndex:"amount",key:"amount",align:"right"},{title:"姓名",dataIndex:"name",key:"name"},{title:"申请时间",dataIndex:"createTime",key:"createTime"},{title:"提现状态",key:"withdrawalStatus"},{title:"操作",key:"action",width:150}],r=w([]),V={selectedRowKeys:r,onChange:a=>{r.value=a},getCheckboxProps:a=>({disabled:a.withdrawalStatus!=="pending"})},O=w([]),_=T({current:1,pageSize:10,total:0}),Y=()=>{_.current=1,g()},F=()=>{Object.assign(s,{memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),Y()},z=a=>{Object.assign(_,a),g()},A=()=>{H.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const a=i.loading("正在导出数据，请稍候...",0),e={...s};try{await we("withdrawals.export",e,`提现列表_${new Date().toLocaleDateString()}.xlsx`),i.success("导出成功")}catch(h){console.error("导出失败:",h),i.error("导出失败，请稍后重试")}finally{a()}}})},K=a=>{H.error({title:"结算失败原因",content:a.rejectReason})},W=async a=>{r.value=[a.id],B()},B=async()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}const a=await E("withdrawals.batchResolve",{ids:r.value});a.code===0?(i.success("操作成功"),r.value=[],g()):i.error(a.message)},q=a=>{r.value=[a.id],p.value="",v.value=!0},P=()=>{if(!r.value.length){i.warning("请选择要操作的记录");return}p.value="",v.value=!0},G=async()=>{if(!p.value){i.error("请输入打款失败原因");return}x.value=!0;const a=await E("withdrawals.batchReject",{rejectReason:p.value,ids:r.value});x.value=!1,a.code===0?(i.success("操作成功"),v.value=!1,r.value=[],g()):i.error(a.message)},g=async()=>{var a,e;R.value=!0;try{const h={page:_.current,pageSize:_.pageSize,memberNickname:s.memberNickname,withdrawalStatus:s.withdrawalStatus,startTime:(a=s.timeRange)==null?void 0:a[0],endTime:(e=s.timeRange)==null?void 0:e[1]},c=await me("withdrawals.list",{...h});c.code===0?(O.value=c.data.list||[],_.total=c.data.total||0):i.error(c.message)}finally{R.value=!1}};return ue(()=>{g()}),(a,e)=>{const h=l("a-input"),c=l("a-form-item"),J=l("a-select-option"),Q=l("a-select"),X=l("a-range-picker"),k=l("a-button"),N=l("a-space"),Z=l("a-form"),ee=l("RightOutlined"),ae=l("a-typography-link"),te=l("download-outlined"),ne=l("info-circle-outlined"),oe=l("a-popconfirm"),le=l("a-table"),se=l("a-textarea"),ie=l("a-modal");return u(),y("div",fe,[f("div",ve,[f("div",ge,[f("div",he,[t(Z,{layout:"inline",model:s},{default:n(()=>[t(c,{label:"会员昵称"},{default:n(()=>[t(h,{value:s.memberNickname,"onUpdate:value":e[0]||(e[0]=o=>s.memberNickname=o),placeholder:"请输入会员昵称","allow-clear":""},null,8,["value"])]),_:1}),t(c,{label:"提现状态"},{default:n(()=>[t(Q,{value:s.withdrawalStatus,"onUpdate:value":e[1]||(e[1]=o=>s.withdrawalStatus=o),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:n(()=>[(u(!0),y(D,null,_e(L.value,o=>(u(),$(J,{key:o.value,value:o.value},{default:n(()=>[m(C(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(c,{label:"申请时间"},{default:n(()=>[t(X,{value:s.timeRange,"onUpdate:value":e[2]||(e[2]=o=>s.timeRange=o),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1}),t(c,null,{default:n(()=>[t(N,null,{default:n(()=>[t(k,{type:"primary",onClick:Y},{default:n(()=>[m(C(a.$t("common.search")),1)]),_:1}),t(k,{onClick:F},{default:n(()=>[m(C(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",ke,[t(N,null,{default:n(()=>[t(ae,{onClick:e[3]||(e[3]=o=>I(M).push("/payment-transactions"))},{default:n(()=>[e[6]||(e[6]=m(" 查看提现交易记录")),t(ee)]),_:1}),t(k,{onClick:A},{icon:n(()=>[t(te)]),default:n(()=>[e[7]||(e[7]=m(" 导出 "))]),_:1}),t(k,{type:"primary",onClick:B},{default:n(()=>e[8]||(e[8]=[m("批量打款")])),_:1}),t(k,{danger:"",onClick:P},{default:n(()=>e[9]||(e[9]=[m("批量拒绝")])),_:1})]),_:1})])]),t(le,{columns:U,"data-source":O.value,loading:R.value,pagination:_,rowKey:"id","row-selection":V,onChange:z},{bodyCell:n(({column:o,record:d})=>[o.key==="withdrawalStatus"?(u(),y(D,{key:0},[m(C(I(S).getEnumText("WithdrawalStatus",d.withdrawalStatus))+" ",1),d.withdrawalStatus==="failed"?(u(),$(ne,{key:0,class:"status-icon",onClick:j=>K(d)},null,8,["onClick"])):b("",!0)],64)):b("",!0),o.key==="action"?(u(),y(D,{key:1},[d.withdrawalStatus==="pending"?(u(),$(N,{key:0},{default:n(()=>[t(oe,{title:"确定要标记为已打款吗？",onConfirm:j=>W(d)},{default:n(()=>e[10]||(e[10]=[f("a",null,"打款",-1)])),_:2},1032,["onConfirm"]),f("a",{class:"danger",onClick:j=>q(d)},"拒绝",8,ye)]),_:2},1024)):b("",!0),d.withdrawalStatus==="failed"?(u(),y("a",{key:1,onClick:j=>I(M).push(`/payment-transactions?withdrawalId=${d.id}`)},"查看交易记录",8,be)):b("",!0)],64)):b("",!0)]),_:1},8,["data-source","loading","pagination"])]),t(ie,{open:v.value,"onUpdate:open":e[5]||(e[5]=o=>v.value=o),title:"打款失败原因",onOk:G,confirmLoading:x.value},{default:n(()=>[t(se,{value:p.value,"onUpdate:value":e[4]||(e[4]=o=>p.value=o),placeholder:"请输入打款失败原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ne=re(Ce,[["__scopeId","data-v-4fa4c234"]]);export{Ne as default};
