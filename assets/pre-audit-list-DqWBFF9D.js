import{_ as Ae,a as $e,b as Ce,j as K,r as _,c as J,k as Ie,d as f,e as v,f as n,s as b,w as l,g as i,y as Q,x as Pe,h as Re,l as N,m as h,o,F as w,n as R,p as y,i as c,t as r,q as je,M as Ne,A as X}from"./index-_Ujq24cd.js";import{d as Oe}from"./download-BETrgU0z.js";import{d as De,e as Me}from"./routeParamsEncryption-BKFTaOaF.js";import{G as Ye}from"./GroupOwner-D_0O_wQf.js";const We={class:"task-audit content-container"},Ee={class:"table-container"},He={class:"table-header"},Ue={style:{width:"100%",display:"flex","justify-content":"space-between"}},Fe=["onClick"],Be={class:"danger"},Le={key:0,class:"count-container"},qe={__name:"pre-audit-list",setup(ze){const O=$e(),{t:d}=Ce(),Z=K(()=>O.loaded?O.getEnumOptions("TaskPreAuditStatus"):[]),D=Pe(),M=Re(),Y=_(!1),C=_(!1),W=_(!1),S=_(""),k=_([]),U=()=>{const e=Q().startOf("month").format("YYYY-MM-DD HH:mm:ss"),t=Q().endOf("month").format("YYYY-MM-DD HH:mm:ss");return[e,t]},ee=()=>{const e=D.query.filters;if(e){const t={},p=De(e);console.log(p),Object.keys(p).forEach(T=>{T==="current"?g.current=p[T]:t[T]=p[T]}),Object.assign(s,{taskPreAuditStatus:null},t);const u={...D.query};delete u.filters,M.replace({path:D.path,query:u})}},s=J({taskName:"",channelId:void 0,taskPreAuditStatus:"pending",preWaiterId:void 0,groupId:void 0,submitTimeRange:U(),completedTaskCount:void 0,keyword:""}),F=_([]),B=_([]),E=_([]),te=K(()=>[{title:d("submittedTasks.list.taskName"),key:"taskName"},{title:d("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:d("submittedTasks.list.memberInfo"),key:"member"},{title:d("submittedTasks.list.status"),dataIndex:"taskPreAuditStatus",key:"taskPreAuditStatus"},{title:d("submittedTasks.rejectTimes"),dataIndex:"rejectTimes",key:"rejectTimes"},{title:d("submittedTasks.preAuditor"),key:"preWaiterName"},{title:d("submittedTasks.preAuditTime"),key:"preAuditTime"},{title:d("submittedTasks.list.action"),key:"action",fixed:"right",width:180}]),I=_([]),L=_(0),g=J({current:1,pageSize:10,total:0}),ae={selectedRowKeys:k,onChange:e=>{k.value=e},getCheckboxProps:e=>({disabled:e.taskPreAuditStatus!=="pending"})},q=()=>{g.current=1,H()},se=()=>{Object.assign(s,{taskName:"",channelId:void 0,taskPreAuditStatus:"pending",preWaiterId:void 0,groupId:void 0,submitTimeRange:U(),completedTaskCount:void 0,keyword:""}),q()},le=e=>{Object.assign(g,e),H()},ne=e=>{M.push(`/member/view/${e.memberId}`)},oe=e=>{const t=Me({...s,current:g.current});M.push({path:`/submitted-tasks/detail/${e.id}`,query:{type:"pre",filters:t}})},re=async e=>{k.value=[e.id],z()},z=async()=>{if(!k.value.length){h.warning(d("submittedTasks.list.selectTask"));return}const e=await X("taskSubmitted.batchPreAuditApprove",{ids:k.value});e.code===0?(h.success(d("submittedTasks.resolveSuccess")),I.value.forEach(t=>{k.value.includes(t.id)&&(t.taskPreAuditStatus="approved")}),k.value=[]):h.error(e.message)},ue=e=>{k.value=[e.id],S.value="",C.value=!0},ie=async()=>{if(!S.value){h.error(d("submittedTasks.rejectReasonRequired"));return}W.value=!0;try{await X("taskSubmitted.batchPreAuditReject",{ids:k.value,reason:S.value}),h.success(d("submittedTasks.rejectSuccess")),C.value=!1,I.value.forEach(e=>{k.value.includes(e.id)&&(e.taskPreAuditStatus="rejected")}),k.value=[]}catch(e){h.error(e.message)}finally{W.value=!1}},de=()=>{if(!k.value.length){h.warning(d("submittedTasks.list.selectTask"));return}S.value="",C.value=!0},ce=async()=>{const e=await N("channel.list");e.code===0&&(F.value=e.data.list)},me=()=>{Ne.confirm({title:d("common.export"),content:d("common.confirmExportContent"),onOk:async()=>{var e,t;try{const p=h.loading(d("common.exporting"),0),u={taskName:s.taskName,channelId:s.channelId,taskPreAuditStatus:s.taskPreAuditStatus,preWaiterId:s.preWaiterId,groupId:s.groupId,submitStartTime:(e=s.submitTimeRange)==null?void 0:e[0],submitEndTime:(t=s.submitTimeRange)==null?void 0:t[1],completedTaskCount:s.completedTaskCount,keyword:s.keyword};await Oe("taskSubmitted.preAuditExport",u,`初审列表_${new Date().toLocaleDateString()}.xlsx`),p(),h.success(d("common.exportSuccess"))}catch(p){console.error("导出失败:",p),h.error(d("common.exportFailed"))}}})},V=async(e="")=>{try{const t=await N("group.list",{page:1,pageSize:50,keyword:e});t.code===0&&(B.value=t.data.list||[])}catch{h.error("获取群组列表失败")}},H=async()=>{var e,t;Y.value=!0;try{const p={page:g.current,pageSize:g.pageSize,taskName:s.taskName,channelId:s.channelId,taskPreAuditStatus:s.taskPreAuditStatus,preWaiterId:s.preWaiterId,groupId:s.groupId,submitStartTime:(e=s.submitTimeRange)==null?void 0:e[0],submitEndTime:(t=s.submitTimeRange)==null?void 0:t[1],completedTaskCount:s.completedTaskCount,keyword:s.keyword},u=await N("taskSubmitted.preAuditList",{...p});u.code===0?(I.value=u.data.list,g.total=u.data.total,L.value=u.data.totalAmount):h.error(u.message)}finally{Y.value=!1}},pe=async()=>{if(E.value.length)return;const e=await N("waiter.list",{page:1,pageSize:100});if(e.code===0){const t={id:0,username:"无"};E.value=[t,...e.data.list]}};return Ie(()=>{ee(),H(),V(),ce(),pe()}),(e,t)=>{const p=i("a-input"),u=i("a-form-item"),T=i("a-select-option"),j=i("a-select"),ke=i("a-range-picker"),fe=i("a-input-number"),ve=i("a-form"),P=i("a-button"),A=i("a-space"),be=i("DownloadOutlined"),he=i("a-avatar"),ye=i("a-typography-link"),ge=i("a-tag"),x=i("a-popconfirm"),_e=i("a-table"),G=i("a-descriptions-item"),Te=i("a-descriptions"),we=i("a-textarea"),Se=i("a-modal");return o(),f("div",We,[v("div",Ee,[v("div",He,[n(ve,{layout:"inline",model:s},{default:l(()=>[n(u,{label:e.$t("submittedTasks.search.taskName")},{default:l(()=>[n(p,{value:s.taskName,"onUpdate:value":t[0]||(t[0]=a=>s.taskName=a),placeholder:e.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("submittedTasks.search.channel")},{default:l(()=>[n(j,{value:s.channelId,"onUpdate:value":t[1]||(t[1]=a=>s.channelId=a),placeholder:e.$t("submittedTasks.search.channelPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:l(()=>[(o(!0),f(w,null,R(F.value,a=>(o(),y(T,{key:a.id,value:a.id},{default:l(()=>[c(r(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("submittedTasks.search.submitTime")},{default:l(()=>[n(ke,{value:s.submitTimeRange,"onUpdate:value":t[2]||(t[2]=a=>s.submitTimeRange=a),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),n(u,{label:e.$t("submittedTasks.search.taskPreAuditStatus")},{default:l(()=>[n(j,{value:s.taskPreAuditStatus,"onUpdate:value":t[3]||(t[3]=a=>s.taskPreAuditStatus=a),placeholder:e.$t("submittedTasks.search.taskPreAuditStatusPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:l(()=>[(o(!0),f(w,null,R(Z.value,a=>(o(),y(T,{key:a.value,value:a.value},{default:l(()=>[c(r(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("submittedTasks.search.preAuditor")},{default:l(()=>[n(j,{value:s.preWaiterId,"onUpdate:value":t[4]||(t[4]=a=>s.preWaiterId=a),placeholder:e.$t("submittedTasks.search.preAuditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:l(()=>[(o(!0),f(w,null,R(E.value,a=>(o(),y(T,{key:a.id,value:a.id},{default:l(()=>[c(r(a.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("submittedTasks.search.groupId")},{default:l(()=>[n(j,{value:s.groupId,"onUpdate:value":t[5]||(t[5]=a=>s.groupId=a),placeholder:e.$t("submittedTasks.search.groupIdPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:V},{default:l(()=>[(o(!0),f(w,null,R(B.value,a=>(o(),y(T,{key:a.id,value:a.id},{default:l(()=>[c(r(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("submittedTasks.search.completedTaskCount")},{default:l(()=>[n(fe,{value:s.completedTaskCount,"onUpdate:value":t[6]||(t[6]=a=>s.completedTaskCount=a),min:0,max:9999,"addon-after":e.$t("submittedTasks.search.times"),style:{width:"100px!important"}},null,8,["value","addon-after"])]),_:1},8,["label"]),n(u,{label:e.$t("member.search.keyword")},{default:l(()=>[n(p,{value:s.keyword,"onUpdate:value":t[7]||(t[7]=a=>s.keyword=a),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"]),v("div",Ue,[v("div",null,[n(A,null,{default:l(()=>[n(P,{type:"primary",onClick:q},{default:l(()=>[c(r(e.$t("common.search")),1)]),_:1}),n(P,{onClick:se},{default:l(()=>[c(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),v("div",null,[n(A,null,{default:l(()=>[I.value.length?(o(),y(P,{key:0,onClick:me},{icon:l(()=>[n(be)]),default:l(()=>[c(" "+r(e.$t("common.export")),1)]),_:1})):b("",!0),n(P,{type:"primary",onClick:z},{default:l(()=>[c(r(e.$t("common.batchResolve")),1)]),_:1}),n(P,{danger:"",onClick:de},{default:l(()=>[c(r(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),n(_e,{columns:te.value,"data-source":I.value,loading:Y.value,pagination:g,"row-selection":ae,rowKey:"id",onChange:le},{bodyCell:l(({column:a,record:m})=>[a.key==="taskName"?(o(),y(A,{key:0},{default:l(()=>[n(he,{src:m.channelIcon,size:"small"},null,8,["src"]),v("span",null,r(m.taskName),1)]),_:2},1024)):b("",!0),a.key==="taskPreAuditStatus"?(o(),f(w,{key:1},[c(r(je(O).getEnumText("TaskPreAuditStatus",m.taskPreAuditStatus)),1)],64)):b("",!0),a.key==="preWaiterName"?(o(),f(w,{key:2},[c(r(m.preWaiterName||"--"),1)],64)):b("",!0),a.key==="preAuditTime"?(o(),f(w,{key:3},[c(r(m.preAuditTime||"--"),1)],64)):b("",!0),a.key==="member"?(o(),f(w,{key:4},[v("div",null,[n(A,null,{default:l(()=>[n(ye,{onClick:$=>ne(m)},{default:l(()=>[c(r(m.nickname),1)]),_:2},1032,["onClick"]),m.isNew?(o(),y(ge,{key:0,color:"green"},{default:l(()=>t[10]||(t[10]=[c("new")])),_:1})):b("",!0)]),_:2},1024)]),v("div",null,r(m.account),1),(o(!0),f(w,null,R(m.groups,$=>(o(),f("div",null,[n(A,null,{default:l(()=>[v("span",null,r($.groupName),1),$.isOwner?(o(),y(Ye,{key:0})):b("",!0)]),_:2},1024)]))),256))],64)):b("",!0),a.key==="action"?(o(),y(A,{key:5},{default:l(()=>[v("a",{onClick:$=>oe(m)},r(e.$t("submittedTasks.list.view")),9,Fe),m.taskPreAuditStatus==="pending"?(o(),y(x,{key:0,title:e.$t("submittedTasks.list.confirmResolve"),onConfirm:$=>re(m)},{default:l(()=>[v("a",null,r(e.$t("submittedTasks.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):b("",!0),m.taskPreAuditStatus==="pending"?(o(),y(x,{key:1,title:e.$t("submittedTasks.list.confirmReject"),onConfirm:$=>ue(m)},{default:l(()=>[v("a",Be,r(e.$t("submittedTasks.list.reject")),1)]),_:2},1032,["title","onConfirm"])):b("",!0)]),_:2},1024)):b("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),g.total?(o(),f("div",Le,[n(Te,{column:2},{default:l(()=>[n(G,{label:e.$t("common.totalCount")},{default:l(()=>[c(r(g.total),1)]),_:1},8,["label"]),n(G,{label:e.$t("common.totalAmount")},{default:l(()=>[c(r(L.value),1)]),_:1},8,["label"])]),_:1})])):b("",!0)]),n(Se,{open:C.value,"onUpdate:open":t[9]||(t[9]=a=>C.value=a),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:ie,confirmLoading:W.value},{default:l(()=>[n(we,{value:S.value,"onUpdate:value":t[8]||(t[8]=a=>S.value=a),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Je=Ae(qe,[["__scopeId","data-v-86d841b9"]]);export{Je as default};
