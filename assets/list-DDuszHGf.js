import{_ as Z,a as ee,b as te,r as x,c as E,x as ae,j as oe,k as ne,d,e as r,f as a,w as t,g as c,l as T,m as h,h as se,o,F as y,n as I,p as k,i as p,t as n,s as _,q as le,M as re,v as ie}from"./index-5tvnBsaR.js";import{_ as ce}from"./CopyContent-DlVdBYlp.js";import{G as me}from"./GroupOwner-CxeDsNfX.js";import{d as ue}from"./download-DPoD6g2H.js";const de={class:"member-list content-container"},pe={class:"table-container"},_e={class:"table-header"},ge={class:"left"},fe={class:"right"},he={key:1,style:{display:"inline-block"}},ke={class:"link-text-container"},be={class:"label"},ye=["href"],ve={key:0},we=["onClick"],$e=["onClick"],Ce={class:"danger"},Ne={__name:"list",setup(Se){const B=ee(),{t:i}=te(),$=se(),L=ae(),C=x(!1),g=E({memberNickname:"",groupId:L.query.groupId}),N=x([]),f=E({current:1,pageSize:10,total:0}),D=x([]),U=oe(()=>[{title:i("member.list.memberNickname"),key:"nickname"},{title:i("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:i("member.list.accounts"),key:"accountList"},{title:i("member.list.inviter"),key:"inviterNickname"},{title:i("member.list.group"),key:"groups"},{title:i("member.list.updateTime"),dataIndex:"updateTime",key:"updateTime",width:180},{title:i("member.list.action"),key:"action",fixed:"right",width:150}]),O=()=>{f.current=1,v()},V=()=>{Object.assign(g,{memberNickname:"",groupId:void 0}),O()},F=e=>{f.current=e.current,f.pageSize=e.pageSize,v()},M=()=>{$.push("/member/create")},G=e=>{$.push(`/member/edit/${e.id}`)},P=e=>{$.push(`/member/view/${e.id}`)},R=async e=>{const s=await ie("member.delete",{},{urlParams:{id:e.id}});s.code===0?(h.success("删除成功"),v()):h.error(s.message)},v=async()=>{C.value=!0;try{const e=await T("member.list",{page:f.current,pageSize:f.pageSize,...g});e.code===0?(N.value=e.data.list,f.total=e.data.total):h.error(e.message)}finally{C.value=!1}},z=async(e="")=>{try{const s=await T("group.list",{page:1,pageSize:50,groupName:e});s.code===0&&(D.value=s.data.list||[])}catch{h.error("获取群组列表失败")}},j=()=>{re.confirm({title:i("common.export"),content:i("common.confirmExportContent"),onOk:async()=>{try{const e=h.loading(i("common.exporting"),0),s={...g};await ue("member.export",s,`会员列表_${new Date().toLocaleDateString()}.xlsx`),e(),h.success(i("common.exportSuccess"))}catch(e){console.error("导出失败:",e),h.error(i("common.exportFailed"))}}})};return ne(()=>{v(),z()}),(e,s)=>{const q=c("a-input"),S=c("a-form-item"),H=c("a-select-option"),J=c("a-select"),w=c("a-button"),b=c("a-space"),K=c("a-form"),Q=c("DownloadOutlined"),W=c("plus-outlined"),A=c("a-tag"),X=c("a-popconfirm"),Y=c("a-table");return o(),d("div",de,[r("div",pe,[r("div",_e,[r("div",ge,[a(K,{layout:"inline",model:g},{default:t(()=>[a(S,{label:e.$t("member.search.memberNickname")},{default:t(()=>[a(q,{value:g.memberNickname,"onUpdate:value":s[0]||(s[0]=l=>g.memberNickname=l),placeholder:e.$t("member.search.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(S,{label:e.$t("member.search.group")},{default:t(()=>[a(J,{value:g.groupId,"onUpdate:value":s[1]||(s[1]=l=>g.groupId=l),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:z,style:{width:"200px"}},{default:t(()=>[(o(!0),d(y,null,I(D.value,l=>(o(),k(H,{key:l.id,value:l.id},{default:t(()=>[p(n(l.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(S,null,{default:t(()=>[a(b,null,{default:t(()=>[a(w,{type:"primary",onClick:O},{default:t(()=>[p(n(e.$t("common.search")),1)]),_:1}),a(w,{onClick:V},{default:t(()=>[p(n(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),r("div",fe,[a(b,null,{default:t(()=>[N.value.length?(o(),k(w,{key:0,onClick:j},{icon:t(()=>[a(Q)]),default:t(()=>[p(" "+n(e.$t("common.export")),1)]),_:1})):_("",!0),a(w,{type:"primary",onClick:M},{icon:t(()=>[a(W)]),default:t(()=>[p(" "+n(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),a(Y,{columns:U.value,"data-source":N.value,loading:C.value,pagination:f,onChange:F},{bodyCell:t(({column:l,record:u})=>[l.key==="nickname"?(o(),k(b,{key:0},{default:t(()=>[r("span",null,n(u.nickname),1),u.isNew?(o(),k(A,{key:0,color:"green"},{default:t(()=>s[2]||(s[2]=[p("new")])),_:1})):_("",!0)]),_:2},1024)):_("",!0),l.key==="accountList"?(o(),d("div",he,[(o(!0),d(y,null,I(u.accountList,m=>(o(),d("div",null,[r("div",null,[a(b,null,{default:t(()=>[p(n(e.$t("member.list.account"))+"："+n(m.account)+" ",1),a(A,{color:"warning"},{default:t(()=>[p(n(le(B).getEnumText("AccountAuditStatus",m.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),r("div",ke,[r("span",be,n(e.$t("member.list.homepage"))+"：",1),a(ce,{content:m.homeUrl},{default:t(()=>[r("a",{href:m.homeUrl,target:"_blank",class:"link-text"},n(m.homeUrl),9,ye)]),_:2},1032,["content"])])]))),256))])):_("",!0),l.key==="inviterNickname"?(o(),d(y,{key:2},[p(n(u.inviterNickname||"--"),1)],64)):_("",!0),l.key==="groups"?(o(),d(y,{key:3},[(o(!0),d(y,null,I(u.groups,m=>(o(),k(b,null,{default:t(()=>[r("span",null,n(m.groupName),1),m.isOwner?(o(),k(me,{key:0})):_("",!0)]),_:2},1024))),256)),!u.groups||u.groups.length===0?(o(),d("span",ve,"--")):_("",!0)],64)):_("",!0),l.key==="action"?(o(),k(b,{key:4},{default:t(()=>[r("a",{onClick:m=>G(u)},n(e.$t("member.list.edit")),9,we),r("a",{onClick:m=>P(u)},n(e.$t("member.list.view")),9,$e),a(X,{title:e.$t("member.list.deleteConfirm"),onConfirm:m=>R(u)},{default:t(()=>[r("a",Ce,n(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},ze=Z(Ne,[["__scopeId","data-v-9e61ec8c"]]);export{ze as default};
