import{_ as fe,a as ve,c as ge,r as w,e as j,z as ke,d as ye,o as he,f as g,g as u,h as n,x as k,w as a,i as c,j as be,p as D,q as C,k as r,F as T,m as N,n as y,l as m,t as s,v as we,M as Ce,y as Te}from"./index-BepA_qxU.js";import{_ as L}from"./CopyContent-DlwWHkS0.js";import{G as $e}from"./GroupOwner-CKeWuvFT.js";import{d as Ie}from"./download-CdGqgC6o.js";import{d as Se,e as V}from"./routeParamsEncryption-BKFTaOaF.js";const Oe={class:"content-container"},De={class:"table-container"},Ne={class:"table-header"},Me={class:"left"},Re={class:"right"},ze={class:"link-text-container"},Ee={class:"label"},Fe=["href"],Ae={key:1},Ue={style:{color:"#999","font-size":"12px"}},Be={key:0},Ye=["onClick"],qe=["onClick"],He={key:0,class:"count-container"},Pe={__name:"list",setup(je){const x=ve(),{t:p}=ge(),$=be(),I=ke(),M=w(!1),o=j({keyword:"",channelId:void 0,groupId:I.query.groupId,inviter:"",completedTaskCount:void 0,createTimeRange:[]}),R=w([]),F=w(0),A=w(0),_=j({current:1,pageSize:10,total:0}),U=w([]),G=ye(()=>[{title:p("member.list.memberNickname"),key:"nickname"},{title:p("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:p("member.list.accounts"),key:"accountList"},{title:p("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:p("member.list.inviter"),key:"inviterNickname"},{title:p("member.list.group"),key:"groups"},{title:p("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:p("member.list.action"),key:"action",width:150}]),J=()=>{const e=I.query.filters;if(e){const t={},f=Se(e);Object.keys(f).forEach(h=>{h==="current"?_.current=f[h]:t[h]=f[h]}),Object.assign(o,{},t);const i={...I.query};delete i.filters,$.replace({path:I.path,query:i})}},B=()=>{_.current=1,S()},K=()=>{Object.assign(o,{keyword:"",channelId:void 0,groupId:void 0,inviter:"",completedTaskCount:void 0,createTimeRange:[]}),B()},Q=e=>{_.current=e.current,_.pageSize=e.pageSize,S()},W=()=>{$.push("/member/create")},X=e=>{const t=V({...o,current:_.current});$.push({name:"MemberEdit",params:{id:e.id},query:{filters:t}})},Y=e=>{const t=V({...o,current:_.current});$.push({name:"MemberView",params:{id:e},query:{filters:t}})},Z=async e=>{const t=await Te("member.delete",{},{urlParams:{id:e.id}});t.code===0?(C.success("删除成功"),S()):C.error(t.message)},S=async()=>{var e,t;M.value=!0;try{const f={page:_.current,pageSize:_.pageSize,keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviter:o.inviter,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(t=o.createTimeRange)==null?void 0:t[1]},i=await D("member.list",f);i.code===0?(R.value=i.data.list,_.total=i.data.total,F.value=i.data.totalApproved,A.value=i.data.totalBalance):C.error(i.message)}finally{M.value=!1}},q=async(e="")=>{try{const t=await D("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(U.value=t.data.list||[])}catch{C.error("获取群组列表失败")}},ee=()=>{Ce.confirm({title:p("common.export"),content:p("common.confirmExportContent"),onOk:async()=>{var e,t;try{const f=C.loading(p("common.exporting"),0),i={keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviter:o.inviter,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(t=o.createTimeRange)==null?void 0:t[1]};await Ie("member.export",i,`会员列表_${new Date().toLocaleDateString()}.xlsx`),f(),C.success(p("common.exportSuccess"))}catch(f){console.error("导出失败:",f),C.error(p("common.exportFailed"))}}})},te=w([]),ae=async(e="")=>{const t=await D("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(te.value=t.data.list||[])},z=w([]),ne=async()=>{if(!z.value.length)try{const e=await D("channel.list");e.code===0&&(z.value=e.data.list)}catch(e){console.error(e)}};return he(()=>{J(),S(),q(),ne(),ae()}),(e,t)=>{const f=c("a-input"),i=c("a-form-item"),h=c("a-select-option"),H=c("a-select"),oe=c("a-input-number"),le=c("a-range-picker"),O=c("a-button"),b=c("a-space"),re=c("a-form"),se=c("DownloadOutlined"),ie=c("plus-outlined"),P=c("a-tag"),ce=c("a-avatar"),ue=c("a-typography-link"),de=c("a-typography-text"),me=c("a-popconfirm"),pe=c("a-table"),E=c("a-descriptions-item"),_e=c("a-descriptions");return r(),g("div",Oe,[u("div",De,[u("div",Ne,[u("div",Me,[n(re,{layout:"inline",model:o},{default:a(()=>[n(i,{label:e.$t("member.search.keyword")},{default:a(()=>[n(f,{value:o.keyword,"onUpdate:value":t[0]||(t[0]=l=>o.keyword=l),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("common.channel")},{default:a(()=>[n(H,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=l=>o.channelId=l),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:a(()=>[(r(!0),g(T,null,N(z.value,l=>(r(),y(h,{key:l.id,value:l.id},{default:a(()=>[m(s(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("member.search.group")},{default:a(()=>[n(H,{value:o.groupId,"onUpdate:value":t[2]||(t[2]=l=>o.groupId=l),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:q},{default:a(()=>[(r(!0),g(T,null,N(U.value,l=>(r(),y(h,{key:l.id,value:l.id},{default:a(()=>[m(s(l.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("member.search.inviter")},{default:a(()=>[n(f,{value:o.inviter,"onUpdate:value":t[3]||(t[3]=l=>o.inviter=l),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("member.list.completedTaskCount")},{default:a(()=>[n(oe,{value:o.completedTaskCount,"onUpdate:value":t[4]||(t[4]=l=>o.completedTaskCount=l),min:0,max:9999},null,8,["value"])]),_:1},8,["label"]),n(i,{label:e.$t("member.search.createTime")},{default:a(()=>[n(le,{value:o.createTimeRange,"onUpdate:value":t[5]||(t[5]=l=>o.createTimeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),n(i,null,{default:a(()=>[n(b,null,{default:a(()=>[n(O,{type:"primary",onClick:B},{default:a(()=>[m(s(e.$t("common.search")),1)]),_:1}),n(O,{onClick:K},{default:a(()=>[m(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",Re,[n(b,null,{default:a(()=>[R.value.length?(r(),y(O,{key:0,onClick:ee},{icon:a(()=>[n(se)]),default:a(()=>[m(" "+s(e.$t("common.export")),1)]),_:1})):k("",!0),n(O,{type:"primary",onClick:W},{icon:a(()=>[n(ie)]),default:a(()=>[m(" "+s(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),n(pe,{columns:G.value,"data-source":R.value,loading:M.value,pagination:_,onChange:Q},{bodyCell:a(({column:l,record:v})=>[l.key==="nickname"?(r(),y(b,{key:0},{default:a(()=>[u("span",null,s(v.nickname),1),v.isNew?(r(),y(P,{key:0,color:"green"},{default:a(()=>t[6]||(t[6]=[m("new")])),_:1})):k("",!0)]),_:2},1024)):k("",!0),l.key==="accountList"?(r(),y(b,{key:1,direction:"vertical"},{default:a(()=>[(r(!0),g(T,null,N(v.accountList,d=>(r(),g("div",null,[u("div",null,[n(b,null,{default:a(()=>[m(s(e.$t("member.list.account"))+"：",1),n(ce,{src:d.channelIcon,size:"small"},null,8,["src"]),m(" "+s(d.account)+" ",1),n(P,{color:"warning"},{default:a(()=>[m(s(we(x).getEnumText("AccountAuditStatus",d.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),u("div",ze,[u("span",Ee,s(e.$t("member.list.homepage"))+"：",1),n(L,{content:d.homeUrl},{default:a(()=>[u("a",{href:d.homeUrl,target:"_blank",class:"link-text"},s(d.homeUrl),9,Fe)]),_:2},1032,["content"])]),u("div",null,[t[7]||(t[7]=u("span",{class:"label"},"uid：",-1)),n(L,{content:d.uid},null,8,["content"])])]))),256))]),_:2},1024)):k("",!0),l.key==="inviterNickname"?(r(),g(T,{key:2},[v.inviterId?(r(),y(ue,{key:0,onClick:d=>Y(v.inviterId)},{default:a(()=>[m(s(v.inviterNickname),1)]),_:2},1032,["onClick"])):(r(),g("span",Ae,"--"))],64)):k("",!0),l.key==="groups"?(r(),g(T,{key:3},[(r(!0),g(T,null,N(v.groups,d=>(r(),g("div",null,[n(b,null,{default:a(()=>[u("span",null,s(d.groupName),1),d.isOwner?(r(),y($e,{key:0})):k("",!0)]),_:2},1024),u("div",Ue,s(d.joinTime),1)]))),256)),!v.groups||v.groups.length===0?(r(),g("span",Be,"--")):k("",!0)],64)):k("",!0),l.key==="action"?(r(),y(b,{key:4},{default:a(()=>[u("a",{onClick:d=>X(v)},s(e.$t("member.list.edit")),9,Ye),u("a",{onClick:d=>Y(v.id)},s(e.$t("member.list.view")),9,qe),n(me,{title:e.$t("member.list.deleteConfirm"),onConfirm:d=>Z(v)},{default:a(()=>[u("a",null,[n(de,{type:"danger"},{default:a(()=>[m(s(e.$t("member.list.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),_.total?(r(),g("div",He,[n(_e,{column:{xs:1,sm:1,md:3,lg:3}},{default:a(()=>[n(E,{label:e.$t("member.list.totalCount")},{default:a(()=>[m(s(_.total),1)]),_:1},8,["label"]),n(E,{label:e.$t("member.list.totalApproved")},{default:a(()=>[m(s(F.value),1)]),_:1},8,["label"]),n(E,{label:e.$t("member.list.totalBalance")},{default:a(()=>[m(s(A.value),1)]),_:1},8,["label"])]),_:1})])):k("",!0)])])}}},Ke=fe(Pe,[["__scopeId","data-v-ea20f6b1"]]);export{Ke as default};
