import{g as W,p as b}from"./request-DxnL66JX.js";import{_ as X,r as c,a as C,p as Y,j as Z,b as w,d as p,c as o,w as n,e as i,o as _,h as A,m as D,n as y,F as ee,l as ae,t as te,k as r}from"./index-CrTl1_Bc.js";const se={class:"account content-container"},oe={class:"table-container"},ne={class:"table-header"},ie={class:"right"},re=["onClick"],le={__name:"index",setup(ce){const k=c(!1),l=c(!1),g=c(!1),m=c("add"),h=c(),t=C({username:"",password:"",remarks:"",permissions:[]}),V={username:[{required:!0,message:"请输入用户名"}],password:[{required:!0,message:"请输入密码",trigger:"change"}]},B=[{title:"task",permissions:"task:list"},{title:"taskCreate",permissions:"task:create"},{title:"taskEdit",permissions:"task:edit"},{title:"taskView",permissions:"task:view"},{title:"accountAudit",permissions:"account:audit"},{title:"taskAudit",permissions:"task:audit"},{title:"taskAuditDetail",permissions:"task:auditDetail"},{title:"member",permissions:"member:list"},{title:"memberCreate",permissions:"member:create"},{title:"memberEdit",permissions:"member:edit"},{title:"memberView",permissions:"member:view"},{title:"channel",permissions:"channel:list"},{title:"group",permissions:"group:list"},{title:"withdrawal",permissions:"settlement:withdrawal"},{title:"otherBills",permissions:"settlement:otherBills"},{title:"account",permissions:"account:list"},{title:"article",permissions:"article:list"}],U=[{title:"账号名称",dataIndex:"username",key:"username"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"操作",key:"action",width:200}],x=c([]),u=C({current:1,pageSize:10,total:0}),q=Y(()=>m.value==="add"?"添加账号":"编辑账号"),E=e=>{Object.assign(u,e),d()},L=()=>{m.value="add",t.username="",t.password="",t.remarks="",t.permissions=[],l.value=!0},N=e=>{m.value="edit",t.username=e.username,t.password="",t.remarks=e.remarks,t.permissions=e.permissions,l.value=!0},O=async e=>{try{const a=await b("account.delete",{id:e.id});a.success?(r.success("删除成功"),d()):r.error(a.message)}catch{r.error("删除失败")}},S=async()=>{const e=await b("account.add",t);e.success?(r.success("添加成功"),l.value=!1,d()):r.error(e.message)},T=async()=>{const e=await b("account.edit",t);e.success?(r.success("编辑成功"),l.value=!1,d()):r.error(e.message)},z=async()=>{try{switch(await h.value.validate(),g.value=!0,m.value){case"add":S();break;case"edit":T();break}}catch(e){console.error(e)}finally{g.value=!1}},d=async()=>{k.value=!0;try{const e=await W("account.list",{page:u.current,pageSize:u.pageSize});x.value=e.data.list,u.total=e.data.total}finally{k.value=!1}};return Z(()=>{d()}),(e,a)=>{const F=i("a-button"),I=i("a-popconfirm"),$=i("a-space"),j=i("a-table"),R=i("a-input"),f=i("a-form-item"),M=i("a-input-password"),G=i("a-textarea"),H=i("a-checkbox"),J=i("a-checkbox-group"),K=i("a-form"),P=i("a-modal");return _(),w("div",se,[p("div",oe,[p("div",ne,[a[6]||(a[6]=p("div",{class:"left"},null,-1)),p("div",ie,[o(F,{type:"primary",onClick:L},{default:n(()=>a[5]||(a[5]=[A(" 添加账号 ")])),_:1})])]),o(j,{columns:U,"data-source":x.value,loading:k.value,pagination:u,onChange:E},{bodyCell:n(({column:s,record:v})=>[s.key==="action"?(_(),D($,{key:0},{default:n(()=>[v.isAdmin?y("",!0):(_(),w("a",{key:0,onClick:Q=>N(v)},"编辑",8,re)),v.isAdmin?y("",!0):(_(),D(I,{key:1,title:"确定要删除该账号吗？",onConfirm:Q=>O(v)},{default:n(()=>a[7]||(a[7]=[p("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"]))]),_:2},1024)):y("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(P,{open:l.value,"onUpdate:open":a[4]||(a[4]=s=>l.value=s),title:q.value,confirmLoading:g.value,onOk:z},{default:n(()=>[o(K,{ref_key:"formRef",ref:h,model:t,rules:V,"label-col":{span:6},"wrapper-col":{span:16}},{default:n(()=>[o(f,{label:"用户名",name:"username"},{default:n(()=>[o(R,{value:t.username,"onUpdate:value":a[0]||(a[0]=s=>t.username=s),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),o(f,{label:"密码",name:"password",required:m.value==="add"},{default:n(()=>[o(M,{value:t.password,"onUpdate:value":a[1]||(a[1]=s=>t.password=s),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["required"]),o(f,{label:"备注",name:"remarks"},{default:n(()=>[o(G,{value:t.remarks,"onUpdate:value":a[2]||(a[2]=s=>t.remarks=s),placeholder:"请输入备注",rows:3},null,8,["value"])]),_:1}),o(f,{label:"权限",name:"permissions"},{default:n(()=>[o(J,{value:t.permissions,"onUpdate:value":a[3]||(a[3]=s=>t.permissions=s)},{default:n(()=>[(_(),w(ee,null,ae(B,s=>o(H,{key:s.title,value:s.permissions},{default:n(()=>[A(te(e.$t("menu."+s.title)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},de=X(le,[["__scopeId","data-v-c02540b6"]]);export{de as default};
