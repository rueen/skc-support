import{_ as te,r as C,a as ae,b as se,c as G,j as V,k as le,d as k,e as p,f as s,w as a,g as r,l as O,m as $,h as ne,o as n,F as h,n as P,p as _,i,t as o,q,P as oe,s as v,v as ue}from"./index-D3dto7Pf.js";const re={class:"task content-container"},de={class:"table-container"},ie={class:"table-header"},ce={class:"left"},ke={class:"right"},pe={key:0},me={key:1},_e=["onClick"],fe={class:"danger"},he={__name:"list",setup(ve){const E=ne(),w=C(!1),y=ae(),{t:c}=se(),u=G({taskName:"",channelId:void 0,taskStatus:void 0,taskGroupId:void 0}),F=C([]),j=C([]),Q=V(()=>y.loaded?y.getEnumOptions("TaskStatus"):[]),R=V(()=>[{title:c("task.list.name"),key:"taskName"},{title:c("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:e})=>y.getEnumText("TaskStatus",e)},{title:c("task.list.quota"),key:"taskQuota"},{title:c("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:c("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0},{title:c("task.list.action"),key:"action",fixed:"right",width:180}]),z=C([]),m=G({current:1,pageSize:10,total:0}),B=G({sorterField:void 0,sorterOrder:void 0}),D=()=>{m.current=1,g()},A=()=>{Object.assign(u,{taskName:"",channelId:void 0,taskStatus:void 0,taskGroupId:void 0}),D()},L=(e,l,S)=>{Object.assign(m,e),Object.assign(B,{sorterField:S.field,sorterOrder:S.order}),g()},M=()=>{E.push("/task/create")},x=e=>{E.push(`/task/edit/${e.id}`)},H=async e=>{try{const l=await ue("task.delete",{},{urlParams:{id:e.id}});l.code===0?($.success(c("common.deleteSuccess")),g()):$.error(l.message)}catch{$.error(c("common.deleteFailed"))}},g=async()=>{w.value=!0;try{const e=await O("task.list",{page:m.current,pageSize:m.pageSize,...B,...u});e.code===0?(z.value=e.data.list,m.total=e.data.total):$.error(e.message)}finally{w.value=!1}},J=async()=>{const e=await O("channel.list");e.code===0&&(F.value=e.data.list)},U=async(e="")=>{const l=await O("taskGroup.list",{page:1,pageSize:50,taskGroupName:e});l.code===0&&(j.value=l.data.list||[])};return le(async()=>{g(),J(),U()}),(e,l)=>{const S=r("a-input"),f=r("a-form-item"),I=r("a-select-option"),N=r("a-select"),T=r("a-button"),b=r("a-space"),K=r("a-form"),W=r("a-avatar"),X=r("a-tag"),Y=r("a-popconfirm"),Z=r("a-table");return n(),k("div",re,[p("div",de,[p("div",ie,[p("div",ce,[s(K,{layout:"inline",model:u},{default:a(()=>[s(f,{label:e.$t("task.search.taskName")},{default:a(()=>[s(S,{value:u.taskName,"onUpdate:value":l[0]||(l[0]=t=>u.taskName=t),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.channelId")},{default:a(()=>[s(N,{value:u.channelId,"onUpdate:value":l[1]||(l[1]=t=>u.channelId=t),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:a(()=>[(n(!0),k(h,null,P(F.value,t=>(n(),_(I,{key:t.id,value:t.id},{default:a(()=>[i(o(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.taskStatus")},{default:a(()=>[s(N,{value:u.taskStatus,"onUpdate:value":l[2]||(l[2]=t=>u.taskStatus=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:"",style:{width:"120px"}},{default:a(()=>[(n(!0),k(h,null,P(Q.value,t=>(n(),_(I,{key:t.value,value:t.value},{default:a(()=>[i(o(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.taskGroup")},{default:a(()=>[s(N,{value:u.taskGroupId,"onUpdate:value":l[3]||(l[3]=t=>u.taskGroupId=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:"",style:{width:"120px"},"show-search":"","filter-option":!1,onSearch:U},{default:a(()=>[(n(!0),k(h,null,P(j.value,t=>(n(),_(I,{key:t.id,value:t.id},{default:a(()=>[i(o(t.taskGroupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(b,null,{default:a(()=>[s(T,{type:"primary",onClick:D},{default:a(()=>[i(o(e.$t("common.search")),1)]),_:1}),s(T,{onClick:A},{default:a(()=>[i(o(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),p("div",ke,[s(b,null,{default:a(()=>[s(T,{type:"primary",onClick:M},{icon:a(()=>[s(q(oe))]),default:a(()=>[i(" "+o(e.$t("task.list.create")),1)]),_:1})]),_:1})])]),s(Z,{columns:R.value,"data-source":z.value,loading:w.value,pagination:m,showSorterTooltip:!1,onChange:L},{bodyCell:a(({column:t,record:d})=>[t.key==="taskName"?(n(),_(b,{key:0},{default:a(()=>[s(W,{src:d.channelIcon},null,8,["src"]),i(" "+o(d.taskName)+" ",1),d.taskGroup?(n(),_(X,{key:0,color:"orange"},{default:a(()=>[i(o(d.taskGroup.taskGroupName),1)]),_:2},1024)):v("",!0)]),_:2},1024)):v("",!0),t.key==="taskQuota"?(n(),k(h,{key:1},[d.unlimitedQuota?(n(),k("span",pe,o(e.$t("task.list.unlimited")),1)):(n(),k("span",me,o(d.quota),1)),p("span",null," / "+o(d.submittedCount),1)],64)):v("",!0),t.key==="taskStatus"?(n(),k(h,{key:2},[i(o(q(y).getEnumText("TaskStatus",d.taskStatus)),1)],64)):v("",!0),t.key==="action"?(n(),_(b,{key:3},{default:a(()=>[p("a",{onClick:ee=>x(d)},o(e.$t("task.list.edit")),9,_e),s(Y,{title:e.$t("task.list.deleteConfirm"),onConfirm:ee=>H(d)},{default:a(()=>[p("a",fe,o(e.$t("task.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},ge=te(he,[["__scopeId","data-v-7418f5bf"]]);export{ge as default};
