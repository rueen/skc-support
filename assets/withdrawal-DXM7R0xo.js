import{_ as ue,b as me,a as we,j as U,r as k,c as F,k as he,d as g,e as y,f as a,w as t,g as i,l as pe,m as u,h as ve,o as w,F as $,n as fe,p as R,i as h,t as d,q as O,s as v,M as L,A as P}from"./index-BO9rEvp4.js";import{d as _e}from"./download-0dRhPj-m.js";const ke={class:"withdrawal content-container"},ge={class:"table-container"},ye={class:"table-header"},be={class:"left"},Ne={class:"right"},Se=["onClick"],Ce=["onClick"],$e={__name:"withdrawal",setup(Re){const{t:s}=me(),j=ve(),T=we(),V=U(()=>T.loaded?T.getEnumOptions("WithdrawalStatus"):[]),D=k(!1),b=k(!1),I=k(!1),f=k(""),n=F({billNo:"",memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),A=U(()=>[{title:s("withdrawal.list.billNo"),dataIndex:"billNo",key:"billNo"},{title:s("withdrawal.list.memberNickname"),key:"nickname"},{title:s("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:s("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:s("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:s("withdrawal.list.name"),dataIndex:"withdrawalName",key:"withdrawalName"},{title:s("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:s("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:s("withdrawal.list.operator"),key:"waiterName"},{title:s("withdrawal.list.action"),key:"action",width:150}]),m=k([]),W={selectedRowKeys:m,onChange:e=>{m.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},Y=k([]),_=F({current:1,pageSize:10,total:0}),B=()=>{_.current=1,N()},z=()=>{Object.assign(n,{billNo:"",memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),B()},K=e=>{Object.assign(_,e),N()},q=()=>{L.confirm({title:s("common.export"),content:s("common.confirmExportContent"),onOk:async()=>{var p,r;const e=u.loading("正在导出数据，请稍候...",0),o={billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,startTime:(p=n.timeRange)==null?void 0:p[0],endTime:(r=n.timeRange)==null?void 0:r[1]};try{await _e("withdrawals.export",o,`提现列表_${new Date().toLocaleDateString()}.xlsx`),u.success(s("common.exportSuccess"))}catch(M){console.error("导出失败:",M),u.error(s("common.exportFailed"))}finally{e()}}})},G=e=>{j.push(`/member/view/${e.memberId}`)},J=e=>{L.error({content:e.rejectReason})},Q=async e=>{m.value=[e.id],E()},E=async()=>{if(!m.value.length){u.warning("请选择要操作的记录");return}const e=await P("withdrawals.batchResolve",{ids:m.value});e.code===0?(u.success("操作成功"),m.value=[],N()):u.error(e.message)},X=e=>{m.value=[e.id],f.value="",b.value=!0},Z=()=>{if(!m.value.length){u.warning("请选择要操作的记录");return}f.value="",b.value=!0},ee=async()=>{if(!f.value){u.error("请输入打款失败原因");return}I.value=!0;try{await P("withdrawals.batchReject",{rejectReason:f.value,ids:m.value}),u.success("操作成功"),b.value=!1,m.value=[],N()}catch(e){u.error(e.message)}finally{I.value=!1}},N=async()=>{var e,o;D.value=!0;try{const p={page:_.current,pageSize:_.pageSize,billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,startTime:(e=n.timeRange)==null?void 0:e[0],endTime:(o=n.timeRange)==null?void 0:o[1]},r=await pe("withdrawals.list",{...p});r.code===0?(Y.value=r.data.list||[],_.total=r.data.total||0):u.error(r.message)}finally{D.value=!1}};return he(()=>{N()}),(e,o)=>{const p=i("a-input"),r=i("a-form-item"),M=i("a-select-option"),ae=i("a-select"),te=i("a-range-picker"),S=i("a-button"),x=i("a-space"),le=i("a-form"),ne=i("RightOutlined"),H=i("a-typography-link"),oe=i("download-outlined"),ie=i("info-circle-outlined"),se=i("a-popconfirm"),re=i("a-table"),de=i("a-textarea"),ce=i("a-modal");return w(),g("div",ke,[y("div",ge,[y("div",ye,[y("div",be,[a(le,{layout:"inline",model:n},{default:t(()=>[a(r,{label:e.$t("withdrawal.list.billNo")},{default:t(()=>[a(p,{value:n.billNo,"onUpdate:value":o[0]||(o[0]=l=>n.billNo=l),placeholder:e.$t("withdrawal.list.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(p,{value:n.memberNickname,"onUpdate:value":o[1]||(o[1]=l=>n.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(ae,{value:n.withdrawalStatus,"onUpdate:value":o[2]||(o[2]=l=>n.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(w(!0),g($,null,fe(V.value,l=>(w(),R(M,{key:l.value,value:l.value},{default:t(()=>[h(d(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(te,{value:n.timeRange,"onUpdate:value":o[3]||(o[3]=l=>n.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(r,null,{default:t(()=>[a(x,null,{default:t(()=>[a(S,{type:"primary",onClick:B},{default:t(()=>[h(d(e.$t("common.search")),1)]),_:1}),a(S,{onClick:z},{default:t(()=>[h(d(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),y("div",Ne,[a(x,null,{default:t(()=>[a(H,{onClick:o[4]||(o[4]=l=>O(j).push("/payment-transactions"))},{default:t(()=>[h(d(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(ne)]),_:1}),a(S,{onClick:q},{icon:t(()=>[a(oe)]),default:t(()=>[h(" "+d(e.$t("withdrawal.list.export")),1)]),_:1}),a(S,{type:"primary",onClick:E},{default:t(()=>[h(d(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(S,{danger:"",onClick:Z},{default:t(()=>[h(d(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(re,{columns:A.value,"data-source":Y.value,loading:D.value,pagination:_,rowKey:"id","row-selection":W,onChange:K},{bodyCell:t(({column:l,record:c})=>[l.key==="nickname"?(w(),R(H,{key:0,onClick:C=>G(c)},{default:t(()=>[h(d(c.nickname),1)]),_:2},1032,["onClick"])):v("",!0),l.key==="withdrawalStatus"?(w(),g($,{key:1},[h(d(O(T).getEnumText("WithdrawalStatus",c.withdrawalStatus))+" ",1),c.withdrawalStatus==="failed"?(w(),R(ie,{key:0,class:"danger",onClick:C=>J(c)},null,8,["onClick"])):v("",!0)],64)):v("",!0),l.key==="waiterName"?(w(),g($,{key:2},[h(d(c.waiterName||"--"),1)],64)):v("",!0),l.key==="action"?(w(),g($,{key:3},[c.withdrawalStatus==="pending"?(w(),R(x,{key:0},{default:t(()=>[a(se,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:C=>Q(c)},{default:t(()=>[y("a",null,d(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),y("a",{class:"danger",onClick:C=>X(c)},d(e.$t("withdrawal.list.reject")),9,Se)]),_:2},1024)):v("",!0),c.withdrawalStatus==="failed"?(w(),g("a",{key:1,onClick:C=>O(j).push(`/payment-transactions?withdrawalId=${c.id}`)},"查看交易记录",8,Ce)):v("",!0)],64)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),a(ce,{open:b.value,"onUpdate:open":o[6]||(o[6]=l=>b.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:ee,confirmLoading:I.value},{default:t(()=>[a(de,{value:f.value,"onUpdate:value":o[5]||(o[5]=l=>f.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},De=ue($e,[["__scopeId","data-v-af79e655"]]);export{De as default};
