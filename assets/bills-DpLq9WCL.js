import{_ as ee,b as ae,a as te,j as S,r as w,c as H,k as le,d as u,e as $,f as o,w as n,g as m,l as U,m as x,h as ne,o as t,F as b,n as C,p as k,i as p,t as r,s as f,q as I,M as se}from"./index-CM_LUiVE.js";const ie={class:"other-bill content-container"},oe={class:"table-container"},ue={class:"table-header"},re={class:"left"},de={key:1},me={key:1},pe={key:0},ce={key:1},be={key:0},fe={key:1},ye={__name:"bills",setup(ke){const{t:c}=ae(),y=te(),G=ne(),P=S(()=>y.loaded?y.getEnumOptions("BillType"):[]),z=S(()=>y.loaded?y.getEnumOptions("SettlementStatus"):[]),h=w(!1),l=H({billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",relatedGroupId:void 0}),F=a=>{se.error({title:"结算失败原因",content:a.failureReason})},V=S(()=>[{title:c("financial.bills.billNo"),dataIndex:"billNo",key:"billNo"},{title:c("financial.bills.memberNickname"),key:"memberNickname"},{title:c("financial.bills.billType"),dataIndex:"billType",key:"billType"},{title:c("financial.bills.relatedTaskName"),key:"taskName"},{title:c("financial.bills.relatedGroupName"),key:"relatedGroupName"},{title:c("financial.bills.amount"),dataIndex:"amount",key:"amount",align:"right"},{title:c("financial.bills.remark"),key:"remark"},{title:c("financial.bills.createTime"),dataIndex:"createTime",key:"createTime"},{title:c("financial.bills.settlementStatus"),key:"settlementStatus"}]),R=w([]),_=H({current:1,pageSize:10,total:0}),D=()=>{_.current=1,g()},j=()=>{Object.assign(l,{billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",relatedGroupId:void 0}),D()},q=a=>{Object.assign(_,a),g()},L=a=>{G.push(`/member/view/${a.memberId}`)},W=a=>{G.push(`/submitted-tasks/detail/${a.submittedId}?type=confirm`)},g=async()=>{var a,s;h.value=!0;try{const v={page:_.current,pageSize:_.pageSize,billNo:l.billNo,billType:l.billType,settlementStatus:l.settlementStatus,startTime:(a=l.timeRange)==null?void 0:a[0],endTime:(s=l.timeRange)==null?void 0:s[1],taskName:l.taskName,relatedGroupId:l.relatedGroupId},d=await U("finance.bills",{...v});d.code===0?(R.value=d.data.list,_.total=d.data.total):x.error(d.message)}finally{h.value=!1}},M=w([]),O=async(a="")=>{try{const s=await U("group.list",{page:1,pageSize:50,groupName:a});s.code===0&&(M.value=s.data.list||[])}catch{x.error("获取群组列表失败")}};return le(()=>{g(),O()}),(a,s)=>{const v=m("a-input"),d=m("a-form-item"),N=m("a-select-option"),T=m("a-select"),A=m("a-range-picker"),Y=m("a-button"),J=m("a-space"),K=m("a-form"),E=m("a-typography-link"),Q=m("a-typography-text"),X=m("info-circle-outlined"),Z=m("a-table");return t(),u("div",ie,[$("div",oe,[$("div",ue,[$("div",re,[o(K,{layout:"inline",model:l},{default:n(()=>[o(d,{label:a.$t("financial.bills.billNo")},{default:n(()=>[o(v,{value:l.billNo,"onUpdate:value":s[0]||(s[0]=e=>l.billNo=e),placeholder:a.$t("financial.bills.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(d,{label:a.$t("financial.bills.billType")},{default:n(()=>[o(T,{value:l.billType,"onUpdate:value":s[1]||(s[1]=e=>l.billType=e),placeholder:a.$t("financial.bills.billTypePlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(t(!0),u(b,null,C(P.value,e=>(t(),k(N,{key:e.value,value:e.value},{default:n(()=>[p(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(d,{label:a.$t("financial.bills.settlementStatus")},{default:n(()=>[o(T,{value:l.settlementStatus,"onUpdate:value":s[2]||(s[2]=e=>l.settlementStatus=e),placeholder:a.$t("financial.bills.settlementStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(t(!0),u(b,null,C(z.value,e=>(t(),k(N,{key:e.value,value:e.value},{default:n(()=>[p(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(d,{label:a.$t("financial.bills.createTime")},{default:n(()=>[o(A,{value:l.timeRange,"onUpdate:value":s[3]||(s[3]=e=>l.timeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),o(d,{label:a.$t("financial.bills.relatedTaskName")},{default:n(()=>[o(v,{value:l.taskName,"onUpdate:value":s[4]||(s[4]=e=>l.taskName=e),placeholder:a.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(d,{label:a.$t("financial.bills.relatedGroupName")},{default:n(()=>[o(T,{value:l.relatedGroupId,"onUpdate:value":s[5]||(s[5]=e=>l.relatedGroupId=e),placeholder:a.$t("financial.bills.relatedGroupNamePlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:O},{default:n(()=>[(t(!0),u(b,null,C(M.value,e=>(t(),k(N,{key:e.id,value:e.id},{default:n(()=>[p(r(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(d,null,{default:n(()=>[o(J,null,{default:n(()=>[o(Y,{type:"primary",onClick:D},{default:n(()=>[p(r(a.$t("common.search")),1)]),_:1}),o(Y,{onClick:j},{default:n(()=>[p(r(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),o(Z,{columns:V.value,"data-source":R.value,loading:h.value,pagination:_,onChange:q},{bodyCell:n(({column:e,record:i})=>[e.key==="memberNickname"?(t(),k(E,{key:0,onClick:B=>L(i)},{default:n(()=>[p(r(i.memberNickname),1)]),_:2},1032,["onClick"])):f("",!0),e.key==="taskName"?(t(),u(b,{key:1},[i.taskName?(t(),k(E,{key:0,onClick:B=>W(i)},{default:n(()=>[p(r(i.taskName),1)]),_:2},1032,["onClick"])):(t(),u("span",de,"--"))],64)):f("",!0),e.key==="relatedGroupName"?(t(),u(b,{key:2},[p(r(i.relatedGroupName||"--"),1)],64)):f("",!0),e.key==="billType"?(t(),u(b,{key:3},[p(r(I(y).getEnumText("BillType",i.billType)),1)],64)):f("",!0),e.key==="amount"?(t(),u(b,{key:4},[i.billType==="reward_deduction"?(t(),k(Q,{key:0,type:"danger"},{default:n(()=>[p(" - "+r(i.amount),1)]),_:2},1024)):(t(),u("span",me,r(i.amount),1))],64)):f("",!0),e.key==="remark"?(t(),u(b,{key:5},[i.remark?(t(),u("span",pe,r(i.remark)+"("+r(a.$t("financial.bills.operator"))+": "+r(i.waiterName)+")",1)):(t(),u("span",ce,"--"))],64)):f("",!0),e.key==="settlementStatus"?(t(),u(b,{key:6},[i.billType==="withdrawal"?(t(),u("span",be,r(I(y).getEnumText("WithdrawalStatus",i.withdrawalStatus)),1)):(t(),u("span",fe,r(I(y).getEnumText("SettlementStatus",i.settlementStatus)),1)),i.settlementStatus==="failed"||i.withdrawalStatus==="failed"?(t(),k(X,{key:2,class:"status-icon",onClick:B=>F(i)},null,8,["onClick"])):f("",!0)],64)):f("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},ve=ee(ye,[["__scopeId","data-v-d3e68614"]]);export{ve as default};
