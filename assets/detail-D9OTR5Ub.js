import{_ as oe,c as ce,a as me,z as be,d as ke,e as O,r as g,o as fe,f as k,h as s,g as o,w as t,i as p,t as a,F as $,m as U,n as m,x as b,C as V,q as _,p as G,j as pe,k as i,l as u,v as B}from"./index-BepA_qxU.js";import{P as _e}from"./PageHeader-s2gPEUX5.js";import{_ as W}from"./CopyContent-DlwWHkS0.js";import{G as Te}from"./GroupOwner-CKeWuvFT.js";import{d as ve}from"./routeParamsEncryption-BKFTaOaF.js";const ye={class:"task-audit-detail content-container"},he={class:"detail-container"},ge={key:0},$e={key:1},Ie={class:"detail-section"},Ce={class:"section-title"},Se={key:0},Ae={class:"link-text-container"},qe=["href"],we={class:"detail-section"},je={class:"section-title"},Pe={class:"link-text-container"},Re=["href"],Ne={key:0,style:{"margin-left":"10px"}},Fe={key:1},Ue={class:"detail-section"},Be={class:"section-title"},Ee={class:"footer-btns"},Le={class:"left"},De={class:"right"},Oe={__name:"detail",setup(Ve){const{t:w}=ce(),j=me(),T=be(),E=pe(),P=T.query.type,M=ke(()=>n.taskPreAuditStatus==="approved"?"confirm":"pre"),R=g(!1),L=g(!1),I=g(""),H=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},y=g(null),n=O({submitContent:{}}),c=O({}),v=O({}),D=g(null),Q=()=>{const e=T.query.filters;e&&(D.value=ve(e))},J=async()=>{const e=M.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",l=await V(e,{ids:[y.value]});l.code===0?(_.success(w("submittedTasks.resolveSuccess")),C()):_.error(l.message)},K=()=>{I.value="",R.value=!0},X=async()=>{if(!I.value){_.error(w("submittedTasks.rejectReasonRequired"));return}L.value=!0;try{const e=M.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject";await V(e,{ids:[y.value],reason:I.value}),_.success(w("submittedTasks.rejectSuccess")),R.value=!1,C()}catch(e){_.error(e.message)}finally{L.value=!1}},Y=()=>{const e=P==="confirm"?"/confirm-audit-tasks":"/pre-audit-tasks",l={};T.query.filters&&(l.filters=T.query.filters),E.push({path:e,query:l})},Z=()=>{const e={type:P};T.query.filters&&(e.filters=T.query.filters),E.push({path:`/submitted-tasks/detail/${n.prevTaskId}`,query:e}),y.value=n.prevTaskId,C()},x=()=>{const e={type:P};T.query.filters&&(e.filters=T.query.filters),E.push({path:`/submitted-tasks/detail/${n.nextTaskId}`,query:e}),y.value=n.nextTaskId,C()},ee=async e=>{try{const l=await G("task.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(c,l.data):_.error(l.message)}catch(l){_.error(l.message)}},te=async e=>{try{const l=await G("member.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(v,l.data):_.error(l.message)}catch{_.error(w("submittedTasks.detail.getMemberDetailFailed"))}},C=async()=>{try{const e={auditType:P,id:y.value};D.value&&(e.filtersParam=D.value);const l=await V("taskSubmitted.detail",e);l.code===0&&(Object.assign(n,l.data),l.data.taskId!=null&&await ee(l.data.taskId),l.data.memberId!=null&&await te(l.data.memberId),l.data.taskId!=null&&l.data.memberId!=null&&await ae())}catch(e){_.error(e.message)}},S=g([]),ae=async()=>{const e=await G("account.list",{taskId:n.taskId,memberId:n.memberId,channelId:c.channelId});e.code===0&&(S.value=e.data.list||[])};return fe(async()=>{y.value=T.params.id,Q(),await C()}),(e,l)=>{const z=p("a-avatar"),h=p("a-space"),d=p("a-descriptions-item"),A=p("a-descriptions"),se=p("a-collapse-panel"),le=p("a-collapse"),N=p("a-tag"),ie=p("a-image"),F=p("a-button"),ue=p("a-textarea"),de=p("a-modal");return i(),k("div",ye,[s(_e,{title:e.$t("submittedTasks.detail.title"),back:!0,useDefaultBack:!1,onBack:Y},null,8,["title"]),o("div",he,[s(le,{ghost:"",class:"collapse"},{default:t(()=>[s(se,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[s(A,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[s(d,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[s(h,null,{default:t(()=>[s(z,{src:c.channelIcon,size:"small"},null,8,["src"]),o("span",null,a(c.taskName),1)]),_:1})]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[u(a(c.category),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[u(a(B(j).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[u(a(c.reward),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[u(a(c.brand),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var r;return[c.groupMode===0?(i(),k("span",ge,a(e.$t("submittedTasks.detail.noSpecify")),1)):(i(),k("span",$e,a((r=c.groupNames)==null?void 0:r.join("、")),1))]}),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[u(a(c.startTime)+" "+a(e.$t("submittedTasks.detail.to"))+" "+a(c.endTime),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[u(a(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[u(a(c.fansRequired),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[u(a(c.contentRequirement),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[u(a(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),o("div",Ie,[o("div",Ce,a(e.$t("submittedTasks.detail.memberInfo")),1),s(A,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[s(d,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[s(h,null,{default:t(()=>[o("span",null,a(v.nickname),1),v.isNew?(i(),m(N,{key:0,color:"green"},{default:t(()=>l[2]||(l[2]=[u("new")])),_:1})):b("",!0)]),_:1})]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[u(a(v.account),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(i(!0),k($,null,U(v.groups,r=>(i(),m(h,null,{default:t(()=>[o("span",null,a(r.groupName),1),r.isOwner?(i(),m(Te,{key:0})):b("",!0)]),_:2},1024))),256)),!v.groups||v.groups.length===0?(i(),k("span",Se,"--")):b("",!0)]),_:1},8,["label"])]),_:1}),(i(!0),k($,null,U(S.value,r=>(i(),k("div",{key:r.channelId},[s(A,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[s(d,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[s(h,null,{default:t(()=>[s(z,{src:r.channelIcon,size:"small"},null,8,["src"]),o("span",null,a(r.account),1),s(N,{color:"warning"},{default:t(()=>[u(a(B(j).getEnumText("AccountAuditStatus",r.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),s(d,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[s(W,{content:r.homeUrl},{default:t(()=>[o("div",Ae,[o("a",{href:r.homeUrl,target:"_blank",class:"link-text"},a(r.homeUrl),9,qe)])]),_:2},1032,["content"])]),_:2},1032,["label"]),r.channelCustomFields.includes("fansCount")?(i(),m(d,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[u(a(r.fansCount),1)]),_:2},1032,["label"])):b("",!0),r.channelCustomFields.includes("friendsCount")?(i(),m(d,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[u(a(r.friendsCount),1)]),_:2},1032,["label"])):b("",!0),r.channelCustomFields.includes("postsCount")?(i(),m(d,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[u(a(r.postsCount),1)]),_:2},1032,["label"])):b("",!0),s(d,{label:"uid"},{default:t(()=>[u(a(r.uid),1)]),_:2},1024)]),_:2},1024)]))),128))]),o("div",we,[o("div",je,a(e.$t("submittedTasks.detail.submitInfo")),1),s(A,{column:1},{default:t(()=>{var r;return[(i(!0),k($,null,U((r=n==null?void 0:n.submitContent)==null?void 0:r.customFields,(f,ne)=>(i(),m(d,{key:ne,label:f.title},{default:t(()=>[f.type==="image"?(i(!0),k($,{key:0},U(f.value,(q,re)=>(i(),m(ie,{src:q.url,width:60,key:re},null,8,["src"]))),128)):(i(),k($,{key:1},[H(f.value)?(i(),k($,{key:0},[s(W,{content:f.value},{default:t(()=>[o("div",Pe,[o("a",{href:f.value,target:"_blank",class:"link-text"},a(f.value),9,Re)])]),_:2},1032,["content"]),f.type==="post"?(i(),k("div",Ne,[S.value.find(q=>q.uid===f.uid)?(i(),m(N,{key:0,color:"green"},{default:t(()=>[u(a(e.$t("submittedTasks.detail.postUidCheckSuccess")),1)]),_:1})):b("",!0),S.value.length&&f.uid!=null&&!S.value.find(q=>q.uid===f.uid)?(i(),m(N,{key:1,color:"red"},{default:t(()=>[u(a(e.$t("submittedTasks.detail.postUidCheckError")),1)]),_:1})):b("",!0)])):b("",!0)],64)):(i(),k("span",Fe,a(f.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),o("div",Ue,[o("div",Be,a(e.$t("submittedTasks.detail.auditInfo")),1),s(A,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[s(d,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[u(a(n.submitTime),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[u(a(B(j).getEnumText("TaskPreAuditStatus",n.taskPreAuditStatus)),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.preAuditor")},{default:t(()=>[u(a(n.preWaiterName),1)]),_:1},8,["label"]),s(d,{label:e.$t("submittedTasks.preAuditTime")},{default:t(()=>[u(a(n.preAuditTime),1)]),_:1},8,["label"]),n.taskPreAuditStatus==="approved"?(i(),m(d,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[u(a(B(j).getEnumText("TaskAuditStatus",n.taskAuditStatus)),1)]),_:1},8,["label"])):b("",!0),n.taskPreAuditStatus==="approved"?(i(),m(d,{key:1,label:e.$t("submittedTasks.confirmAuditor")},{default:t(()=>[u(a(n.waiterName),1)]),_:1},8,["label"])):b("",!0),n.taskPreAuditStatus==="approved"?(i(),m(d,{key:2,label:e.$t("submittedTasks.confirmAuditTime")},{default:t(()=>[u(a(n.auditTime),1)]),_:1},8,["label"])):b("",!0),n.auditStatus==="rejected"?(i(),m(d,{key:3,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[u(a(n.rejectReason),1)]),_:1},8,["label"])):b("",!0)]),_:1})]),o("div",Ee,[o("div",Le,[n.auditStatus==="pending"?(i(),m(h,{key:0},{default:t(()=>[s(F,{type:"primary",onClick:J},{default:t(()=>[u(a(e.$t("submittedTasks.detail.approve")),1)]),_:1}),s(F,{danger:"",onClick:K},{default:t(()=>[u(a(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):b("",!0)]),o("div",De,[s(h,null,{default:t(()=>[n.prevTaskId&&n.prevTaskId!==n.nextTaskId?(i(),m(F,{key:0,onClick:Z},{default:t(()=>[u(a(e.$t("submittedTasks.detail.prev")),1)]),_:1})):b("",!0),n.nextTaskId?(i(),m(F,{key:1,onClick:x},{default:t(()=>[u(a(e.$t("submittedTasks.detail.next")),1)]),_:1})):b("",!0)]),_:1})])])]),s(de,{open:R.value,"onUpdate:open":l[1]||(l[1]=r=>R.value=r),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:X,confirmLoading:L.value},{default:t(()=>[s(ue,{value:I.value,"onUpdate:value":l[0]||(l[0]=r=>I.value=r),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Qe=oe(Oe,[["__scopeId","data-v-251e89dc"]]);export{Qe as default};
