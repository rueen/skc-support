import{_ as fe,b as ye,a as ke,j as L,r as v,c as V,k as be,d as _,e as b,f as a,s as f,w as t,g as i,l as W,m as w,h as ge,o as c,F as S,n as z,p as $,i as u,t as r,q as A,M as K,A as q}from"./index-ZPK4NXiE.js";import{d as Ce}from"./download-KH315_St.js";const Ne={class:"withdrawal content-container"},Se={class:"table-container"},$e={class:"table-header"},Re={class:"left"},Ie={class:"right"},Te=["onClick"],je=["onClick"],De={key:0,class:"count-container"},Me={__name:"withdrawal",setup(Oe){const{t:d}=ye(),T=ge(),j=ke(),G=L(()=>j.loaded?j.getEnumOptions("WithdrawalStatus"):[]),D=v([]),M=v(!1),g=v(!1),O=v(!1),k=v(""),n=V({billNo:"",memberNickname:"",withdrawalStatus:"pending",paymentChannelId:null,timeRange:[]}),J=L(()=>[{title:d("withdrawal.list.billNo"),dataIndex:"billNo",key:"billNo"},{title:d("withdrawal.list.memberNickname"),key:"nickname"},{title:d("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:d("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:d("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:d("withdrawal.list.name"),dataIndex:"withdrawalName",key:"withdrawalName"},{title:d("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:d("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:d("withdrawal.list.operator"),key:"waiterName"},{title:d("withdrawal.list.action"),key:"action",width:150}]),h=v([]),Q={selectedRowKeys:h,onChange:e=>{h.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},B=v([]),P=v(0),p=V({current:1,pageSize:10,total:0}),U=()=>{p.current=1,C()},X=()=>{Object.assign(n,{billNo:"",memberNickname:"",withdrawalStatus:void 0,paymentChannelId:null,timeRange:[]}),U()},Z=e=>{Object.assign(p,e),C()},ee=()=>{K.confirm({title:d("common.export"),content:d("common.confirmExportContent"),onOk:async()=>{var y,s;const e=w.loading("正在导出数据，请稍候...",0),o={billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,paymentChannelId:n.paymentChannelId,startTime:(y=n.timeRange)==null?void 0:y[0],endTime:(s=n.timeRange)==null?void 0:s[1]};try{await Ce("withdrawals.export",o,`提现列表_${new Date().toLocaleDateString()}.xlsx`),w.success(d("common.exportSuccess"))}catch(R){console.error("导出失败:",R),w.error(d("common.exportFailed"))}finally{e()}}})},ae=e=>{T.push(`/member/view/${e.memberId}`)},te=e=>{K.error({content:e.rejectReason})},le=async e=>{h.value=[e.id],E()},E=async()=>{if(!h.value.length){w.warning("请选择要操作的记录");return}const e=await q("withdrawals.batchResolve",{ids:h.value});e.code===0?(w.success("操作成功"),h.value=[],C()):w.error(e.message)},ne=e=>{h.value=[e.id],k.value="",g.value=!0},oe=()=>{if(!h.value.length){w.warning("请选择要操作的记录");return}k.value="",g.value=!0},ie=async()=>{if(!k.value){w.error("请输入打款失败原因");return}O.value=!0;try{await q("withdrawals.batchReject",{rejectReason:k.value,ids:h.value}),w.success("操作成功"),g.value=!1,h.value=[],C()}catch(e){w.error(e.message)}finally{O.value=!1}},C=async()=>{var e,o;M.value=!0;try{const y={page:p.current,pageSize:p.pageSize,billNo:n.billNo,memberNickname:n.memberNickname,withdrawalStatus:n.withdrawalStatus,paymentChannelId:n.paymentChannelId,startTime:(e=n.timeRange)==null?void 0:e[0],endTime:(o=n.timeRange)==null?void 0:o[1]},s=await W("withdrawals.list",{...y});s.code===0?(B.value=s.data.list||[],p.total=s.data.total||0,P.value=s.data.totalAmount):w.error(s.message)}finally{M.value=!1}},se=async()=>{if(!D.value.length)try{const e=await W("paymentChannels.list");e.code===0&&(D.value=e.data)}catch(e){console.error(e)}};return be(()=>{C(),se()}),(e,o)=>{const y=i("a-input"),s=i("a-form-item"),R=i("a-select-option"),H=i("a-select"),re=i("a-range-picker"),N=i("a-button"),Y=i("a-space"),de=i("a-form"),ce=i("RightOutlined"),x=i("a-typography-link"),ue=i("download-outlined"),me=i("info-circle-outlined"),we=i("a-popconfirm"),he=i("a-table"),F=i("a-descriptions-item"),pe=i("a-descriptions"),ve=i("a-textarea"),_e=i("a-modal");return c(),_("div",Ne,[b("div",Se,[b("div",$e,[b("div",Re,[a(de,{layout:"inline",model:n},{default:t(()=>[a(s,{label:e.$t("withdrawal.list.billNo")},{default:t(()=>[a(y,{value:n.billNo,"onUpdate:value":o[0]||(o[0]=l=>n.billNo=l),placeholder:e.$t("withdrawal.list.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(y,{value:n.memberNickname,"onUpdate:value":o[1]||(o[1]=l=>n.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(H,{value:n.withdrawalStatus,"onUpdate:value":o[2]||(o[2]=l=>n.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(c(!0),_(S,null,z(G.value,l=>(c(),$(R,{key:l.value,value:l.value},{default:t(()=>[u(r(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e.$t("withdrawal.list.accountType")},{default:t(()=>[a(H,{value:n.paymentChannelId,"onUpdate:value":o[3]||(o[3]=l=>n.paymentChannelId=l),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(c(!0),_(S,null,z(D.value,l=>(c(),$(R,{key:l.id,value:l.id},{default:t(()=>[u(r(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(s,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(re,{value:n.timeRange,"onUpdate:value":o[4]||(o[4]=l=>n.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(s,null,{default:t(()=>[a(Y,null,{default:t(()=>[a(N,{type:"primary",onClick:U},{default:t(()=>[u(r(e.$t("common.search")),1)]),_:1}),a(N,{onClick:X},{default:t(()=>[u(r(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),b("div",Ie,[a(Y,null,{default:t(()=>[a(x,{onClick:o[5]||(o[5]=l=>A(T).push("/payment-transactions"))},{default:t(()=>[u(r(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(ce)]),_:1}),a(N,{onClick:ee},{icon:t(()=>[a(ue)]),default:t(()=>[u(" "+r(e.$t("withdrawal.list.export")),1)]),_:1}),a(N,{type:"primary",onClick:E},{default:t(()=>[u(r(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(N,{danger:"",onClick:oe},{default:t(()=>[u(r(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(he,{columns:J.value,"data-source":B.value,loading:M.value,pagination:p,rowKey:"id","row-selection":Q,onChange:Z},{bodyCell:t(({column:l,record:m})=>[l.key==="nickname"?(c(),$(x,{key:0,onClick:I=>ae(m)},{default:t(()=>[u(r(m.nickname),1)]),_:2},1032,["onClick"])):f("",!0),l.key==="withdrawalStatus"?(c(),_(S,{key:1},[u(r(A(j).getEnumText("WithdrawalStatus",m.withdrawalStatus))+" ",1),m.withdrawalStatus==="failed"?(c(),$(me,{key:0,class:"danger",onClick:I=>te(m)},null,8,["onClick"])):f("",!0)],64)):f("",!0),l.key==="waiterName"?(c(),_(S,{key:2},[u(r(m.waiterName||"--"),1)],64)):f("",!0),l.key==="action"?(c(),_(S,{key:3},[m.withdrawalStatus==="pending"?(c(),$(Y,{key:0},{default:t(()=>[a(we,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:I=>le(m)},{default:t(()=>[b("a",null,r(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),b("a",{class:"danger",onClick:I=>ne(m)},r(e.$t("withdrawal.list.reject")),9,Te)]),_:2},1024)):f("",!0),m.withdrawalStatus==="failed"?(c(),_("a",{key:1,onClick:I=>A(T).push(`/payment-transactions?withdrawalId=${m.id}`)},"查看交易记录",8,je)):f("",!0)],64)):f("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),p.total?(c(),_("div",De,[a(pe,{column:2},{default:t(()=>[a(F,{label:e.$t("common.totalCount")},{default:t(()=>[u(r(p.total),1)]),_:1},8,["label"]),a(F,{label:e.$t("common.totalAmount")},{default:t(()=>[u(r(P.value),1)]),_:1},8,["label"])]),_:1})])):f("",!0)]),a(_e,{open:g.value,"onUpdate:open":o[7]||(o[7]=l=>g.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:ie,confirmLoading:O.value},{default:t(()=>[a(ve,{value:k.value,"onUpdate:value":o[6]||(o[6]=l=>k.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Be=fe(Me,[["__scopeId","data-v-6401ea20"]]);export{Be as default};
