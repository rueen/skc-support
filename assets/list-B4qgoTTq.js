import{_ as le,a as re,b as se,r as C,c as L,x as ie,j as ce,k as ue,d as _,e as i,f as o,w as t,g as u,l as O,m as b,h as de,o as r,F as w,n as T,p as f,i as g,t as s,s as k,q as me,M as pe,v as _e}from"./index-CUoBUQge.js";import{_ as B}from"./CopyContent-C3kvS2Da.js";import{G as ge}from"./GroupOwner-CN__gVuh.js";import{d as fe}from"./download-dcsOXtqr.js";const ke={class:"member-list content-container"},ve={class:"table-container"},he={class:"table-header"},ye={class:"left"},be={class:"right"},we={class:"link-text-container"},$e={class:"label"},Ie=["href"],Ce={key:1},Te={style:{color:"#999","font-size":"12px"}},Se={key:0},De=["onClick"],Ne=["onClick"],Me={class:"danger"},Oe={__name:"list",setup(Re){const F=re(),{t:d}=se(),S=de(),P=ie(),D=C(!1),l=L({keyword:"",groupId:P.query.groupId,inviterId:null,createTimeRange:[]}),N=C([]),v=L({current:1,pageSize:10,total:0}),R=C([]),V=ce(()=>[{title:d("member.list.memberNickname"),key:"nickname"},{title:d("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:d("member.list.accounts"),key:"accountList"},{title:d("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:d("member.list.inviter"),key:"inviterNickname"},{title:d("member.list.group"),key:"groups"},{title:d("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:d("member.list.action"),key:"action",fixed:"right",width:150}]),x=()=>{v.current=1,$()},j=()=>{Object.assign(l,{keyword:"",groupId:void 0,inviterId:null,createTimeRange:[]}),x()},G=e=>{v.current=e.current,v.pageSize=e.pageSize,$()},q=()=>{S.push("/member/create")},J=e=>{S.push(`/member/edit/${e.id}`)},z=e=>{S.push(`/member/view/${e}`)},K=async e=>{const a=await _e("member.delete",{},{urlParams:{id:e.id}});a.code===0?(b.success("删除成功"),$()):b.error(a.message)},$=async()=>{var e,a;D.value=!0;try{const h={page:v.current,pageSize:v.pageSize,keyword:l.keyword,groupId:l.groupId,inviterId:l.inviterId,createStartTime:(e=l.createTimeRange)==null?void 0:e[0],createEndTime:(a=l.createTimeRange)==null?void 0:a[1]},m=await O("member.list",h);m.code===0?(N.value=m.data.list,v.total=m.data.total):b.error(m.message)}finally{D.value=!1}},E=async(e="")=>{try{const a=await O("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(R.value=a.data.list||[])}catch{b.error("获取群组列表失败")}},Q=()=>{pe.confirm({title:d("common.export"),content:d("common.confirmExportContent"),onOk:async()=>{var e,a;try{const h=b.loading(d("common.exporting"),0),m={keyword:l.keyword,groupId:l.groupId,inviterId:l.inviterId,createStartTime:(e=l.createTimeRange)==null?void 0:e[0],createEndTime:(a=l.createTimeRange)==null?void 0:a[1]};await fe("member.export",m,`会员列表_${new Date().toLocaleDateString()}.xlsx`),h(),b.success(d("common.exportSuccess"))}catch(h){console.error("导出失败:",h),b.error(d("common.exportFailed"))}}})},M=C([]),W=async()=>{M.value.length||await Y()},Y=async(e="")=>{const a=await O("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(M.value=a.data.list||[])};return ue(()=>{$(),E()}),(e,a)=>{const h=u("a-input"),m=u("a-form-item"),U=u("a-select-option"),A=u("a-select"),X=u("a-range-picker"),I=u("a-button"),y=u("a-space"),Z=u("a-form"),ee=u("DownloadOutlined"),te=u("plus-outlined"),H=u("a-tag"),ae=u("a-typography-link"),oe=u("a-popconfirm"),ne=u("a-table");return r(),_("div",ke,[i("div",ve,[i("div",he,[i("div",ye,[o(Z,{layout:"inline",model:l},{default:t(()=>[o(m,{label:e.$t("member.search.keyword")},{default:t(()=>[o(h,{value:l.keyword,"onUpdate:value":a[0]||(a[0]=n=>l.keyword=n),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("member.search.group")},{default:t(()=>[o(A,{value:l.groupId,"onUpdate:value":a[1]||(a[1]=n=>l.groupId=n),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:E,style:{width:"200px"}},{default:t(()=>[(r(!0),_(w,null,T(R.value,n=>(r(),f(U,{key:n.id,value:n.id},{default:t(()=>[g(s(n.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("member.list.inviter")},{default:t(()=>[o(A,{value:l.inviterId,"onUpdate:value":a[2]||(a[2]=n=>l.inviterId=n),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onFocus:W,onSearch:Y},{default:t(()=>[(r(!0),_(w,null,T(M.value,n=>(r(),f(U,{key:n.id,value:n.id},{default:t(()=>[g(s(n.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(m,{label:e.$t("member.search.createTime")},{default:t(()=>[o(X,{value:l.createTimeRange,"onUpdate:value":a[3]||(a[3]=n=>l.createTimeRange=n),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(m,null,{default:t(()=>[o(y,null,{default:t(()=>[o(I,{type:"primary",onClick:x},{default:t(()=>[g(s(e.$t("common.search")),1)]),_:1}),o(I,{onClick:j},{default:t(()=>[g(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",be,[o(y,null,{default:t(()=>[N.value.length?(r(),f(I,{key:0,onClick:Q},{icon:t(()=>[o(ee)]),default:t(()=>[g(" "+s(e.$t("common.export")),1)]),_:1})):k("",!0),o(I,{type:"primary",onClick:q},{icon:t(()=>[o(te)]),default:t(()=>[g(" "+s(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),o(ne,{columns:V.value,"data-source":N.value,loading:D.value,pagination:v,onChange:G},{bodyCell:t(({column:n,record:p})=>[n.key==="nickname"?(r(),f(y,{key:0},{default:t(()=>[i("span",null,s(p.nickname),1),p.isNew?(r(),f(H,{key:0,color:"green"},{default:t(()=>a[4]||(a[4]=[g("new")])),_:1})):k("",!0)]),_:2},1024)):k("",!0),n.key==="accountList"?(r(),f(y,{key:1,direction:"vertical"},{default:t(()=>[(r(!0),_(w,null,T(p.accountList,c=>(r(),_("div",null,[i("div",null,[o(y,null,{default:t(()=>[g(s(e.$t("member.list.account"))+"："+s(c.account)+" ",1),o(H,{color:"warning"},{default:t(()=>[g(s(me(F).getEnumText("AccountAuditStatus",c.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),i("div",we,[i("span",$e,s(e.$t("member.list.homepage"))+"：",1),o(B,{content:c.homeUrl},{default:t(()=>[i("a",{href:c.homeUrl,target:"_blank",class:"link-text"},s(c.homeUrl),9,Ie)]),_:2},1032,["content"])]),i("div",null,[a[5]||(a[5]=i("span",{class:"label"},"uid：",-1)),o(B,{content:c.uid},null,8,["content"])])]))),256))]),_:2},1024)):k("",!0),n.key==="inviterNickname"?(r(),_(w,{key:2},[p.inviterId?(r(),f(ae,{key:0,onClick:c=>z(p.inviterId)},{default:t(()=>[g(s(p.inviterNickname),1)]),_:2},1032,["onClick"])):(r(),_("span",Ce,"--"))],64)):k("",!0),n.key==="groups"?(r(),_(w,{key:3},[(r(!0),_(w,null,T(p.groups,c=>(r(),_("div",null,[o(y,null,{default:t(()=>[i("span",null,s(c.groupName),1),c.isOwner?(r(),f(ge,{key:0})):k("",!0)]),_:2},1024),i("div",Te,s(c.joinTime),1)]))),256)),!p.groups||p.groups.length===0?(r(),_("span",Se,"--")):k("",!0)],64)):k("",!0),n.key==="action"?(r(),f(y,{key:4},{default:t(()=>[i("a",{onClick:c=>J(p)},s(e.$t("member.list.edit")),9,De),i("a",{onClick:c=>z(p.id)},s(e.$t("member.list.view")),9,Ne),o(oe,{title:e.$t("member.list.deleteConfirm"),onConfirm:c=>K(p)},{default:t(()=>[i("a",Me,s(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Ue=le(Oe,[["__scopeId","data-v-b136035d"]]);export{Ue as default};
