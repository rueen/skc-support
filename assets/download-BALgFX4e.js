import{B as p,m as d,J as g,K as x}from"./index-BoqzPyfM.js";const b=(n,c={},u="",a={})=>{const l=g.create({baseURL:p.businessApiUrl,timeout:6e4,responseType:"blob"});l.interceptors.request.use(r=>{const e=localStorage.getItem("token");return e&&(r.headers.Authorization=`Bearer ${e}`),r},r=>(console.error("下载请求错误:",r),Promise.reject(r)));const f=x(c);return c.sign=f,l({url:n,method:"get",params:c,...a}).then(r=>{let e=u;if(!e){const i=r.headers["content-disposition"];if(i){const m=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);if(m&&m[1]){e=m[1].replace(/['"]/g,"");try{e=decodeURIComponent(e)}catch(h){console.error("文件名解码失败:",h)}}}if(!e){const s=r.headers["content-type"];s?s.includes("excel")||s.includes("spreadsheetml")?e="export.xlsx":s.includes("csv")?e="export.csv":s.includes("pdf")?e="export.pdf":e="export.file":e="export.file"}}const o=new Blob([r.data]),t=document.createElement("a");return t.href=URL.createObjectURL(o),t.download=e,document.body.appendChild(t),t.click(),URL.revokeObjectURL(t.href),document.body.removeChild(t),{success:!0,filename:e}}).catch(r=>{let e="下载失败";if(r.response)if(r.response.status===401)e="登录已过期，请重新登录",localStorage.removeItem("token"),window.location.href="/login";else try{const o=new FileReader;o.onload=()=>{try{e=JSON.parse(o.result).message||"下载失败",d.error(e)}catch{d.error("下载失败")}},o.readAsText(r.response.data)}catch{d.error("下载失败")}else d.error(e);return Promise.reject(r)})},R=(n,c={},u="",a={})=>{const[l,f]=n.split("."),r=p.api[l]&&p.api[l][f];if(!r)return console.error(`API ${n} 不存在`),d.error(`API ${n} 不存在`),Promise.reject(new Error(`API ${n} 不存在`));let e=r;return a.urlParams&&(e=e.replace(/:([^/]+)/g,(o,t)=>{const i=a.urlParams[t];return i===void 0?(console.warn(`URL 参数 ${t} 未提供`),o):i})),b(e,c,u,a)};export{R as d};
