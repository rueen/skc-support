import{_ as le,r as v,b as C,j as ne,k as se,c as g,e as a,d as c,w as o,f as i,l as T,m as s,o as u,F as ie,n as re,p as S,h as y,t as m,B as de,s as b,v as ce,z as ue,A as me}from"./index-Bx9mD4zV.js";import{_ as pe}from"./CopyContent-PVsq7kY9.js";import{P as fe}from"./PageHeader-DqSSBxjb.js";const _e={class:"old-account content-container"},ve={class:"table-container"},ke={class:"table-header"},he={class:"left"},ge={class:"right"},ye={key:0},be={key:1},Ue=["href"],we={key:3},xe=["onClick"],Be={__name:"old-list",setup(Fe){const x=v(!1),U=v(null),$={action:`${de.businessApiUrl}/old-accounts-fb/import`,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},r=C({keyword:"",memberId:void 0}),z=v([]),D=[{title:"FB账户",key:"account",dataIndex:"uid"},{title:"FB昵称",key:"nickname",dataIndex:"nickname"},{title:"FB链接",key:"homeUrl"},{title:"关联会员",key:"member"},{title:"操作",key:"action"}],A=v([]),p=C({current:1,pageSize:10,total:0}),k=v(!1),B=v(!1),O=ne(()=>n.id?"编辑账号":"添加账号"),n=C({id:null,uid:"",nickname:"",homeUrl:""}),V={uid:[{required:!0,message:"请输入FB账户",trigger:"blur"}],nickname:[{required:!0,message:"请输入FB昵称",trigger:"blur"}],homeUrl:[{required:!0,message:"请输入FB链接",trigger:"blur"},{pattern:/^https?:\/\//,message:"请输入有效的链接，以http://或https://开头",trigger:"blur"}]},f=async()=>{x.value=!0;try{const e=await T("oldAccount.list",{page:p.current,pageSize:p.pageSize,...r});e.code===0?(A.value=e.data.list,p.total=e.data.total):s.error(e.message)}finally{x.value=!1}},E=()=>{n.id=null,n.uid="",n.nickname="",n.homeUrl="",U.value&&U.value.resetFields()},M=()=>{E(),k.value=!0},P=e=>{E(),Object.assign(n,{id:e.id,uid:e.uid,nickname:e.nickname,homeUrl:e.homeUrl}),k.value=!0},j=async e=>{try{const t=await ce("oldAccount.delete",{id:e.id},{urlParams:{id:e.id}});t.code===0?(s.success("删除成功"),f()):s.error(t.message)}catch{s.error("删除失败")}},q=()=>{U.value.validate().then(async()=>{B.value=!0;try{let e;n.id?e=await ue("oldAccount.edit",n,{urlParams:{id:n.id}}):e=await me("oldAccount.add",n),e.code===0?(s.success(n.id?"编辑成功":"添加成功"),k.value=!1,f()):s.error(e.message)}finally{B.value=!1}}).catch(e=>{console.log("验证失败",e)})},R=e=>e.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||e.type==="application/vnd.ms-excel"?(s.loading({content:"正在上传和处理Excel文件...",key:"importTip"}),!0):(s.error("请上传Excel文件(.xlsx或.xls)"),!1),H=e=>{if(s.destroy("importTip"),e.code===0){const t=e.data||{};s.success(`导入成功：${e.message||`总计${t.total||0}条数据，成功导入${t.imported||0}条，跳过${t.skipped||0}条`}`),f()}else s.error(e.message||"导入失败")},K=e=>{console.log(e),s.destroy("importTip"),s.error("上传失败")},I=()=>{p.current=1,f()},G=()=>{r.keyword="",r.memberId=void 0,I()},J=e=>{Object.assign(p,{current:e.current,pageSize:e.pageSize}),f()},L=async(e="")=>{try{const t=await T("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(z.value=t.data.list||[])}catch{s.error("获取会员列表失败")}};return se(()=>{f(),L()}),(e,t)=>{const h=i("a-input"),_=i("a-form-item"),Q=i("a-select-option"),W=i("a-select"),w=i("a-button"),F=i("a-space"),N=i("a-form"),X=i("upload-outlined"),Y=i("a-upload"),Z=i("plus-outlined"),ee=i("a-popconfirm"),te=i("a-table"),ae=i("a-modal");return u(),g("div",_e,[a(fe,{title:"FB老账号管理",back:!0,style:{"margin-bottom":"0"}}),c("div",ve,[c("div",ke,[c("div",he,[a(N,{layout:"inline",model:r},{default:o(()=>[a(_,{label:"搜索关键词"},{default:o(()=>[a(h,{value:r.keyword,"onUpdate:value":t[0]||(t[0]=l=>r.keyword=l),placeholder:"请输入账户/昵称/链接","allow-clear":""},null,8,["value"])]),_:1}),a(_,{label:"关联会员"},{default:o(()=>[a(W,{value:r.memberId,"onUpdate:value":t[1]||(t[1]=l=>r.memberId=l),placeholder:"请选择关联会员",style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:L},{default:o(()=>[(u(!0),g(ie,null,re(z.value,l=>(u(),S(Q,{key:l.id,value:l.id},{default:o(()=>[y(m(l.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(_,null,{default:o(()=>[a(F,null,{default:o(()=>[a(w,{type:"primary",onClick:I},{default:o(()=>[y(m(e.$t("common.search")),1)]),_:1}),a(w,{onClick:G},{default:o(()=>[y(m(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",ge,[a(F,null,{default:o(()=>[a(Y,{name:"file",multiple:!1,showUploadList:!1,action:$.action,headers:$.headers,beforeUpload:R,onSuccess:H,onError:K,accept:".xlsx,.xls"},{default:o(()=>[a(w,null,{default:o(()=>[a(X),t[6]||(t[6]=y(" 导入账号 "))]),_:1})]),_:1},8,["action","headers"]),a(w,{type:"primary",onClick:M},{default:o(()=>[a(Z),t[7]||(t[7]=y(" 添加账号 "))]),_:1})]),_:1})])]),a(te,{columns:D,"data-source":A.value,loading:x.value,pagination:p,rowKey:"id",onChange:J},{bodyCell:o(({column:l,record:d})=>[l.key==="account"?(u(),g("div",ye,[c("div",null,m(d.uid),1)])):b("",!0),l.key==="nickname"?(u(),g("div",be,m(d.nickname),1)):b("",!0),l.key==="homeUrl"?(u(),S(pe,{key:2,content:d.homeUrl},{default:o(()=>[c("a",{href:d.homeUrl,target:"_blank",class:"link-text",style:{"max-width":"200px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},m(d.homeUrl),9,Ue)]),_:2},1032,["content"])):b("",!0),l.key==="member"?(u(),g("div",we,m(d.memberNickname||"--"),1)):b("",!0),l.key==="action"?(u(),S(F,{key:4},{default:o(()=>[c("a",{onClick:oe=>P(d)},"编辑",8,xe),a(ee,{title:"确定要删除该账号吗？",onConfirm:oe=>j(d)},{default:o(()=>t[8]||(t[8]=[c("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):b("",!0)]),_:1},8,["data-source","loading","pagination"])]),a(ae,{open:k.value,"onUpdate:open":t[5]||(t[5]=l=>k.value=l),title:O.value,onOk:q,confirmLoading:B.value},{default:o(()=>[a(N,{model:n,rules:V,ref_key:"formRef",ref:U,"label-col":{span:4},"wrapper-col":{span:20}},{default:o(()=>[a(_,{label:"FB账户",name:"uid"},{default:o(()=>[a(h,{value:n.uid,"onUpdate:value":t[2]||(t[2]=l=>n.uid=l),placeholder:"请输入FB账户"},null,8,["value"])]),_:1}),a(_,{label:"FB昵称",name:"nickname"},{default:o(()=>[a(h,{value:n.nickname,"onUpdate:value":t[3]||(t[3]=l=>n.nickname=l),placeholder:"请输入FB昵称"},null,8,["value"])]),_:1}),a(_,{label:"FB链接",name:"homeUrl"},{default:o(()=>[a(h,{value:n.homeUrl,"onUpdate:value":t[4]||(t[4]=l=>n.homeUrl=l),placeholder:"请输入FB链接"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},ze=le(Be,[["__scopeId","data-v-100b3825"]]);export{ze as default};
