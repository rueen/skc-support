import{_ as Oe,a as Re,b as je,j as le,r as v,c as P,k as Ge,d as k,e as _,f as l,s as f,w as s,g as c,y as ne,x as De,h as Me,l as D,m as g,o as u,F as y,n as $,p as b,i as r,t as o,q as Ye,M as Ee,A as oe}from"./index-C_vAxHhQ.js";import{d as Ue}from"./download-BDmazi0q.js";import{d as We,e as Fe}from"./routeParamsEncryption-BKFTaOaF.js";import{G as He}from"./GroupOwner-D80hcZU6.js";const Pe={class:"task-audit content-container"},ze={class:"table-container"},Be={class:"table-header"},Le={class:"left"},Ve={class:"right"},qe=["onClick"],Ke={class:"danger"},Je={key:0,class:"count-container"},Qe={__name:"confirm-audit-list",setup(Xe){const M=Re(),{t:m}=je(),ue=le(()=>M.loaded?M.getEnumOptions("TaskAuditStatus"):[]),Y=Me(),E=De(),U=v(!1),z=v(!1),N=v(!1),W=v(!1),S=v(""),O=v(null),h=v([]),F=v([]),B=()=>{const e=ne().startOf("month").format("YYYY-MM-DD HH:mm:ss"),a=ne().endOf("month").format("YYYY-MM-DD HH:mm:ss");return[e,a]},n=P({taskName:"",channelId:void 0,taskAuditStatus:"pending",preWaiterId:void 0,groupId:void 0,submitTimeRange:B(),completedTaskCount:void 0,keyword:"",taskGroupId:void 0}),L=v([]),V=v([]),re=le(()=>[{title:m("submittedTasks.list.taskName"),key:"taskName"},{title:m("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:m("submittedTasks.list.memberInfo"),key:"member"},{title:m("submittedTasks.list.status"),dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:m("submittedTasks.rejectTimes"),dataIndex:"rejectTimes",key:"rejectTimes"},{title:m("submittedTasks.preAuditor"),key:"preWaiterName"},{title:m("submittedTasks.preAuditTime"),dataIndex:"preAuditTime",key:"preAuditTime",sorter:!0},{title:m("submittedTasks.confirmAuditor"),key:"waiterName"},{title:m("submittedTasks.confirmAuditTime"),dataIndex:"confirmAuditTime",key:"confirmAuditTime",sorter:!0},{title:m("submittedTasks.list.action"),key:"action"}]),R=v([]),q=v(0),T=P({current:1,pageSize:10,total:0}),K=P({sorterField:void 0,sorterOrder:void 0}),ie={selectedRowKeys:h,onChange:e=>{h.value=e},getCheckboxProps:e=>({disabled:e.taskAuditStatus!=="pending"})},de=()=>{const e=E.query.filters;if(e){const a={},p=We(e);Object.keys(p).forEach(w=>{w==="current"?T.current=p[w]:a[w]=p[w]}),Object.assign(n,{taskAuditStatus:null},a);const i={...E.query};delete i.filters,Y.replace({path:E.path,query:i})}},J=()=>{T.current=1,H()},ce=()=>{Object.assign(n,{taskName:"",channelId:void 0,taskAuditStatus:"pending",preWaiterId:void 0,groupId:void 0,submitTimeRange:B(),completedTaskCount:void 0,keyword:"",taskGroupId:void 0}),J()},me=(e,a,p)=>{Object.assign(T,e),Object.assign(K,{sorterField:p.field,sorterOrder:p.order}),H()},pe=e=>{Y.push(`/member/view/${e.memberId}`)},ke=e=>{const a=Fe({...n,current:T.current});Y.push({path:`/submitted-tasks/detail/${e.id}`,query:{type:"confirm",filters:a}})},fe=async e=>{h.value=[e.id],Q()},Q=async()=>{if(!h.value.length){g.warning(m("submittedTasks.list.selectTask"));return}const e=await oe("taskSubmitted.batchConfirmAuditApprove",{ids:h.value});e.code===0?(g.success(m("submittedTasks.resolveSuccess")),R.value.forEach(a=>{h.value.includes(a.id)&&(a.taskAuditStatus="approved")}),h.value=[]):g.error(e.message)},ve=e=>{h.value=[e.id],S.value="",N.value=!0},be=async()=>{if(!S.value){g.error("请输入拒绝原因");return}W.value=!0;try{await oe("taskSubmitted.batchConfirmAuditReject",{ids:h.value,reason:S.value}),g.success("审核拒绝成功"),N.value=!1,R.value.forEach(e=>{h.value.includes(e.id)&&(e.taskAuditStatus="rejected")}),h.value=[]}catch(e){g.error(e.message)}finally{W.value=!1}},he=()=>{if(!h.value.length){g.warning("请选择要拒绝的任务");return}S.value="",N.value=!0},ge=async()=>{const e=await D("channel.list");e.code===0&&(L.value=e.data.list)},ye=()=>{Ee.confirm({title:m("common.export"),content:m("common.confirmExportContent"),onOk:async()=>{var e,a;try{const p=g.loading(m("common.exporting"),0),i={taskName:n.taskName,channelId:n.channelId,taskAuditStatus:n.taskAuditStatus,preWaiterId:n.preWaiterId,groupId:n.groupId,submitStartTime:(e=n.submitTimeRange)==null?void 0:e[0],submitEndTime:(a=n.submitTimeRange)==null?void 0:a[1],completedTaskCount:n.completedTaskCount,keyword:n.keyword,taskGroupId:n.taskGroupId};await Ue("taskSubmitted.confirmAuditExport",i,`复审列表_${new Date().toLocaleDateString()}.xlsx`),p(),g.success(m("common.exportSuccess"))}catch(p){console.error("导出失败:",p),g.error(m("common.exportFailed"))}}})},X=async(e="")=>{try{const a=await D("group.list",{page:1,pageSize:50,keyword:e});a.code===0&&(V.value=a.data.list||[])}catch{g.error("获取群组列表失败")}},H=async()=>{var e,a;U.value=!0;try{const p={page:T.current,pageSize:T.pageSize,taskName:n.taskName,channelId:n.channelId,taskAuditStatus:n.taskAuditStatus,preWaiterId:n.preWaiterId,groupId:n.groupId,submitStartTime:(e=n.submitTimeRange)==null?void 0:e[0],submitEndTime:(a=n.submitTimeRange)==null?void 0:a[1],completedTaskCount:n.completedTaskCount,keyword:n.keyword,taskGroupId:n.taskGroupId},i=await D("taskSubmitted.confirmAuditList",{...p,...K});i.code===0?(R.value=i.data.list,T.total=i.data.total,q.value=i.data.totalAmount):g.error(i.message)}finally{U.value=!1}},_e=async()=>{if(F.value.length)return;const e=await D("waiter.list",{page:1,pageSize:100});e.code===0&&(F.value=e.data.list||[])},Z=v([]),x=async(e="")=>{const a=await D("taskGroup.list",{page:1,pageSize:50,taskGroupName:e});a.code===0&&(Z.value=a.data.list||[])};return Ge(()=>{de(),H(),X(),ge(),_e(),x()}),(e,a)=>{const p=c("a-input"),i=c("a-form-item"),w=c("a-select-option"),j=c("a-select"),Te=c("a-range-picker"),we=c("a-input-number"),G=c("a-button"),I=c("a-space"),Ae=c("a-form"),Se=c("DownloadOutlined"),Ie=c("a-avatar"),ee=c("a-tag"),Ce=c("a-typography-link"),te=c("a-popconfirm"),$e=c("a-table"),A=c("a-descriptions-item"),ae=c("a-descriptions"),se=c("a-modal"),Ne=c("a-textarea");return u(),k("div",Pe,[_("div",ze,[_("div",Be,[_("div",Le,[l(Ae,{layout:"inline",model:n},{default:s(()=>[l(i,{label:e.$t("submittedTasks.search.taskName")},{default:s(()=>[l(p,{value:n.taskName,"onUpdate:value":a[0]||(a[0]=t=>n.taskName=t),placeholder:e.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),l(i,{label:e.$t("submittedTasks.search.channel")},{default:s(()=>[l(j,{value:n.channelId,"onUpdate:value":a[1]||(a[1]=t=>n.channelId=t),placeholder:e.$t("submittedTasks.search.channelPlaceholder"),"allow-clear":""},{default:s(()=>[(u(!0),k(y,null,$(L.value,t=>(u(),b(w,{key:t.id,value:t.id},{default:s(()=>[r(o(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(i,{label:e.$t("submittedTasks.search.submitTime")},{default:s(()=>[l(Te,{value:n.submitTimeRange,"onUpdate:value":a[2]||(a[2]=t=>n.submitTimeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),l(i,{label:e.$t("submittedTasks.search.taskAuditStatus")},{default:s(()=>[l(j,{value:n.taskAuditStatus,"onUpdate:value":a[3]||(a[3]=t=>n.taskAuditStatus=t),placeholder:e.$t("submittedTasks.search.taskAuditStatusPlaceholder"),"allow-clear":""},{default:s(()=>[(u(!0),k(y,null,$(ue.value,t=>(u(),b(w,{key:t.value,value:t.value},{default:s(()=>[r(o(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(i,{label:e.$t("submittedTasks.search.preAuditor")},{default:s(()=>[l(j,{value:n.preWaiterId,"onUpdate:value":a[4]||(a[4]=t=>n.preWaiterId=t),placeholder:e.$t("submittedTasks.search.preAuditorPlaceholder"),"allow-clear":""},{default:s(()=>[(u(!0),k(y,null,$(F.value,t=>(u(),b(w,{key:t.id,value:t.id},{default:s(()=>[r(o(t.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(i,{label:e.$t("submittedTasks.search.groupId")},{default:s(()=>[l(j,{value:n.groupId,"onUpdate:value":a[5]||(a[5]=t=>n.groupId=t),placeholder:e.$t("submittedTasks.search.groupIdPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:X},{default:s(()=>[(u(!0),k(y,null,$(V.value,t=>(u(),b(w,{key:t.id,value:t.id},{default:s(()=>[r(o(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(i,{label:e.$t("submittedTasks.search.completedTaskCount")},{default:s(()=>[l(we,{value:n.completedTaskCount,"onUpdate:value":a[6]||(a[6]=t=>n.completedTaskCount=t),min:0,max:9999,"addon-after":e.$t("submittedTasks.search.times")},null,8,["value","addon-after"])]),_:1},8,["label"]),l(i,{label:e.$t("member.search.keyword")},{default:s(()=>[l(p,{value:n.keyword,"onUpdate:value":a[7]||(a[7]=t=>n.keyword=t),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),l(i,{label:e.$t("task.search.taskGroup")},{default:s(()=>[l(j,{value:n.taskGroupId,"onUpdate:value":a[8]||(a[8]=t=>n.taskGroupId=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:"","show-search":"","filter-option":!1,onSearch:x},{default:s(()=>[(u(!0),k(y,null,$(Z.value,t=>(u(),b(w,{key:t.id,value:t.id},{default:s(()=>[r(o(t.taskGroupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(i,null,{default:s(()=>[l(I,null,{default:s(()=>[l(G,{type:"primary",onClick:J},{default:s(()=>[r(o(e.$t("common.search")),1)]),_:1}),l(G,{onClick:ce},{default:s(()=>[r(o(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",Ve,[l(I,null,{default:s(()=>[R.value.length?(u(),b(G,{key:0,onClick:ye},{icon:s(()=>[l(Se)]),default:s(()=>[r(" "+o(e.$t("common.export")),1)]),_:1})):f("",!0),l(G,{type:"primary",onClick:Q},{default:s(()=>[r(o(e.$t("common.batchResolve")),1)]),_:1}),l(G,{danger:"",onClick:he},{default:s(()=>[r(o(e.$t("common.batchReject")),1)]),_:1})]),_:1})])]),l($e,{columns:re.value,"data-source":R.value,loading:U.value,pagination:T,showSorterTooltip:!1,"row-selection":ie,rowKey:"id",onChange:me},{bodyCell:s(({column:t,record:d})=>[t.key==="taskName"?(u(),b(I,{key:0},{default:s(()=>[l(Ie,{src:d.channelIcon,size:"small"},null,8,["src"]),_("span",null,o(d.taskName),1),d.taskGroup?(u(),b(ee,{key:0,color:"orange"},{default:s(()=>[r(o(d.taskGroup.taskGroupName),1)]),_:2},1024)):f("",!0)]),_:2},1024)):f("",!0),t.key==="taskAuditStatus"?(u(),k(y,{key:1},[r(o(Ye(M).getEnumText("TaskAuditStatus",d.taskAuditStatus)),1)],64)):f("",!0),t.key==="preWaiterName"?(u(),k(y,{key:2},[r(o(d.preWaiterName||"--"),1)],64)):f("",!0),t.key==="preAuditTime"?(u(),k(y,{key:3},[r(o(d.preAuditTime||"--"),1)],64)):f("",!0),t.key==="waiterName"?(u(),k(y,{key:4},[r(o(d.waiterName||"--"),1)],64)):f("",!0),t.key==="confirmAuditTime"?(u(),k(y,{key:5},[r(o(d.auditTime||"--"),1)],64)):f("",!0),t.key==="member"?(u(),k(y,{key:6},[_("div",null,[l(I,null,{default:s(()=>[l(Ce,{onClick:C=>pe(d)},{default:s(()=>[r(o(d.nickname),1)]),_:2},1032,["onClick"]),d.isNew?(u(),b(ee,{key:0,color:"green"},{default:s(()=>a[12]||(a[12]=[r("new")])),_:1})):f("",!0)]),_:2},1024)]),_("div",null,o(d.account),1),(u(!0),k(y,null,$(d.groups,C=>(u(),k("div",null,[l(I,null,{default:s(()=>[_("span",null,o(C.groupName),1),C.isOwner?(u(),b(He,{key:0})):f("",!0)]),_:2},1024)]))),256))],64)):f("",!0),t.key==="action"?(u(),b(I,{key:7},{default:s(()=>[_("a",{onClick:C=>ke(d)},o(e.$t("submittedTasks.list.view")),9,qe),d.taskAuditStatus==="pending"?(u(),b(te,{key:0,title:e.$t("submittedTasks.list.confirmResolve"),onConfirm:C=>fe(d)},{default:s(()=>[_("a",null,o(e.$t("submittedTasks.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):f("",!0),d.taskAuditStatus==="pending"?(u(),b(te,{key:1,title:e.$t("submittedTasks.list.confirmReject"),onConfirm:C=>ve(d)},{default:s(()=>[_("a",Ke,o(e.$t("submittedTasks.list.reject")),1)]),_:2},1032,["title","onConfirm"])):f("",!0)]),_:2},1024)):f("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),T.total?(u(),k("div",Je,[l(ae,{column:2},{default:s(()=>[l(A,{label:e.$t("common.totalCount")},{default:s(()=>[r(o(T.total),1)]),_:1},8,["label"]),l(A,{label:e.$t("common.totalAmount")},{default:s(()=>[r(o(q.value),1)]),_:1},8,["label"])]),_:1})])):f("",!0)]),l(se,{open:z.value,"onUpdate:open":a[9]||(a[9]=t=>z.value=t),title:"任务详情",footer:null},{default:s(()=>[l(ae,{column:1},{default:s(()=>[l(A,{label:"任务名称"},{default:s(()=>{var t;return[r(o((t=O.value)==null?void 0:t.taskName),1)]}),_:1}),l(A,{label:"任务类型"},{default:s(()=>{var t;return[r(o((t=O.value)==null?void 0:t.taskType),1)]}),_:1}),l(A,{label:"任务描述"},{default:s(()=>{var t;return[r(o((t=O.value)==null?void 0:t.description),1)]}),_:1}),l(A,{label:"任务奖励"},{default:s(()=>{var t;return[r(o((t=O.value)==null?void 0:t.reward),1)]}),_:1}),l(A,{label:"创建时间"},{default:s(()=>{var t;return[r(o((t=O.value)==null?void 0:t.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),l(se,{open:N.value,"onUpdate:open":a[11]||(a[11]=t=>N.value=t),title:"拒绝原因",onOk:be,confirmLoading:W.value},{default:s(()=>[l(Ne,{value:S.value,"onUpdate:value":a[10]||(a[10]=t=>S.value=t),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},at=Oe(Qe,[["__scopeId","data-v-6a468748"]]);export{at as default};
