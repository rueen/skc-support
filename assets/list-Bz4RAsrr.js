import{_ as pe,i as me,j as _e,r as m,a as q,k as ve,b,d as c,c as l,w as a,e as s,l as T,m as p,f as fe,o as u,F as N,n as U,p as v,h as i,t as d,q as f,g as ke,z as V}from"./index-IvzggnH7.js";const ge={class:"task-audit content-container"},ye={class:"table-container"},be={class:"table-header"},we={class:"left"},he={class:"right"},Se={key:2},Ce={class:"group-name"},xe=["onClick"],Ae={__name:"list",setup(Ne){const R=me(),M=_e(()=>R.loaded?R.getEnumOptions("TaskAuditStatus"):[]),P=fe(),I=m(!1),z=m(!1),w=m(!1),B=m(!1),k=m(""),h=m(null),_=m([]),o=q({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0}),E=m([]),L=m([]),H=[{title:"任务名称",key:"taskName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:"操作",key:"action",fixed:"right",width:180}],$=m([]),g=q({current:1,pageSize:10,total:0}),J={selectedRowKeys:_,onChange:n=>{_.value=n},getCheckboxProps:n=>({disabled:n.taskAuditStatus!=="pending"})},D=()=>{g.current=1,y()},Q=()=>{o.taskName="",o.channelId=void 0,o.taskAuditStatus=void 0,o.groupId=void 0,D()},W=n=>{Object.assign(g,n),y()},X=n=>{P.push(`/task-submitted/detail/${n.id}`)},Y=async n=>{const t=await V("taskSubmitted.batchResolve",{ids:[n.id]});t.code===0?(p.success("审核通过成功"),y()):p.error(t.message)},Z=async()=>{if(!_.value.length){p.warning("请选择要通过的任务");return}const n=await V("taskSubmitted.batchResolve",{ids:_.value});n.code===0?(p.success("批量审核通过成功"),_.value=[],y()):p.error(n.message)},ee=n=>{_.value=[n.id],k.value="",w.value=!0},te=async()=>{if(!k.value){p.error("请输入拒绝原因");return}B.value=!0;const n=await V("taskSubmitted.batchReject",{ids:_.value,reason:k.value});n.code===0?(p.success("审核拒绝成功"),w.value=!1,y()):p.error(n.message)},ae=()=>{if(!_.value.length){p.warning("请选择要拒绝的任务");return}k.value="",w.value=!0},ne=async()=>{const n=await T("channel.list");n.code===0&&(E.value=n.data.list)},le=async(n="")=>{try{const t=await T("group.list",{params:{page:1,pageSize:50,keyword:n}});t.code===0&&(L.value=t.data.list||[])}catch{p.error("获取群组列表失败")}},y=async()=>{I.value=!0;try{const n=await T("taskSubmitted.list",{page:g.current,pageSize:g.pageSize,...o});n.code===0?($.value=n.data.list,g.total=n.data.total):p.error(n.message)}finally{I.value=!1}};return ve(()=>{y(),le(),ne()}),(n,t)=>{const se=s("a-input"),S=s("a-form-item"),j=s("a-select-option"),O=s("a-select"),x=s("a-button"),A=s("a-space"),oe=s("a-form"),ue=s("a-avatar"),ie=s("a-tag"),F=s("a-popconfirm"),de=s("a-table"),C=s("a-descriptions-item"),re=s("a-descriptions"),G=s("a-modal"),ce=s("a-textarea");return u(),b("div",ge,[c("div",ye,[c("div",be,[c("div",we,[l(oe,{layout:"inline",model:o},{default:a(()=>[l(S,{label:"任务名称"},{default:a(()=>[l(se,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=e=>o.taskName=e),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),l(S,{label:"平台渠道"},{default:a(()=>[l(O,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=e=>o.channelId=e),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(u(!0),b(N,null,U(E.value,e=>(u(),v(j,{key:e.id,value:e.id},{default:a(()=>[i(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(S,{label:"审核状态"},{default:a(()=>[l(O,{value:o.taskAuditStatus,"onUpdate:value":t[2]||(t[2]=e=>o.taskAuditStatus=e),placeholder:"请选择审核状态",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(u(!0),b(N,null,U(M.value,e=>(u(),v(j,{key:e.value,value:e.value},{default:a(()=>[i(d(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(S,{label:"所属群组"},{default:a(()=>[l(O,{value:o.groupId,"onUpdate:value":t[3]||(t[3]=e=>o.groupId=e),placeholder:"请选择群组",style:{width:"120px"},"allow-clear":""},{default:a(()=>[(u(!0),b(N,null,U(L.value,e=>(u(),v(j,{key:e.id,value:e.id},{default:a(()=>[i(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),l(S,null,{default:a(()=>[l(A,null,{default:a(()=>[l(x,{type:"primary",onClick:D},{default:a(()=>t[7]||(t[7]=[i("查询")])),_:1}),l(x,{onClick:Q},{default:a(()=>t[8]||(t[8]=[i("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),c("div",he,[l(A,null,{default:a(()=>[l(x,{type:"primary",onClick:Z},{default:a(()=>t[9]||(t[9]=[i("批量通过")])),_:1}),l(x,{danger:"",onClick:ae},{default:a(()=>t[10]||(t[10]=[i("批量拒绝")])),_:1})]),_:1})])]),l(de,{columns:H,"data-source":$.value,loading:I.value,pagination:g,"row-selection":J,rowKey:"id",onChange:W},{bodyCell:a(({column:e,record:r})=>[e.key==="taskName"?(u(),v(A,{key:0},{default:a(()=>[l(ue,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,d(r.taskName),1)]),_:2},1024)):f("",!0),e.key==="taskAuditStatus"?(u(),b(N,{key:1},[i(d(ke(R).getEnumText("TaskAuditStatus",r.taskAuditStatus)),1)],64)):f("",!0),e.key==="member"?(u(),b("div",Se,[c("div",null,d(r.memberNickname),1),c("div",Ce,[c("span",null,d(r.groupName),1),r.isGroupOwner?(u(),v(ie,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>t[11]||(t[11]=[i("群主")])),_:1})):f("",!0)])])):f("",!0),e.key==="action"?(u(),v(A,{key:3},{default:a(()=>[c("a",{onClick:K=>X(r)},"查看",8,xe),r.taskAuditStatus==="pending"?(u(),v(F,{key:0,title:"确定要通过该任务吗？",onConfirm:K=>Y(r)},{default:a(()=>t[12]||(t[12]=[c("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):f("",!0),r.taskAuditStatus==="pending"?(u(),v(F,{key:1,title:"确定要拒绝该任务吗？",onConfirm:K=>ee(r)},{default:a(()=>t[13]||(t[13]=[c("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):f("",!0)]),_:2},1024)):f("",!0)]),_:1},8,["data-source","loading","pagination"])]),l(G,{open:z.value,"onUpdate:open":t[4]||(t[4]=e=>z.value=e),title:"任务详情",footer:null},{default:a(()=>[l(re,{column:1},{default:a(()=>[l(C,{label:"任务名称"},{default:a(()=>{var e;return[i(d((e=h.value)==null?void 0:e.taskName),1)]}),_:1}),l(C,{label:"任务类型"},{default:a(()=>{var e;return[i(d((e=h.value)==null?void 0:e.taskType),1)]}),_:1}),l(C,{label:"任务描述"},{default:a(()=>{var e;return[i(d((e=h.value)==null?void 0:e.description),1)]}),_:1}),l(C,{label:"任务奖励"},{default:a(()=>{var e;return[i(d((e=h.value)==null?void 0:e.reward),1)]}),_:1}),l(C,{label:"创建时间"},{default:a(()=>{var e;return[i(d((e=h.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),l(G,{open:w.value,"onUpdate:open":t[6]||(t[6]=e=>w.value=e),title:"拒绝原因",onOk:te,confirmLoading:B.value},{default:a(()=>[l(ce,{value:k.value,"onUpdate:value":t[5]||(t[5]=e=>k.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ie=pe(Ae,[["__scopeId","data-v-ea531918"]]);export{Ie as default};
