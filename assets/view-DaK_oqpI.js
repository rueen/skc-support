import{_ as Ae,c as Re,a as Be,r as v,e as L,d as Pe,D as Ue,p as De,z as Ne,f as b,h as a,g as i,t as s,w as t,i as r,F as S,l as M,q as f,j as ze,o as d,n as _,x as g,k as m,m as G,M as Ee,y as qe,v as k,C as ee}from"./index-BknH-23p.js";import{P as Fe}from"./PageHeader-BgqNhcCq.js";import{_ as V}from"./CopyContent-BegEEud4.js";import{G as Me}from"./GroupOwner--jAXpdqN.js";const Ge={class:"member-view content-container"},Ve={class:"detail-container"},je={class:"section"},He={class:"section-title"},We={key:0},Je={key:0},Ke={style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},Qe={class:"section"},Xe={class:"section-title"},Ye={class:"account-list"},Ze={class:"link-text-container",style:{"max-width":"300px"}},xe=["href"],ea={class:"section",style:{"padding-bottom":"24px"}},aa={class:"section-title"},ta={class:"section",style:{"padding-bottom":"24px"}},la={class:"section-title"},na={class:"section"},sa={class:"section-title"},oa={key:1},ra={__name:"view",setup(ia){const{t:w}=Re(),A=Be(),R=Ne(),j=ze(),p=v(""),o=L({}),H=v([]),ae=Pe(()=>`${Ue.h5Url}?inviteCode=${o.inviteCode}`),B=L({}),P=L({}),U=L({}),W=v(),h=v(!1),T=v("grant"),c=L({amount:"",remark:"",relatedTaskId:null}),I=v(!1),te=v({amount:[{required:!0,message:w("member.view.amountRequired")}],remark:[{required:!0,message:w("member.view.remarkRequired")}]}),le=()=>{const e={};R.query.filters&&(e.filters=R.query.filters),j.push({name:"MemberList",query:e})},ne=async()=>{const e=await f("member.detail",{},{urlParams:{id:p.value}});e.code===0&&Object.assign(o,e.data||{})},D=async()=>{const e=await f("member.balance",{},{urlParams:{memberId:p.value}});e.code===0&&(o.balance=e.data.balance)},se=async()=>{const e=await f("member.withdrawalsAccount",{},{urlParams:{memberId:p.value}});e.code===0&&(o.withdrawalsAccount=e.data[0]||{})},J=async()=>{const e=await f("account.list",{memberId:p.value});e.code===0&&(H.value=e.data.list||[])},oe=e=>{j.push({name:"AccountEdit",params:{id:e.id}})},re=e=>{Ee.confirm({content:w("common.deleteConfirm"),onOk:async()=>{const n=await qe("account.delete",{},{urlParams:{id:e.id}});n.code===0?(k.success(n.message),J()):k.error(n.message)}})},ie=async()=>{const e=await f("member.taskStats",{},{urlParams:{memberId:p.value}});e.code===0&&Object.assign(B,e.data||{})},ue=async()=>{const e=await f("member.inviteStats",{},{urlParams:{memberId:p.value}});e.code===0&&Object.assign(P,e.data||{})},me=async()=>{const e=await f("member.groupsStats",{},{urlParams:{memberId:p.value}});e.code===0&&Object.assign(U,e.data||{})},K=v([]),N=async(e="")=>{const n=await f("taskSubmitted.preAuditList",{page:1,pageSize:30,keyword:o.account,taskName:e,sorterField:"preAuditTime",sorterOrder:"descend"});n.code===0&&(K.value=n.data.list||[])},de=()=>{h.value=!0,T.value="grant",N()},ce=()=>{h.value=!0,T.value="deduct",N()},z=v(!1),pe=v([{title:w("member.view.balanceLogs.beforeBalance"),dataIndex:"beforeBalance",key:"beforeBalance",width:120},{title:w("member.view.balanceLogs.amount"),dataIndex:"amount",key:"amount",width:120},{title:w("member.view.balanceLogs.afterBalance"),dataIndex:"afterBalance",key:"afterBalance",width:120},{title:w("member.view.balanceLogs.transactionType"),key:"transactionType"},{title:w("member.view.balanceLogs.createTime"),dataIndex:"createTime",key:"createTime"}]),Q=v([]),ve=async()=>{z.value=!0;const e=await f("member.balanceLogs",{pageSize:3e3,pageNum:1},{urlParams:{memberId:p.value}});e.code===0&&(Q.value=e.data.list||[])},be=async()=>{I.value=!0;try{const e={memberId:p.value,amount:c.amount,remark:c.remark};c.relatedTaskId&&(e.taskId=c.relatedTaskId);const n=await ee("member.grantReward",{...e});n.code===0?(k.success("奖励发放成功"),h.value=!1,D()):k.error(n.message)}catch{k.error("奖励发放失败")}finally{I.value=!1}},fe=async()=>{I.value=!0;try{const e={memberId:p.value,amount:c.amount,remark:c.remark};c.relatedTaskId&&(e.taskId=c.relatedTaskId);const n=await ee("member.deductReward",{...e},{urlParams:{memberId:p.value}});n.code===0?(k.success("奖励扣除成功"),h.value=!1,D()):k.error(n.message)}catch{k.error("奖励扣除失败")}finally{I.value=!1}},we=async()=>{try{switch(await W.value.validate(),T.value){case"grant":be();break;case"deduct":fe();break}}catch(e){console.log(e)}};return De(()=>{p.value=R.params.id,ne(),D(),J(),ie(),ue(),me(),se()}),(e,n)=>{const _e=r("UserOutlined"),X=r("a-avatar"),Y=r("a-tag"),O=r("a-space"),u=r("a-descriptions-item"),E=r("a-button"),ge=r("PlusOutlined"),ke=r("MinusOutlined"),Z=r("a-descriptions"),ye=r("EditOutlined"),he=r("DeleteOutlined"),$=r("a-statistic"),C=r("a-col"),q=r("a-row"),$e=r("a-input"),F=r("a-form-item"),Ce=r("a-select-option"),Te=r("a-select"),Ie=r("a-textarea"),Oe=r("a-form"),x=r("a-modal"),Le=r("a-typography-text"),Se=r("a-table");return d(),b("div",Ge,[a(Fe,{title:e.$t("member.view.pageTitle"),back:!0,useDefaultBack:!1,onBack:le},null,8,["title"]),i("div",Ve,[i("div",je,[i("div",He,s(e.$t("member.view.memberInfo")),1),a(Z,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[a(u,{label:e.$t("member.view.memberNickname")},{default:t(()=>[a(O,null,{default:t(()=>[a(X,{src:o.avatar,size:"small"},{icon:t(()=>[a(_e)]),_:1},8,["src"]),i("span",null,s(o.nickname),1),o.isNew?(d(),_(Y,{key:0,color:"green"},{default:t(()=>n[8]||(n[8]=[m("new")])),_:1})):g("",!0)]),_:1})]),_:1},8,["label"]),a(u,{label:e.$t("member.view.memberAccount")},{default:t(()=>[m(s(o.account),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.gender")},{default:t(()=>[m(s(G(A).getEnumText("GenderType",o.gender)),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.occupation")},{default:t(()=>[m(s(G(A).getEnumText("OccupationType",o.occupation))+" ",1),o.occupation===null?(d(),b("span",We," - ")):g("",!0)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.email")},{default:t(()=>[m(s(o.email||"-"),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.phone")},{default:t(()=>[m(s(o.phone||"-"),1)]),_:1},8,["label"]),a(u,{label:"Telegram"},{default:t(()=>[m(s(o.telegram||"-"),1)]),_:1}),a(u,{label:e.$t("member.view.group")},{default:t(()=>[(d(!0),b(S,null,M(o.groups,l=>(d(),_(O,{key:l.id},{default:t(()=>[m(s(l.groupName)+" ",1),l.isOwner?(d(),_(Me,{key:0})):g("",!0)]),_:2},1024))),128)),!o.groups||!o.groups.length?(d(),b("span",Je," - ")):g("",!0)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.inviter")},{default:t(()=>[m(s(o.inviterNickname||"-"),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.inviteUrl")},{default:t(()=>[a(V,{content:ae.value},null,8,["content"])]),_:1},8,["label"]),a(u,{label:e.$t("member.view.withdrawalsAccount")},{default:t(()=>[a(O,null,{default:t(()=>{var l,y;return[i("span",null,s(((l=o==null?void 0:o.withdrawalsAccount)==null?void 0:l.paymentChannelName)||"-"),1),i("span",null,s(((y=o==null?void 0:o.withdrawalsAccount)==null?void 0:y.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),a(u,{label:e.$t("member.view.balance")},{default:t(()=>[i("div",Ke,[i("span",null,s(o.balance),1),a(E,{type:"link",size:"small",onClick:n[0]||(n[0]=l=>ve())},{default:t(()=>[m(s(e.$t("member.view.balanceLogs.view")),1)]),_:1}),a(E,{type:"primary",size:"small",onClick:n[1]||(n[1]=l=>de()),style:{"margin-left":"16px"}},{default:t(()=>[a(ge),m(" "+s(e.$t("member.view.rewardGrant")),1)]),_:1}),a(E,{size:"small",danger:"",onClick:n[2]||(n[2]=l=>ce()),style:{"margin-left":"16px"}},{default:t(()=>[a(ke),m(" "+s(e.$t("member.view.rewardDeduct")),1)]),_:1})])]),_:1},8,["label"])]),_:1})]),i("div",Qe,[i("div",Xe,s(e.$t("member.view.accountInfo")),1),i("div",Ye,[(d(!0),b(S,null,M(H.value,l=>(d(),b("div",{key:l.channelId},[a(Z,{column:1},{default:t(()=>[a(u,{label:e.$t("member.view.account")},{default:t(()=>[a(O,{size:24},{default:t(()=>[a(O,null,{default:t(()=>[a(X,{src:l.channelIcon,size:"small"},null,8,["src"]),i("span",null,s(l.account),1),a(Y,{color:"warning"},{default:t(()=>[m(s(G(A).getEnumText("AccountAuditStatus",l.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024),a(ye,{onClick:y=>oe(l)},null,8,["onClick"]),a(he,{onClick:y=>re(l)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),a(u,{label:e.$t("member.view.homepage")},{default:t(()=>[a(V,{content:l.homeUrl},{default:t(()=>[i("div",Ze,[i("a",{href:l.homeUrl,target:"_blank",class:"link-text"},s(l.homeUrl),9,xe)])]),_:2},1032,["content"])]),_:2},1032,["label"]),a(u,{label:"uid"},{default:t(()=>[a(V,{content:l.uid},null,8,["content"])]),_:2},1024),l.channelCustomFields.includes("fansCount")?(d(),_(u,{key:0,label:e.$t("member.view.fansCount")},{default:t(()=>[m(s(l.fansCount),1)]),_:2},1032,["label"])):g("",!0),l.channelCustomFields.includes("friendsCount")?(d(),_(u,{key:1,label:e.$t("member.view.friendsCount")},{default:t(()=>[m(s(l.friendsCount),1)]),_:2},1032,["label"])):g("",!0),l.channelCustomFields.includes("postsCount")?(d(),_(u,{key:2,label:e.$t("member.view.postsCount")},{default:t(()=>[m(s(l.postsCount),1)]),_:2},1032,["label"])):g("",!0)]),_:2},1024)]))),128))])]),i("div",ea,[i("div",aa,s(e.$t("member.view.taskStats")),1),a(q,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.completedTaskCount"),value:B.completedTaskCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.taskReward"),value:B.totalTaskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),i("div",ta,[i("div",la,s(e.$t("member.view.inviteStats")),1),a(q,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.inviteCount"),value:P.inviteCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.inviteReward"),value:P.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),i("div",na,[i("div",sa,s(e.$t("member.view.groupStats")),1),a(q,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.groupCount"),value:U.groupCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.groupEarnings"),value:U.totalCommission},null,8,["title","value"])]),_:1})]),_:1})])]),a(x,{open:h.value,"onUpdate:open":n[6]||(n[6]=l=>h.value=l),title:T.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:we,confirmLoading:I.value},{default:t(()=>[a(Oe,{ref_key:"rewardFormRef",ref:W,model:c,rules:te.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:t(()=>[a(F,{label:T.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:t(()=>[a($e,{value:c.amount,"onUpdate:value":n[3]||(n[3]=l=>c.amount=l)},null,8,["value"])]),_:1},8,["label"]),a(F,{label:e.$t("member.view.relatedTask")},{default:t(()=>[a(Te,{value:c.relatedTaskId,"onUpdate:value":n[4]||(n[4]=l=>c.relatedTaskId=l),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:N},{default:t(()=>[(d(!0),b(S,null,M(K.value,l=>(d(),_(Ce,{key:l.taskId,value:l.taskId},{default:t(()=>[m(s(l.taskName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(F,{label:e.$t("member.view.remark"),name:"remark"},{default:t(()=>[a(Ie,{value:c.remark,"onUpdate:value":n[5]||(n[5]=l=>c.remark=l),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"]),a(x,{open:z.value,"onUpdate:open":n[7]||(n[7]=l=>z.value=l),title:e.$t("member.view.balanceLogs.title"),width:800},{default:t(()=>[a(Se,{size:"small",columns:pe.value,"data-source":Q.value,pagination:!1,scroll:{y:400}},{bodyCell:t(({column:l,record:y})=>[l.key==="transactionType"?(d(),b(S,{key:0},[y.transactionType==="withdrawal_refund"?(d(),_(Le,{key:0,type:"danger"},{default:t(()=>n[9]||(n[9]=[m("余额退还")])),_:1})):(d(),b("span",oa,s(y.transactionType),1))],64)):g("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open","title"])])}}},pa=Ae(ra,[["__scopeId","data-v-05349b69"]]);export{pa as default};
