import{_ as re,a as ue,b as ie,j as L,r as R,x as pe,c as me,k as ce,d as c,f as t,e as k,w as s,g as n,l as H,m as f,y as v,h as fe,o as m,F as w,n as I,p as b,i as u,t as r,s as V,q as z,Q as ke,P as ve,z as ge,A as be}from"./index-BHj_wI8R.js";import{P as he}from"./PageHeader-DT7Ragp0.js";const ye={class:"task-form content-container"},Te={class:"form-container"},_e={class:"group-select"},$e={key:1,class:"group-tip"},qe={class:"user-range"},Re={key:0,class:"task-count"},we=["innerHTML"],Ie={class:"quota-container"},Pe={class:"custom-fields"},Ye={__name:"detail",setup(Me){const N=ue(),{t:i}=ie(),A=L(()=>N.loaded?N.getEnumOptions("TaskType"):[]),P=pe(),Y=fe(),O=R(),M=L(()=>P.name==="TaskEdit"),a=me({taskName:"",channelId:void 0,category:void 0,taskType:void 0,reward:void 0,brand:"",groupIds:[],groupMode:0,customFields:[{title:"",type:"input"}],startTime:null,endTime:null,quota:void 0,unlimitedQuota:!0,fansRequired:void 0,contentRequirement:"",taskInfo:"",notice:`1.请尽快完成发布，填写发布链接。
2.任务结束后无法填写，不能结算。
3.发布内容不符合要求，将无法审核通过。
4.填写链接无法访问或其他无关链接，视为放弃结算。`,userRange:0,taskCount:0}),J={taskName:[{required:!0,message:i("task.detail.validation.taskNameRequired")}],channelId:[{required:!0,message:i("task.detail.validation.channelRequired")}],category:[{required:!0,message:i("task.detail.validation.categoryRequired")}],taskType:[{required:!0,message:i("task.detail.validation.taskTypeRequired")}],reward:[{required:!0,message:i("task.detail.validation.rewardRequired")}],fansRequired:[{required:!0,message:i("task.detail.validation.fansRequired")}],groupIds:[{validator:(e,l)=>a.groupMode===1&&(!l||l.length===0)?Promise.reject(i("task.detail.validation.groupRequired")):Promise.resolve()}],taskCount:[{validator:(e,l)=>a.userRange===1&&l==null?Promise.reject(i("task.detail.validation.taskCountRequired")):Promise.resolve()}]},S=R([]),Q=R([]),K=()=>{a.customFields.length<10&&a.customFields.push({title:"",type:"input"})},W=e=>{a.customFields.splice(e,1)},X=e=>{e.target.value===0&&(a.groupIds=[])},Z=async()=>{try{h.value=!0;const e={...a,groupIds:a.groupMode===0?[]:a.groupIds,startTime:a.startTime?v(a.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:a.endTime?v(a.endTime).format("YYYY-MM-DD HH:mm:ss"):null},l=await be("task.add",e);l.code===0?(f.success(i("task.detail.submitSuccess")),Y.back()):f.error(l.message)}catch(e){console.log(e),f.error(i("task.detail.submitFailed"))}finally{h.value=!1}},x=async()=>{try{h.value=!0;const e={...a,groupIds:a.groupMode===0?[]:a.groupIds,startTime:a.startTime?v(a.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:a.endTime?v(a.endTime).format("YYYY-MM-DD HH:mm:ss"):null},l=await ge("task.edit",{...e},{urlParams:{id:P.params.id}});l.code===0?(f.success(i("task.detail.submitSuccess")),Y.back()):f.error(l.message)}catch(e){console.log(e),f.error(i("task.detail.submitFailed"))}finally{h.value=!1}},h=R(!1),ee=()=>{O.value.validate().then(async()=>{M.value?await x():await Z()})},ae=()=>{Y.back()},te=async e=>{try{const l=await H("task.detail",{},{urlParams:{id:e}});if(l.code===0){let p={};for(let d in l.data)d!=="groups"&&(p[d]=l.data[d]);p.startTime&&(p.startTime=v(p.startTime)),p.endTime&&(p.endTime=v(p.endTime)),Object.assign(a,p)}}catch(l){console.log(l),f.error(l)}},le=async()=>{const e=await H("channel.list");e.code===0&&(S.value=e.data.list)},j=async(e="")=>{try{const l=await H("group.list",{page:1,pageSize:50,groupName:e});l.code===0&&(Q.value=l.data.list||[])}catch{f.error(i("task.detail.loadGroupFailed"))}};return ce(()=>{le(),j(),M.value&&te(P.params.id)}),(e,l)=>{const p=n("a-input"),d=n("a-form-item"),g=n("a-select-option"),y=n("a-select"),T=n("a-input-number"),E=n("a-date-picker"),U=n("a-col"),se=n("a-row"),_=n("a-radio"),G=n("a-radio-group"),B=n("a-form-item-rest"),oe=n("a-tooltip"),de=n("a-checkbox"),C=n("a-space"),$=n("a-button"),D=n("a-textarea"),ne=n("a-form");return m(),c("div",ye,[t(he,{title:M.value?e.$t("task.detail.editTitle"):e.$t("task.detail.createTitle"),back:!0,class:"page-header"},null,8,["title"]),k("div",Te,[t(ne,{ref_key:"formRef",ref:O,model:a,rules:J,"label-col":{span:5},"wrapper-col":{span:18},layout:"horizontal"},{default:s(()=>[t(d,{label:e.$t("task.detail.taskName"),name:"taskName"},{default:s(()=>[t(p,{value:a.taskName,"onUpdate:value":l[0]||(l[0]=o=>a.taskName=o),placeholder:e.$t("task.detail.taskNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.channelId"),name:"channelId"},{default:s(()=>[t(y,{value:a.channelId,"onUpdate:value":l[1]||(l[1]=o=>a.channelId=o),placeholder:e.$t("task.detail.channelPlaceholder")},{default:s(()=>[(m(!0),c(w,null,I(S.value,o=>(m(),b(g,{key:o.id,value:o.id},{default:s(()=>[u(r(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.category"),name:"category"},{default:s(()=>[t(p,{value:a.category,"onUpdate:value":l[2]||(l[2]=o=>a.category=o),placeholder:e.$t("task.detail.categoryPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.taskType"),name:"taskType"},{default:s(()=>[t(y,{value:a.taskType,"onUpdate:value":l[3]||(l[3]=o=>a.taskType=o),placeholder:e.$t("task.detail.taskTypePlaceholder")},{default:s(()=>[(m(!0),c(w,null,I(A.value,o=>(m(),b(g,{key:o.value,value:o.value},{default:s(()=>[u(r(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.reward"),name:"reward"},{default:s(()=>[t(T,{value:a.reward,"onUpdate:value":l[4]||(l[4]=o=>a.reward=o),min:0,precision:2,step:.1,placeholder:e.$t("task.detail.rewardPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.fansRequired"),name:"fansRequired"},{default:s(()=>[t(T,{value:a.fansRequired,"onUpdate:value":l[5]||(l[5]=o=>a.fansRequired=o),min:0,step:1,placeholder:e.$t("task.detail.fansRequiredPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.taskTime"),required:""},{default:s(()=>[t(se,{gutter:8},{default:s(()=>[t(U,{span:11},{default:s(()=>[t(d,{name:"startTime",rules:[{required:!0,message:e.$t("task.detail.validation.startTimeRequired")}]},{default:s(()=>[t(E,{value:a.startTime,"onUpdate:value":l[6]||(l[6]=o=>a.startTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("task.detail.startTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1},8,["rules"])]),_:1}),t(U,{span:2,class:"text-center"},{default:s(()=>l[18]||(l[18]=[k("span",null,"至",-1)])),_:1}),t(U,{span:11},{default:s(()=>[t(d,{name:"endTime",rules:[{required:!0,message:e.$t("task.detail.validation.endTimeRequired")}]},{default:s(()=>[t(E,{value:a.endTime,"onUpdate:value":l[7]||(l[7]=o=>a.endTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("task.detail.endTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1},8,["rules"])]),_:1})]),_:1})]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.specifyGroup"),name:"groupIds"},{default:s(()=>[k("div",_e,[t(G,{value:a.groupMode,"onUpdate:value":l[8]||(l[8]=o=>a.groupMode=o),onChange:X},{default:s(()=>[t(_,{value:0},{default:s(()=>[u(r(e.$t("task.detail.noSpecify")),1)]),_:1}),t(_,{value:1},{default:s(()=>[u(r(e.$t("task.detail.specifyGroups")),1)]),_:1})]),_:1},8,["value"]),t(B,null,{default:s(()=>[a.groupMode===1?(m(),b(y,{key:0,value:a.groupIds,"onUpdate:value":l[9]||(l[9]=o=>a.groupIds=o),"show-search":"","filter-option":!1,mode:"multiple",placeholder:e.$t("task.detail.groupPlaceholder"),style:{width:"100%","margin-top":"8px"},onSearch:j},{default:s(()=>[(m(!0),c(w,null,I(Q.value,o=>(m(),b(g,{key:o.id,value:o.id},{default:s(()=>[u(r(o.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])):(m(),c("div",$e,r(e.$t("task.detail.groupTip")),1))]),_:1})])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.userRange"),name:"userRange"},{default:s(()=>[k("div",qe,[t(G,{value:a.userRange,"onUpdate:value":l[10]||(l[10]=o=>a.userRange=o)},{default:s(()=>[t(_,{value:0},{default:s(()=>[u(r(e.$t("task.detail.allUsers")),1)]),_:1}),t(_,{value:1},{default:s(()=>[u(r(e.$t("task.detail.taskCompletionCount")),1)]),_:1})]),_:1},8,["value"]),t(B,null,{default:s(()=>[a.userRange===1?(m(),c("div",Re,[t(d,{name:"taskCount"},{default:s(()=>[t(T,{value:a.taskCount,"onUpdate:value":l[11]||(l[11]=o=>a.taskCount=o),min:0,precision:0,placeholder:e.$t("task.detail.countPlaceholder"),"addon-after":e.$t("task.detail.times")},null,8,["value","placeholder","addon-after"])]),_:1}),t(oe,null,{title:s(()=>[k("div",{innerHTML:e.$t("task.detail.countTip")},null,8,we)]),default:s(()=>[t(z(ke))]),_:1})])):V("",!0)]),_:1})])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.quota")},{default:s(()=>[k("div",Ie,[t(C,{align:"baseline"},{default:s(()=>[t(d,{name:"quota"},{default:s(()=>[t(T,{value:a.quota,"onUpdate:value":l[12]||(l[12]=o=>a.quota=o),min:0,precision:0,disabled:a.unlimitedQuota,placeholder:e.$t("task.detail.quotaPlaceholder")},null,8,["value","disabled","placeholder"])]),_:1}),t(de,{checked:a.unlimitedQuota,"onUpdate:checked":l[13]||(l[13]=o=>a.unlimitedQuota=o)},{default:s(()=>[u(r(e.$t("task.detail.unlimited")),1)]),_:1},8,["checked"])]),_:1})])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.brand"),name:"brand"},{default:s(()=>[t(p,{value:a.brand,"onUpdate:value":l[14]||(l[14]=o=>a.brand=o),placeholder:e.$t("task.detail.brandPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.customFields")},{default:s(()=>[k("div",Pe,[(m(!0),c(w,null,I(a.customFields,(o,F)=>(m(),c("div",{key:F,class:"field-item"},[t(C,{align:"baseline"},{default:s(()=>[t(d,{name:["customFields",F,"title"],rules:[{required:!0,message:e.$t("task.detail.validation.fieldTitleRequired")}]},{default:s(()=>[t(p,{value:o.title,"onUpdate:value":q=>o.title=q,placeholder:e.$t("task.detail.fieldTitlePlaceholder")},null,8,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","rules"]),t(y,{value:o.type,"onUpdate:value":q=>o.type=q,style:{width:"120px"}},{default:s(()=>[t(g,{value:"input"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.input")),1)]),_:1}),t(g,{value:"image"},{default:s(()=>[u(r(e.$t("task.detail.fieldType.image")),1)]),_:1})]),_:2},1032,["value","onUpdate:value"]),t($,{type:"link",danger:"",onClick:q=>W(F)},{default:s(()=>[u(r(e.$t("task.detail.deleteField")),1)]),_:2},1032,["onClick"])]),_:2},1024)]))),128)),a.customFields.length<10?(m(),b($,{key:0,type:"dashed",block:"",onClick:K},{default:s(()=>[t(z(ve)),u(r(e.$t("task.detail.addField")),1)]),_:1})):V("",!0)])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.contentRequirement"),name:"contentRequirement"},{default:s(()=>[t(D,{value:a.contentRequirement,"onUpdate:value":l[15]||(l[15]=o=>a.contentRequirement=o),rows:4,placeholder:e.$t("task.detail.contentRequirementPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.taskInfo"),name:"taskInfo"},{default:s(()=>[t(D,{value:a.taskInfo,"onUpdate:value":l[16]||(l[16]=o=>a.taskInfo=o),rows:4,placeholder:e.$t("task.detail.taskInfoPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.detail.notice"),name:"notice"},{default:s(()=>[t(D,{value:a.notice,"onUpdate:value":l[17]||(l[17]=o=>a.notice=o),rows:4,placeholder:e.$t("task.detail.noticePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{"wrapper-col":{span:16,offset:4}},{default:s(()=>[t(C,null,{default:s(()=>[t($,{type:"primary",onClick:ee},{default:s(()=>[u(r(e.$t("common.submit")),1)]),_:1}),t($,{onClick:ae},{default:s(()=>[u(r(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},De=re(Ye,[["__scopeId","data-v-c0dacc80"]]);export{De as default};
