import{_ as te,i as le,r as k,p as ne,q as oe,a as ue,j as se,b as p,c as a,d as v,w as n,e as s,k as y,f as de,o as r,m as f,n as P,F as T,l as R,h as i,t as B,g as D,P as re}from"./index-CrTl1_Bc.js";import{P as ie}from"./index-DdsyUa1P.js";import{c as pe,g as me,d as ve}from"./enums-u5GZanCL.js";import{g as Q}from"./request-DxnL66JX.js";const fe={class:"task-form content-container"},ce={class:"form-container"},_e={class:"group-select"},ge={key:1,class:"group-tip"},be={class:"quota-container"},ke={class:"custom-fields"},ye={__name:"detail",setup(qe){const x=oe(),C=de(),{locale:V}=le(),F=k(),d=ne(()=>x.name==="TaskEdit"),t=ue({taskName:"",channelId:void 0,category:void 0,type:void 0,reward:void 0,brand:"",groupIds:[],groupMode:0,customFields:[{title:"",type:"input"}],startTime:null,endTime:null,quota:void 0,unlimitedQuota:!0,fansRequired:void 0,contentRequirement:"",taskInfo:"",notice:`1.请尽快完成发布，填写发布链接。
2.任务结束后无法填写，不能结算。
3.发布内容不符合要求，将无法审核通过。
4.填写链接无法访问或其他无关链接，视为放弃结算。`}),j={taskName:[{required:!0,message:"请输入任务名称"}],channelId:[{required:!0,message:"请选择平台渠道"}],category:[{required:!0,message:"请输入达人领域"}],type:[{required:!0,message:"请选择任务类型"}],reward:[{required:!0,message:"请输入任务奖励"}],fansRequired:[{required:!0,message:"请输入粉丝要求"}],groupIds:[{validator:(u,e)=>t.groupMode===1&&(!e||e.length===0)?Promise.reject("请选择指定群组"):Promise.resolve()}]},N=k([]),E=k(!1),M=k([]),S=()=>{t.customFields.length<10&&t.customFields.push({title:"",type:"input"})},z=u=>{t.customFields.splice(u,1)},G=u=>me(ve,u,V.value),H=u=>{u.target.value===0&&(t.groupIds=[])},$=()=>{F.value.validate().then(async()=>{try{submitLoading.value=!0;const u={...t,groupIds:t.groupMode===0?[]:t.groupIds},e=await post("task.add",u);e.success?(y.success("提交成功"),C.back()):y.error(e.message)}catch{y.error("提交失败")}finally{submitLoading.value=!1}})},A=()=>{C.back()},J=async u=>{},K=async()=>{const u=await Q("channel.list");u.success&&(N.value=u.data.list)},W=async(u="")=>{try{const e=await Q("group.list",{params:{page:1,pageSize:50,keyword:u}});e.success&&(M.value=e.data.list||[])}catch{y.error("获取群组列表失败")}};return se(()=>{K(),W(),d.value&&J(x.params.id)}),(u,e)=>{const m=s("a-input"),o=s("a-form-item"),c=s("a-select-option"),_=s("a-select"),h=s("a-input-number"),L=s("a-date-picker"),q=s("a-col"),X=s("a-row"),O=s("a-radio"),Y=s("a-radio-group"),Z=s("a-form-item-rest"),ee=s("a-checkbox"),w=s("a-space"),g=s("a-button"),U=s("a-textarea"),ae=s("a-form");return r(),p("div",fe,[a(ie,{title:d.value?"编辑任务":"新建任务",back:!0,class:"page-header"},null,8,["title"]),v("div",ce,[a(ae,{ref_key:"formRef",ref:F,model:t,rules:j,"label-col":{span:3},"wrapper-col":{span:20},layout:"horizontal"},{default:n(()=>[a(o,{label:"任务名称",name:"taskName"},{default:n(()=>[a(m,{value:t.taskName,"onUpdate:value":e[0]||(e[0]=l=>t.taskName=l),placeholder:"请输入任务名称"},null,8,["value"])]),_:1}),a(o,{label:"平台渠道",name:"channelId"},{default:n(()=>[a(_,{value:t.channelId,"onUpdate:value":e[1]||(e[1]=l=>t.channelId=l),placeholder:"请选择平台渠道"},{default:n(()=>[(r(!0),p(T,null,R(N.value,l=>(r(),f(c,{key:l.id,value:l.id},{default:n(()=>[i(B(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(o,{label:"达人领域",name:"category"},{default:n(()=>[a(m,{value:t.category,"onUpdate:value":e[2]||(e[2]=l=>t.category=l),placeholder:"请输入达人领域"},null,8,["value"])]),_:1}),a(o,{label:"任务类型",name:"type"},{default:n(()=>[a(_,{value:t.type,"onUpdate:value":e[3]||(e[3]=l=>t.type=l),placeholder:"请选择任务类型"},{default:n(()=>[(r(!0),p(T,null,R(Object.values(D(pe)),l=>(r(),f(c,{key:l,value:l},{default:n(()=>[i(B(G(l)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(o,{label:"任务奖励",name:"reward"},{default:n(()=>[a(h,{value:t.reward,"onUpdate:value":e[4]||(e[4]=l=>t.reward=l),min:0,precision:2,step:.1,placeholder:"请输入任务奖励"},null,8,["value"])]),_:1}),a(o,{label:"粉丝要求",name:"fansRequired"},{default:n(()=>[a(m,{value:t.fansRequired,"onUpdate:value":e[5]||(e[5]=l=>t.fansRequired=l),placeholder:"请输入粉丝要求",disabled:d.value},null,8,["value","disabled"])]),_:1}),a(o,{label:"任务时间",required:""},{default:n(()=>[a(X,{gutter:8},{default:n(()=>[a(q,{span:11},{default:n(()=>[a(o,{name:"startTime",rules:[{required:!0,message:"请选择开始时间"}],disabled:d.value},{default:n(()=>[a(L,{value:t.startTime,"onUpdate:value":e[6]||(e[6]=l=>t.startTime=l),"show-time":"",style:{width:"100%"},placeholder:"开始时间"},null,8,["value"])]),_:1},8,["disabled"])]),_:1}),a(q,{span:2,class:"text-center"},{default:n(()=>e[16]||(e[16]=[v("span",null,"至",-1)])),_:1}),a(q,{span:11},{default:n(()=>[a(o,{name:"endTime",rules:[{required:!0,message:"请选择结束时间"}],disabled:d.value},{default:n(()=>[a(L,{value:t.endTime,"onUpdate:value":e[7]||(e[7]=l=>t.endTime=l),"show-time":"",style:{width:"100%"},placeholder:"结束时间"},null,8,["value"])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),a(o,{label:"指定群组",name:"groupIds"},{default:n(()=>[v("div",_e,[a(Y,{value:t.groupMode,"onUpdate:value":e[8]||(e[8]=l=>t.groupMode=l),onChange:H},{default:n(()=>[a(O,{value:0},{default:n(()=>e[17]||(e[17]=[i("不指定")])),_:1}),a(O,{value:1},{default:n(()=>e[18]||(e[18]=[i("指定群组")])),_:1})]),_:1},8,["value"]),a(Z,null,{default:n(()=>[t.groupMode===1?(r(),f(_,{key:0,value:t.groupIds,"onUpdate:value":e[9]||(e[9]=l=>t.groupIds=l),mode:"multiple",placeholder:"请选择群组",style:{width:"100%","margin-top":"8px"},options:M.value,loading:E.value},null,8,["value","options","loading"])):(r(),p("div",ge," 所有群组的会员都可以接取该任务 "))]),_:1})])]),_:1}),a(o,{label:"任务名额"},{default:n(()=>[v("div",be,[a(w,{align:"baseline"},{default:n(()=>[a(o,{name:"quota"},{default:n(()=>[a(h,{value:t.quota,"onUpdate:value":e[10]||(e[10]=l=>t.quota=l),min:0,precision:0,disabled:t.unlimitedQuota||d.value,placeholder:"请输入任务名额"},null,8,["value","disabled"])]),_:1}),a(ee,{checked:t.unlimitedQuota,"onUpdate:checked":e[11]||(e[11]=l=>t.unlimitedQuota=l),disabled:d.value},{default:n(()=>e[19]||(e[19]=[i(" 不限制 ")])),_:1},8,["checked","disabled"])]),_:1})])]),_:1}),a(o,{label:"品牌",name:"brand"},{default:n(()=>[a(m,{value:t.brand,"onUpdate:value":e[12]||(e[12]=l=>t.brand=l),placeholder:"请输入品牌名称"},null,8,["value"])]),_:1}),a(o,{label:"提交信息字段"},{default:n(()=>[v("div",ke,[(r(!0),p(T,null,R(t.customFields,(l,I)=>(r(),p("div",{key:I,class:"field-item"},[a(w,{align:"baseline"},{default:n(()=>[a(o,{name:["customFields",I,"title"],rules:[{required:!0,message:"请输入字段标题"}]},{default:n(()=>[a(m,{value:l.title,"onUpdate:value":b=>l.title=b,placeholder:"请输入字段标题"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),a(_,{value:l.type,"onUpdate:value":b=>l.type=b,style:{width:"120px"}},{default:n(()=>[a(c,{value:"input"},{default:n(()=>e[20]||(e[20]=[i("输入框")])),_:1}),a(c,{value:"image"},{default:n(()=>e[21]||(e[21]=[i("上传图片")])),_:1})]),_:2},1032,["value","onUpdate:value"]),a(g,{type:"link",danger:"",onClick:b=>z(I)},{default:n(()=>e[22]||(e[22]=[i(" 删除 ")])),_:2},1032,["onClick"])]),_:2},1024)]))),128)),t.customFields.length<10?(r(),f(g,{key:0,type:"dashed",block:"",onClick:S},{default:n(()=>[a(D(re)),e[23]||(e[23]=i("添加字段 "))]),_:1})):P("",!0)])]),_:1}),a(o,{label:"作品要求",name:"contentRequirement"},{default:n(()=>[a(U,{value:t.contentRequirement,"onUpdate:value":e[13]||(e[13]=l=>t.contentRequirement=l),rows:4,placeholder:"请输入作品要求",disabled:d.value},null,8,["value","disabled"])]),_:1}),a(o,{label:"任务信息",name:"taskInfo"},{default:n(()=>[a(U,{value:t.taskInfo,"onUpdate:value":e[14]||(e[14]=l=>t.taskInfo=l),rows:4,placeholder:"请输入任务信息",disabled:d.value},null,8,["value","disabled"])]),_:1}),a(o,{label:"温馨提示",name:"notice"},{default:n(()=>[a(U,{value:t.notice,"onUpdate:value":e[15]||(e[15]=l=>t.notice=l),rows:4,placeholder:"请输入温馨提示",disabled:d.value},null,8,["value","disabled"])]),_:1}),d.value?P("",!0):(r(),f(o,{key:0,"wrapper-col":{span:16,offset:4}},{default:n(()=>[a(w,null,{default:n(()=>[a(g,{type:"primary",onClick:$},{default:n(()=>e[24]||(e[24]=[i("提交")])),_:1}),a(g,{onClick:A},{default:n(()=>e[25]||(e[25]=[i("取消")])),_:1})]),_:1})]),_:1}))]),_:1},8,["model"])])])}}},Re=te(ye,[["__scopeId","data-v-ab1d6c53"]]);export{Re as default};
