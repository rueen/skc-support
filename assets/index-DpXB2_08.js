import{g as K,d as Q,a as X,p as Y}from"./request-C_BJNrf-.js";import{_ as Z,r as l,a as h,p as ee,k as ae,b as x,d,c as o,w as n,e as r,o as v,h as C,m as D,n as B,F as se,l as te,t as oe,i}from"./index-DMd8pDFg.js";const ne={class:"waiter content-container"},re={class:"table-container"},ie={class:"table-header"},le={class:"right"},me=["onClick"],de={__name:"index",setup(ue){const k=l(!1),m=l(!1),u=l(!1),c=l("add"),g=l(),w=l(null),e=h({username:"",password:"",remarks:"",permissions:[]}),V=[{title:"task",permissions:"task:list"},{title:"taskCreate",permissions:"task:create"},{title:"taskEdit",permissions:"task:edit"},{title:"account",permissions:"account:list"},{title:"taskAudit",permissions:"task:audit"},{title:"taskAuditDetail",permissions:"task:auditDetail"},{title:"member",permissions:"member:list"},{title:"memberCreate",permissions:"member:create"},{title:"memberEdit",permissions:"member:edit"},{title:"memberView",permissions:"member:view"},{title:"channel",permissions:"channel:list"},{title:"group",permissions:"group:list"},{title:"withdrawal",permissions:"settlement:withdrawal"},{title:"otherBills",permissions:"settlement:otherBills"},{title:"waiter",permissions:"waiter:list"},{title:"article",permissions:"article:list"}],U=[{title:"账号名称",dataIndex:"username",key:"username"},{title:"备注",dataIndex:"remarks",key:"remarks"},{title:"操作",key:"action",width:200}],y=l([]),p=h({current:1,pageSize:10,total:0}),E=ee(()=>c.value==="add"?"添加账号":"编辑账号"),I=s=>{Object.assign(p,s),_()},L=()=>{c.value="add",e.username="",e.password="",e.remarks="",e.permissions=[],m.value=!0},N=s=>{w.value=s.id,c.value="edit",e.username=s.username,e.password="",e.remarks=s.remarks,e.permissions=s.permissions.split(","),m.value=!0},O=async s=>{try{const a=await Q("waiter.delete",{id:s.id},{urlParams:{id:s.id}});a.code===0?(i.success("删除成功"),_()):i.error(a.message)}catch{i.error("删除失败")}},S=async()=>{try{u.value=!0;const s=await Y("waiter.add",{...e,permissions:e.permissions.join(",")});s.code===0?(i.success("添加成功"),m.value=!1,_()):i.error(s.message)}catch{i.error("添加失败")}finally{u.value=!1}},T=async()=>{try{u.value=!0;const s={id:w.value,username:e.username,remarks:e.remarks,permissions:e.permissions.join(",")};e.password&&(s.password=e.password);const a=await X("waiter.edit",s,{urlParams:{id:w.value}});a.code===0?(i.success("编辑成功"),m.value=!1,_()):i.error(a.message)}catch{i.error("编辑失败")}finally{u.value=!1}},j=async()=>{switch(await g.value.validate(),c.value){case"add":S();break;case"edit":T();break}},_=async()=>{k.value=!0;try{const s=await K("waiter.list",{page:p.current,pageSize:p.pageSize});y.value=s.data.list,p.total=s.data.total}finally{k.value=!1}};return ae(()=>{_()}),(s,a)=>{const z=r("a-button"),A=r("a-popconfirm"),F=r("a-space"),$=r("a-table"),q=r("a-input"),f=r("a-form-item"),P=r("a-input-password"),R=r("a-textarea"),W=r("a-checkbox"),M=r("a-checkbox-group"),G=r("a-form"),H=r("a-modal");return v(),x("div",ne,[d("div",re,[d("div",ie,[a[6]||(a[6]=d("div",{class:"left"},null,-1)),d("div",le,[o(z,{type:"primary",onClick:L},{default:n(()=>a[5]||(a[5]=[C(" 添加账号 ")])),_:1})])]),o($,{columns:U,"data-source":y.value,loading:k.value,pagination:p,onChange:I},{bodyCell:n(({column:t,record:b})=>[t.key==="action"?(v(),D(F,{key:0},{default:n(()=>[d("a",{onClick:J=>N(b)},"编辑",8,me),b.is_admin?B("",!0):(v(),D(A,{key:0,title:"确定要删除该账号吗？",onConfirm:J=>O(b)},{default:n(()=>a[7]||(a[7]=[d("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"]))]),_:2},1024)):B("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(H,{open:m.value,"onUpdate:open":a[4]||(a[4]=t=>m.value=t),title:E.value,confirmLoading:u.value,onOk:j},{default:n(()=>[o(G,{ref_key:"formRef",ref:g,model:e,"label-col":{span:6},"wrapper-col":{span:16}},{default:n(()=>[o(f,{label:"用户名",name:"username",rules:[{required:!0,message:"请输入用户名"}]},{default:n(()=>[o(q,{value:e.username,"onUpdate:value":a[0]||(a[0]=t=>e.username=t),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),o(f,{label:"密码",name:"password",rules:[{required:c.value==="add",message:"请输入密码"}]},{default:n(()=>[o(P,{value:e.password,"onUpdate:value":a[1]||(a[1]=t=>e.password=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["rules"]),o(f,{label:"备注",name:"remarks"},{default:n(()=>[o(R,{value:e.remarks,"onUpdate:value":a[2]||(a[2]=t=>e.remarks=t),placeholder:"请输入备注",rows:3},null,8,["value"])]),_:1}),o(f,{label:"权限",name:"permissions"},{default:n(()=>[o(M,{value:e.permissions,"onUpdate:value":a[3]||(a[3]=t=>e.permissions=t)},{default:n(()=>[(v(),x(se,null,te(V,t=>o(W,{key:t.title,value:t.permissions},{default:n(()=>[C(oe(s.$t("menu."+t.title)),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},_e=Z(de,[["__scopeId","data-v-8416cc16"]]);export{_e as default};
