import{P as A}from"./PageHeader-DBCyoF9g.js";import{_ as S,r as _,c as q,k as B,d as U,f as s,w as r,g as d,l as M,m as v,o as c,e as m,t as l,p as w,s as h,i as y,A as G}from"./index-D_ybMHgJ.js";const N={class:"system-config-container"},O={class:"form-item-desc"},V={class:"form-item-desc"},E={class:"form-item-desc"},H={class:"form-item-desc"},I={class:"form-item-desc"},z={class:"form-item-desc"},F={__name:"index",setup(J){const C=_(null),g=_(!1),f=_(!1),o=_(!0),t=q({max_group_members:null,group_owner_commission_rate:null,invite_reward_amount:null}),k={max_group_members:[{required:!0,message:"请输入最大群成员数",trigger:"blur"},{type:"number",min:10,max:1e3,message:"群成员数必须在 10-1000 之间",trigger:"blur"}],group_owner_commission_rate:[{required:!0,message:"请输入群主收益率",trigger:"blur"},{type:"number",min:0,max:100,message:"收益率必须在 0-100 之间",trigger:"blur"}],invite_reward_amount:[{required:!0,message:"请输入邀请奖励金额",trigger:"blur"},{type:"number",min:0,max:1e3,message:"奖励金额必须在 0-1000 之间",trigger:"blur"}],withdrawal_threshold:[{required:!0,message:"请输入提现门槛",trigger:"blur"},{type:"number",min:0,max:99999,message:"提现门槛必须在 0-99999 之间",trigger:"blur"}],account_reject_times:[{required:!0,message:"请输入账号",trigger:"blur"},{type:"number",min:0,max:99999,message:"账号可提交次数必须在 0-99999 之间",trigger:"blur"}],task_reject_times:[{required:!0,message:"请输入任务",trigger:"blur"},{type:"number",min:0,max:99999,message:"任务可驳回次数必须在 0-99999 之间",trigger:"blur"}]},p=async()=>{g.value=!0;try{const e=await M("system.getAllConfig");if(e&&e.data){const a={};e.data.forEach(i=>{a[i.config_key]=i}),Object.assign(t,{max_group_members:a.max_group_members.config_value,group_owner_commission_rate:(a.group_owner_commission_rate.config_value-0)*100,invite_reward_amount:a.invite_reward_amount.config_value,withdrawal_threshold:a.withdrawal_threshold.config_value,account_reject_times:a.account_reject_times.config_value,task_reject_times:a.task_reject_times.config_value})}}catch(e){v.error("获取系统配置失败："+(e.message||"未知错误"))}finally{g.value=!1}},$=async()=>{f.value=!0;const e={max_group_members:t.max_group_members,group_owner_commission_rate:t.group_owner_commission_rate/100,invite_reward_amount:t.invite_reward_amount,withdrawal_threshold:t.withdrawal_threshold,account_reject_times:t.account_reject_times,task_reject_times:t.task_reject_times},a=await G("system.saveAllConfig",{configs:e});f.value=!1,a&&a.code===0?(v.success("保存系统配置成功"),p(),o.value=!0):v.error(a.message||"保存失败")},j=()=>{C.value.validate().then(()=>{$()}).catch(e=>{console.error("表单验证失败",e)})},R=()=>{o.value=!1},T=()=>{p()};return B(()=>{p()}),(e,a)=>{const i=d("a-input-number"),u=d("a-form-item"),b=d("a-button"),x=d("a-space"),D=d("a-form"),P=d("a-spin");return c(),U("div",N,[s(A,{title:e.$t("systemConfig.pageTitle"),back:!0},null,8,["title"]),s(P,{spinning:g.value},{default:r(()=>[s(D,{model:t,rules:k,ref_key:"formRef",ref:C,"label-col":{span:6},"wrapper-col":{span:12}},{default:r(()=>[s(u,{label:e.$t("systemConfig.maxGroupMembers"),name:"maxGroupMembers"},{default:r(()=>[s(i,{value:t.max_group_members,"onUpdate:value":a[0]||(a[0]=n=>t.max_group_members=n),min:1,max:3e3,placeholder:"请输入最大群成员数",disabled:o.value},null,8,["value","disabled"]),m("div",O,[m("div",null,l(e.$t("systemConfig.maxGroupMembersDesc1")),1),m("div",null,l(e.$t("systemConfig.maxGroupMembersDesc2")),1)])]),_:1},8,["label"]),s(u,{label:e.$t("systemConfig.groupOwnerProfitRate"),name:"ownerProfitRate"},{default:r(()=>[s(i,{value:t.group_owner_commission_rate,"onUpdate:value":a[1]||(a[1]=n=>t.group_owner_commission_rate=n),min:0,max:100,step:.1,precision:1,addonAfter:"%",placeholder:e.$t("systemConfig.groupOwnerProfitRatePlaceholder"),disabled:o.value},null,8,["value","placeholder","disabled"]),m("div",V,l(e.$t("systemConfig.groupOwnerProfitRateDesc")),1)]),_:1},8,["label"]),s(u,{label:e.$t("systemConfig.inviteRewardAmount"),name:"inviteRewardAmount"},{default:r(()=>[s(i,{value:t.invite_reward_amount,"onUpdate:value":a[2]||(a[2]=n=>t.invite_reward_amount=n),min:0,max:1e3,step:.1,precision:1,addonBefore:"¥",placeholder:e.$t("systemConfig.inviteRewardAmountPlaceholder"),disabled:o.value},null,8,["value","placeholder","disabled"]),m("div",E,l(e.$t("systemConfig.inviteRewardAmountDesc")),1)]),_:1},8,["label"]),s(u,{label:e.$t("systemConfig.withdrawalThreshold"),name:"withdrawalThreshold"},{default:r(()=>[s(i,{value:t.withdrawal_threshold,"onUpdate:value":a[3]||(a[3]=n=>t.withdrawal_threshold=n),min:0,max:99999,step:1,addonBefore:"¥",placeholder:e.$t("systemConfig.withdrawalThresholdPlaceholder"),disabled:o.value},null,8,["value","placeholder","disabled"]),m("div",H,l(e.$t("systemConfig.withdrawalThresholdDesc")),1)]),_:1},8,["label"]),s(u,{label:e.$t("systemConfig.accountSubmitTimes"),name:"accountSubmitTimes"},{default:r(()=>[s(i,{value:t.account_reject_times,"onUpdate:value":a[4]||(a[4]=n=>t.account_reject_times=n),min:-1,max:99999,step:1,disabled:o.value},null,8,["value","disabled"]),m("div",I,l(e.$t("systemConfig.accountSubmitTimesDesc")),1)]),_:1},8,["label"]),s(u,{label:e.$t("systemConfig.taskRejectTimes"),name:"taskRejectTimes"},{default:r(()=>[s(i,{value:t.task_reject_times,"onUpdate:value":a[5]||(a[5]=n=>t.task_reject_times=n),min:-1,max:99999,step:1,disabled:o.value},null,8,["value","disabled"]),m("div",z,l(e.$t("systemConfig.taskRejectTimesDesc")),1)]),_:1},8,["label"]),s(u,{"wrapper-col":{span:12,offset:6}},{default:r(()=>[s(x,null,{default:r(()=>[o.value?h("",!0):(c(),w(b,{key:0,type:"primary",onClick:j,loading:f.value},{default:r(()=>[y(l(e.$t("common.save")),1)]),_:1},8,["loading"])),o.value?(c(),w(b,{key:1,onClick:R},{default:r(()=>[y(l(e.$t("common.edit")),1)]),_:1})):h("",!0),o.value?h("",!0):(c(),w(b,{key:2,onClick:T},{default:r(()=>[y(l(e.$t("common.reset")),1)]),_:1}))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])])}}},Q=S(F,[["__scopeId","data-v-bef5b5eb"]]);export{Q as default};
