import{r as k,b as ce,c as C,j as T,k as de,d as b,f as t,e as g,w as o,g as s,l as H,m as c,o as m,F as re,n as ue,p as A,i as p,t as d,B as me,s as L,M as pe,v as fe,z as _e,A as he}from"./index-KtKkQ3PP.js";import{_ as ke}from"./CopyContent-aHe1-oIe.js";import{P as ge}from"./PageHeader-B9Q3uTOG.js";const ye={class:"content-container"},ve={class:"table-container"},be={class:"table-header"},Le={class:"left"},$e={class:"right"},we={key:0},Ue={key:1},Be={key:3},Fe=["onClick"],Ne={__name:"old-list",setup(Ce){const U=k(!1),$=k(null),{t:i}=ce(),P={action:`${me.businessApiUrl}/old-accounts-fb/import`,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},r=C({keyword:"",memberId:void 0}),S=k([]),D=T(()=>[{title:i("account.oldList.FBAccount"),key:"account",dataIndex:"uid"},{title:i("account.oldList.FBNickname"),key:"nickname",dataIndex:"nickname"},{title:i("account.oldList.FBHomepage"),key:"homeUrl"},{title:i("account.oldList.linkedMember"),key:"member"},{title:i("account.oldList.action"),key:"action"}]),N=k([]),f=C({current:1,pageSize:10,total:0}),y=k(!1),B=k(!1),O=T(()=>n.id?i("account.oldList.editTitle"):i("account.oldList.addTitle")),n=C({id:null,uid:"",nickname:"",homeUrl:""}),V={uid:[{required:!0,message:i("account.oldList.FBAccountPlaceholder"),trigger:"blur"}],nickname:[{required:!0,message:i("account.oldList.FBNicknamePlaceholder"),trigger:"blur"}],homeUrl:[{required:!0,message:i("account.oldList.FBHomepagePlaceholder"),trigger:"blur"},{pattern:/^https?:\/\//,message:i("account.oldList.FBHomepagePlaceholder2"),trigger:"blur"}]},_=async()=>{U.value=!0;try{const e=await H("oldAccount.list",{page:f.current,pageSize:f.pageSize,...r});e.code===0?(N.value=e.data.list,f.total=e.data.total):c.error(e.message)}finally{U.value=!1}},E=()=>{n.id=null,n.uid="",n.nickname="",n.homeUrl="",$.value&&$.value.resetFields()},j=()=>{E(),y.value=!0},q=e=>{E(),Object.assign(n,{id:e.id,uid:e.uid,nickname:e.nickname,homeUrl:e.homeUrl}),y.value=!0},R=async e=>{try{const a=await fe("oldAccount.delete",{id:e.id},{urlParams:{id:e.id}});a.code===0?(c.success("delete success"),_()):c.error(a.message)}catch{c.error("delete failed")}},x=()=>{$.value.validate().then(async()=>{B.value=!0;try{let e;n.id?e=await _e("oldAccount.edit",n,{urlParams:{id:n.id}}):e=await he("oldAccount.add",n),e.code===0?(c.success(n.id?"edit success":"add success"),y.value=!1,_()):c.error(e.message)}finally{B.value=!1}}).catch(e=>{console.log("validate failed",e)})},K=e=>e.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"||e.type==="application/vnd.ms-excel"?(c.loading({content:i("account.oldList.uploadExcelLoading"),key:"importTip"}),!0):(c.error(i("account.oldList.uploadExcelError")),!1),G=e=>{if(c.destroy("importTip"),e.code===0){const a=e.data||{};pe.success({content:`import success: ${`total ${a.total||0} data, imported ${a.imported||0} data, skipped ${a.skipped||0} data(Linked Member)`}`}),_()}else c.error(e.message||"import failed")},J=e=>{console.log(e),c.destroy("importTip"),c.error("upload failed")},z=()=>{f.current=1,_()},Q=()=>{r.keyword="",r.memberId=void 0,z()},W=e=>{Object.assign(f,{current:e.current,pageSize:e.pageSize}),_()},I=async(e="")=>{try{const a=await H("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(S.value=a.data.list||[])}catch{c.error("get member list failed")}};return de(()=>{_(),I()}),(e,a)=>{const v=s("a-input"),h=s("a-form-item"),X=s("a-select-option"),Y=s("a-select"),w=s("a-button"),F=s("a-space"),M=s("a-form"),Z=s("upload-outlined"),ee=s("a-upload"),te=s("plus-outlined"),ae=s("a-typography-link"),oe=s("a-typography-text"),le=s("a-popconfirm"),ne=s("a-table"),se=s("a-modal");return m(),b("div",ye,[t(ge,{title:e.$t("account.list.oldAccount"),back:!0,style:{"margin-bottom":"0"}},null,8,["title"]),g("div",ve,[g("div",be,[g("div",Le,[t(M,{layout:"inline",model:r},{default:o(()=>[t(h,{label:e.$t("account.oldList.keyword")},{default:o(()=>[t(v,{value:r.keyword,"onUpdate:value":a[0]||(a[0]=l=>r.keyword=l),placeholder:e.$t("account.oldList.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{label:e.$t("account.oldList.member")},{default:o(()=>[t(Y,{value:r.memberId,"onUpdate:value":a[1]||(a[1]=l=>r.memberId=l),placeholder:e.$t("account.oldList.memberPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:I},{default:o(()=>[(m(!0),b(re,null,ue(S.value,l=>(m(),A(X,{key:l.id,value:l.id},{default:o(()=>[p(d(l.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(h,null,{default:o(()=>[t(F,null,{default:o(()=>[t(w,{type:"primary",onClick:z},{default:o(()=>[p(d(e.$t("common.search")),1)]),_:1}),t(w,{onClick:Q},{default:o(()=>[p(d(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),g("div",$e,[t(F,null,{default:o(()=>[t(ee,{name:"file",multiple:!1,showUploadList:!1,action:P.action,headers:P.headers,beforeUpload:K,onSuccess:G,onError:J,accept:".xlsx,.xls"},{default:o(()=>[t(w,null,{default:o(()=>[t(Z),p(" "+d(e.$t("account.oldList.import")),1)]),_:1})]),_:1},8,["action","headers"]),t(w,{type:"primary",onClick:j},{default:o(()=>[t(te),p(" "+d(e.$t("account.oldList.add")),1)]),_:1})]),_:1})])]),t(ne,{columns:D.value,"data-source":N.value,loading:U.value,pagination:f,rowKey:"id",onChange:W},{bodyCell:o(({column:l,record:u})=>[l.key==="account"?(m(),b("div",we,[g("div",null,d(u.uid),1)])):L("",!0),l.key==="nickname"?(m(),b("div",Ue,d(u.nickname),1)):L("",!0),l.key==="homeUrl"?(m(),A(ke,{key:2,content:u.homeUrl},{default:o(()=>[t(ae,{href:u.homeUrl,target:"_blank",style:{"max-width":"320px",display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},{default:o(()=>[p(d(u.homeUrl),1)]),_:2},1032,["href"])]),_:2},1032,["content"])):L("",!0),l.key==="member"?(m(),b("div",Be,d(u.memberNickname||"--"),1)):L("",!0),l.key==="action"?(m(),A(F,{key:4},{default:o(()=>[g("a",{onClick:ie=>q(u)},d(e.$t("account.oldList.edit")),9,Fe),t(le,{title:e.$t("account.oldList.deleteConfirm"),onConfirm:ie=>R(u)},{default:o(()=>[t(oe,{type:"danger"},{default:o(()=>[p(d(e.$t("account.oldList.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:2},1024)):L("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),t(se,{open:y.value,"onUpdate:open":a[5]||(a[5]=l=>y.value=l),title:O.value,onOk:x,confirmLoading:B.value},{default:o(()=>[t(M,{model:n,rules:V,ref_key:"formRef",ref:$,"label-col":{span:6},"wrapper-col":{span:18}},{default:o(()=>[t(h,{label:e.$t("account.oldList.FBAccount"),name:"uid"},{default:o(()=>[t(v,{value:n.uid,"onUpdate:value":a[2]||(a[2]=l=>n.uid=l),placeholder:e.$t("account.oldList.FBAccountPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{label:e.$t("account.oldList.FBNickname"),name:"nickname"},{default:o(()=>[t(v,{value:n.nickname,"onUpdate:value":a[3]||(a[3]=l=>n.nickname=l),placeholder:e.$t("account.oldList.FBNicknamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(h,{label:e.$t("account.oldList.FBHomepage"),name:"homeUrl"},{default:o(()=>[t(v,{value:n.homeUrl,"onUpdate:value":a[4]||(a[4]=l=>n.homeUrl=l),placeholder:e.$t("account.oldList.FBHomepagePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}};export{Ne as default};
