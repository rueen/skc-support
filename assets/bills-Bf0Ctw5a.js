import{_ as ee,b as ae,a as le,j as S,r as w,c as B,k as te,d as u,e as $,f as s,w as n,g as d,l as H,m as P,h as ne,o as t,F as b,n as C,p as y,i as c,t as r,s as k,q as I,M as ie}from"./index-BcInYu-b.js";const se={class:"other-bill content-container"},oe={class:"table-container"},ue={class:"table-header"},re={class:"left"},me={key:1},de={key:1},ce={key:0},pe={key:1},be={key:0},ke={key:1},fe={__name:"bills",setup(ye){const{t:p}=ae(),f=le(),G=ne(),z=S(()=>f.loaded?f.getEnumOptions("BillType"):[]),F=S(()=>f.loaded?f.getEnumOptions("SettlementStatus"):[]),h=w(!1),l=B({billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",memberNickname:"",relatedGroupId:void 0}),V=a=>{ie.error({title:"结算失败原因",content:a.failureReason})},j=S(()=>[{title:p("financial.bills.billNo"),dataIndex:"billNo",key:"billNo"},{title:p("financial.bills.memberNickname"),key:"memberNickname"},{title:p("financial.bills.billType"),dataIndex:"billType",key:"billType"},{title:p("financial.bills.relatedTaskName"),key:"taskName"},{title:p("financial.bills.relatedGroupName"),key:"relatedGroupName"},{title:p("financial.bills.amount"),dataIndex:"amount",key:"amount",align:"right"},{title:p("financial.bills.remark"),key:"remark"},{title:p("financial.bills.createTime"),dataIndex:"createTime",key:"createTime"},{title:p("financial.bills.settlementStatus"),key:"settlementStatus"}]),R=w([]),_=B({current:1,pageSize:10,total:0}),D=()=>{_.current=1,N()},x=()=>{Object.assign(l,{billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",memberNickname:"",relatedGroupId:void 0}),D()},q=a=>{Object.assign(_,a),N()},L=a=>{G.push(`/member/view/${a.memberId}`)},W=a=>{G.push(`/submitted-tasks/detail/${a.submittedId}?type=confirm`)},N=async()=>{var a,i;h.value=!0;try{const v={page:_.current,pageSize:_.pageSize,billNo:l.billNo,billType:l.billType,settlementStatus:l.settlementStatus,startTime:(a=l.timeRange)==null?void 0:a[0],endTime:(i=l.timeRange)==null?void 0:i[1],taskName:l.taskName,memberNickname:l.memberNickname,relatedGroupId:l.relatedGroupId},m=await H("finance.bills",{...v});m.code===0?(R.value=m.data.list,_.total=m.data.total):P.error(m.message)}finally{h.value=!1}},M=w([]),O=async(a="")=>{try{const i=await H("group.list",{page:1,pageSize:50,groupName:a});i.code===0&&(M.value=i.data.list||[])}catch{P.error("获取群组列表失败")}};return te(()=>{N(),O()}),(a,i)=>{const v=d("a-input"),m=d("a-form-item"),g=d("a-select-option"),T=d("a-select"),A=d("a-range-picker"),Y=d("a-button"),J=d("a-space"),K=d("a-form"),E=d("a-typography-link"),Q=d("a-typography-text"),X=d("info-circle-outlined"),Z=d("a-table");return t(),u("div",se,[$("div",oe,[$("div",ue,[$("div",re,[s(K,{layout:"inline",model:l},{default:n(()=>[s(m,{label:a.$t("financial.bills.billNo")},{default:n(()=>[s(v,{value:l.billNo,"onUpdate:value":i[0]||(i[0]=e=>l.billNo=e),placeholder:a.$t("financial.bills.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:a.$t("financial.bills.billType")},{default:n(()=>[s(T,{value:l.billType,"onUpdate:value":i[1]||(i[1]=e=>l.billType=e),placeholder:a.$t("financial.bills.billTypePlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(t(!0),u(b,null,C(z.value,e=>(t(),y(g,{key:e.value,value:e.value},{default:n(()=>[c(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:a.$t("financial.bills.settlementStatus")},{default:n(()=>[s(T,{value:l.settlementStatus,"onUpdate:value":i[2]||(i[2]=e=>l.settlementStatus=e),placeholder:a.$t("financial.bills.settlementStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(t(!0),u(b,null,C(F.value,e=>(t(),y(g,{key:e.value,value:e.value},{default:n(()=>[c(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:a.$t("financial.bills.createTime")},{default:n(()=>[s(A,{value:l.timeRange,"onUpdate:value":i[3]||(i[3]=e=>l.timeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),s(m,{label:a.$t("financial.bills.relatedTaskName")},{default:n(()=>[s(v,{value:l.taskName,"onUpdate:value":i[4]||(i[4]=e=>l.taskName=e),placeholder:a.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:a.$t("financial.bills.memberNickname")},{default:n(()=>[s(v,{value:l.memberNickname,"onUpdate:value":i[5]||(i[5]=e=>l.memberNickname=e),placeholder:a.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:a.$t("financial.bills.relatedGroupName")},{default:n(()=>[s(T,{value:l.relatedGroupId,"onUpdate:value":i[6]||(i[6]=e=>l.relatedGroupId=e),placeholder:a.$t("financial.bills.relatedGroupNamePlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:O},{default:n(()=>[(t(!0),u(b,null,C(M.value,e=>(t(),y(g,{key:e.id,value:e.id},{default:n(()=>[c(r(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,null,{default:n(()=>[s(J,null,{default:n(()=>[s(Y,{type:"primary",onClick:D},{default:n(()=>[c(r(a.$t("common.search")),1)]),_:1}),s(Y,{onClick:x},{default:n(()=>[c(r(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),s(Z,{columns:j.value,"data-source":R.value,loading:h.value,pagination:_,onChange:q},{bodyCell:n(({column:e,record:o})=>[e.key==="memberNickname"?(t(),y(E,{key:0,onClick:U=>L(o)},{default:n(()=>[c(r(o.memberNickname),1)]),_:2},1032,["onClick"])):k("",!0),e.key==="taskName"?(t(),u(b,{key:1},[o.taskName?(t(),y(E,{key:0,onClick:U=>W(o)},{default:n(()=>[c(r(o.taskName),1)]),_:2},1032,["onClick"])):(t(),u("span",me,"--"))],64)):k("",!0),e.key==="relatedGroupName"?(t(),u(b,{key:2},[c(r(o.relatedGroupName||"--"),1)],64)):k("",!0),e.key==="billType"?(t(),u(b,{key:3},[c(r(I(f).getEnumText("BillType",o.billType)),1)],64)):k("",!0),e.key==="amount"?(t(),u(b,{key:4},[o.billType==="reward_deduction"?(t(),y(Q,{key:0,type:"danger"},{default:n(()=>[c(" - "+r(o.amount),1)]),_:2},1024)):(t(),u("span",de,r(o.amount),1))],64)):k("",!0),e.key==="remark"?(t(),u(b,{key:5},[o.remark?(t(),u("span",ce,r(o.remark)+"("+r(a.$t("financial.bills.operator"))+": "+r(o.waiterName)+")",1)):(t(),u("span",pe,"--"))],64)):k("",!0),e.key==="settlementStatus"?(t(),u(b,{key:6},[o.billType==="withdrawal"?(t(),u("span",be,r(I(f).getEnumText("WithdrawalStatus",o.withdrawalStatus)),1)):(t(),u("span",ke,r(I(f).getEnumText("SettlementStatus",o.settlementStatus)),1)),o.settlementStatus==="failed"||o.withdrawalStatus==="failed"?(t(),y(X,{key:2,class:"status-icon",onClick:U=>V(o)},null,8,["onClick"])):k("",!0)],64)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},ve=ee(fe,[["__scopeId","data-v-9b13b44d"]]);export{ve as default};
