import{_ as me,i as _e,r as c,a as q,j as ve,b as w,d as f,c as n,w as l,e as o,k as u,f as ge,o as i,F as U,l as V,m as _,h as r,t as d,g as B,n as C}from"./index-BwvjrgmS.js";import{e as x,g as ke,f as ye,h as be}from"./enums-Vx4wKXVy.js";import{g as D,p as L}from"./request-BmRi9MFl.js";const he={class:"task-audit content-container"},Se={class:"table-container"},we={class:"table-header"},Ce={class:"left"},Ne={class:"right"},xe={key:1},Ie={class:"group-name"},Re=["onClick"],Te={__name:"list",setup(je){const H=ge(),{locale:J}=_e(),I=c(!1),A=c(!1),y=c(!1),R=c(!1),v=c(""),b=c(null),m=c([]),s=q({taskName:"",channelId:void 0,auditStatus:void 0,groupId:void 0}),z=c([]),E=c([]),Q=[{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"平台渠道",dataIndex:"channelName",key:"channelName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"auditStatus",key:"auditStatus"},{title:"操作",key:"action",fixed:"right",width:180}],G=c([]),g=q({current:1,pageSize:10,total:0}),W={selectedRowKeys:m,onChange:t=>{m.value=t},getCheckboxProps:t=>({disabled:t.auditStatus!==x.PENDING})},P=t=>ke(ye,t,J.value),X=t=>be[t],$=()=>{g.current=1,k()},Y=()=>{s.taskName="",s.channelId=void 0,s.auditStatus=void 0,s.groupId=void 0,$()},Z=t=>{Object.assign(g,t),k()},ee=t=>{H.push(`/task-audit/detail/${t.id}`)},te=async t=>{try{const a=await L("taskSubmitted.batchResolve",{ids:[t.id]});a.success?(u.success("审核通过成功"),k()):u.error(a.message)}catch{u.error("审核通过失败")}},ae=async()=>{if(!m.value.length){u.warning("请选择要通过的任务");return}try{const t=await L("taskSubmitted.batchResolve",{ids:m.value});t.success?(u.success("批量审核通过成功"),m.value=[],k()):u.error(t.message)}catch{u.error("批量审核通过失败")}},le=t=>{m.value=[t.id],v.value="",y.value=!0},ne=async()=>{if(!v.value){u.error("请输入拒绝原因");return}try{R.value=!0;const t=await L("taskSubmitted.batchReject",{ids:m.value,reason:v.value});t.success?(u.success("审核拒绝成功"),y.value=!1,k()):u.error(t.message)}catch{u.error("审核拒绝失败")}finally{R.value=!1}},se=()=>{if(!m.value.length){u.warning("请选择要拒绝的任务");return}v.value="",y.value=!0},oe=async()=>{const t=await D("channel.list");t.success&&(z.value=t.data.list)},ue=async(t="")=>{try{const a=await D("group.list",{params:{page:1,pageSize:50,keyword:t}});a.success&&(E.value=a.data.list||[])}catch{u.error("获取群组列表失败")}},k=async()=>{I.value=!0;try{const t=await D("taskSubmitted.list",{params:{page:g.current,pageSize:g.pageSize,...s}});t.success?(G.value=t.data.list,g.total=t.data.total):u.error(t.message)}finally{I.value=!1}};return ve(()=>{k(),ue(),oe()}),(t,a)=>{const re=o("a-input"),h=o("a-form-item"),T=o("a-select-option"),j=o("a-select"),N=o("a-button"),O=o("a-space"),ie=o("a-form"),de=o("a-tag"),F=o("a-popconfirm"),ce=o("a-table"),S=o("a-descriptions-item"),pe=o("a-descriptions"),K=o("a-modal"),fe=o("a-textarea");return i(),w("div",he,[f("div",Se,[f("div",we,[f("div",Ce,[n(ie,{layout:"inline",model:s},{default:l(()=>[n(h,{label:"任务名称"},{default:l(()=>[n(re,{value:s.taskName,"onUpdate:value":a[0]||(a[0]=e=>s.taskName=e),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),n(h,{label:"平台渠道"},{default:l(()=>[n(j,{value:s.channelId,"onUpdate:value":a[1]||(a[1]=e=>s.channelId=e),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:l(()=>[(i(!0),w(U,null,V(z.value,e=>(i(),_(T,{key:e.id,value:e.id},{default:l(()=>[r(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(h,{label:"审核状态"},{default:l(()=>[n(j,{value:s.auditStatus,"onUpdate:value":a[2]||(a[2]=e=>s.auditStatus=e),placeholder:"请选择审核状态",style:{width:"120px"},"allow-clear":""},{default:l(()=>[(i(!0),w(U,null,V(Object.values(B(x)),e=>(i(),_(T,{key:e,value:e},{default:l(()=>[r(d(P(e)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(h,{label:"所属群组"},{default:l(()=>[n(j,{value:s.groupId,"onUpdate:value":a[3]||(a[3]=e=>s.groupId=e),placeholder:"请选择群组",style:{width:"120px"},"allow-clear":""},{default:l(()=>[(i(!0),w(U,null,V(E.value,e=>(i(),_(T,{key:e.id,value:e.id},{default:l(()=>[r(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(h,null,{default:l(()=>[n(O,null,{default:l(()=>[n(N,{type:"primary",onClick:$},{default:l(()=>a[7]||(a[7]=[r("查询")])),_:1}),n(N,{onClick:Y},{default:l(()=>a[8]||(a[8]=[r("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),f("div",Ne,[n(O,null,{default:l(()=>[n(N,{type:"primary",onClick:ae},{default:l(()=>a[9]||(a[9]=[r("批量通过")])),_:1}),n(N,{danger:"",onClick:se},{default:l(()=>a[10]||(a[10]=[r("批量拒绝")])),_:1})]),_:1})])]),n(ce,{columns:Q,"data-source":G.value,loading:I.value,pagination:g,"row-selection":W,onChange:Z},{bodyCell:l(({column:e,record:p})=>[e.key==="auditStatus"?(i(),_(de,{key:0,color:X(p.auditStatus)},{default:l(()=>[r(d(P(p.auditStatus)),1)]),_:2},1032,["color"])):C("",!0),e.key==="member"?(i(),w("div",xe,[f("div",null,d(p.memberNickname),1),f("div",Ie,d(p.groupName),1)])):C("",!0),e.key==="action"?(i(),_(O,{key:2},{default:l(()=>[f("a",{onClick:M=>ee(p)},"查看",8,Re),p.auditStatus===B(x).PENDING?(i(),_(F,{key:0,title:"确定要通过该任务吗？",onConfirm:M=>te(p)},{default:l(()=>a[11]||(a[11]=[f("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):C("",!0),p.auditStatus===B(x).PENDING?(i(),_(F,{key:1,title:"确定要拒绝该任务吗？",onConfirm:M=>le(p)},{default:l(()=>a[12]||(a[12]=[f("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):C("",!0)]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading","pagination"])]),n(K,{open:A.value,"onUpdate:open":a[4]||(a[4]=e=>A.value=e),title:"任务详情",footer:null},{default:l(()=>[n(pe,{column:1},{default:l(()=>[n(S,{label:"任务名称"},{default:l(()=>{var e;return[r(d((e=b.value)==null?void 0:e.taskName),1)]}),_:1}),n(S,{label:"任务类型"},{default:l(()=>{var e;return[r(d((e=b.value)==null?void 0:e.taskType),1)]}),_:1}),n(S,{label:"任务描述"},{default:l(()=>{var e;return[r(d((e=b.value)==null?void 0:e.description),1)]}),_:1}),n(S,{label:"任务奖励"},{default:l(()=>{var e;return[r(d((e=b.value)==null?void 0:e.reward),1)]}),_:1}),n(S,{label:"创建时间"},{default:l(()=>{var e;return[r(d((e=b.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),n(K,{open:y.value,"onUpdate:open":a[6]||(a[6]=e=>y.value=e),title:"拒绝原因",onOk:ne,confirmLoading:R.value},{default:l(()=>[n(fe,{value:v.value,"onUpdate:value":a[5]||(a[5]=e=>v.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Be=me(Te,[["__scopeId","data-v-fc95fbe9"]]);export{Be as default};
