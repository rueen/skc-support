import{_ as ye,a as we,b as Te,j as K,r as k,c as q,k as Se,d as g,e as f,f as s,w as a,g as i,l as x,m as p,h as Ce,o as u,F as y,n as j,p as v,i as d,t as o,s as b,q as Ie,M as Ae,A as J}from"./index-HyEta7Jh.js";import{d as Ne}from"./download-8S3SfOkV.js";import{G as $e}from"./GroupOwner-BIPS63hu.js";const Re={class:"task-audit content-container"},Oe={class:"table-container"},xe={class:"table-header"},je={style:{width:"100%",display:"flex","justify-content":"space-between"}},De={key:4},Ue=["onClick"],Ee={__name:"confirm-audit-list",setup(Me){const D=we(),{t:r}=Te(),Q=K(()=>D.loaded?D.getEnumOptions("TaskAuditStatus"):[]),B=Ce(),U=k(!1),L=k(!1),S=k(!1),V=k(!1),w=k(""),C=k(null),_=k([]),E=k([]),l=q({taskName:"",channelId:void 0,taskAuditStatus:"pending",waiterId:void 0,groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),z=k([]),H=k([]),X=K(()=>[{title:r("submittedTasks.list.taskName"),key:"taskName"},{title:r("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:r("submittedTasks.list.memberInfo"),key:"member"},{title:r("submittedTasks.list.status"),dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:r("submittedTasks.list.preAuditor"),key:"preWaiterName"},{title:r("submittedTasks.list.confirmAuditor"),key:"waiterName"},{title:r("submittedTasks.list.action"),key:"action",fixed:"right",width:180}]),M=k([]),T=q({current:1,pageSize:10,total:0}),Z={selectedRowKeys:_,onChange:t=>{_.value=t},getCheckboxProps:t=>({disabled:t.taskAuditStatus!=="pending"})},P=()=>{T.current=1,I()},ee=()=>{Object.assign(l,{taskName:"",channelId:void 0,taskAuditStatus:"pending",waiterId:void 0,groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),P()},te=t=>{Object.assign(T,t),I()},ae=t=>{B.push(`/member/view/${t.memberId}`)},se=t=>{B.push(`/submitted-tasks/detail/${t.id}?type=confirm`)},ne=async t=>{_.value=[t.id],F()},F=async()=>{if(!_.value.length){p.warning(r("submittedTasks.list.selectTask"));return}const t=await J("taskSubmitted.batchConfirmAuditApprove",{ids:_.value});t.code===0?(p.success(r("submittedTasks.resolveSuccess")),_.value=[],I()):p.error(t.message)},le=t=>{_.value=[t.id],w.value="",S.value=!0},oe=async()=>{if(!w.value){p.error("请输入拒绝原因");return}V.value=!0;const t=await J("taskSubmitted.batchConfirmAuditReject",{ids:_.value,reason:w.value});t.code===0?(p.success("审核拒绝成功"),S.value=!1,I()):p.error(t.message)},ue=()=>{if(!_.value.length){p.warning("请选择要拒绝的任务");return}w.value="",S.value=!0},ie=async()=>{const t=await x("channel.list");t.code===0&&(z.value=t.data.list)},de=()=>{Ae.confirm({title:r("common.export"),content:r("common.confirmExportContent"),onOk:async()=>{var t,n;try{const h=p.loading(r("common.exporting"),0),m={taskName:l.taskName,channelId:l.channelId,taskAuditStatus:l.taskAuditStatus,waiterId:l.waiterId,groupId:l.groupId,submitStartTime:(t=l.submitTimeRange)==null?void 0:t[0],submitEndTime:(n=l.submitTimeRange)==null?void 0:n[1],completedTaskCount:l.completedTaskCount};await Ne("taskSubmitted.confirmAuditExport",m,`复审列表_${new Date().toLocaleDateString()}.xlsx`),h(),p.success(r("common.exportSuccess"))}catch(h){console.error("导出失败:",h),p.error(r("common.exportFailed"))}}})},re=async(t="")=>{try{const n=await x("group.list",{params:{page:1,pageSize:50,keyword:t}});n.code===0&&(H.value=n.data.list||[])}catch{p.error("获取群组列表失败")}},I=async()=>{var t,n;U.value=!0;try{const h={page:T.current,pageSize:T.pageSize,taskName:l.taskName,channelId:l.channelId,taskAuditStatus:l.taskAuditStatus,waiterId:l.waiterId,groupId:l.groupId,submitStartTime:(t=l.submitTimeRange)==null?void 0:t[0],submitEndTime:(n=l.submitTimeRange)==null?void 0:n[1],completedTaskCount:l.completedTaskCount},m=await x("taskSubmitted.confirmAuditList",{...h});m.code===0?(M.value=m.data.list,T.total=m.data.total):p.error(m.message)}finally{U.value=!1}},me=async()=>{if(E.value.length)return;const t=await x("waiter.list",{page:1,pageSize:100});t.code===0&&(E.value=t.data.list||[])};return Se(()=>{I(),re(),ie(),me()}),(t,n)=>{const h=i("a-input"),m=i("a-form-item"),R=i("a-select-option"),O=i("a-select"),ce=i("a-range-picker"),pe=i("a-input-number"),ke=i("a-form"),A=i("a-button"),N=i("a-space"),fe=i("DownloadOutlined"),ve=i("a-avatar"),be=i("a-typography-link"),W=i("a-popconfirm"),_e=i("a-table"),$=i("a-descriptions-item"),ge=i("a-descriptions"),G=i("a-modal"),he=i("a-textarea");return u(),g("div",Re,[f("div",Oe,[f("div",xe,[s(ke,{layout:"inline",model:l},{default:a(()=>[s(m,{label:t.$t("submittedTasks.search.taskName")},{default:a(()=>[s(h,{value:l.taskName,"onUpdate:value":n[0]||(n[0]=e=>l.taskName=e),placeholder:t.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:t.$t("submittedTasks.search.channel")},{default:a(()=>[s(O,{value:l.channelId,"onUpdate:value":n[1]||(n[1]=e=>l.channelId=e),placeholder:t.$t("submittedTasks.search.channelPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),g(y,null,j(z.value,e=>(u(),v(R,{key:e.id,value:e.id},{default:a(()=>[d(o(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:t.$t("submittedTasks.search.submitTime")},{default:a(()=>[s(ce,{value:l.submitTimeRange,"onUpdate:value":n[2]||(n[2]=e=>l.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),s(m,{label:t.$t("submittedTasks.search.taskAuditStatus")},{default:a(()=>[s(O,{value:l.taskAuditStatus,"onUpdate:value":n[3]||(n[3]=e=>l.taskAuditStatus=e),placeholder:t.$t("submittedTasks.search.taskAuditStatusPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),g(y,null,j(Q.value,e=>(u(),v(R,{key:e.value,value:e.value},{default:a(()=>[d(o(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:t.$t("submittedTasks.search.confirmAuditor")},{default:a(()=>[s(O,{value:l.waiterId,"onUpdate:value":n[4]||(n[4]=e=>l.waiterId=e),placeholder:t.$t("submittedTasks.search.confirmAuditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:a(()=>[(u(!0),g(y,null,j(E.value,e=>(u(),v(R,{key:e.id,value:e.id},{default:a(()=>[d(o(e.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:t.$t("submittedTasks.search.groupId")},{default:a(()=>[s(O,{value:l.groupId,"onUpdate:value":n[5]||(n[5]=e=>l.groupId=e),placeholder:t.$t("submittedTasks.search.groupIdPlaceholder"),"allow-clear":""},{default:a(()=>[(u(!0),g(y,null,j(H.value,e=>(u(),v(R,{key:e.id,value:e.id},{default:a(()=>[d(o(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(m,{label:t.$t("submittedTasks.search.completedTaskCount")},{default:a(()=>[s(pe,{value:l.completedTaskCount,"onUpdate:value":n[6]||(n[6]=e=>l.completedTaskCount=e),min:0,max:9999,"addon-after":t.$t("submittedTasks.search.times"),style:{width:"100px!important"}},null,8,["value","addon-after"])]),_:1},8,["label"])]),_:1},8,["model"]),f("div",je,[f("div",null,[s(N,null,{default:a(()=>[s(A,{type:"primary",onClick:P},{default:a(()=>[d(o(t.$t("common.search")),1)]),_:1}),s(A,{onClick:ee},{default:a(()=>[d(o(t.$t("common.reset")),1)]),_:1})]),_:1})]),f("div",null,[s(N,null,{default:a(()=>[M.value.length?(u(),v(A,{key:0,onClick:de},{icon:a(()=>[s(fe)]),default:a(()=>[d(" "+o(t.$t("common.export")),1)]),_:1})):b("",!0),s(A,{type:"primary",onClick:F},{default:a(()=>[d(o(t.$t("common.batchResolve")),1)]),_:1}),s(A,{danger:"",onClick:ue},{default:a(()=>[d(o(t.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),s(_e,{columns:X.value,"data-source":M.value,loading:U.value,pagination:T,"row-selection":Z,rowKey:"id",onChange:te},{bodyCell:a(({column:e,record:c})=>[e.key==="taskName"?(u(),v(N,{key:0},{default:a(()=>[s(ve,{src:c.channelIcon,size:"small"},null,8,["src"]),f("span",null,o(c.taskName),1)]),_:2},1024)):b("",!0),e.key==="taskAuditStatus"?(u(),g(y,{key:1},[d(o(Ie(D).getEnumText("TaskAuditStatus",c.taskAuditStatus)),1)],64)):b("",!0),e.key==="preWaiterName"?(u(),g(y,{key:2},[d(o(c.preWaiterName||"--"),1)],64)):b("",!0),e.key==="waiterName"?(u(),g(y,{key:3},[d(o(c.waiterName||"--"),1)],64)):b("",!0),e.key==="member"?(u(),g("div",De,[f("div",null,[s(be,{onClick:Y=>ae(c)},{default:a(()=>[d(o(c.nickname),1)]),_:2},1032,["onClick"])]),s(N,{class:"group-name"},{default:a(()=>[f("span",null,o(c.groupName),1),c.isOwner?(u(),v($e,{key:0})):b("",!0)]),_:2},1024)])):b("",!0),e.key==="action"?(u(),v(N,{key:5},{default:a(()=>[f("a",{onClick:Y=>se(c)},"查看",8,Ue),c.taskAuditStatus==="pending"?(u(),v(W,{key:0,title:"确定要通过该任务吗？",onConfirm:Y=>ne(c)},{default:a(()=>n[10]||(n[10]=[f("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):b("",!0),c.taskAuditStatus==="pending"?(u(),v(W,{key:1,title:"确定要拒绝该任务吗？",onConfirm:Y=>le(c)},{default:a(()=>n[11]||(n[11]=[f("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):b("",!0)]),_:2},1024)):b("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),s(G,{open:L.value,"onUpdate:open":n[7]||(n[7]=e=>L.value=e),title:"任务详情",footer:null},{default:a(()=>[s(ge,{column:1},{default:a(()=>[s($,{label:"任务名称"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.taskName),1)]}),_:1}),s($,{label:"任务类型"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.taskType),1)]}),_:1}),s($,{label:"任务描述"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.description),1)]}),_:1}),s($,{label:"任务奖励"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.reward),1)]}),_:1}),s($,{label:"创建时间"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),s(G,{open:S.value,"onUpdate:open":n[9]||(n[9]=e=>S.value=e),title:"拒绝原因",onOk:oe,confirmLoading:V.value},{default:a(()=>[s(he,{value:w.value,"onUpdate:value":n[8]||(n[8]=e=>w.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ve=ye(Ee,[["__scopeId","data-v-6b516044"]]);export{Ve as default};
