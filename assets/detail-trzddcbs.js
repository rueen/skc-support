import{_ as le,a as ne,b as oe,r as g,c as H,j as E,B as ae,k as re,p as O,o as m,w as s,e as I,f as a,g as n,d as z,n as se,F as M,i as y,t as c,s as D,q as ie,l as J,m as h,x as ce,h as de,z as me,A as pe}from"./index-D76b9hFB.js";import{P as ke}from"./PageHeader-z7ICa915.js";const fe={class:"select-task-modal"},ve={class:"filter-form"},_e={class:"selected-info"},he={key:1},ge={__name:"SelectTask",props:{visible:{type:Boolean,default:!1},selectedId:{type:Array,default:()=>[]}},emits:["update:visible","confirm","cancel"],setup(Q,{emit:d}){const $=ne(),{t:T}=oe(),p=Q,N=d,S=g(!1),F=g(!1),i=g([]),u=H({taskName:"",channelId:void 0,taskStatus:void 0}),C=g([]),W=E(()=>$.loaded?$.getEnumOptions("TaskStatus"):[]),f=E(()=>[{title:T("task.list.name"),key:"taskName",width:200},{title:T("task.list.status"),key:"taskStatus",width:100},{title:T("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:T("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0}]),B=g([]),b=H({current:1,pageSize:10,total:0}),V=H({sorterField:void 0,sorterOrder:void 0}),j=E(()=>({selectedRowKeys:i.value,onChange:(e,r)=>{X(e)},getCheckboxProps:e=>({disabled:!1})})),X=(e,r)=>{const v=B.value.map(w=>w.id),_=i.value.filter(w=>!v.includes(w));i.value=[..._,...e]},x=()=>{b.current=1,G()},Y=()=>{u.taskName="",u.channelId=void 0,u.taskStatus=void 0,x()},R=(e,r,v)=>{Object.assign(b,e),Object.assign(V,{sorterField:v.field,sorterOrder:v.order}),G()},Z=()=>{N("confirm",{taskIds:i.value}),L()},L=()=>{N("update:visible",!1),N("cancel")},G=async()=>{S.value=!0;try{const e=await J("task.list",{page:b.current,pageSize:b.pageSize,...V,...u});e.code===0?(B.value=e.data.list,b.total=e.data.total):h.error(e.message)}finally{S.value=!1}},t=async()=>{const e=await J("channel.list");e.code===0&&(C.value=e.data.list)},l=()=>{p.selectedId&&p.selectedId.length>0&&(i.value=[...p.selectedId])};return ae(()=>p.visible,e=>{e?(G(),C.value.length||t(),l()):(i.value=[],b.current=1)}),ae(()=>p.selectedId,()=>{p.visible&&l()},{deep:!0}),re(()=>{p.visible&&(G(),t(),l())}),(e,r)=>{const v=n("a-input"),_=n("a-form-item"),w=n("a-select-option"),U=n("a-select"),A=n("a-button"),K=n("a-space"),ee=n("a-form"),k=n("a-alert"),P=n("a-avatar"),te=n("a-table"),ue=n("a-modal");return m(),O(ue,{open:Q.visible,title:e.$t("task.selectTask.title"),width:900,"confirm-loading":F.value,onOk:Z,onCancel:L},{default:s(()=>[I("div",fe,[I("div",ve,[a(ee,{layout:"inline",model:u},{default:s(()=>[a(_,{label:e.$t("task.search.taskName")},{default:s(()=>[a(v,{value:u.taskName,"onUpdate:value":r[0]||(r[0]=o=>u.taskName=o),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(_,{label:e.$t("task.search.channelId")},{default:s(()=>[a(U,{value:u.channelId,"onUpdate:value":r[1]||(r[1]=o=>u.channelId=o),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:s(()=>[(m(!0),z(M,null,se(C.value,o=>(m(),O(w,{key:o.id,value:o.id},{default:s(()=>[y(c(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(_,{label:e.$t("task.search.taskStatus")},{default:s(()=>[a(U,{value:u.taskStatus,"onUpdate:value":r[2]||(r[2]=o=>u.taskStatus=o),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:s(()=>[(m(!0),z(M,null,se(W.value,o=>(m(),O(w,{key:o.value,value:o.value},{default:s(()=>[y(c(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(_,null,{default:s(()=>[a(K,null,{default:s(()=>[a(A,{type:"primary",onClick:x},{default:s(()=>[y(c(e.$t("common.search")),1)]),_:1}),a(A,{onClick:Y},{default:s(()=>[y(c(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),I("div",_e,[a(k,{message:e.$t("task.selectTask.selectedCount",{count:i.value.length}),type:"info","show-icon":""},null,8,["message"])]),a(te,{columns:f.value,"data-source":B.value,loading:S.value,pagination:b,"row-selection":j.value,rowKey:"id",onChange:R,size:"middle"},{bodyCell:s(({column:o,record:q})=>[o.key==="taskName"?(m(),O(K,{key:0},{default:s(()=>[a(P,{src:q.channelIcon,size:"small"},null,8,["src"]),I("span",null,c(q.taskName),1)]),_:2},1024)):D("",!0),o.key==="taskTime"?(m(),z("div",he,c(q.startTime)+" - "+c(q.endTime),1)):D("",!0),o.key==="taskStatus"?(m(),z(M,{key:2},[y(c(ie($).getEnumText("TaskStatus",q.taskStatus)),1)],64)):D("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])])]),_:1},8,["open","title","confirm-loading"])}}},ye=le(ge,[["__scopeId","data-v-16074623"]]),be={class:"task-form content-container"},Te={class:"danger"},we={__name:"detail",setup(Q){const{t:d}=oe(),$=ne(),T=ce(),p=de(),N=g(),S=E(()=>T.name==="TaskGroupEdit"),F=g(!1),i=g([]),u=E(()=>i.value.map(t=>t.id)),C=g(!1),W=E(()=>[{title:"index",key:"index",width:60,customRender:({index:t})=>t+1},{title:d("task.list.name"),key:"taskName"},{title:d("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:t})=>$.getEnumText("TaskStatus",t)},{title:d("task.list.startTime"),dataIndex:"startTime",key:"startTime"},{title:d("task.list.endTime"),dataIndex:"endTime",key:"endTime"},{title:d("task.list.action"),key:"action",fixed:"right",width:180}]),f=H({taskGroupName:"",taskGroupReward:0}),B={taskGroupName:[{required:!0,message:d("task.group.validation.taskGroupNameRequired")}],taskGroupReward:[{required:!0,message:d("task.group.validation.taskGroupRewardRequired")}]},b=()=>{F.value=!0},V=({taskIds:t})=>{j(t)},j=async(t,l=!1)=>{if(!(!t||!t.length))try{C.value=!0;const e=await J("task.list",{page:1,pageSize:100,sorterField:"startTime",sorterOrder:"ascend",taskIds:t});e.code===0?l?i.value=t.map(r=>e.data.list.find(v=>v.id===r)):i.value=e.data.list:h.error(e.message)}catch(e){h.error(e)}finally{C.value=!1}},X=t=>{i.value=i.value.filter(l=>l.id!==t.id)},x=async()=>{try{R.value=!0;const t={...f,relatedTasks:u.value},l=await pe("taskGroup.add",t);l.code===0?(h.success(d("common.submitSuccess")),p.back()):h.error(l.message)}catch{h.error(d("common.submitFailed"))}finally{R.value=!1}},Y=async()=>{try{R.value=!0;const t={...f},l=await me("taskGroup.edit",{...t,relatedTasks:u.value},{urlParams:{id:T.params.id}});l.code===0?(h.success(d("common.submitSuccess")),p.back()):h.error(l.message)}catch{h.error(d("common.submitFailed"))}finally{R.value=!1}},R=g(!1),Z=()=>{N.value.validate().then(async()=>{S.value?await Y():await x()})},L=()=>{p.back()},G=async t=>{try{const l=await J("taskGroup.detail",{},{urlParams:{id:t}});if(l.code===0){const e=l.data;Object.assign(f,{taskGroupName:e.taskGroupName,taskGroupReward:e.taskGroupReward}),j(e.relatedTasks,!0)}}catch(l){h.error(l)}};return re(()=>{S.value&&G(T.params.id)}),(t,l)=>{const e=n("a-input"),r=n("a-form-item"),v=n("a-input-number"),_=n("a-button"),w=n("a-avatar"),U=n("a-space"),A=n("a-popconfirm"),K=n("a-table"),ee=n("a-form");return m(),z("div",be,[a(ke,{title:S.value?t.$t("task.group.editTitle"):t.$t("task.group.createTitle"),back:!0,class:"page-header"},null,8,["title"]),I("div",null,[a(ee,{ref_key:"formRef",ref:N,model:f,rules:B,"label-col":{span:3},"wrapper-col":{span:19},layout:"horizontal"},{default:s(()=>[a(r,{label:t.$t("task.group.name")},{default:s(()=>[a(e,{value:f.taskGroupName,"onUpdate:value":l[0]||(l[0]=k=>f.taskGroupName=k),placeholder:t.$t("common.inputPlaceholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:t.$t("task.group.reward")},{default:s(()=>[a(v,{value:f.taskGroupReward,"onUpdate:value":l[1]||(l[1]=k=>f.taskGroupReward=k),min:0,precision:2,step:1,placeholder:t.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(r,{label:t.$t("task.group.relatedTask")},{default:s(()=>[I("div",null,[a(_,{type:"primary",onClick:b},{default:s(()=>[y(c(t.$t("task.group.selectTaskBtnText",{count:i.value.length})),1)]),_:1}),a(K,{columns:W.value,"data-source":i.value,loading:C.value,pagination:!1,style:{"margin-top":"10px"}},{bodyCell:s(({column:k,record:P})=>[k.key==="taskName"?(m(),O(U,{key:0},{default:s(()=>[a(w,{src:P.channelIcon},null,8,["src"]),y(" "+c(P.taskName),1)]),_:2},1024)):D("",!0),k.key==="taskStatus"?(m(),z(M,{key:1},[y(c(ie($).getEnumText("TaskStatus",P.taskStatus)),1)],64)):D("",!0),k.key==="action"?(m(),O(A,{key:2,title:t.$t("common.deleteConfirm"),onConfirm:te=>X(P)},{default:s(()=>[I("a",Te,c(t.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])):D("",!0)]),_:1},8,["columns","data-source","loading"])])]),_:1},8,["label"]),a(r,{"wrapper-col":{span:16,offset:3}},{default:s(()=>[a(U,null,{default:s(()=>[a(_,{type:"primary",onClick:Z},{default:s(()=>[y(c(t.$t("common.submit")),1)]),_:1}),a(_,{onClick:L},{default:s(()=>[y(c(t.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),a(ye,{visible:F.value,"onUpdate:visible":l[2]||(l[2]=k=>F.value=k),selectedId:u.value,onConfirm:V},null,8,["visible","selectedId"])])}}},Ie=le(we,[["__scopeId","data-v-eff6d7f2"]]);export{Ie as default};
