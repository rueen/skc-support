import{_ as _e,i as ke,j as ge,r as f,a as W,k as ye,b as g,d as c,c as n,w as a,e as s,l as U,m,f as be,o as u,F as w,n as M,p as k,h as i,t as d,q as v,g as G,D as we,M as Se,z as K}from"./index-D7zbyf1Z.js";import{d as Ce}from"./download-BmIvHCEM.js";const he={class:"task-audit content-container"},xe={class:"table-container"},Ae={class:"table-header"},Ne={style:{width:"100%",display:"flex","justify-content":"space-between"}},Te={key:4},Re={class:"group-name"},Ie=["onClick"],Oe={__name:"confirm-audit-list",setup(je){const T=ke(),q=ge(()=>T.loaded?T.getEnumOptions("TaskAuditStatus"):[]),P=be(),R=f(!1),Y=f(!1),S=f(!1),B=f(!1),y=f(""),C=f(null),_=f([]),o=W({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),E=f([]),L=f([]),J=[{title:"任务名称",key:"taskName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:"初审员",key:"preWaiterName"},{title:"复审员",key:"waiterName"},{title:"操作",key:"action",fixed:"right",width:180}],I=f([]),b=W({current:1,pageSize:10,total:0}),Q={selectedRowKeys:_,onChange:l=>{_.value=l},getCheckboxProps:l=>({disabled:l.taskAuditStatus!=="pending"})},V=()=>{b.current=1,h()},X=()=>{Object.assign(o,{taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),V()},Z=l=>{Object.assign(b,l),h()},ee=l=>{P.push(`/submitted-tasks/detail/${l.id}?type=confirm`)},te=async l=>{_.value=[l.id],z()},z=async()=>{if(!_.value.length){m.warning("请选择要通过的任务");return}const l=await K("taskSubmitted.batchConfirmAuditApprove",{ids:_.value});l.code===0?(m.success("批量审核通过成功"),_.value=[],h()):m.error(l.message)},ae=l=>{_.value=[l.id],y.value="",S.value=!0},ne=async()=>{if(!y.value){m.error("请输入拒绝原因");return}B.value=!0;const l=await K("taskSubmitted.batchConfirmAuditReject",{ids:_.value,reason:y.value});l.code===0?(m.success("审核拒绝成功"),S.value=!1,h()):m.error(l.message)},le=()=>{if(!_.value.length){m.warning("请选择要拒绝的任务");return}y.value="",S.value=!0},oe=async()=>{const l=await U("channel.list");l.code===0&&(E.value=l.data.list)},se=()=>{Se.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const l=m.loading("正在导出数据，请稍候...",0),t={...o};await Ce("taskSubmitted.confirmAuditExport",t,`复审列表_${new Date().toLocaleDateString()}.xlsx`),l(),m.success("导出成功")}catch(l){console.error("导出失败:",l),m.error("导出失败，请稍后重试")}}})},ue=async(l="")=>{try{const t=await U("group.list",{params:{page:1,pageSize:50,keyword:l}});t.code===0&&(L.value=t.data.list||[])}catch{m.error("获取群组列表失败")}},h=async()=>{var l,t;R.value=!0;try{const O={page:b.current,pageSize:b.pageSize,taskName:o.taskName,channelId:o.channelId,taskAuditStatus:o.taskAuditStatus,groupId:o.groupId,submitStartTime:(l=o.submitTimeRange)==null?void 0:l[0],submitEndTime:(t=o.submitTimeRange)==null?void 0:t[1],completedTaskCount:o.completedTaskCount},p=await U("taskSubmitted.confirmAuditList",{...O});p.code===0?(I.value=p.data.list,b.total=p.data.total):m.error(p.message)}finally{R.value=!1}};return ye(()=>{h(),ue(),oe()}),(l,t)=>{const O=s("a-input"),p=s("a-form-item"),j=s("a-select-option"),D=s("a-select"),ie=s("a-range-picker"),de=s("a-input-number"),re=s("a-form"),x=s("a-button"),N=s("a-space"),ce=s("a-avatar"),me=s("a-tag"),H=s("a-popconfirm"),pe=s("a-table"),A=s("a-descriptions-item"),fe=s("a-descriptions"),$=s("a-modal"),ve=s("a-textarea");return u(),g("div",he,[c("div",xe,[c("div",Ae,[n(re,{layout:"inline",model:o},{default:a(()=>[n(p,{label:"任务名称"},{default:a(()=>[n(O,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=e=>o.taskName=e),placeholder:"请输入任务名称","allow-clear":"",style:{width:"140px"}},null,8,["value"])]),_:1}),n(p,{label:"平台渠道"},{default:a(()=>[n(D,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=e=>o.channelId=e),placeholder:"请选择平台渠道","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),g(w,null,M(E.value,e=>(u(),k(j,{key:e.id,value:e.id},{default:a(()=>[i(d(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(p,{label:"复审状态"},{default:a(()=>[n(D,{value:o.taskAuditStatus,"onUpdate:value":t[2]||(t[2]=e=>o.taskAuditStatus=e),placeholder:"请选择复审状态","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(u(!0),g(w,null,M(q.value,e=>(u(),k(j,{key:e.value,value:e.value},{default:a(()=>[i(d(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(p,{label:"所属群组"},{default:a(()=>[n(D,{value:o.groupId,"onUpdate:value":t[3]||(t[3]=e=>o.groupId=e),placeholder:"请选择群组","allow-clear":""},{default:a(()=>[(u(!0),g(w,null,M(L.value,e=>(u(),k(j,{key:e.id,value:e.id},{default:a(()=>[i(d(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(p,{label:"提交时间"},{default:a(()=>[n(ie,{value:o.submitTimeRange,"onUpdate:value":t[4]||(t[4]=e=>o.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1}),n(p,{label:"已完成任务"},{default:a(()=>[n(de,{value:o.completedTaskCount,"onUpdate:value":t[5]||(t[5]=e=>o.completedTaskCount=e),min:0,max:9999,"addon-after":"次",style:{width:"100px!important"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),c("div",Ne,[c("div",null,[n(N,null,{default:a(()=>[n(x,{type:"primary",onClick:V},{default:a(()=>t[9]||(t[9]=[i("查询")])),_:1}),n(x,{onClick:X},{default:a(()=>t[10]||(t[10]=[i("重置")])),_:1})]),_:1})]),c("div",null,[n(N,null,{default:a(()=>[I.value.length?(u(),k(x,{key:0,onClick:se},{icon:a(()=>[n(G(we))]),default:a(()=>[t[11]||(t[11]=i(" 导出 "))]),_:1})):v("",!0),n(x,{type:"primary",onClick:z},{default:a(()=>t[12]||(t[12]=[i("批量通过")])),_:1}),n(x,{danger:"",onClick:le},{default:a(()=>t[13]||(t[13]=[i("批量拒绝")])),_:1})]),_:1})])])]),n(pe,{columns:J,"data-source":I.value,loading:R.value,pagination:b,"row-selection":Q,rowKey:"id",onChange:Z},{bodyCell:a(({column:e,record:r})=>[e.key==="taskName"?(u(),k(N,{key:0},{default:a(()=>[n(ce,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,d(r.taskName),1)]),_:2},1024)):v("",!0),e.key==="taskAuditStatus"?(u(),g(w,{key:1},[i(d(G(T).getEnumText("TaskAuditStatus",r.taskAuditStatus)),1)],64)):v("",!0),e.key==="preWaiterName"?(u(),g(w,{key:2},[i(d(r.preWaiterName||"--"),1)],64)):v("",!0),e.key==="waiterName"?(u(),g(w,{key:3},[i(d(r.waiterName||"--"),1)],64)):v("",!0),e.key==="member"?(u(),g("div",Te,[c("div",null,d(r.memberNickname),1),c("div",Re,[c("span",null,d(r.groupName),1),r.isGroupOwner?(u(),k(me,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>t[14]||(t[14]=[i("群主")])),_:1})):v("",!0)])])):v("",!0),e.key==="action"?(u(),k(N,{key:5},{default:a(()=>[c("a",{onClick:F=>ee(r)},"查看",8,Ie),r.taskAuditStatus==="pending"?(u(),k(H,{key:0,title:"确定要通过该任务吗？",onConfirm:F=>te(r)},{default:a(()=>t[15]||(t[15]=[c("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):v("",!0),r.taskAuditStatus==="pending"?(u(),k(H,{key:1,title:"确定要拒绝该任务吗？",onConfirm:F=>ae(r)},{default:a(()=>t[16]||(t[16]=[c("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):v("",!0)]),_:2},1024)):v("",!0)]),_:1},8,["data-source","loading","pagination"])]),n($,{open:Y.value,"onUpdate:open":t[6]||(t[6]=e=>Y.value=e),title:"任务详情",footer:null},{default:a(()=>[n(fe,{column:1},{default:a(()=>[n(A,{label:"任务名称"},{default:a(()=>{var e;return[i(d((e=C.value)==null?void 0:e.taskName),1)]}),_:1}),n(A,{label:"任务类型"},{default:a(()=>{var e;return[i(d((e=C.value)==null?void 0:e.taskType),1)]}),_:1}),n(A,{label:"任务描述"},{default:a(()=>{var e;return[i(d((e=C.value)==null?void 0:e.description),1)]}),_:1}),n(A,{label:"任务奖励"},{default:a(()=>{var e;return[i(d((e=C.value)==null?void 0:e.reward),1)]}),_:1}),n(A,{label:"创建时间"},{default:a(()=>{var e;return[i(d((e=C.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),n($,{open:S.value,"onUpdate:open":t[8]||(t[8]=e=>S.value=e),title:"拒绝原因",onOk:ne,confirmLoading:B.value},{default:a(()=>[n(ve,{value:y.value,"onUpdate:value":t[7]||(t[7]=e=>y.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Me=_e(Oe,[["__scopeId","data-v-a80f7432"]]);export{Me as default};
