import{_ as pe,b as _e,a as we,r as b,c as R,j as fe,B as ge,k as ke,x as he,d as g,f as t,e as o,t as n,w as a,g as i,F as z,n as M,l as p,h as $e,o as d,i as u,q as F,s as k,p as A,A as H,m as h}from"./index-fiN95LW_.js";import{P as ye}from"./PageHeader-6wFIfKwH.js";import{_ as N}from"./CopyContent-D4Yu_1cB.js";import{G as Ce}from"./GroupOwner-B485tbip.js";const Re={class:"member-view content-container"},Ae={class:"detail-container"},Se={class:"section"},Ie={class:"section-title"},Oe={key:0},Te={key:0},Ee={class:"section"},Ue={class:"section-title"},Pe={class:"account-list"},Fe={class:"link-text-container",style:{"max-width":"300px"}},Ne=["href"],Ge={class:"section",style:{"padding-bottom":"24px"}},Be={class:"section-title"},De={class:"section",style:{"padding-bottom":"24px"}},Le={class:"section-title"},je={class:"section"},qe={class:"section-title"},Ve={__name:"view",setup(ze){const{t:G}=_e(),S=we(),W=he(),J=$e(),m=b(""),s=R({}),B=b([]),K=fe(()=>`${ge.h5Url}?inviteCode=${s.inviteCode}`),I=R({}),O=R({}),T=R({}),D=b(),_=b(!1),$=b("grant"),v=R({amount:"",remark:""}),y=b(!1),Q=b({amount:[{required:!0,message:G("member.view.amountRequired")}],remark:[{required:!0,message:G("member.view.remarkRequired")}]}),X=async()=>{const e=await p("member.detail",{},{urlParams:{id:m.value}});e.code===0&&Object.assign(s,e.data||{})},E=async()=>{const e=await p("member.balance",{},{urlParams:{memberId:m.value}});e.code===0&&(s.balance=e.data.balance)},Y=async()=>{const e=await p("member.withdrawalsAccount",{},{urlParams:{memberId:m.value}});e.code===0&&(s.withdrawalsAccount=e.data[0]||{})},Z=async()=>{const e=await p("account.list",{memberId:m.value});e.code===0&&(B.value=e.data.list||[])},x=e=>{J.push({name:"AccountEdit",params:{id:e.id}})},ee=async()=>{const e=await p("member.taskStats",{},{urlParams:{memberId:m.value}});e.code===0&&Object.assign(I,e.data||{})},te=async()=>{const e=await p("member.inviteStats",{},{urlParams:{memberId:m.value}});e.code===0&&Object.assign(O,e.data||{})},ae=async()=>{const e=await p("member.groupsStats",{},{urlParams:{memberId:m.value}});e.code===0&&Object.assign(T,e.data||{})},le=()=>{_.value=!0,$.value="grant"},ne=()=>{_.value=!0,$.value="deduct"},se=async()=>{y.value=!0;try{const e=await H("member.grantReward",{memberId:m.value,amount:v.amount,remark:v.remark});e.code===0?(h.success("奖励发放成功"),_.value=!1,E()):h.error(e.message)}catch{h.error("奖励发放失败")}finally{y.value=!1}},oe=async()=>{y.value=!0;try{const e=await H("member.deductReward",{memberId:m.value,amount:v.amount,remark:v.remark},{urlParams:{memberId:m.value}});e.code===0?(h.success("奖励扣除成功"),_.value=!1,E()):h.error(e.message)}catch{h.error("奖励扣除失败")}finally{y.value=!1}},re=async()=>{try{switch(await D.value.validate(),$.value){case"grant":se();break;case"deduct":oe();break}}catch(e){console.log(e)}};return ke(()=>{m.value=W.params.id,X(),E(),Z(),ee(),te(),ae(),Y()}),(e,c)=>{const ie=i("UserOutlined"),L=i("a-avatar"),C=i("a-space"),r=i("a-descriptions-item"),j=i("a-button"),q=i("a-descriptions"),ue=i("a-tag"),me=i("EditOutlined"),w=i("a-statistic"),f=i("a-col"),U=i("a-row"),de=i("a-input"),V=i("a-form-item"),ce=i("a-textarea"),ve=i("a-form"),be=i("a-modal");return d(),g("div",Re,[t(ye,{title:e.$t("member.view.pageTitle"),back:!0},null,8,["title"]),o("div",Ae,[o("div",Se,[o("div",Ie,n(e.$t("member.view.memberInfo")),1),t(q,{column:2},{default:a(()=>[t(r,{label:e.$t("member.view.memberNickname")},{default:a(()=>[t(C,null,{default:a(()=>[t(L,{src:s.avatar,size:"small"},{icon:a(()=>[t(ie)]),_:1},8,["src"]),o("span",null,n(s.nickname),1)]),_:1})]),_:1},8,["label"]),t(r,{label:e.$t("member.view.memberAccount")},{default:a(()=>[u(n(s.account),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.gender")},{default:a(()=>[u(n(F(S).getEnumText("GenderType",s.gender)),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.occupation")},{default:a(()=>[u(n(F(S).getEnumText("OccupationType",s.occupation))+" ",1),s.occupation===null?(d(),g("span",Oe," - ")):k("",!0)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.email")},{default:a(()=>[u(n(s.email||"-"),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.phone")},{default:a(()=>[u(n(s.phone||"-"),1)]),_:1},8,["label"]),t(r,{label:"Telegram"},{default:a(()=>[u(n(s.telegram||"-"),1)]),_:1}),t(r,{label:e.$t("member.view.group")},{default:a(()=>[(d(!0),g(z,null,M(s.groups,l=>(d(),A(C,{key:l.id},{default:a(()=>[u(n(l.groupName)+" ",1),l.isOwner?(d(),A(Ce,{key:0})):k("",!0)]),_:2},1024))),128)),!s.groups||!s.groups.length?(d(),g("span",Te," - ")):k("",!0)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.inviter")},{default:a(()=>[u(n(s.inviterNickname||"-"),1)]),_:1},8,["label"]),t(r,{label:e.$t("member.view.inviteUrl")},{default:a(()=>[t(N,{content:K.value},null,8,["content"])]),_:1},8,["label"]),t(r,{label:e.$t("member.view.withdrawalsAccount")},{default:a(()=>[t(C,null,{default:a(()=>{var l,P;return[o("span",null,n(((l=s==null?void 0:s.withdrawalsAccount)==null?void 0:l.paymentChannelName)||"-"),1),o("span",null,n(((P=s==null?void 0:s.withdrawalsAccount)==null?void 0:P.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),t(r,{label:e.$t("member.view.balance")},{default:a(()=>[t(C,null,{default:a(()=>[o("span",null,n(s.balance),1),t(j,{type:"link",size:"small",onClick:c[0]||(c[0]=l=>le())},{default:a(()=>[u(n(e.$t("member.view.rewardGrant")),1)]),_:1}),t(j,{type:"link",size:"small",onClick:c[1]||(c[1]=l=>ne())},{default:a(()=>[u(n(e.$t("member.view.rewardDeduct")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),o("div",Ee,[o("div",Ue,n(e.$t("member.view.accountInfo")),1),o("div",Pe,[(d(!0),g(z,null,M(B.value,l=>(d(),g("div",{key:l.channelId},[t(q,{column:1},{default:a(()=>[t(r,{label:e.$t("member.view.account")},{default:a(()=>[t(C,null,{default:a(()=>[t(L,{src:l.channelIcon,size:"small"},null,8,["src"]),o("span",null,n(l.account),1),t(ue,{color:"warning"},{default:a(()=>[u(n(F(S).getEnumText("AccountAuditStatus",l.accountAuditStatus)),1)]),_:2},1024),t(me,{class:"edit-icon",onClick:P=>x(l)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),t(r,{label:e.$t("member.view.homepage")},{default:a(()=>[t(N,{content:l.homeUrl},{default:a(()=>[o("div",Fe,[o("a",{href:l.homeUrl,target:"_blank",class:"link-text"},n(l.homeUrl),9,Ne)])]),_:2},1032,["content"])]),_:2},1032,["label"]),t(r,{label:"uid"},{default:a(()=>[t(N,{content:l.uid},null,8,["content"])]),_:2},1024),l.channelCustomFields.includes("fansCount")?(d(),A(r,{key:0,label:e.$t("member.view.fansCount")},{default:a(()=>[u(n(l.fansCount),1)]),_:2},1032,["label"])):k("",!0),l.channelCustomFields.includes("friendsCount")?(d(),A(r,{key:1,label:e.$t("member.view.friendsCount")},{default:a(()=>[u(n(l.friendsCount),1)]),_:2},1032,["label"])):k("",!0),l.channelCustomFields.includes("postsCount")?(d(),A(r,{key:2,label:e.$t("member.view.postsCount")},{default:a(()=>[u(n(l.postsCount),1)]),_:2},1032,["label"])):k("",!0)]),_:2},1024)]))),128))])]),o("div",Ge,[o("div",Be,n(e.$t("member.view.taskStats")),1),t(U,{gutter:16},{default:a(()=>[t(f,{span:6},{default:a(()=>[t(w,{title:e.$t("member.view.completedTaskCount"),value:I.completedTaskCount},null,8,["title","value"])]),_:1}),t(f,{span:6},{default:a(()=>[t(w,{title:e.$t("member.view.taskReward"),value:I.taskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),o("div",De,[o("div",Le,n(e.$t("member.view.inviteStats")),1),t(U,null,{default:a(()=>[t(f,{span:6},{default:a(()=>[t(w,{title:e.$t("member.view.inviteCount"),value:O.inviteCount},null,8,["title","value"])]),_:1}),t(f,{span:6},{default:a(()=>[t(w,{title:e.$t("member.view.inviteReward"),value:O.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),o("div",je,[o("div",qe,n(e.$t("member.view.groupStats")),1),t(U,null,{default:a(()=>[t(f,{span:6},{default:a(()=>[t(w,{title:e.$t("member.view.groupCount"),value:T.groupCount},null,8,["title","value"])]),_:1}),t(f,{span:6},{default:a(()=>[t(w,{title:e.$t("member.view.groupEarnings"),value:T.totalEarnings},null,8,["title","value"])]),_:1})]),_:1})])]),t(be,{open:_.value,"onUpdate:open":c[4]||(c[4]=l=>_.value=l),title:$.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:re,confirmLoading:y.value},{default:a(()=>[t(ve,{ref_key:"rewardFormRef",ref:D,model:v,rules:Q.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:a(()=>[t(V,{label:$.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:a(()=>[t(de,{value:v.amount,"onUpdate:value":c[2]||(c[2]=l=>v.amount=l)},null,8,["value"])]),_:1},8,["label"]),t(V,{label:e.$t("member.view.remark"),name:"remark"},{default:a(()=>[t(ce,{value:v.remark,"onUpdate:value":c[3]||(c[3]=l=>v.remark=l),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"])])}}},Ke=pe(Ve,[["__scopeId","data-v-ca46447c"]]);export{Ke as default};
