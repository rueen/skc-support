import{_ as F,r as m,b as G,j as H,x as J,c as K,k as Q,d as A,f as r,e as W,w as o,g as i,l as P,m as u,h as X,o as p,F as O,n as B,p as C,i as g,t as w,z as Y,A as x}from"./index-_KmhQP4-.js";import{P as ee}from"./PageHeader-JsscRD6U.js";const ae={class:"member-form content-container"},te={class:"form-container"},le={__name:"detail",setup(re){const _=J(),k=X(),S=m(),{t:R}=G(),b=H(()=>!!_.params.id),t=K({memberNickname:"",memberAccount:"",password:"",groupIds:[],inviterId:void 0,isNew:!0}),h={memberAccount:[{required:!0,message:R("member.detail.memberAccountPlaceholder")},{validator:(e,a)=>{const s=/^9[0-9]{9}$/,n=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!a||s.test(a)||n.test(a)?Promise.resolve():Promise.reject(R("member.detail.memberAccountRule"))}}]},N=m(!1),f=m([]),I=m(!1),z=m([]),y=async(e="",a=null)=>{N.value=!0;try{const s=await P("group.list",{page:1,pageSize:200,groupName:e,memberId:a});s.code===0&&(f.value=s.data.list||[],t.groupIds.some(d=>f.value.some(v=>v.id===d))||(t.groupIds=[]))}finally{N.value=!1}},L=e=>{f.value=[],y()},E=async(e="")=>{I.value=!0;try{const a=await P("member.list",{page:1,pageSize:20,memberNickname:e});if(a.code===0){let s=a.data.list||[];!s.find(d=>d.id===c.value.inviterId)&&c.value.inviterId&&s.push({id:c.value.inviterId,nickname:c.value.inviterNickname}),z.value=s}}finally{I.value=!1}},c=m({}),M=async()=>{if(b.value)try{const e=await P("member.detail",{},{urlParams:{id:_.params.id}});if(e.code===0){const a=e.data;c.value=a,Object.assign(t,{memberNickname:a.nickname,memberAccount:a.account,groupIds:a.groups.map(s=>s.groupId),inviterId:a.inviterId,isNew:!!a.isNew})}}catch{u.error("load member info failed"),k.back()}},j=async()=>{t.isNew=t.isNew?1:0;const e=await x("member.add",t);e.code===0?(u.success(e.message),k.back()):u.error(e.message)},T=async()=>{t.isNew=t.isNew?1:0;const e=await Y("member.edit",t,{urlParams:{id:_.params.id}});e.code===0?(u.success(e.message),k.back()):u.error(e.message)},$=m(!1),V=()=>{S.value.validate().then(async()=>{try{$.value=!0,b.value?T():j()}catch{u.error("submit failed")}finally{$.value=!1}})};return Q(async()=>{await M(),await E(),await y()}),(e,a)=>{const s=i("a-input"),n=i("a-form-item"),d=i("a-select-option"),v=i("a-select"),Z=i("a-switch"),U=i("a-button"),q=i("a-space"),D=i("a-form");return p(),A("div",ae,[r(ee,{title:b.value?e.$t("member.detail.editTitle"):e.$t("member.detail.addTitle"),back:!0},null,8,["title"]),W("div",te,[r(D,{ref_key:"formRef",ref:S,model:t,rules:h,"label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[r(n,{label:e.$t("member.detail.memberAccount"),name:"memberAccount",rules:h.memberAccount},{default:o(()=>[r(s,{value:t.memberAccount,"onUpdate:value":a[0]||(a[0]=l=>t.memberAccount=l),placeholder:e.$t("member.detail.memberAccountPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(n,{label:e.$t("member.detail.password"),name:"password",rules:[{required:!b.value,message:e.$t("member.detail.passwordPlaceholder")}]},{default:o(()=>[r(s,{value:t.password,"onUpdate:value":a[1]||(a[1]=l=>t.password=l),placeholder:e.$t("member.detail.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(n,{label:e.$t("member.detail.memberNickname"),name:"memberNickname",rules:h.memberNickname},{default:o(()=>[r(s,{value:t.memberNickname,"onUpdate:value":a[2]||(a[2]=l=>t.memberNickname=l),placeholder:e.$t("member.detail.memberNicknamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(n,{label:e.$t("member.detail.inviter"),name:"inviterId"},{default:o(()=>[r(v,{value:t.inviterId,"onUpdate:value":a[3]||(a[3]=l=>t.inviterId=l),placeholder:e.$t("member.detail.inviterPlaceholder"),loading:I.value,"show-search":"","allow-clear":"","filter-option":!1,onSearch:E,onSelect:L},{default:o(()=>[(p(!0),A(O,null,B(z.value,l=>(p(),C(d,{key:l.id,value:l.id},{default:o(()=>[g(w(l.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),r(n,{label:e.$t("member.detail.group"),name:"groupIds"},{default:o(()=>[r(v,{value:t.groupIds,"onUpdate:value":a[4]||(a[4]=l=>t.groupIds=l),placeholder:e.$t("member.detail.groupPlaceholder"),loading:N.value,mode:"multiple","allow-clear":"","show-search":"","filter-option":!1,onSearch:y},{default:o(()=>[(p(!0),A(O,null,B(f.value,l=>(p(),C(d,{key:l.id,value:l.id},{default:o(()=>[g(w(l.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),r(n,{label:e.$t("member.detail.isNew")},{default:o(()=>[r(Z,{checked:t.isNew,"onUpdate:checked":a[5]||(a[5]=l=>t.isNew=l)},null,8,["checked"])]),_:1},8,["label"]),r(n,{"wrapper-col":{offset:4}},{default:o(()=>[r(q,null,{default:o(()=>[r(U,{type:"primary",loading:$.value,onClick:V},{default:o(()=>[g(w(e.$t("common.submit")),1)]),_:1},8,["loading"]),r(U,{onClick:a[6]||(a[6]=l=>e.$router.back())},{default:o(()=>[g(w(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},ne=F(le,[["__scopeId","data-v-afaf7592"]]);export{ne as default};
