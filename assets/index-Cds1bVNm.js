import{D as Z,E as ee,_ as te,a as ae,r,b as E,j as S,k as oe,G as le,H as ne,c as ie,d as s,e as o,w as l,f as n,l as se,m as c,o as x,h as B,t as g,p as re,s as ce,B as D,I,v as de,z as ue,A as pe}from"./index-Fv33tcUH.js";var me=Z();const fe=ee(me),_e={class:"article content-container"},ve={class:"table-container"},ge={class:"table-header"},he={class:"right"},ye=["onClick"],be=["onClick"],ke={class:"editor-wrapper"},we={__name:"index",setup(Ce){const{t:p}=ae(),h=r(!1),d=r(!1),m=r(!1),f=r("add"),C=r(),y=r(null),b=r(null);let i=null;const $={placeholderText:"请输入文章内容",height:300,toolbarButtons:["fontSize","textColor","backgroundColor","formatOL","html"],language:"zh_cn",imageUploadURL:D.imageUploadUrl,imageUploadParams:{type:"article"},imageUploadMethod:"POST",imageUploadHeaders:{Authorization:"Bearer "+localStorage.getItem("token")},imageMaxSize:5*1024*1024,imageAllowedTypes:["jpeg","jpg","png","gif"],events:{"image.uploaded":function(e){const t=JSON.parse(e);return t.code===0&&t.data&&t.data.url?t.data.url:!1},"image.error":function(e,t){c.error("图片上传失败: "+(e.message||"未知错误"))}}},a=E({title:"",location:"",content:""}),P={title:[{required:!0,message:"请输入文章标题"}],content:[{required:!0,message:"请输入文章内容"}]},A=S(()=>[{title:p("article.title"),dataIndex:"title",key:"title"},{title:p("article.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:p("article.action"),key:"action",width:200}]),T=r([]),_=E({current:1,pageSize:10,total:0}),O=S(()=>({add:p("article.addTitle"),edit:p("article.editTitle")})[f.value]),j=async e=>{try{const t=await de("article.delete",{id:e.id},{urlParams:{id:e.id}});t.code===0?(c.success("删除成功"),v()):c.error(t.message)}catch(t){console.error(t)}},L=()=>{f.value="add",a.title="",a.location="",a.content="",d.value=!0},N=e=>{window.open(`${D.h5Url}/article/${e.id}`,"_blank")},V=e=>{f.value="edit",a.title=e.title,a.location=e.location,a.content=e.content,d.value=!0,y.value=e.id,I(()=>{i&&i.html.set(a.content||"")})},M=async()=>{m.value=!0;try{const e=await pe("article.add",{...a});e.code===0?(c.success("添加成功"),d.value=!1,v()):c.error(e.message)}catch(e){console.error(e)}finally{m.value=!1}},q=async()=>{m.value=!0;try{const e=await ue("article.edit",{id:y.value,...a},{urlParams:{id:y.value}});e.code===0?(c.success("保存成功"),d.value=!1,v()):c.error(e.message)}catch(e){console.error(e)}finally{m.value=!1}},F=async()=>{switch(await C.value.validate(),f.value){case"add":await M();break;case"edit":await q();break}},v=async()=>{h.value=!0;try{const e=await se("article.list",{page:_.current,pageSize:_.pageSize});e.code===0?(T.value=e.data.list,_.total=e.data.total):c.error(e.message)}finally{h.value=!1}};oe(()=>{v(),le(d,e=>{e&&I(()=>{b.value&&!i&&R()})})});const R=()=>{i&&i.destroy(),i=new fe(b.value,{...$,events:{...$.events,contentChanged:function(){a.content=this.html.get()},initialized:function(){this.html.set(a.content||"")}}})};return ne(()=>{i&&(i.destroy(),i=null)}),(e,t)=>{const H=n("plus-outlined"),G=n("a-button"),J=n("a-typography-text"),K=n("a-popconfirm"),Q=n("a-space"),W=n("a-table"),U=n("a-input"),k=n("a-form-item"),X=n("a-form"),Y=n("a-modal");return x(),ie("div",_e,[s("div",ve,[s("div",ge,[t[3]||(t[3]=s("div",{class:"left"},null,-1)),s("div",he,[o(G,{type:"primary",onClick:L},{default:l(()=>[o(H),B(" "+g(e.$t("article.add")),1)]),_:1})])]),o(W,{columns:A.value,"data-source":T.value,loading:h.value,pagination:_},{bodyCell:l(({column:u,record:w})=>[u.key==="action"?(x(),re(Q,{key:0},{default:l(()=>[s("a",{onClick:z=>N(w)},g(e.$t("article.preview")),9,ye),s("a",{onClick:z=>V(w)},g(e.$t("article.edit")),9,be),o(K,{title:e.$t("article.deleteConfirm"),onConfirm:z=>j(w)},{default:l(()=>[s("a",null,[o(J,{type:"danger"},{default:l(()=>[B(g(e.$t("article.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):ce("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),o(Y,{open:d.value,"onUpdate:open":t[2]||(t[2]=u=>d.value=u),title:O.value,width:800,confirmLoading:m.value,onOk:F},{default:l(()=>[o(X,{ref_key:"formRef",ref:C,model:a,rules:P,"label-col":{span:4},"wrapper-col":{span:19}},{default:l(()=>[o(k,{label:e.$t("article.title"),name:"title"},{default:l(()=>[o(U,{value:a.title,"onUpdate:value":t[0]||(t[0]=u=>a.title=u),placeholder:e.$t("article.titlePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(k,{label:e.$t("article.location"),name:"location"},{default:l(()=>[o(U,{value:a.location,"onUpdate:value":t[1]||(t[1]=u=>a.location=u),placeholder:e.$t("article.locationPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(k,{label:e.$t("article.content"),name:"content"},{default:l(()=>[s("div",ke,[s("textarea",{ref_key:"editorEl",ref:b},null,512)])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},Te=te(we,[["__scopeId","data-v-b57ce803"]]);export{Te as default};
