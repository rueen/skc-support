import{_ as Ie,b as Le,a as Oe,r as v,c as O,j as Ae,B as Re,k as Se,x as Be,d as f,f as a,e as i,t as l,w as t,g as r,F as q,n as Y,l as w,h as Pe,o as d,p as k,s as _,i as m,q as M,M as Ue,v as De,m as g,A as Z}from"./index-tCeVsuJW.js";import{P as Ee}from"./PageHeader-CJHzDmi-.js";import{_ as z}from"./CopyContent-CoOPICwi.js";import{G as Ne}from"./GroupOwner-BWklPdub.js";const qe={class:"member-view content-container"},Me={class:"detail-container"},ze={class:"section"},Fe={class:"section-title"},Ge={key:0},Ve={key:0},je={style:{display:"flex","flex-wrap":"wrap","align-items":"center"}},He={class:"section"},We={class:"section-title"},Je={class:"account-list"},Ke={class:"link-text-container",style:{"max-width":"300px"}},Qe=["href"],Xe={class:"section",style:{"padding-bottom":"24px"}},Ye={class:"section-title"},Ze={class:"section",style:{"padding-bottom":"24px"}},xe={class:"section-title"},ea={class:"section"},aa={class:"section-title"},ta={key:1},na={__name:"view",setup(la){const{t:b}=Le(),A=Oe(),R=Be(),F=Pe(),c=v(""),s=O({}),G=v([]),x=Ae(()=>`${Re.h5Url}?inviteCode=${s.inviteCode}`),S=O({}),B=O({}),P=O({}),V=v(),h=v(!1),T=v("grant"),p=O({amount:"",remark:""}),I=v(!1),ee=v({amount:[{required:!0,message:b("member.view.amountRequired")}],remark:[{required:!0,message:b("member.view.remarkRequired")}]}),ae=()=>{const e={};R.query.filters&&(e.filters=R.query.filters),F.push({name:"MemberList",query:e})},te=async()=>{const e=await w("member.detail",{},{urlParams:{id:c.value}});e.code===0&&Object.assign(s,e.data||{})},U=async()=>{const e=await w("member.balance",{},{urlParams:{memberId:c.value}});e.code===0&&(s.balance=e.data.balance)},ne=async()=>{const e=await w("member.withdrawalsAccount",{},{urlParams:{memberId:c.value}});e.code===0&&(s.withdrawalsAccount=e.data[0]||{})},j=async()=>{const e=await w("account.list",{memberId:c.value});e.code===0&&(G.value=e.data.list||[])},le=e=>{F.push({name:"AccountEdit",params:{id:e.id}})},se=e=>{Ue.confirm({content:b("common.deleteConfirm"),onOk:async()=>{const o=await De("account.delete",{},{urlParams:{id:e.id}});o.code===0?(g.success(o.message),j()):g.error(o.message)}})},oe=async()=>{const e=await w("member.taskStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(S,e.data||{})},re=async()=>{const e=await w("member.inviteStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(B,e.data||{})},ie=async()=>{const e=await w("member.groupsStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(P,e.data||{})},ue=()=>{h.value=!0,T.value="grant"},me=()=>{h.value=!0,T.value="deduct"},D=v(!1),de=v([{title:b("member.view.balanceLogs.beforeBalance"),dataIndex:"beforeBalance",key:"beforeBalance",width:120},{title:b("member.view.balanceLogs.amount"),dataIndex:"amount",key:"amount",width:120},{title:b("member.view.balanceLogs.afterBalance"),dataIndex:"afterBalance",key:"afterBalance",width:120},{title:b("member.view.balanceLogs.transactionType"),key:"transactionType"},{title:b("member.view.balanceLogs.createTime"),dataIndex:"createTime",key:"createTime"}]),H=v([]),ce=async()=>{D.value=!0;const e=await w("member.balanceLogs",{pageSize:3e3,pageNum:1},{urlParams:{memberId:c.value}});e.code===0&&(H.value=e.data.list||[])},ve=async()=>{I.value=!0;try{const e=await Z("member.grantReward",{memberId:c.value,amount:p.amount,remark:p.remark});e.code===0?(g.success("奖励发放成功"),h.value=!1,U()):g.error(e.message)}catch{g.error("奖励发放失败")}finally{I.value=!1}},pe=async()=>{I.value=!0;try{const e=await Z("member.deductReward",{memberId:c.value,amount:p.amount,remark:p.remark},{urlParams:{memberId:c.value}});e.code===0?(g.success("奖励扣除成功"),h.value=!1,U()):g.error(e.message)}catch{g.error("奖励扣除失败")}finally{I.value=!1}},be=async()=>{try{switch(await V.value.validate(),T.value){case"grant":ve();break;case"deduct":pe();break}}catch(e){console.log(e)}};return Se(()=>{c.value=R.params.id,te(),U(),j(),oe(),re(),ie(),ne()}),(e,o)=>{const fe=r("UserOutlined"),W=r("a-avatar"),J=r("a-tag"),L=r("a-space"),u=r("a-descriptions-item"),E=r("a-button"),we=r("PlusOutlined"),_e=r("MinusOutlined"),K=r("a-descriptions"),ge=r("EditOutlined"),ye=r("DeleteOutlined"),$=r("a-statistic"),C=r("a-col"),N=r("a-row"),ke=r("a-input"),Q=r("a-form-item"),he=r("a-textarea"),$e=r("a-form"),X=r("a-modal"),Ce=r("a-typography-text"),Te=r("a-table");return d(),f("div",qe,[a(Ee,{title:e.$t("member.view.pageTitle"),back:!0,useDefaultBack:!1,onBack:ae},null,8,["title"]),i("div",Me,[i("div",ze,[i("div",Fe,l(e.$t("member.view.memberInfo")),1),a(K,{column:{xs:1,sm:1,md:1,lg:2}},{default:t(()=>[a(u,{label:e.$t("member.view.memberNickname")},{default:t(()=>[a(L,null,{default:t(()=>[a(W,{src:s.avatar,size:"small"},{icon:t(()=>[a(fe)]),_:1},8,["src"]),i("span",null,l(s.nickname),1),s.isNew?(d(),k(J,{key:0,color:"green"},{default:t(()=>o[7]||(o[7]=[m("new")])),_:1})):_("",!0)]),_:1})]),_:1},8,["label"]),a(u,{label:e.$t("member.view.memberAccount")},{default:t(()=>[m(l(s.account),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.gender")},{default:t(()=>[m(l(M(A).getEnumText("GenderType",s.gender)),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.occupation")},{default:t(()=>[m(l(M(A).getEnumText("OccupationType",s.occupation))+" ",1),s.occupation===null?(d(),f("span",Ge," - ")):_("",!0)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.email")},{default:t(()=>[m(l(s.email||"-"),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.phone")},{default:t(()=>[m(l(s.phone||"-"),1)]),_:1},8,["label"]),a(u,{label:"Telegram"},{default:t(()=>[m(l(s.telegram||"-"),1)]),_:1}),a(u,{label:e.$t("member.view.group")},{default:t(()=>[(d(!0),f(q,null,Y(s.groups,n=>(d(),k(L,{key:n.id},{default:t(()=>[m(l(n.groupName)+" ",1),n.isOwner?(d(),k(Ne,{key:0})):_("",!0)]),_:2},1024))),128)),!s.groups||!s.groups.length?(d(),f("span",Ve," - ")):_("",!0)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.inviter")},{default:t(()=>[m(l(s.inviterNickname||"-"),1)]),_:1},8,["label"]),a(u,{label:e.$t("member.view.inviteUrl")},{default:t(()=>[a(z,{content:x.value},null,8,["content"])]),_:1},8,["label"]),a(u,{label:e.$t("member.view.withdrawalsAccount")},{default:t(()=>[a(L,null,{default:t(()=>{var n,y;return[i("span",null,l(((n=s==null?void 0:s.withdrawalsAccount)==null?void 0:n.paymentChannelName)||"-"),1),i("span",null,l(((y=s==null?void 0:s.withdrawalsAccount)==null?void 0:y.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),a(u,{label:e.$t("member.view.balance")},{default:t(()=>[i("div",je,[i("span",null,l(s.balance),1),a(E,{type:"link",size:"small",onClick:o[0]||(o[0]=n=>ce())},{default:t(()=>[m(l(e.$t("member.view.balanceLogs.view")),1)]),_:1}),a(E,{type:"primary",size:"small",onClick:o[1]||(o[1]=n=>ue()),style:{"margin-left":"16px"}},{default:t(()=>[a(we),m(" "+l(e.$t("member.view.rewardGrant")),1)]),_:1}),a(E,{size:"small",danger:"",onClick:o[2]||(o[2]=n=>me()),style:{"margin-left":"16px"}},{default:t(()=>[a(_e),m(" "+l(e.$t("member.view.rewardDeduct")),1)]),_:1})])]),_:1},8,["label"])]),_:1})]),i("div",He,[i("div",We,l(e.$t("member.view.accountInfo")),1),i("div",Je,[(d(!0),f(q,null,Y(G.value,n=>(d(),f("div",{key:n.channelId},[a(K,{column:1},{default:t(()=>[a(u,{label:e.$t("member.view.account")},{default:t(()=>[a(L,{size:24},{default:t(()=>[a(L,null,{default:t(()=>[a(W,{src:n.channelIcon,size:"small"},null,8,["src"]),i("span",null,l(n.account),1),a(J,{color:"warning"},{default:t(()=>[m(l(M(A).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024),a(ge,{onClick:y=>le(n)},null,8,["onClick"]),a(ye,{onClick:y=>se(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),a(u,{label:e.$t("member.view.homepage")},{default:t(()=>[a(z,{content:n.homeUrl},{default:t(()=>[i("div",Ke,[i("a",{href:n.homeUrl,target:"_blank",class:"link-text"},l(n.homeUrl),9,Qe)])]),_:2},1032,["content"])]),_:2},1032,["label"]),a(u,{label:"uid"},{default:t(()=>[a(z,{content:n.uid},null,8,["content"])]),_:2},1024),n.channelCustomFields.includes("fansCount")?(d(),k(u,{key:0,label:e.$t("member.view.fansCount")},{default:t(()=>[m(l(n.fansCount),1)]),_:2},1032,["label"])):_("",!0),n.channelCustomFields.includes("friendsCount")?(d(),k(u,{key:1,label:e.$t("member.view.friendsCount")},{default:t(()=>[m(l(n.friendsCount),1)]),_:2},1032,["label"])):_("",!0),n.channelCustomFields.includes("postsCount")?(d(),k(u,{key:2,label:e.$t("member.view.postsCount")},{default:t(()=>[m(l(n.postsCount),1)]),_:2},1032,["label"])):_("",!0)]),_:2},1024)]))),128))])]),i("div",Xe,[i("div",Ye,l(e.$t("member.view.taskStats")),1),a(N,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.completedTaskCount"),value:S.completedTaskCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.taskReward"),value:S.totalTaskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),i("div",Ze,[i("div",xe,l(e.$t("member.view.inviteStats")),1),a(N,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.inviteCount"),value:B.inviteCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.inviteReward"),value:B.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),i("div",ea,[i("div",aa,l(e.$t("member.view.groupStats")),1),a(N,null,{default:t(()=>[a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.groupCount"),value:P.groupCount},null,8,["title","value"])]),_:1}),a(C,{span:6,xs:{span:12},sm:{span:8}},{default:t(()=>[a($,{title:e.$t("member.view.groupEarnings"),value:P.totalCommission},null,8,["title","value"])]),_:1})]),_:1})])]),a(X,{open:h.value,"onUpdate:open":o[5]||(o[5]=n=>h.value=n),title:T.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:be,confirmLoading:I.value},{default:t(()=>[a($e,{ref_key:"rewardFormRef",ref:V,model:p,rules:ee.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:t(()=>[a(Q,{label:T.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:t(()=>[a(ke,{value:p.amount,"onUpdate:value":o[3]||(o[3]=n=>p.amount=n)},null,8,["value"])]),_:1},8,["label"]),a(Q,{label:e.$t("member.view.remark"),name:"remark"},{default:t(()=>[a(he,{value:p.remark,"onUpdate:value":o[4]||(o[4]=n=>p.remark=n),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"]),a(X,{open:D.value,"onUpdate:open":o[6]||(o[6]=n=>D.value=n),title:e.$t("member.view.balanceLogs.title"),width:800},{default:t(()=>[a(Te,{size:"small",columns:de.value,"data-source":H.value,pagination:!1,scroll:{y:400}},{bodyCell:t(({column:n,record:y})=>[n.key==="transactionType"?(d(),f(q,{key:0},[y.transactionType==="withdrawal_refund"?(d(),k(Ce,{key:0,type:"danger"},{default:t(()=>o[8]||(o[8]=[m("余额退还")])),_:1})):(d(),f("span",ta,l(y.transactionType),1))],64)):_("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open","title"])])}}},ua=Ie(na,[["__scopeId","data-v-b718e365"]]);export{ua as default};
