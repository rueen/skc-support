import{b as oe,r as k,j as se,x as ie,c as de,k as re,d as c,f as l,e as q,w as n,g as s,l as D,y as h,m as i,h as ue,o as d,F as ce,n as me,p as b,i as _,t as r,B as pe,s as I,z as fe,A as ke}from"./index-Cfr3vlO8.js";import{P as _e}from"./PageHeader-BvdwLlI9.js";import{S as ve}from"./SelectTask-Bwem1zrx.js";const Te={class:"content-container"},ye={class:"form-container"},ge={key:0},he={key:0},be={key:1},Ie={key:0},$e={key:1},we={key:0},Ye={key:1},Ue={__name:"detail",setup(Ce){const{t:u}=oe(),$=ie(),w=ue(),N=k(),m=k([]),B={action:pe.imageUploadUrl,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},Y=se(()=>$.name==="AdEdit"),t=de({title:"",location:"home_banner",startTime:void 0,endTime:void 0,content:{adImage:"",linkType:"none",articleId:null,articleName:null,taskId:null,taskName:null,taskGroupId:null,taskGroupName:null}}),M={title:[{required:!0,message:u("ad.detail.validation.titleRequired")}],location:[{required:!0,message:u("ad.detail.validation.locationRequired")}],startTime:[{required:!0,message:u("ad.detail.validation.startTimeRequired")}],endTime:[{required:!0,message:u("ad.detail.validation.endTimeRequired")}]},G=e=>{e.file.status==="removed"&&(t.content.adImage="")},H=e=>{e.code===0?(t.content.adImage=e.data.url,m.value=[{uid:"-1",name:"image.png",status:"done",url:t.content.adImage}],i.success("上传成功")):(i.error(response.message||"上传失败"),m.value=m.value.filter(a=>a.uid!==file.uid))},R=()=>{i.error("上传失败"),m.value=[]},A=e=>e.type.startsWith("image/")?e.size/1024/1024<1?!0:(i.error("图片必须小于 1MB！"),!1):(i.error("只能上传图片文件！"),!1),T=k(!1),L=()=>{T.value=!0},V=({taskId:e,task:a})=>{e&&a&&(t.content.taskId=e,t.content.taskName=a.taskName,T.value=!1)},E=k(!1),P=()=>{E.value=!0},z=k(!1),F=()=>{z.value=!0},j=async e=>{try{y.value=!0;const a=await ke("ad.add",e);a.code===0?(i.success(u("common.submitSuccess")),w.back()):i.error(a.message)}catch(a){console.log(a),i.error(u("common.submitFailed"))}finally{y.value=!1}},O=async e=>{try{y.value=!0;const a=await fe("ad.edit",{...e},{urlParams:{id:$.params.id}});a.code===0?(i.success(u("common.submitSuccess")),w.back()):i.error(a.message)}catch(a){console.log(a),i.error(u("common.submitFailed"))}finally{y.value=!1}},y=k(!1),W=()=>{N.value.validate().then(async()=>{if(!t.content.adImage){i.error(u("ad.detail.validation.adImageRequired"));return}const e={...t,startTime:t.startTime?h(t.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:t.endTime?h(t.endTime).format("YYYY-MM-DD HH:mm:ss"):null};Y.value?await O(e):await j(e)})},J=()=>{w.back()},K=async e=>{try{const a=await D("ad.detail",{},{urlParams:{id:e}});if(a.code===0){const f=a.data;Object.assign(t,f,{startTime:h(f.startTime),endTime:h(f.endTime)}),m.value=[{uid:"-1",name:"image.png",status:"done",url:f.content.adImage}]}}catch(a){console.log(a),i.error(a)}},S=k([]),Q=async()=>{try{const e=await D("public.location",{});e.code===0&&(S.value=e.data||[])}catch(e){console.log(e)}};return re(()=>{Q(),Y.value&&K($.params.id)}),(e,a)=>{const f=s("a-input"),p=s("a-form-item"),X=s("a-select-option"),Z=s("a-select"),U=s("a-date-picker"),C=s("a-col"),x=s("a-row"),ee=s("plus-outlined"),ae=s("a-upload"),g=s("a-radio"),te=s("a-radio-group"),v=s("a-button"),le=s("a-space"),ne=s("a-form");return d(),c("div",Te,[l(_e,{title:Y.value?e.$t("ad.detail.editTitle"):e.$t("ad.detail.createTitle"),back:!0,class:"page-header"},null,8,["title"]),q("div",ye,[l(ne,{ref_key:"formRef",ref:N,model:t,rules:M,"label-col":{span:5},"wrapper-col":{span:18},layout:"horizontal"},{default:n(()=>[l(p,{label:e.$t("ad.detail.title"),name:"title"},{default:n(()=>[l(f,{value:t.title,"onUpdate:value":a[0]||(a[0]=o=>t.title=o),placeholder:e.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),l(p,{label:e.$t("ad.detail.location"),name:"location"},{default:n(()=>[l(Z,{value:t.location,"onUpdate:value":a[1]||(a[1]=o=>t.location=o),placeholder:e.$t("common.selectPlaceholder")},{default:n(()=>[(d(!0),c(ce,null,me(S.value,o=>(d(),b(X,{key:o.code,value:o.code},{default:n(()=>[_(r(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(p,{label:e.$t("ad.detail.adTime"),required:""},{default:n(()=>[l(x,{gutter:8},{default:n(()=>[l(C,{span:11},{default:n(()=>[l(p,{name:"startTime"},{default:n(()=>[l(U,{value:t.startTime,"onUpdate:value":a[2]||(a[2]=o=>t.startTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("ad.detail.startTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1})]),_:1}),l(C,{span:2,style:{"text-align":"center","line-height":"32px"}},{default:n(()=>a[7]||(a[7]=[q("span",null,"至",-1)])),_:1}),l(C,{span:11},{default:n(()=>[l(p,{name:"endTime"},{default:n(()=>[l(U,{value:t.endTime,"onUpdate:value":a[3]||(a[3]=o=>t.endTime=o),"show-time":"",style:{width:"100%"},placeholder:e.$t("ad.detail.endTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),l(p,{label:e.$t("ad.detail.adImage"),required:""},{default:n(()=>[l(ae,{"file-list":m.value,"onUpdate:fileList":a[4]||(a[4]=o=>m.value=o),action:B.action,headers:B.headers,"before-upload":A,onSuccess:H,onError:R,onChange:G,accept:"image/*","list-type":"picture-card","max-count":1},{default:n(()=>[m.value.length?I("",!0):(d(),c("div",ge,[l(ee)]))]),_:1},8,["file-list","action","headers"])]),_:1},8,["label"]),l(p,{label:e.$t("ad.detail.link"),required:""},{default:n(()=>[l(te,{value:t.content.linkType,"onUpdate:value":a[5]||(a[5]=o=>t.content.linkType=o),name:"linkType"},{default:n(()=>[l(g,{value:"none"},{default:n(()=>[_(r(e.$t("ad.detail.linkType.none")),1)]),_:1}),l(g,{value:"article"},{default:n(()=>[_(r(e.$t("ad.detail.linkType.article")),1)]),_:1}),l(g,{value:"task"},{default:n(()=>[_(r(e.$t("ad.detail.linkType.task")),1)]),_:1}),l(g,{value:"taskGroup"},{default:n(()=>[_(r(e.$t("ad.detail.linkType.taskGroup")),1)]),_:1})]),_:1},8,["value"]),t.content.linkType==="article"?(d(),b(v,{key:0,type:"primary",onClick:P},{default:n(()=>[t.content.articleId!=null?(d(),c("span",he,r(e.$t("ad.detail.selectArticleBtnText",{name:t.content.articleName})),1)):(d(),c("span",be,r(e.$t("ad.detail.selectArticleBtnText1")),1))]),_:1})):I("",!0),t.content.linkType==="task"?(d(),b(v,{key:1,type:"primary",onClick:L},{default:n(()=>[t.content.taskId!=null?(d(),c("span",Ie,r(e.$t("ad.detail.selectTaskBtnText",{name:t.content.taskName})),1)):(d(),c("span",$e,r(e.$t("ad.detail.selectTaskBtnText1")),1))]),_:1})):I("",!0),t.content.linkType==="taskGroup"?(d(),b(v,{key:2,type:"primary",onClick:F},{default:n(()=>[t.content.taskGroupId!=null?(d(),c("span",we,r(e.$t("ad.detail.selectTaskGroupBtnText",{name:t.content.taskGroupName})),1)):(d(),c("span",Ye,r(e.$t("ad.detail.selectTaskGroupBtnText1")),1))]),_:1})):I("",!0)]),_:1},8,["label"]),l(p,{"wrapper-col":{span:16,offset:4}},{default:n(()=>[l(le,null,{default:n(()=>[l(v,{type:"primary",onClick:W},{default:n(()=>[_(r(e.$t("common.submit")),1)]),_:1}),l(v,{onClick:J},{default:n(()=>[_(r(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),l(ve,{visible:T.value,"onUpdate:visible":a[6]||(a[6]=o=>T.value=o),selectedId:t.content.taskId,selectedTaskInfo:{taskName:t.content.taskName,taskId:t.content.taskId},mode:"single",onConfirm:V},null,8,["visible","selectedId","selectedTaskInfo"])])}}};export{Ue as default};
