import{_ as Y,j as Z,r as b,a as R,k as tt,b as v,d as _,c as n,w as e,e as l,i as c,f as at,o as r,F as V,l as j,m as p,h as d,t as C,g as m,D as et,P as nt,n as y,M as st}from"./index-TqCv0KUg.js";import{T as x,g as ot,a as lt,b as rt}from"./enums-Vx4wKXVy.js";import{g as h}from"./request-BqyiWvI-.js";const ct={class:"task content-container"},dt={class:"table-container"},it={class:"table-header"},ut={class:"left"},_t={class:"right"},pt=["onClick"],mt={__name:"list",setup(kt){const N=at(),{locale:z}=Z(),S=b(!1),o=R({taskName:"",channelId:void 0,taskStatus:void 0}),w=b([]),A=[{title:"任务名称",dataIndex:"taskName",key:"taskName"},{title:"平台渠道",dataIndex:"channelName",key:"channelName"},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus"},{title:"创建时间",dataIndex:"createTime",key:"createTime"},{title:"操作",key:"action",fixed:"right",width:180}],I=b([]),i=R({current:1,pageSize:10,total:0}),O=a=>ot(lt,a,z.value),F=a=>rt[a],D=()=>{i.current=1,k()},L=()=>{o.taskName="",o.channelId=void 0,o.taskStatus=void 0,D()},M=a=>{Object.assign(i,a),k()},U=()=>{N.push("/task/create")},$=a=>{N.push(`/task/edit/${a.id}`)},P=async a=>{try{const t=await h("task.delete",{id:a.id});t.code===0?(c.success("删除成功"),k()):c.error(t.message)}catch{c.error("删除失败")}},q=()=>{st.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const a={taskName:o.taskName,channelId:o.channelId},t=await h("task.export",a);t.code===0?c.success("导出成功"):c.error(t.message)}catch{c.error("导出失败")}}})},k=async()=>{S.value=!0;try{const a=await h("task.list",{page:i.current,pageSize:i.pageSize,...o});a.code===0?(I.value=a.data.list,i.total=a.data.total):c.error(a.message)}finally{S.value=!1}},G=async()=>{const a=await h("channel.list");a.code===0&&(w.value=a.data.list)};return tt(()=>{k(),G()}),(a,t)=>{const H=l("a-input"),f=l("a-form-item"),E=l("a-select-option"),B=l("a-select"),g=l("a-button"),T=l("a-space"),J=l("a-form"),K=l("a-tag"),Q=l("a-popconfirm"),W=l("a-table");return r(),v("div",ct,[_("div",dt,[_("div",it,[_("div",ut,[n(J,{layout:"inline",model:o},{default:e(()=>[n(f,{label:"任务名称"},{default:e(()=>[n(H,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=s=>o.taskName=s),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),n(f,{label:"平台渠道"},{default:e(()=>[n(B,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=s=>o.channelId=s),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:e(()=>[(r(!0),v(V,null,j(w.value,s=>(r(),p(E,{key:s.id,value:s.id},{default:e(()=>[d(C(s.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(f,{label:"任务状态"},{default:e(()=>[n(B,{value:o.taskStatus,"onUpdate:value":t[2]||(t[2]=s=>o.taskStatus=s),placeholder:"请选择状态",style:{width:"120px"},"allow-clear":""},{default:e(()=>[(r(!0),v(V,null,j(Object.values(m(x)),s=>(r(),p(E,{key:s,value:s},{default:e(()=>[d(C(O(s)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(f,null,{default:e(()=>[n(T,null,{default:e(()=>[n(g,{type:"primary",onClick:D},{default:e(()=>t[3]||(t[3]=[d("查询")])),_:1}),n(g,{onClick:L},{default:e(()=>t[4]||(t[4]=[d("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",_t,[n(T,null,{default:e(()=>[n(g,{onClick:q},{icon:e(()=>[n(m(et))]),default:e(()=>[t[5]||(t[5]=d(" 导出 "))]),_:1}),n(g,{type:"primary",onClick:U},{icon:e(()=>[n(m(nt))]),default:e(()=>[t[6]||(t[6]=d(" 新建任务 "))]),_:1})]),_:1})])]),n(W,{columns:A,"data-source":I.value,loading:S.value,pagination:i,onChange:M},{bodyCell:e(({column:s,record:u})=>[s.key==="taskStatus"?(r(),p(K,{key:0,color:F(u.taskStatus)},{default:e(()=>[d(C(O(u.taskStatus)),1)]),_:2},1032,["color"])):y("",!0),s.key==="action"?(r(),p(T,{key:1},{default:e(()=>[u.taskStatus===m(x).NOT_STARTED?(r(),v("a",{key:0,onClick:X=>$(u)},"编辑",8,pt)):y("",!0),u.taskStatus===m(x).NOT_STARTED?(r(),p(Q,{key:1,title:"确定要删除该任务吗？",onConfirm:X=>P(u)},{default:e(()=>t[7]||(t[7]=[_("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])):y("",!0)]),_:2},1024)):y("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},yt=Y(mt,[["__scopeId","data-v-af7b489f"]]);export{yt as default};
