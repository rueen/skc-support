import{_ as q,r as d,b as D,j as F,x as G,c as H,k as J,d as $,f as l,e as K,w as o,g as i,l as P,m as u,h as Q,o as c,F as U,n as B,p as C,i as f,t as v,z as W,A as X}from"./index-DLDbQKfj.js";import{P as Y}from"./PageHeader-TkYGUAl2.js";const x={class:"member-form content-container"},ee={class:"form-container"},ae={__name:"detail",setup(te){const g=G(),_=Q(),A=d(),{t:N}=D(),p=F(()=>!!g.params.id),r=H({memberNickname:"",memberAccount:"",password:"",groupIds:[],inviterId:void 0}),k={memberAccount:[{required:!0,message:N("member.detail.memberAccountPlaceholder")},{validator:(e,a)=>{const n=/^1[3-9]\d{9}$/,s=/^(\+?63[0-9]{10}|9[0-9]{9})$/,m=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!a||n.test(a)||s.test(a)||m.test(a)?Promise.resolve():Promise.reject(N("member.detail.memberAccountRule"))}}]},h=d(!1),b=d([]),w=d(!1),R=d([]),I=async(e="")=>{h.value=!0;try{const a=await P("group.list",{page:1,pageSize:50,groupName:e,memberId:r.inviterId});a.code===0&&(b.value=a.data.list||[],r.groupIds.some(s=>b.value.some(m=>m.id===s))||(r.groupIds=[]))}finally{h.value=!1}},E=e=>{b.value=[],I()},S=async(e="")=>{w.value=!0;try{const a=await P("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(R.value=a.data.list||[])}finally{w.value=!1}},L=async()=>{if(p.value)try{const e=await P("member.detail",{},{urlParams:{id:g.params.id}});if(e.code===0){const a=e.data;Object.assign(r,{memberNickname:a.nickname,memberAccount:a.account,groupIds:a.groups.map(n=>n.groupId),inviterId:a.inviterId})}}catch{u.error("load member info failed"),_.back()}},M=async()=>{const e=await X("member.add",r);e.code===0?(u.success("submit success"),_.back()):u.error(e.message)},j=async()=>{const e=await W("member.edit",r,{urlParams:{id:g.params.id}});e.code===0?(u.success("submit success"),_.back()):u.error(e.message)},y=d(!1),T=()=>{A.value.validate().then(async()=>{try{y.value=!0,p.value?j():M()}catch{u.error("submit failed")}finally{y.value=!1}})};return J(async()=>{await L(),await S(),await I()}),(e,a)=>{const n=i("a-input"),s=i("a-form-item"),m=i("a-select-option"),z=i("a-select"),O=i("a-button"),V=i("a-space"),Z=i("a-form");return c(),$("div",x,[l(Y,{title:p.value?e.$t("member.detail.editTitle"):e.$t("member.detail.addTitle"),back:!0},null,8,["title"]),K("div",ee,[l(Z,{ref_key:"formRef",ref:A,model:r,rules:k,"label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[l(s,{label:e.$t("member.detail.memberAccount"),name:"memberAccount",rules:k.memberAccount},{default:o(()=>[l(n,{value:r.memberAccount,"onUpdate:value":a[0]||(a[0]=t=>r.memberAccount=t),placeholder:e.$t("member.detail.memberAccountPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),l(s,{label:e.$t("member.detail.password"),name:"password",rules:[{required:!p.value,message:e.$t("member.detail.passwordPlaceholder")}]},{default:o(()=>[l(n,{value:r.password,"onUpdate:value":a[1]||(a[1]=t=>r.password=t),placeholder:e.$t("member.detail.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),l(s,{label:e.$t("member.detail.memberNickname"),name:"memberNickname",rules:k.memberNickname},{default:o(()=>[l(n,{value:r.memberNickname,"onUpdate:value":a[2]||(a[2]=t=>r.memberNickname=t),placeholder:e.$t("member.detail.memberNicknamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),l(s,{label:e.$t("member.detail.inviter"),name:"inviterId"},{default:o(()=>[l(z,{value:r.inviterId,"onUpdate:value":a[3]||(a[3]=t=>r.inviterId=t),placeholder:e.$t("member.detail.inviterPlaceholder"),loading:w.value,"show-search":"","allow-clear":"","filter-option":!1,onSearch:S,onSelect:E},{default:o(()=>[(c(!0),$(U,null,B(R.value,t=>(c(),C(m,{key:t.id,value:t.id},{default:o(()=>[f(v(t.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),l(s,{label:e.$t("member.detail.group"),name:"groupIds"},{default:o(()=>[l(z,{value:r.groupIds,"onUpdate:value":a[4]||(a[4]=t=>r.groupIds=t),placeholder:e.$t("member.detail.groupPlaceholder"),loading:h.value,mode:"multiple","allow-clear":"","show-search":"","filter-option":!1,onSearch:I},{default:o(()=>[(c(!0),$(U,null,B(b.value,t=>(c(),C(m,{key:t.id,value:t.id},{default:o(()=>[f(v(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),l(s,{"wrapper-col":{offset:4}},{default:o(()=>[l(V,null,{default:o(()=>[l(O,{type:"primary",loading:y.value,onClick:T},{default:o(()=>[f(v(e.$t("common.submit")),1)]),_:1},8,["loading"]),l(O,{onClick:a[5]||(a[5]=t=>e.$router.back())},{default:o(()=>[f(v(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},oe=q(ae,[["__scopeId","data-v-04bdb564"]]);export{oe as default};
