import{_ as ve,i as ke,j as ge,r as f,b as W,k as ye,c as g,d as c,e as o,w as a,f as u,l as $,m,g as be,o as i,F as h,n as U,p as k,h as d,t as s,s as _,q as he,M as we,A as G}from"./index-D6TRxwQf.js";import{d as Se}from"./download-B3jXR2BR.js";const Ce={class:"task-audit content-container"},Ae={class:"table-container"},Ne={class:"table-header"},xe={style:{width:"100%",display:"flex","justify-content":"space-between"}},Te={key:4},Re={class:"group-name"},Ie=["onClick"],Oe={__name:"confirm-audit-list",setup(je){const T=ke(),K=ge(()=>T.loaded?T.getEnumOptions("TaskAuditStatus"):[]),q=be(),R=f(!1),M=f(!1),w=f(!1),Y=f(!1),y=f(""),S=f(null),v=f([]),l=W({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),B=f([]),E=f([]),P=[{title:"任务名称",key:"taskName"},{title:"任务奖励",dataIndex:"reward",key:"reward"},{title:"会员信息",key:"member"},{title:"审核状态",dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:"初审员",key:"preWaiterName"},{title:"复审员",key:"waiterName"},{title:"操作",key:"action",fixed:"right",width:180}],I=f([]),b=W({current:1,pageSize:10,total:0}),J={selectedRowKeys:v,onChange:t=>{v.value=t},getCheckboxProps:t=>({disabled:t.taskAuditStatus!=="pending"})},L=()=>{b.current=1,C()},Q=()=>{Object.assign(l,{taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),L()},X=t=>{Object.assign(b,t),C()},Z=t=>{q.push(`/submitted-tasks/detail/${t.id}?type=confirm`)},ee=async t=>{v.value=[t.id],V()},V=async()=>{if(!v.value.length){m.warning("请选择要通过的任务");return}const t=await G("taskSubmitted.batchConfirmAuditApprove",{ids:v.value});t.code===0?(m.success("批量审核通过成功"),v.value=[],C()):m.error(t.message)},te=t=>{v.value=[t.id],y.value="",w.value=!0},ae=async()=>{if(!y.value){m.error("请输入拒绝原因");return}Y.value=!0;const t=await G("taskSubmitted.batchConfirmAuditReject",{ids:v.value,reason:y.value});t.code===0?(m.success("审核拒绝成功"),w.value=!1,C()):m.error(t.message)},ne=()=>{if(!v.value.length){m.warning("请选择要拒绝的任务");return}y.value="",w.value=!0},oe=async()=>{const t=await $("channel.list");t.code===0&&(B.value=t.data.list)},le=()=>{we.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const t=m.loading("正在导出数据，请稍候...",0),n={...l};await Se("taskSubmitted.confirmAuditExport",n,`复审列表_${new Date().toLocaleDateString()}.xlsx`),t(),m.success("导出成功")}catch(t){console.error("导出失败:",t),m.error("导出失败，请稍后重试")}}})},se=async(t="")=>{try{const n=await $("group.list",{params:{page:1,pageSize:50,keyword:t}});n.code===0&&(E.value=n.data.list||[])}catch{m.error("获取群组列表失败")}},C=async()=>{var t,n;R.value=!0;try{const O={page:b.current,pageSize:b.pageSize,taskName:l.taskName,channelId:l.channelId,taskAuditStatus:l.taskAuditStatus,groupId:l.groupId,submitStartTime:(t=l.submitTimeRange)==null?void 0:t[0],submitEndTime:(n=l.submitTimeRange)==null?void 0:n[1],completedTaskCount:l.completedTaskCount},p=await $("taskSubmitted.confirmAuditList",{...O});p.code===0?(I.value=p.data.list,b.total=p.data.total):m.error(p.message)}finally{R.value=!1}};return ye(()=>{C(),se(),oe()}),(t,n)=>{const O=u("a-input"),p=u("a-form-item"),j=u("a-select-option"),D=u("a-select"),ue=u("a-range-picker"),ie=u("a-input-number"),de=u("a-form"),A=u("a-button"),x=u("a-space"),re=u("DownloadOutlined"),ce=u("a-avatar"),me=u("a-tag"),H=u("a-popconfirm"),pe=u("a-table"),N=u("a-descriptions-item"),fe=u("a-descriptions"),z=u("a-modal"),_e=u("a-textarea");return i(),g("div",Ce,[c("div",Ae,[c("div",Ne,[o(de,{layout:"inline",model:l},{default:a(()=>[o(p,{label:"任务名称"},{default:a(()=>[o(O,{value:l.taskName,"onUpdate:value":n[0]||(n[0]=e=>l.taskName=e),placeholder:"请输入任务名称","allow-clear":"",style:{width:"140px"}},null,8,["value"])]),_:1}),o(p,{label:"平台渠道"},{default:a(()=>[o(D,{value:l.channelId,"onUpdate:value":n[1]||(n[1]=e=>l.channelId=e),placeholder:"请选择平台渠道","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),g(h,null,U(B.value,e=>(i(),k(j,{key:e.id,value:e.id},{default:a(()=>[d(s(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(p,{label:"复审状态"},{default:a(()=>[o(D,{value:l.taskAuditStatus,"onUpdate:value":n[2]||(n[2]=e=>l.taskAuditStatus=e),placeholder:"请选择复审状态","allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),g(h,null,U(K.value,e=>(i(),k(j,{key:e.value,value:e.value},{default:a(()=>[d(s(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(p,{label:"所属群组"},{default:a(()=>[o(D,{value:l.groupId,"onUpdate:value":n[3]||(n[3]=e=>l.groupId=e),placeholder:"请选择群组","allow-clear":""},{default:a(()=>[(i(!0),g(h,null,U(E.value,e=>(i(),k(j,{key:e.id,value:e.id},{default:a(()=>[d(s(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(p,{label:"提交时间"},{default:a(()=>[o(ue,{value:l.submitTimeRange,"onUpdate:value":n[4]||(n[4]=e=>l.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1}),o(p,{label:"已完成任务"},{default:a(()=>[o(ie,{value:l.completedTaskCount,"onUpdate:value":n[5]||(n[5]=e=>l.completedTaskCount=e),min:0,max:9999,"addon-after":"次",style:{width:"100px!important"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),c("div",xe,[c("div",null,[o(x,null,{default:a(()=>[o(A,{type:"primary",onClick:L},{default:a(()=>[d(s(t.$t("common.search")),1)]),_:1}),o(A,{onClick:Q},{default:a(()=>[d(s(t.$t("common.reset")),1)]),_:1})]),_:1})]),c("div",null,[o(x,null,{default:a(()=>[I.value.length?(i(),k(A,{key:0,onClick:le},{icon:a(()=>[o(re)]),default:a(()=>[d(" "+s(t.$t("common.export")),1)]),_:1})):_("",!0),o(A,{type:"primary",onClick:V},{default:a(()=>[d(s(t.$t("common.batchResolve")),1)]),_:1}),o(A,{danger:"",onClick:ne},{default:a(()=>[d(s(t.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),o(pe,{columns:P,"data-source":I.value,loading:R.value,pagination:b,"row-selection":J,rowKey:"id",onChange:X},{bodyCell:a(({column:e,record:r})=>[e.key==="taskName"?(i(),k(x,{key:0},{default:a(()=>[o(ce,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(r.taskName),1)]),_:2},1024)):_("",!0),e.key==="taskAuditStatus"?(i(),g(h,{key:1},[d(s(he(T).getEnumText("TaskAuditStatus",r.taskAuditStatus)),1)],64)):_("",!0),e.key==="preWaiterName"?(i(),g(h,{key:2},[d(s(r.preWaiterName||"--"),1)],64)):_("",!0),e.key==="waiterName"?(i(),g(h,{key:3},[d(s(r.waiterName||"--"),1)],64)):_("",!0),e.key==="member"?(i(),g("div",Te,[c("div",null,s(r.memberNickname),1),c("div",Re,[c("span",null,s(r.groupName),1),r.isGroupOwner?(i(),k(me,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:a(()=>n[9]||(n[9]=[d("群主")])),_:1})):_("",!0)])])):_("",!0),e.key==="action"?(i(),k(x,{key:5},{default:a(()=>[c("a",{onClick:F=>Z(r)},"查看",8,Ie),r.taskAuditStatus==="pending"?(i(),k(H,{key:0,title:"确定要通过该任务吗？",onConfirm:F=>ee(r)},{default:a(()=>n[10]||(n[10]=[c("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):_("",!0),r.taskAuditStatus==="pending"?(i(),k(H,{key:1,title:"确定要拒绝该任务吗？",onConfirm:F=>te(r)},{default:a(()=>n[11]||(n[11]=[c("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):_("",!0)]),_:2},1024)):_("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(z,{open:M.value,"onUpdate:open":n[6]||(n[6]=e=>M.value=e),title:"任务详情",footer:null},{default:a(()=>[o(fe,{column:1},{default:a(()=>[o(N,{label:"任务名称"},{default:a(()=>{var e;return[d(s((e=S.value)==null?void 0:e.taskName),1)]}),_:1}),o(N,{label:"任务类型"},{default:a(()=>{var e;return[d(s((e=S.value)==null?void 0:e.taskType),1)]}),_:1}),o(N,{label:"任务描述"},{default:a(()=>{var e;return[d(s((e=S.value)==null?void 0:e.description),1)]}),_:1}),o(N,{label:"任务奖励"},{default:a(()=>{var e;return[d(s((e=S.value)==null?void 0:e.reward),1)]}),_:1}),o(N,{label:"创建时间"},{default:a(()=>{var e;return[d(s((e=S.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),o(z,{open:w.value,"onUpdate:open":n[8]||(n[8]=e=>w.value=e),title:"拒绝原因",onOk:ae,confirmLoading:Y.value},{default:a(()=>[o(_e,{value:y.value,"onUpdate:value":n[7]||(n[7]=e=>y.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Ue=ve(Oe,[["__scopeId","data-v-6445b5e6"]]);export{Ue as default};
