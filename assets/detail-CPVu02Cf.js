import{_ as le,i as ne,v as oe,j as re,a as E,r as I,k as ue,b as _,c as t,d as c,w as e,e as p,F as T,n as j,p as m,q as f,l as P,m as k,f as de,o as u,t as s,h as l,g as R,z as B}from"./index-C3A18lFD.js";import{P as ie}from"./PageHeader-vT6TYOWN.js";import{_ as ce}from"./CopyContent-CkmhvoaK.js";const me={class:"task-audit-detail content-container"},_e={class:"detail-container"},pe={key:0},fe={key:1},ke={class:"detail-section"},be={key:0},ve={class:"link-text-container"},ge=["href"],ye={class:"detail-section"},he={class:"detail-section"},Ie={class:"footer-btns"},Te={class:"left"},Ce={class:"right"},xe={__name:"detail",setup(Se){const C=ne(),F=oe(),L=de(),N=F.query.type,q=re(()=>r.taskPreAuditStatus==="approved"?"confirm":"pre"),x=I(!1),O=I(!1),g=I(""),b=I(null),r=E({submitContent:{}}),i=E({}),v=E({}),D=async()=>{const d=q.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",a=await B(d,{ids:[b.value]});a.code===0?(k.success("审核通过成功"),y()):k.error(a.message)},z=()=>{g.value="",x.value=!0},M=async()=>{if(!g.value){k.error("请输入拒绝原因");return}O.value=!0;const d=q.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject",a=await B(d,{ids:[b.value],reason:g.value});a.code===0?(k.success("审核拒绝成功"),x.value=!1,y()):k.error(a.message)},H=()=>{L.push(`/submitted-tasks/detail/${r.prevTaskId}?type=${N}`),b.value=r.prevTaskId,y()},Q=()=>{L.push(`/submitted-tasks/detail/${r.nextTaskId}?type=${N}`),b.value=r.nextTaskId,y()},W=async d=>{try{const a=await P("task.detail",{},{urlParams:{id:d}});a.code===0?Object.assign(i,a.data):k.error(a.message)}catch{k.error("获取任务详情失败")}},G=async d=>{try{const a=await P("member.detail",{},{urlParams:{id:d}});a.code===0?Object.assign(v,a.data):k.error(a.message)}catch{k.error("获取会员详情失败")}},y=async()=>{try{const d=await P("taskSubmitted.detail",{auditType:N},{urlParams:{id:b.value}});d.code===0&&(Object.assign(r,d.data),d.data.taskId!=null&&await W(d.data.taskId),d.data.memberId!=null&&await G(d.data.memberId),d.data.taskId!=null&&d.data.memberId!=null&&await J())}catch{k.error("获取详情失败")}},U=I([]),J=async()=>{const d=await P("account.list",{taskId:r.taskId,memberId:r.memberId,channelId:i.channelId});d.code===0&&(U.value=d.data.list||[])};return ue(async()=>{b.value=F.params.id,await y()}),(d,a)=>{const V=p("a-avatar"),S=p("a-space"),n=p("a-descriptions-item"),h=p("a-descriptions"),K=p("a-collapse-panel"),X=p("a-collapse"),$=p("a-tag"),Y=p("a-image"),w=p("a-button"),Z=p("a-textarea"),ee=p("a-modal");return u(),_("div",me,[t(ie,{title:"任务审核详情",back:!0}),c("div",_e,[t(X,{ghost:"",class:"collapse"},{default:e(()=>[t(K,{header:"任务信息"},{default:e(()=>[t(h,{column:2},{default:e(()=>[t(n,{label:"任务名称"},{default:e(()=>[t(S,null,{default:e(()=>[t(V,{src:i.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(i.taskName),1)]),_:1})]),_:1}),t(n,{label:"达人领域"},{default:e(()=>[l(s(i.category),1)]),_:1}),t(n,{label:"任务类型"},{default:e(()=>[l(s(R(C).getEnumText("TaskType",i.taskType)),1)]),_:1}),t(n,{label:"任务奖励"},{default:e(()=>[l(s(i.reward)+" 元",1)]),_:1}),t(n,{label:"品牌"},{default:e(()=>[l(s(i.brand),1)]),_:1}),t(n,{label:"指定群组"},{default:e(()=>{var o;return[i.groupMode===0?(u(),_("span",pe,"不指定")):(u(),_("span",fe,s((o=i.groupNames)==null?void 0:o.join("、")),1))]}),_:1}),t(n,{label:"任务时间"},{default:e(()=>[l(s(i.startTime)+" 至 "+s(i.endTime),1)]),_:1}),t(n,{label:"任务名额"},{default:e(()=>[l(s(i.unlimitedQuota?"不限制":i.quota),1)]),_:1}),t(n,{label:"粉丝要求"},{default:e(()=>[l(s(i.fansRequired)+" 粉丝",1)]),_:1}),t(n,{label:"作品要求"},{default:e(()=>[l(s(i.contentRequirement),1)]),_:1}),t(n,{label:"任务信息"},{default:e(()=>[l(s(i.taskInfo),1)]),_:1})]),_:1})]),_:1})]),_:1}),c("div",ke,[a[3]||(a[3]=c("div",{class:"section-title"},"会员信息",-1)),t(h,{column:2},{default:e(()=>[t(n,{label:"会员昵称"},{default:e(()=>[l(s(v.nickname),1)]),_:1}),t(n,{label:"账号"},{default:e(()=>[l(s(v.account),1)]),_:1}),t(n,{label:"所属群"},{default:e(()=>[(u(!0),_(T,null,j(v.groups,o=>(u(),_("div",null,[c("span",null,s(o.groupName),1),o.isOwner?(u(),m($,{key:0,color:"blue",style:{"margin-left":"10px"}},{default:e(()=>a[2]||(a[2]=[l("群主")])),_:1})):f("",!0)]))),256)),!v.groups||v.groups.length===0?(u(),_("span",be,"--")):f("",!0)]),_:1})]),_:1}),(u(!0),_(T,null,j(U.value,o=>(u(),_("div",{key:o.channelId},[t(h,{column:2},{default:e(()=>[t(n,{label:"账号"},{default:e(()=>[t(S,null,{default:e(()=>[t(V,{src:o.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(o.account),1),t($,{color:"warning"},{default:e(()=>[l(s(R(C).getEnumText("AccountAuditStatus",o.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),t(n,{label:"主页"},{default:e(()=>[t(ce,{content:o.homeUrl},{default:e(()=>[c("div",ve,[c("a",{href:o.homeUrl,target:"_blank",class:"link-text"},s(o.homeUrl),9,ge)])]),_:2},1032,["content"])]),_:2},1024),o.channelCustomFields.includes("fansCount")?(u(),m(n,{key:0,label:"粉丝数"},{default:e(()=>[l(s(o.fansCount),1)]),_:2},1024)):f("",!0),o.channelCustomFields.includes("friendsCount")?(u(),m(n,{key:1,label:"好友数"},{default:e(()=>[l(s(o.friendsCount),1)]),_:2},1024)):f("",!0),o.channelCustomFields.includes("postsCount")?(u(),m(n,{key:2,label:"发帖数"},{default:e(()=>[l(s(o.postsCount),1)]),_:2},1024)):f("",!0)]),_:2},1024)]))),128))]),c("div",ye,[a[4]||(a[4]=c("div",{class:"section-title"},"提交信息",-1)),t(h,{column:2},{default:e(()=>{var o;return[(u(!0),_(T,null,j((o=r==null?void 0:r.submitContent)==null?void 0:o.customFields,(A,te)=>(u(),m(n,{key:te,label:A.title},{default:e(()=>[A.type==="image"?(u(!0),_(T,{key:0},j(A.value,(ae,se)=>(u(),m(Y,{src:ae.url,width:60,key:se},null,8,["src"]))),128)):(u(),_(T,{key:1},[l(s(A.value),1)],64))]),_:2},1032,["label"]))),128))]}),_:1})]),c("div",he,[a[5]||(a[5]=c("div",{class:"section-title"},"审核信息",-1)),t(h,{column:2},{default:e(()=>[t(n,{label:"提交时间"},{default:e(()=>[l(s(r.submitTime),1)]),_:1}),t(n,{label:"初审状态"},{default:e(()=>[l(s(R(C).getEnumText("TaskPreAuditStatus",r.taskPreAuditStatus)),1)]),_:1}),t(n,{label:"初审员"},{default:e(()=>[l(s(r.preWaiterName),1)]),_:1}),r.taskPreAuditStatus==="approved"?(u(),m(n,{key:0,label:"复审状态"},{default:e(()=>[l(s(R(C).getEnumText("TaskAuditStatus",r.taskAuditStatus)),1)]),_:1})):f("",!0),r.taskPreAuditStatus==="approved"?(u(),m(n,{key:1,label:"复审员"},{default:e(()=>[l(s(r.waiterName),1)]),_:1})):f("",!0),r.auditStatus==="rejected"?(u(),m(n,{key:2,label:"拒绝原因"},{default:e(()=>[l(s(r.rejectReason),1)]),_:1})):f("",!0)]),_:1})]),c("div",Ie,[c("div",Te,[r.auditStatus==="pending"?(u(),m(S,{key:0},{default:e(()=>[t(w,{type:"primary",onClick:D},{default:e(()=>a[6]||(a[6]=[l(" 审核通过 ")])),_:1}),t(w,{danger:"",onClick:z},{default:e(()=>a[7]||(a[7]=[l(" 审核拒绝 ")])),_:1})]),_:1})):f("",!0)]),c("div",Ce,[t(S,null,{default:e(()=>[r.prevTaskId&&r.prevTaskId!==r.nextTaskId?(u(),m(w,{key:0,onClick:H},{default:e(()=>a[8]||(a[8]=[l("上一个")])),_:1})):f("",!0),r.nextTaskId?(u(),m(w,{key:1,onClick:Q},{default:e(()=>a[9]||(a[9]=[l("下一个")])),_:1})):f("",!0)]),_:1})])])]),t(ee,{open:x.value,"onUpdate:open":a[1]||(a[1]=o=>x.value=o),title:"拒绝原因",onOk:M,confirmLoading:O.value},{default:e(()=>[t(Z,{value:g.value,"onUpdate:value":a[0]||(a[0]=o=>g.value=o),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Pe=le(xe,[["__scopeId","data-v-df2e5ec1"]]);export{Pe as default};
