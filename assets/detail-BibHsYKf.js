import{_ as Z,r as u,m as D,y as E,a as F,n as G,b as y,c as r,d as H,w as s,e as l,p as w,j as i,f as T,o as c,F as O,q as R,s as h,h as p,t as z,A as J,B as K}from"./index-xdmi2-2f.js";import{P as Q}from"./index-CEDEQFYi.js";const W={class:"member-form content-container"},X={class:"form-container"},Y={__name:"detail",setup(ee){const f=E(),v=T(),I=u(),m=D(()=>!!f.params.id),o=F({memberNickname:"",memberAccount:"",password:"",groupId:void 0,inviterId:void 0}),b={memberAccount:[{required:!0,message:"请输入账号"},{validator:(a,e)=>{const d=/^1[3-9]\d{9}$/,n=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!e||d.test(e)||n.test(e)?Promise.resolve():Promise.reject("请输入正确的手机号或邮箱格式")}}]},_=u(!1),N=u([]),g=u(!1),A=u([]),B=(a,e)=>e.children.toLowerCase().indexOf(a.toLowerCase())>=0,x=async(a="")=>{_.value=!0;try{const e=await w("group.list",{page:1,pageSize:50,groupName:a});e.code===0&&(N.value=e.data.list||[])}finally{_.value=!1}},S=async()=>{g.value=!0;try{const a=await w("member.list",{page:1,pageSize:50});a.code===0&&(A.value=a.data.list||[])}finally{g.value=!1}},U=async()=>{if(m.value)try{const a=await w("member.detail",{},{urlParams:{id:f.params.id}});if(a.code===0){const e=a.data;Object.assign(o,{memberNickname:e.memberNickname,memberAccount:e.memberAccount,groupId:e.groupId,inviterId:e.inviterId})}}catch{i.error("加载会员信息失败"),v.back()}},M=async()=>{const a=await K("member.add",o);a.code===0?(i.success("提交成功"),v.back()):i.error(a.message)},$=async()=>{const a=await J("member.edit",o,{urlParams:{id:f.params.id}});a.code===0?(i.success("提交成功"),v.back()):i.error(a.message)},k=u(!1),j=()=>{I.value.validate().then(async()=>{try{k.value=!0,m.value?$():M()}catch{i.error("提交失败")}finally{k.value=!1}})};return G(()=>{x(),S(),U()}),(a,e)=>{const d=l("a-input"),n=l("a-form-item"),P=l("a-select-option"),C=l("a-select"),L=l("a-button"),q=l("a-space"),V=l("a-form");return c(),y("div",W,[r(Q,{title:m.value?"编辑会员":"新增会员",back:!0},null,8,["title"]),H("div",X,[r(V,{ref_key:"formRef",ref:I,model:o,rules:b,"label-col":{span:4},"wrapper-col":{span:16}},{default:s(()=>[r(n,{label:"账号",name:"memberAccount",rules:b.memberAccount},{default:s(()=>[r(d,{value:o.memberAccount,"onUpdate:value":e[0]||(e[0]=t=>o.memberAccount=t),placeholder:"请输入账号（手机号/邮箱）"},null,8,["value"])]),_:1},8,["rules"]),r(n,{label:"密码",name:"password",rules:[{required:!m.value,message:"请输入密码"}]},{default:s(()=>[r(d,{value:o.password,"onUpdate:value":e[1]||(e[1]=t=>o.password=t),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["rules"]),r(n,{label:"会员昵称",name:"memberNickname",rules:b.memberNickname},{default:s(()=>[r(d,{value:o.memberNickname,"onUpdate:value":e[2]||(e[2]=t=>o.memberNickname=t),placeholder:"请输入会员昵称"},null,8,["value"])]),_:1},8,["rules"]),r(n,{label:"所属群",name:"groupId"},{default:s(()=>[r(C,{value:o.groupId,"onUpdate:value":e[3]||(e[3]=t=>o.groupId=t),placeholder:"请选择所属群",loading:_.value,"allow-clear":"","show-search":"","filter-option":!1,onSearch:x},{default:s(()=>[(c(!0),y(O,null,R(N.value,t=>(c(),h(P,{key:t.id,value:t.id},{default:s(()=>[p(z(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),r(n,{label:"邀请人",name:"inviterId"},{default:s(()=>[r(C,{value:o.inviterId,"onUpdate:value":e[4]||(e[4]=t=>o.inviterId=t),placeholder:"请选择邀请人",loading:g.value,"show-search":"","filter-option":B},{default:s(()=>[(c(!0),y(O,null,R(A.value,t=>(c(),h(P,{key:t.id,value:t.id},{default:s(()=>[p(z(t.memberNickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),r(n,{"wrapper-col":{offset:4}},{default:s(()=>[r(q,null,{default:s(()=>[r(L,{type:"primary",loading:k.value,onClick:j},{default:s(()=>e[6]||(e[6]=[p(" 提交 ")])),_:1},8,["loading"]),r(L,{onClick:e[5]||(e[5]=t=>a.$router.back())},{default:s(()=>e[7]||(e[7]=[p("取消")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},re=Z(Y,[["__scopeId","data-v-e6bc478a"]]);export{re as default};
