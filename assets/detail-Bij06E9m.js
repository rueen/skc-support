import{b as Q,a as W,r as p,j as R,x as X,c as Y,k as Z,d as E,f as t,e as C,w as r,g as u,l as P,m as l,h as ee,o as T,i as k,t as m,p as B,s as N,F as ae,q as te,z as se,A as oe}from"./index-C_vAxHhQ.js";import{P as re}from"./PageHeader-DjL1xhnJ.js";import{S as le}from"./SelectTask-DM668MKL.js";const ne={class:"content-container"},ie={class:"table-container"},ue={class:"danger"},fe={__name:"detail",setup(ce){const{t:s}=Q(),$=W(),y=X(),b=ee(),F=p(),g=R(()=>y.name==="TaskGroupEdit"),h=p(!1),c=p([]),f=R(()=>c.value.map(e=>e.id)),w=p(!1),V=R(()=>[{title:"ID",dataIndex:"id",key:"id"},{title:s("task.list.name"),key:"taskName"},{title:s("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:e})=>$.getEnumText("TaskStatus",e)},{title:s("task.list.startTime"),dataIndex:"startTime",key:"startTime"},{title:s("task.list.endTime"),dataIndex:"endTime",key:"endTime"},{title:s("task.list.createTime"),dataIndex:"createTime",key:"createTime"},{title:s("task.list.action"),key:"action"}]),n=Y({taskGroupName:"",taskGroupReward:0}),q=()=>{h.value=!0},x=({taskIds:e})=>{I(e)},I=async(e,a=!1)=>{if(!(!e||!e.length))try{w.value=!0;const o=await P("task.list",{page:1,pageSize:100,sorterField:"createTime",sorterOrder:"ascend",taskIds:e});o.code===0?a?c.value=e.map(d=>o.data.list.find(G=>G.id===d)):c.value=o.data.list:l.error(o.message)}catch(o){l.error(o)}finally{w.value=!1}},z=e=>{c.value=c.value.filter(a=>a.id!==e.id)},U=async()=>{try{v.value=!0;const e={...n,relatedTasks:f.value},a=await oe("taskGroup.add",e);a.code===0?(l.success(s("common.submitSuccess")),b.back()):l.error(a.message)}catch{l.error(s("common.submitFailed"))}finally{v.value=!1}},j=async()=>{try{v.value=!0;const e={...n},a=await se("taskGroup.edit",{...e,relatedTasks:f.value},{urlParams:{id:y.params.id}});a.code===0?(l.success(s("common.submitSuccess")),b.back()):l.error(a.message)}catch{l.error(s("common.submitFailed"))}finally{v.value=!1}},v=p(!1),A=async()=>{if(!n.taskGroupName){l.error(s("task.group.validation.taskGroupNameRequired"));return}if(!n.taskGroupReward){l.error(s("task.group.validation.taskGroupRewardRequired"));return}if(!f.value.length){l.error(s("task.group.validation.relatedTaskRequired"));return}g.value?await j():await U()},L=()=>{b.back()},O=async e=>{try{const a=await P("taskGroup.detail",{},{urlParams:{id:e}});if(a.code===0){const o=a.data;Object.assign(n,{taskGroupName:o.taskGroupName,taskGroupReward:o.taskGroupReward}),I(o.relatedTasks,!0)}}catch(a){l.error(a)}};return Z(()=>{g.value&&O(y.params.id)}),(e,a)=>{const o=u("a-input"),d=u("a-form-item"),G=u("a-input-number"),S=u("a-button"),H=u("a-avatar"),D=u("a-space"),M=u("a-popconfirm"),J=u("a-table"),K=u("a-form");return T(),E("div",ne,[t(re,{title:g.value?e.$t("task.group.editTitle"):e.$t("task.group.createTitle"),back:!0,class:"page-header"},null,8,["title"]),C("div",ie,[t(K,{ref_key:"formRef",ref:F,model:n,"label-col":{span:3},"wrapper-col":{span:19},layout:"horizontal"},{default:r(()=>[t(d,{label:e.$t("task.group.name")},{default:r(()=>[t(o,{value:n.taskGroupName,"onUpdate:value":a[0]||(a[0]=i=>n.taskGroupName=i),placeholder:e.$t("common.inputPlaceholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.group.reward")},{default:r(()=>[t(G,{value:n.taskGroupReward,"onUpdate:value":a[1]||(a[1]=i=>n.taskGroupReward=i),min:0,precision:2,step:1,placeholder:e.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(d,{label:e.$t("task.group.relatedTask")},{default:r(()=>[C("div",null,[t(S,{type:"primary",onClick:q},{default:r(()=>[k(m(e.$t("task.group.selectTaskBtnText",{count:c.value.length})),1)]),_:1}),t(J,{columns:V.value,"data-source":c.value,loading:w.value,pagination:!1,style:{"margin-top":"10px"}},{bodyCell:r(({column:i,record:_})=>[i.key==="taskName"?(T(),B(D,{key:0},{default:r(()=>[t(H,{src:_.channelIcon},null,8,["src"]),k(" "+m(_.taskName),1)]),_:2},1024)):N("",!0),i.key==="taskStatus"?(T(),E(ae,{key:1},[k(m(te($).getEnumText("TaskStatus",_.taskStatus)),1)],64)):N("",!0),i.key==="action"?(T(),B(M,{key:2,title:e.$t("common.deleteConfirm"),onConfirm:de=>z(_)},{default:r(()=>[C("a",ue,m(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])):N("",!0)]),_:1},8,["columns","data-source","loading"])])]),_:1},8,["label"]),t(d,{"wrapper-col":{span:16,offset:3}},{default:r(()=>[t(D,null,{default:r(()=>[t(S,{type:"primary",onClick:A},{default:r(()=>[k(m(e.$t("common.submit")),1)]),_:1}),t(S,{onClick:L},{default:r(()=>[k(m(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),t(le,{visible:h.value,"onUpdate:visible":a[2]||(a[2]=i=>h.value=i),selectedId:f.value,onConfirm:x},null,8,["visible","selectedId"])])}}};export{fe as default};
