import{_ as Ce,a as $e,b as Se,j as Q,r as v,c as X,k as Ie,d as r,e as i,f as l,w as n,g as m,x as Re,h as je,l as N,m as g,o as u,F as b,n as I,p as y,i as p,t as s,s as h,q as Ae,A as Z,M as Te,v as Oe}from"./index-CLr09BPV.js";import{_ as x}from"./CopyContent-_1toU-sV.js";import{G as Ne}from"./GroupOwner-BDL-R4Ec.js";import{d as Fe,e as Ue}from"./routeParamsEncryption-BKFTaOaF.js";const Pe={class:"account content-container"},ze={class:"table-container"},De={class:"table-header"},Me={style:{width:"100%",display:"flex","justify-content":"space-between"}},Ee={class:"right"},Ye={key:0,class:"account-info"},Be={class:"link-text-container"},He={class:"label"},qe=["href"],Ve={class:"stats"},Le={key:0,class:"stat-item"},Ge={key:1,class:"stat-item"},We={key:2,class:"stat-item"},Ke={key:1},Je={key:1},Qe={class:"danger"},Xe=["onClick"],Ze={class:"danger"},xe={__name:"list",setup(et){const F=je(),U=Re(),P=$e(),{t:f}=Se(),ee=Q(()=>P.loaded?P.getEnumOptions("AccountAuditStatus"):[]),z=v(!1),_=v([]),R=v(!1),D=v(!1),C=v(""),Y=v(null),te=()=>{const e=U.query.filters;if(e){Y.value=Fe(e),Object.assign(o,{accountAuditStatus:null},Y.value);const t={...U.query};delete t.filters,F.replace({path:U.path,query:t})}},o=X({keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),B=v([]),H=v([]),q=v([]),M=v([]),ae=Q(()=>[{title:f("account.list.accountInfo"),key:"accountInfo",width:500},{title:f("account.list.memberInfo"),key:"member"},{title:f("account.list.submitTime"),dataIndex:"submitTime",key:"submitTime"},{title:f("account.list.auditStatus"),dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:f("account.list.rejectReason"),key:"rejectReason"},{title:f("account.list.waiterName"),key:"waiterName"},{title:f("account.list.action"),key:"action"}]),ne={selectedRowKeys:_,onChange:e=>{_.value=e},getCheckboxProps:e=>({disabled:e.accountAuditStatus!=="pending"})},V=v([]),$=X({current:1,pageSize:10,total:0}),L=()=>{$.current=1,S()},le=()=>{Object.assign(o,{keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),L()},oe=e=>{F.push(`/member/view/${e.memberId}`)},se=e=>{var k,d;const t=Ue({...o,submitStartTime:(k=o.submitTimeRange)==null?void 0:k[0],submitEndTime:(d=o.submitTimeRange)==null?void 0:d[1],submitTimeRange:void 0});F.push({name:"AccountEdit",params:{id:e.id},query:{filters:t}})},ue=()=>{F.push("/account/old")},ce=e=>{Object.assign($,{current:e.current,pageSize:e.pageSize}),S()},ie=async e=>{_.value=[e.id],G()},G=async()=>{if(!_.value.length){g.warning(f("account.list.message.selectAccount"));return}const e=await Z("account.batchResolve",{ids:_.value});if(e.code===0){const t=e.data.failed.map(k=>k.reason).join(",");t?Te.error({title:f("account.list.batchRejectFailedTitle"),content:`成功 ${e.data.successCount} 条，失败 ${e.data.failedCount} 条，失败原因：${t}`}):(g.success(f("account.list.message.success")),_.value=[],S())}else g.error(e.message)},re=async()=>{if(!_.value.length){g.warning(f("account.list.message.selectAccount"));return}C.value="",R.value=!0},de=e=>{_.value=[e.id],C.value="",R.value=!0},me=async()=>{if(!C.value){g.error(f("account.list.message.rejectReason"));return}D.value=!0;try{const e=await Z("account.batchReject",{ids:_.value,rejectReason:C.value});e.code===0?(g.success(f("account.list.message.success")),_.value=[],R.value=!1,S()):g.error(e.message)}catch(e){console.log(e)}finally{D.value=!1}},S=async()=>{var e,t;z.value=!0;try{const k={page:$.current,pageSize:$.pageSize,keyword:o.keyword,channelId:o.channelId,accountAuditStatus:o.accountAuditStatus,waiterId:o.waiterId,groupId:o.groupId,memberId:o.memberId,submitStartTime:(e=o.submitTimeRange)==null?void 0:e[0],submitEndTime:(t=o.submitTimeRange)==null?void 0:t[1]},d=await N("account.list",{...k});d.code===0?(V.value=d.data.list,$.total=d.data.total):g.error(d.message)}finally{z.value=!1}},pe=async()=>{const e=await N("channel.list");e.code===0&&(B.value=e.data.list)},W=async(e="")=>{try{const t=await N("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(H.value=t.data.list||[])}catch{g.error("获取群组列表失败")}},K=async(e="")=>{const t=await N("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(q.value=t.data.list||[])},fe=async e=>{const t=await Oe("account.delete",{},{urlParams:{id:e.id}});t.code===0?(g.success(t.message),S()):g.error(t.message)},he=async()=>{if(M.value.length)return;const e=await N("waiter.list",{page:1,pageSize:100});if(e.code===0){const t={id:0,username:"无"};M.value=[t,...e.data.list]}};return Ie(()=>{te(),S(),W(),pe(),K(),he()}),(e,t)=>{const k=m("a-input"),d=m("a-form-item"),j=m("a-select-option"),A=m("a-select"),ve=m("a-range-picker"),T=m("a-button"),O=m("a-space"),ge=m("a-form"),_e=m("a-avatar"),J=m("a-typography-link"),ye=m("a-typography-text"),E=m("a-popconfirm"),be=m("a-table"),ke=m("a-textarea"),we=m("a-modal");return u(),r("div",Pe,[i("div",ze,[i("div",De,[l(ge,{layout:"inline",model:o},{default:n(()=>[l(d,{label:e.$t("account.search.account")},{default:n(()=>[l(k,{value:o.keyword,"onUpdate:value":t[0]||(t[0]=a=>o.keyword=a),placeholder:e.$t("account.search.accountPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("account.search.channel")},{default:n(()=>[l(A,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=a=>o.channelId=a),placeholder:e.$t("account.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(u(!0),r(b,null,I(B.value,a=>(u(),y(j,{key:a.id,value:a.id},{default:n(()=>[p(s(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("account.search.submitTime")},{default:n(()=>[l(ve,{value:o.submitTimeRange,"onUpdate:value":t[2]||(t[2]=a=>o.submitTimeRange=a),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),l(d,{label:e.$t("account.search.auditStatus")},{default:n(()=>[l(A,{value:o.accountAuditStatus,"onUpdate:value":t[3]||(t[3]=a=>o.accountAuditStatus=a),placeholder:e.$t("account.search.auditStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(u(!0),r(b,null,I(ee.value,a=>(u(),y(j,{key:a.value,value:a.value},{default:n(()=>[p(s(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("account.search.auditor")},{default:n(()=>[l(A,{value:o.waiterId,"onUpdate:value":t[4]||(t[4]=a=>o.waiterId=a),placeholder:e.$t("account.search.auditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:n(()=>[(u(!0),r(b,null,I(M.value,a=>(u(),y(j,{key:a.id,value:a.id},{default:n(()=>[p(s(a.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("account.search.group")},{default:n(()=>[l(A,{value:o.groupId,"onUpdate:value":t[5]||(t[5]=a=>o.groupId=a),placeholder:e.$t("account.search.groupPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:W},{default:n(()=>[(u(!0),r(b,null,I(H.value,a=>(u(),y(j,{key:a.id,value:a.id},{default:n(()=>[p(s(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,{label:e.$t("account.search.member")},{default:n(()=>[l(A,{value:o.memberId,"onUpdate:value":t[6]||(t[6]=a=>o.memberId=a),placeholder:e.$t("account.search.memberPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:K},{default:n(()=>[(u(!0),r(b,null,I(q.value,a=>(u(),y(j,{key:a.id,value:a.id},{default:n(()=>[p(s(a.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(d,null,{default:n(()=>[l(O,null,{default:n(()=>[l(T,{type:"primary",onClick:L},{default:n(()=>[p(s(e.$t("common.search")),1)]),_:1}),l(T,{onClick:le},{default:n(()=>[p(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),i("div",Me,[l(T,{onClick:ue},{default:n(()=>[p(s(e.$t("account.list.oldAccount")),1)]),_:1}),i("div",Ee,[l(O,null,{default:n(()=>[l(T,{type:"primary",onClick:G},{default:n(()=>[p(s(e.$t("common.batchResolve")),1)]),_:1}),l(T,{danger:"",onClick:re},{default:n(()=>[p(s(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),l(be,{columns:ae.value,"data-source":V.value,loading:z.value,pagination:$,"row-selection":ne,rowKey:"id",onChange:ce},{bodyCell:n(({column:a,record:c})=>[a.key==="accountInfo"?(u(),r("div",Ye,[l(O,null,{default:n(()=>[l(_e,{src:c.channelIcon,size:"small"},null,8,["src"]),i("span",null,s(c.account),1)]),_:2},1024),i("div",null,[i("div",Be,[i("span",He,s(e.$t("account.list.homepage"))+"：",1),l(x,{content:c.homeUrl},{default:n(()=>[l(J,null,{default:n(()=>[i("a",{href:c.homeUrl,target:"_blank"},s(c.homeUrl),9,qe)]),_:2},1024)]),_:2},1032,["content"])])]),i("div",null,[t[9]||(t[9]=i("span",{class:"label"},"uid：",-1)),l(x,{content:c.uid},null,8,["content"])]),i("div",Ve,[c.channelCustomFields.includes("fansCount")?(u(),r("div",Le,s(e.$t("account.list.fansCount"))+"："+s(c.fansCount),1)):h("",!0),c.channelCustomFields.includes("friendsCount")?(u(),r("div",Ge,s(e.$t("account.list.friendsCount"))+"："+s(c.friendsCount),1)):h("",!0),c.channelCustomFields.includes("postsCount")?(u(),r("div",We,s(e.$t("account.list.postsCount"))+"："+s(c.postsCount),1)):h("",!0)])])):h("",!0),a.key==="member"?(u(),r("div",Ke,[i("div",null,[l(J,{onClick:w=>oe(c)},{default:n(()=>[p(s(c.memberNickname),1)]),_:2},1032,["onClick"])]),(u(!0),r(b,null,I(c.groups,w=>(u(),r("div",null,[l(O,null,{default:n(()=>[i("span",null,s(w.groupName),1),w.isOwner?(u(),y(Ne,{key:0})):h("",!0)]),_:2},1024)]))),256))])):h("",!0),a.key==="accountAuditStatus"?(u(),r(b,{key:2},[p(s(Ae(P).getEnumText("AccountAuditStatus",c.accountAuditStatus)),1)],64)):h("",!0),a.key==="rejectReason"?(u(),r(b,{key:3},[c.rejectReason?(u(),y(ye,{key:0,type:"danger"},{default:n(()=>[p(s(c.rejectReason),1)]),_:2},1024)):(u(),r("span",Je,"--"))],64)):h("",!0),a.key==="waiterName"?(u(),r(b,{key:4},[p(s(c.waiterName||"--"),1)],64)):h("",!0),a.key==="action"?(u(),y(O,{key:5},{default:n(()=>[c.accountAuditStatus==="pending"?(u(),y(E,{key:0,title:e.$t("account.list.resolveConfirm"),onConfirm:w=>ie(c)},{default:n(()=>[i("a",null,s(e.$t("account.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),c.accountAuditStatus==="pending"?(u(),y(E,{key:1,title:e.$t("account.list.rejectConfirm"),onConfirm:w=>de(c)},{default:n(()=>[i("a",Qe,s(e.$t("account.list.reject")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),i("a",{onClick:w=>se(c)},s(e.$t("common.edit")),9,Xe),l(E,{title:e.$t("common.deleteConfirm"),onConfirm:w=>fe(c)},{default:n(()=>[i("a",Ze,s(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),l(we,{open:R.value,"onUpdate:open":t[8]||(t[8]=a=>R.value=a),title:e.$t("account.list.rejectReason"),onOk:me,confirmLoading:D.value},{default:n(()=>[l(ke,{value:C.value,"onUpdate:value":t[7]||(t[7]=a=>C.value=a),placeholder:e.$t("account.list.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},ot=Ce(xe,[["__scopeId","data-v-8472907b"]]);export{ot as default};
