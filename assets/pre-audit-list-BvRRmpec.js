import{_ as be,a as ve,b as fe,j as V,r as h,c as z,k as he,d as _,e as p,f as l,w as a,g as u,l as D,m,h as ge,o as i,F as A,n as E,p as v,i as k,t as d,s as f,q as _e,M as Te,A as F}from"./index-CQD26ebJ.js";import{d as ye}from"./download-BN6feVcd.js";import{G as we}from"./GroupOwner-oimVLQIN.js";const Se={class:"task-audit content-container"},Ce={class:"table-container"},$e={class:"table-header"},Ae={style:{width:"100%",display:"flex","justify-content":"space-between"}},Pe={key:3},Re=["onClick"],Ie={class:"danger"},Ne={__name:"pre-audit-list",setup(je){const P=ve(),{t:o}=fe(),G=V(()=>P.loaded?P.getEnumOptions("TaskPreAuditStatus"):[]),M=ge(),R=h(!1),w=h(!1),U=h(!1),T=h(""),b=h([]),s=z({taskName:"",channelId:void 0,taskPreAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),Y=h([]),x=h([]),W=V(()=>[{title:o("submittedTasks.list.taskName"),key:"taskName"},{title:o("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:o("submittedTasks.list.memberInfo"),key:"member"},{title:o("submittedTasks.list.status"),dataIndex:"taskPreAuditStatus",key:"taskPreAuditStatus"},{title:o("submittedTasks.list.preAuditor"),key:"preWaiterName"},{title:o("submittedTasks.list.action"),key:"action",fixed:"right",width:180}]),I=h([]),y=z({current:1,pageSize:10,total:0}),q={selectedRowKeys:b,onChange:e=>{b.value=e},getCheckboxProps:e=>({disabled:e.taskPreAuditStatus!=="pending"})},B=()=>{y.current=1,S()},K=()=>{Object.assign(s,{taskName:"",channelId:void 0,taskPreAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),B()},J=e=>{Object.assign(y,e),S()},Q=e=>{M.push(`/member/view/${e.memberId}`)},X=e=>{M.push(`/submitted-tasks/detail/${e.id}?type=pre`)},Z=async e=>{b.value=[e.id],L()},L=async()=>{if(!b.value.length){m.warning(o("submittedTasks.list.selectTask"));return}const e=await F("taskSubmitted.batchPreAuditApprove",{ids:b.value});e.code===0?(m.success(o("submittedTasks.resolveSuccess")),b.value=[],S()):m.error(e.message)},ee=e=>{b.value=[e.id],T.value="",w.value=!0},te=async()=>{if(!T.value){m.error(o("submittedTasks.rejectReasonRequired"));return}U.value=!0;const e=await F("taskSubmitted.batchPreAuditReject",{ids:b.value,reason:T.value});e.code===0?(m.success(o("submittedTasks.rejectSuccess")),w.value=!1,S()):m.error(e.message)},ae=()=>{if(!b.value.length){m.warning(o("submittedTasks.list.selectTask"));return}T.value="",w.value=!0},se=async()=>{const e=await D("channel.list");e.code===0&&(Y.value=e.data.list)},ne=()=>{Te.confirm({title:o("submittedTasks.list.export"),content:o("submittedTasks.list.confirmExportContent"),onOk:async()=>{var e,n;try{const g=m.loading(o("submittedTasks.list.exporting"),0),r={taskName:s.taskName,channelId:s.channelId,taskPreAuditStatus:s.taskPreAuditStatus,groupId:s.groupId,submitStartTime:(e=s.submitTimeRange)==null?void 0:e[0],submitEndTime:(n=s.submitTimeRange)==null?void 0:n[1],completedTaskCount:s.completedTaskCount};await ye("taskSubmitted.preAuditExport",r,`初审列表_${new Date().toLocaleDateString()}.xlsx`),g(),m.success(o("submittedTasks.list.exportSuccess"))}catch(g){console.error("导出失败:",g),m.error(o("submittedTasks.list.exportFailed"))}}})},le=async(e="")=>{try{const n=await D("group.list",{params:{page:1,pageSize:50,keyword:e}});n.code===0&&(x.value=n.data.list||[])}catch{m.error("获取群组列表失败")}},S=async()=>{var e,n;R.value=!0;try{const g={page:y.current,pageSize:y.pageSize,taskName:s.taskName,channelId:s.channelId,taskPreAuditStatus:s.taskPreAuditStatus,groupId:s.groupId,submitStartTime:(e=s.submitTimeRange)==null?void 0:e[0],submitEndTime:(n=s.submitTimeRange)==null?void 0:n[1],completedTaskCount:s.completedTaskCount},r=await D("taskSubmitted.preAuditList",{...g});r.code===0?(I.value=r.data.list,y.total=r.data.total):m.error(r.message)}finally{R.value=!1}};return he(()=>{S(),le(),se()}),(e,n)=>{const g=u("a-input"),r=u("a-form-item"),N=u("a-select-option"),j=u("a-select"),oe=u("a-range-picker"),ue=u("a-input-number"),ie=u("a-form"),C=u("a-button"),$=u("a-space"),de=u("DownloadOutlined"),re=u("a-avatar"),ce=u("a-typography-link"),H=u("a-popconfirm"),me=u("a-table"),pe=u("a-textarea"),ke=u("a-modal");return i(),_("div",Se,[p("div",Ce,[p("div",$e,[l(ie,{layout:"inline",model:s},{default:a(()=>[l(r,{label:e.$t("submittedTasks.search.taskName")},{default:a(()=>[l(g,{value:s.taskName,"onUpdate:value":n[0]||(n[0]=t=>s.taskName=t),placeholder:e.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.channel")},{default:a(()=>[l(j,{value:s.channelId,"onUpdate:value":n[1]||(n[1]=t=>s.channelId=t),placeholder:e.$t("submittedTasks.search.channelPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),_(A,null,E(Y.value,t=>(i(),v(N,{key:t.id,value:t.id},{default:a(()=>[k(d(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.taskPreAuditStatus")},{default:a(()=>[l(j,{value:s.taskPreAuditStatus,"onUpdate:value":n[2]||(n[2]=t=>s.taskPreAuditStatus=t),placeholder:e.$t("submittedTasks.search.taskPreAuditStatusPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),_(A,null,E(G.value,t=>(i(),v(N,{key:t.value,value:t.value},{default:a(()=>[k(d(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.groupId")},{default:a(()=>[l(j,{value:s.groupId,"onUpdate:value":n[3]||(n[3]=t=>s.groupId=t),placeholder:e.$t("submittedTasks.search.groupIdPlaceholder"),"allow-clear":""},{default:a(()=>[(i(!0),_(A,null,E(x.value,t=>(i(),v(N,{key:t.id,value:t.id},{default:a(()=>[k(d(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.submitTime")},{default:a(()=>[l(oe,{value:s.submitTimeRange,"onUpdate:value":n[4]||(n[4]=t=>s.submitTimeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),l(r,{label:e.$t("submittedTasks.search.completedTaskCount")},{default:a(()=>[l(ue,{value:s.completedTaskCount,"onUpdate:value":n[5]||(n[5]=t=>s.completedTaskCount=t),min:0,max:9999,"addon-after":e.$t("submittedTasks.search.times"),style:{width:"100px!important"}},null,8,["value","addon-after"])]),_:1},8,["label"])]),_:1},8,["model"]),p("div",Ae,[p("div",null,[l($,null,{default:a(()=>[l(C,{type:"primary",onClick:B},{default:a(()=>[k(d(e.$t("common.search")),1)]),_:1}),l(C,{onClick:K},{default:a(()=>[k(d(e.$t("common.reset")),1)]),_:1})]),_:1})]),p("div",null,[l($,null,{default:a(()=>[I.value.length?(i(),v(C,{key:0,onClick:ne},{icon:a(()=>[l(de)]),default:a(()=>[k(" "+d(e.$t("common.export")),1)]),_:1})):f("",!0),l(C,{type:"primary",onClick:L},{default:a(()=>[k(d(e.$t("common.batchResolve")),1)]),_:1}),l(C,{danger:"",onClick:ae},{default:a(()=>[k(d(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),l(me,{columns:W.value,"data-source":I.value,loading:R.value,pagination:y,"row-selection":q,rowKey:"id",onChange:J},{bodyCell:a(({column:t,record:c})=>[t.key==="taskName"?(i(),v($,{key:0},{default:a(()=>[l(re,{src:c.channelIcon,size:"small"},null,8,["src"]),p("span",null,d(c.taskName),1)]),_:2},1024)):f("",!0),t.key==="taskPreAuditStatus"?(i(),_(A,{key:1},[k(d(_e(P).getEnumText("TaskPreAuditStatus",c.taskPreAuditStatus)),1)],64)):f("",!0),t.key==="preWaiterName"?(i(),_(A,{key:2},[k(d(c.preWaiterName||"--"),1)],64)):f("",!0),t.key==="member"?(i(),_("div",Pe,[p("div",null,[l(ce,{onClick:O=>Q(c)},{default:a(()=>[k(d(c.nickname),1)]),_:2},1032,["onClick"])]),l($,{class:"group-name"},{default:a(()=>[p("span",null,d(c.groupName),1),c.isOwner?(i(),v(we,{key:0})):f("",!0)]),_:2},1024)])):f("",!0),t.key==="action"?(i(),v($,{key:4},{default:a(()=>[p("a",{onClick:O=>X(c)},d(e.$t("submittedTasks.list.view")),9,Re),c.taskPreAuditStatus==="pending"?(i(),v(H,{key:0,title:e.$t("submittedTasks.list.confirmResolve"),onConfirm:O=>Z(c)},{default:a(()=>[p("a",null,d(e.$t("submittedTasks.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):f("",!0),c.taskPreAuditStatus==="pending"?(i(),v(H,{key:1,title:e.$t("submittedTasks.list.confirmReject"),onConfirm:O=>ee(c)},{default:a(()=>[p("a",Ie,d(e.$t("submittedTasks.list.reject")),1)]),_:2},1032,["title","onConfirm"])):f("",!0)]),_:2},1024)):f("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),l(ke,{open:w.value,"onUpdate:open":n[7]||(n[7]=t=>w.value=t),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:te,confirmLoading:U.value},{default:a(()=>[l(pe,{value:T.value,"onUpdate:value":n[6]||(n[6]=t=>T.value=t),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Me=be(Ne,[["__scopeId","data-v-10fd0b2a"]]);export{Me as default};
