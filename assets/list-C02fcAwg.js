import{_ as K,r as x,i as W,a as B,j as X,k as Y,b as d,d as _,c as s,w as e,e as i,l as D,m as g,f as Z,o as l,F as k,n as V,p as S,h as c,t as r,g as z,P as tt,q as m,s as et}from"./index-BlTIBMeX.js";const at={class:"task content-container"},st={class:"table-container"},nt={class:"table-header"},lt={class:"left"},ot={class:"right"},ut={key:0},it={key:1},dt=["onClick"],ct={__name:"list",setup(rt){const N=Z(),C=x(!1),f=W(),o=B({taskName:"",channelId:void 0,taskStatus:void 0}),T=x([]),F=X(()=>f.loaded?f.getEnumOptions("TaskStatus"):[]),P=[{title:"任务名称",key:"taskName"},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus",customRender:({text:n})=>f.getEnumText("TaskStatus",n)},{title:"任务名额 / 已提交",key:"taskQuota"},{title:"任务时间",key:"taskTime"},{title:"操作",key:"action",fixed:"right",width:180}],w=x([]),p=B({current:1,pageSize:10,total:0}),I=()=>{p.current=1,v()},Q=()=>{o.taskName="",o.channelId=void 0,o.taskStatus=void 0,I()},R=n=>{Object.assign(p,n),v()},U=()=>{N.push("/task/create")},$=n=>{N.push(`/task/edit/${n.id}`)},j=async n=>{try{const a=await et("task.delete",{},{urlParams:{id:n.id}});a.code===0?(g.success("删除成功"),v()):g.error(a.message)}catch{g.error("删除失败")}},v=async()=>{C.value=!0;try{const n=await D("task.list",{page:p.current,pageSize:p.pageSize,...o});n.code===0?(w.value=n.data.list,p.total=n.data.total):g.error(n.message)}finally{C.value=!1}},q=async()=>{const n=await D("channel.list");n.code===0&&(T.value=n.data.list)};return Y(async()=>{v(),q()}),(n,a)=>{const A=i("a-input"),y=i("a-form-item"),E=i("a-select-option"),O=i("a-select"),b=i("a-button"),h=i("a-space"),L=i("a-form"),M=i("a-avatar"),G=i("a-popconfirm"),H=i("a-table");return l(),d("div",at,[_("div",st,[_("div",nt,[_("div",lt,[s(L,{layout:"inline",model:o},{default:e(()=>[s(y,{label:"任务名称"},{default:e(()=>[s(A,{value:o.taskName,"onUpdate:value":a[0]||(a[0]=t=>o.taskName=t),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),s(y,{label:"平台渠道"},{default:e(()=>[s(O,{value:o.channelId,"onUpdate:value":a[1]||(a[1]=t=>o.channelId=t),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:e(()=>[(l(!0),d(k,null,V(T.value,t=>(l(),S(E,{key:t.id,value:t.id},{default:e(()=>[c(r(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(y,{label:"任务状态"},{default:e(()=>[s(O,{value:o.taskStatus,"onUpdate:value":a[2]||(a[2]=t=>o.taskStatus=t),placeholder:"请选择任务状态",allowClear:""},{default:e(()=>[(l(!0),d(k,null,V(F.value,t=>(l(),S(E,{key:t.value,value:t.value},{default:e(()=>[c(r(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(y,null,{default:e(()=>[s(h,null,{default:e(()=>[s(b,{type:"primary",onClick:I},{default:e(()=>a[3]||(a[3]=[c("查询")])),_:1}),s(b,{onClick:Q},{default:e(()=>a[4]||(a[4]=[c("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",ot,[s(h,null,{default:e(()=>[s(b,{type:"primary",onClick:U},{icon:e(()=>[s(z(tt))]),default:e(()=>[a[5]||(a[5]=c(" 新建任务 "))]),_:1})]),_:1})])]),s(H,{columns:P,"data-source":w.value,loading:C.value,pagination:p,onChange:R},{bodyCell:e(({column:t,record:u})=>[t.key==="taskName"?(l(),S(h,{key:0},{default:e(()=>[s(M,{src:u.channelIcon},null,8,["src"]),c(" "+r(u.taskName),1)]),_:2},1024)):m("",!0),t.key==="taskTime"?(l(),d(k,{key:1},[c(r(u.startTime)+" - "+r(u.endTime),1)],64)):m("",!0),t.key==="taskQuota"?(l(),d(k,{key:2},[u.unlimitedQuota?(l(),d("span",ut,"不限制")):(l(),d("span",it,r(u.quota),1)),_("span",null," / "+r(u.submittedCount),1)],64)):m("",!0),t.key==="taskStatus"?(l(),d(k,{key:3},[c(r(z(f).getEnumText("TaskStatus",u.taskStatus)),1)],64)):m("",!0),t.key==="action"?(l(),S(h,{key:4},{default:e(()=>[_("a",{onClick:J=>$(u)},"编辑",8,dt),s(G,{title:"确定要删除该任务吗？",onConfirm:J=>j(u)},{default:e(()=>a[6]||(a[6]=[_("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):m("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},pt=K(ct,[["__scopeId","data-v-306dcf58"]]);export{pt as default};
