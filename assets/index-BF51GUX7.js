import{D as Z,E as ee,_ as te,b as ae,r,c as E,j as S,k as oe,G as le,H as ne,d as ie,e as s,f as o,w as l,g as n,l as se,m as c,o as x,i as B,t as v,p as re,s as ce,B as D,I,v as de,z as ue,A as pe}from"./index-Dj_DbIEG.js";var me=Z();const fe=ee(me),_e={class:"article content-container"},ge={class:"table-container"},ve={class:"table-header"},he={class:"right"},ye=["onClick"],be=["onClick"],ke={class:"editor-wrapper"},we={__name:"index",setup(Ce){const{t:d}=ae(),h=r(!1),u=r(!1),m=r(!1),f=r("add"),C=r(),y=r(null),b=r(null);let i=null;const $={placeholderText:"请输入文章内容",height:300,toolbarButtons:["fontSize","textColor","backgroundColor","formatOL","html"],language:"zh_cn",imageUploadURL:D.imageUploadUrl,imageUploadParams:{type:"article"},imageUploadMethod:"POST",imageUploadHeaders:{Authorization:"Bearer "+localStorage.getItem("token")},imageMaxSize:5*1024*1024,imageAllowedTypes:["jpeg","jpg","png","gif"],events:{"image.uploaded":function(e){const t=JSON.parse(e);return t.code===0&&t.data&&t.data.url?t.data.url:!1},"image.error":function(e,t){c.error("图片上传失败: "+(e.message||"未知错误"))}}},a=E({title:"",location:"",content:""}),P={title:[{required:!0,message:d("article.titleRequired")}],content:[{required:!0,message:d("article.contentRequired")}]},A=S(()=>[{title:d("article.title"),dataIndex:"title",key:"title"},{title:d("article.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:d("article.action"),key:"action",width:200}]),T=r([]),_=E({current:1,pageSize:10,total:0}),O=S(()=>({add:d("article.addTitle"),edit:d("article.editTitle")})[f.value]),j=async e=>{try{const t=await de("article.delete",{id:e.id},{urlParams:{id:e.id}});t.code===0?(c.success(t.message),g()):c.error(t.message)}catch(t){console.error(t)}},q=()=>{f.value="add",a.title="",a.location="",a.content="",u.value=!0},L=e=>{window.open(`${D.h5Url}/article/${e.id}`,"_blank")},N=e=>{f.value="edit",a.title=e.title,a.location=e.location,a.content=e.content,u.value=!0,y.value=e.id,I(()=>{i&&i.html.set(a.content||"")})},R=async()=>{m.value=!0;try{const e=await pe("article.add",{...a});e.code===0?(c.success(e.message),u.value=!1,g()):c.error(e.message)}catch(e){console.error(e)}finally{m.value=!1}},V=async()=>{m.value=!0;try{const e=await ue("article.edit",{id:y.value,...a},{urlParams:{id:y.value}});e.code===0?(c.success(e.message),u.value=!1,g()):c.error(e.message)}catch(e){console.error(e)}finally{m.value=!1}},M=async()=>{switch(await C.value.validate(),f.value){case"add":await R();break;case"edit":await V();break}},g=async()=>{h.value=!0;try{const e=await se("article.list",{page:_.current,pageSize:_.pageSize});e.code===0?(T.value=e.data.list,_.total=e.data.total):c.error(e.message)}finally{h.value=!1}};oe(()=>{g(),le(u,e=>{e&&I(()=>{b.value&&!i&&F()})})});const F=()=>{i&&i.destroy(),i=new fe(b.value,{...$,events:{...$.events,contentChanged:function(){a.content=this.html.get()},initialized:function(){this.html.set(a.content||"")}}})};return ne(()=>{i&&(i.destroy(),i=null)}),(e,t)=>{const H=n("plus-outlined"),G=n("a-button"),J=n("a-typography-text"),K=n("a-popconfirm"),Q=n("a-space"),W=n("a-table"),U=n("a-input"),k=n("a-form-item"),X=n("a-form"),Y=n("a-modal");return x(),ie("div",_e,[s("div",ge,[s("div",ve,[t[3]||(t[3]=s("div",{class:"left"},null,-1)),s("div",he,[o(G,{type:"primary",onClick:q},{default:l(()=>[o(H),B(" "+v(e.$t("article.add")),1)]),_:1})])]),o(W,{columns:A.value,"data-source":T.value,loading:h.value,pagination:_},{bodyCell:l(({column:p,record:w})=>[p.key==="action"?(x(),re(Q,{key:0},{default:l(()=>[s("a",{onClick:z=>L(w)},v(e.$t("article.preview")),9,ye),s("a",{onClick:z=>N(w)},v(e.$t("article.edit")),9,be),o(K,{title:e.$t("article.deleteConfirm"),onConfirm:z=>j(w)},{default:l(()=>[s("a",null,[o(J,{type:"danger"},{default:l(()=>[B(v(e.$t("article.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):ce("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),o(Y,{open:u.value,"onUpdate:open":t[2]||(t[2]=p=>u.value=p),title:O.value,width:800,confirmLoading:m.value,onOk:M},{default:l(()=>[o(X,{ref_key:"formRef",ref:C,model:a,rules:P,"label-col":{span:4},"wrapper-col":{span:19}},{default:l(()=>[o(k,{label:e.$t("article.title"),name:"title"},{default:l(()=>[o(U,{value:a.title,"onUpdate:value":t[0]||(t[0]=p=>a.title=p),placeholder:e.$t("article.titlePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(k,{label:e.$t("article.location"),name:"location"},{default:l(()=>[o(U,{value:a.location,"onUpdate:value":t[1]||(t[1]=p=>a.location=p),placeholder:e.$t("article.locationPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(k,{label:e.$t("article.content"),name:"content"},{default:l(()=>[s("div",ke,[s("textarea",{ref_key:"editorEl",ref:b},null,512)])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},Te=te(we,[["__scopeId","data-v-6018b0ae"]]);export{Te as default};
