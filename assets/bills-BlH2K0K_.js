import{_ as re,b as ue,a as de,j as C,r as N,c as F,k as me,d,e as I,f as o,v as b,w as l,g as m,y as j,l as z,m as g,h as ce,o as s,F as k,p as M,q as h,i as p,t as r,s as Y,M as A}from"./index-D-6dhutF.js";import{d as pe}from"./download-Gk1WT9n0.js";const be={class:"other-bill content-container"},fe={class:"table-container"},ye={class:"table-header"},ke={class:"left"},_e={key:1},he={key:1},ve={key:5,style:{"max-width":"250px"}},ge={key:0},Ne={key:1},we={key:0},Te={key:1},Se={key:0,class:"count-container"},$e={__name:"bills",setup(Ce){const{t:c}=ue(),_=de(),D=ce(),V=C(()=>_.loaded?_.getEnumOptions("BillType"):[]),L=C(()=>_.loaded?_.getEnumOptions("SettlementStatus"):[]),w=N(!1),G=()=>{const e=j().startOf("month").format("YYYY-MM-DD HH:mm:ss"),n=j().endOf("month").format("YYYY-MM-DD HH:mm:ss");return[e,n]},a=F({billNo:"",billType:void 0,settlementStatus:void 0,timeRange:G(),taskName:"",keyword:"",relatedGroupId:void 0}),q=e=>{A.error({title:"结算失败原因",content:e.failureReason})},W=C(()=>[{title:c("financial.bills.billNo"),dataIndex:"billNo",key:"billNo"},{title:c("financial.bills.memberNickname"),key:"memberNickname"},{title:c("financial.bills.billType"),dataIndex:"billType",key:"billType"},{title:c("financial.bills.relatedTaskName"),key:"taskName"},{title:c("financial.bills.relatedGroupName"),key:"relatedGroupName"},{title:c("financial.bills.amount"),dataIndex:"amount",key:"amount",align:"right"},{title:c("financial.bills.remark"),key:"remark"},{title:c("financial.bills.createTime"),dataIndex:"createTime",key:"createTime"},{title:c("financial.bills.settlementStatus"),key:"settlementStatus"}]),O=N([]),R=N(0),f=F({current:1,pageSize:10,total:0}),x=()=>{f.current=1,T()},J=()=>{Object.assign(a,{billNo:"",billType:void 0,settlementStatus:void 0,timeRange:G(),taskName:"",keyword:"",relatedGroupId:void 0}),x()},K=e=>{Object.assign(f,e),T()},Q=e=>{D.push(`/member/view/${e.memberId}`)},X=e=>{D.push(`/submitted-tasks/detail/${e.submittedId}?type=confirm`)},T=async()=>{var e,n;w.value=!0;try{const y={page:f.current,pageSize:f.pageSize,billNo:a.billNo,billType:a.billType,settlementStatus:a.settlementStatus,startTime:(e=a.timeRange)==null?void 0:e[0],endTime:(n=a.timeRange)==null?void 0:n[1],taskName:a.taskName,keyword:a.keyword,relatedGroupId:a.relatedGroupId},u=await z("finance.bills",{...y});u.code===0?(O.value=u.data.list,f.total=u.data.total,R.value=u.data.totalAmount):g.error(u.message)}finally{w.value=!1}},E=N([]),H=async(e="")=>{try{const n=await z("group.list",{page:1,pageSize:50,groupName:e});n.code===0&&(E.value=n.data.list||[])}catch{g.error("获取群组列表失败")}},Z=()=>{A.confirm({title:c("common.export"),content:c("common.confirmExportContent"),onOk:async()=>{var y,u;const e=g.loading("正在导出数据，请稍候...",0),n={billNo:a.billNo,billType:a.billType,settlementStatus:a.settlementStatus,startTime:(y=a.timeRange)==null?void 0:y[0],endTime:(u=a.timeRange)==null?void 0:u[1],taskName:a.taskName,keyword:a.keyword,relatedGroupId:a.relatedGroupId};try{await pe("finance.billsExport",n,`结算账单_${new Date().toLocaleDateString()}.xlsx`),g.success(c("common.exportSuccess"))}catch(v){console.error("导出失败:",v),g.error(c("common.exportFailed"))}finally{e()}}})};return me(()=>{T(),H()}),(e,n)=>{const y=m("a-input"),u=m("a-form-item"),v=m("a-select-option"),S=m("a-select"),ee=m("a-range-picker"),$=m("a-button"),te=m("download-outlined"),ae=m("a-space"),le=m("a-form"),B=m("a-typography-link"),ne=m("a-typography-text"),oe=m("info-circle-outlined"),se=m("a-table"),U=m("a-descriptions-item"),ie=m("a-descriptions");return s(),d("div",be,[I("div",fe,[I("div",ye,[I("div",ke,[o(le,{layout:"inline",model:a},{default:l(()=>[o(u,{label:e.$t("financial.bills.billNo")},{default:l(()=>[o(y,{value:a.billNo,"onUpdate:value":n[0]||(n[0]=t=>a.billNo=t),placeholder:e.$t("financial.bills.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(u,{label:e.$t("financial.bills.billType")},{default:l(()=>[o(S,{value:a.billType,"onUpdate:value":n[1]||(n[1]=t=>a.billType=t),placeholder:e.$t("financial.bills.billTypePlaceholder"),style:{width:"120px"},"allow-clear":""},{default:l(()=>[(s(!0),d(k,null,M(V.value,t=>(s(),h(v,{key:t.value,value:t.value},{default:l(()=>[p(r(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(u,{label:e.$t("financial.bills.settlementStatus")},{default:l(()=>[o(S,{value:a.settlementStatus,"onUpdate:value":n[2]||(n[2]=t=>a.settlementStatus=t),placeholder:e.$t("financial.bills.settlementStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:l(()=>[(s(!0),d(k,null,M(L.value,t=>(s(),h(v,{key:t.value,value:t.value},{default:l(()=>[p(r(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(u,{label:e.$t("financial.bills.createTime")},{default:l(()=>[o(ee,{value:a.timeRange,"onUpdate:value":n[3]||(n[3]=t=>a.timeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),o(u,{label:e.$t("financial.bills.relatedTaskName")},{default:l(()=>[o(y,{value:a.taskName,"onUpdate:value":n[4]||(n[4]=t=>a.taskName=t),placeholder:e.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(u,{label:e.$t("financial.bills.memberNickname")},{default:l(()=>[o(y,{value:a.keyword,"onUpdate:value":n[5]||(n[5]=t=>a.keyword=t),placeholder:e.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(u,{label:e.$t("financial.bills.relatedGroupName")},{default:l(()=>[o(S,{value:a.relatedGroupId,"onUpdate:value":n[6]||(n[6]=t=>a.relatedGroupId=t),placeholder:e.$t("financial.bills.relatedGroupNamePlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:H},{default:l(()=>[(s(!0),d(k,null,M(E.value,t=>(s(),h(v,{key:t.id,value:t.id},{default:l(()=>[p(r(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(u,null,{default:l(()=>[o(ae,null,{default:l(()=>[o($,{type:"primary",onClick:x},{default:l(()=>[p(r(e.$t("common.search")),1)]),_:1}),o($,{onClick:J},{default:l(()=>[p(r(e.$t("common.reset")),1)]),_:1}),o($,{onClick:Z},{icon:l(()=>[o(te)]),default:l(()=>[p(" "+r(e.$t("common.export")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),o(se,{columns:W.value,"data-source":O.value,loading:w.value,pagination:f,onChange:K},{bodyCell:l(({column:t,record:i})=>[t.key==="memberNickname"?(s(),h(B,{key:0,onClick:P=>Q(i)},{default:l(()=>[p(r(i.memberNickname),1)]),_:2},1032,["onClick"])):b("",!0),t.key==="taskName"?(s(),d(k,{key:1},[i.taskName?(s(),h(B,{key:0,onClick:P=>X(i)},{default:l(()=>[p(r(i.taskName),1)]),_:2},1032,["onClick"])):(s(),d("span",_e,"--"))],64)):b("",!0),t.key==="relatedGroupName"?(s(),d(k,{key:2},[p(r(i.relatedGroupName||"--"),1)],64)):b("",!0),t.key==="billType"?(s(),d(k,{key:3},[p(r(Y(_).getEnumText("BillType",i.billType)),1)],64)):b("",!0),t.key==="amount"?(s(),d(k,{key:4},[i.billType==="reward_deduction"?(s(),h(ne,{key:0,type:"danger"},{default:l(()=>[p(" - "+r(i.amount),1)]),_:2},1024)):(s(),d("span",he,r(i.amount),1))],64)):b("",!0),t.key==="remark"?(s(),d("div",ve,[i.remark?(s(),d("span",ge,r(i.remark)+"("+r(e.$t("financial.bills.operator"))+": "+r(i.waiterName)+")",1)):(s(),d("span",Ne,"--"))])):b("",!0),t.key==="settlementStatus"?(s(),d(k,{key:6},[i.billType==="withdrawal"?(s(),d("span",we,r(Y(_).getEnumText("WithdrawalStatus",i.withdrawalStatus)),1)):(s(),d("span",Te,r(Y(_).getEnumText("SettlementStatus",i.settlementStatus)),1)),i.settlementStatus==="failed"||i.withdrawalStatus==="failed"?(s(),h(oe,{key:2,class:"status-icon",onClick:P=>q(i)},null,8,["onClick"])):b("",!0)],64)):b("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),f.total?(s(),d("div",Se,[o(ie,{column:2},{default:l(()=>[o(U,{label:e.$t("common.totalCount")},{default:l(()=>[p(r(f.total),1)]),_:1},8,["label"]),o(U,{label:e.$t("common.totalAmount")},{default:l(()=>[p(r(R.value),1)]),_:1},8,["label"])]),_:1})])):b("",!0)])])}}},Ye=re($e,[["__scopeId","data-v-4f466bd2"]]);export{Ye as default};
