import{_ as Y,r as N,a as Z,b as ee,c as I,j as V,k as te,d as c,e as m,f as s,w as t,g as r,l as j,m as g,h as ae,o as i,F as S,n as q,p as b,i as k,t as n,q as z,P as se,s as C,v as ne}from"./index-DzzIDgkI.js";const le={class:"task content-container"},oe={class:"table-container"},ie={class:"table-header"},re={class:"left"},de={class:"right"},ue={key:0},ce={key:1},me=["onClick"],ke={class:"danger"},pe={__name:"list",setup(_e){const w=ae(),$=N(!1),_=Z(),{t:d}=ee(),l=I({taskName:"",channelId:void 0,taskStatus:void 0}),O=N([]),Q=V(()=>_.loaded?_.getEnumOptions("TaskStatus"):[]),R=V(()=>[{title:d("task.list.name"),key:"taskName"},{title:d("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:e})=>_.getEnumText("TaskStatus",e)},{title:d("task.list.quota"),key:"taskQuota"},{title:d("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:d("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0},{title:d("task.list.action"),key:"action",fixed:"right",width:180}]),E=N([]),p=I({current:1,pageSize:10,total:0}),F=I({sorterField:"startTime",sorterOrder:"ascend"}),P=()=>{p.current=1,h()},U=()=>{l.taskName="",l.channelId=void 0,l.taskStatus=void 0,P()},A=(e,o,f)=>{Object.assign(p,e),Object.assign(F,{sorterField:f.field,sorterOrder:f.order}),h()},L=()=>{w.push("/task/create")},M=e=>{w.push(`/task/edit/${e.id}`)},x=async e=>{try{const o=await ne("task.delete",{},{urlParams:{id:e.id}});o.code===0?(g.success(d("common.deleteSuccess")),h()):g.error(o.message)}catch{g.error(d("common.deleteFailed"))}},h=async()=>{$.value=!0;try{const e=await j("task.list",{page:p.current,pageSize:p.pageSize,...F,...l});e.code===0?(E.value=e.data.list,p.total=e.data.total):g.error(e.message)}finally{$.value=!1}},G=async()=>{const e=await j("channel.list");e.code===0&&(O.value=e.data.list)};return te(async()=>{h(),G()}),(e,o)=>{const f=r("a-input"),v=r("a-form-item"),B=r("a-select-option"),D=r("a-select"),T=r("a-button"),y=r("a-space"),H=r("a-form"),J=r("a-avatar"),K=r("a-popconfirm"),W=r("a-table");return i(),c("div",le,[m("div",oe,[m("div",ie,[m("div",re,[s(H,{layout:"inline",model:l},{default:t(()=>[s(v,{label:e.$t("task.search.taskName")},{default:t(()=>[s(f,{value:l.taskName,"onUpdate:value":o[0]||(o[0]=a=>l.taskName=a),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(v,{label:e.$t("task.search.channelId")},{default:t(()=>[s(D,{value:l.channelId,"onUpdate:value":o[1]||(o[1]=a=>l.channelId=a),placeholder:e.$t("task.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(i(!0),c(S,null,q(O.value,a=>(i(),b(B,{key:a.id,value:a.id},{default:t(()=>[k(n(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(v,{label:e.$t("task.search.taskStatus")},{default:t(()=>[s(D,{value:l.taskStatus,"onUpdate:value":o[2]||(o[2]=a=>l.taskStatus=a),placeholder:e.$t("task.search.statusPlaceholder"),allowClear:""},{default:t(()=>[(i(!0),c(S,null,q(Q.value,a=>(i(),b(B,{key:a.value,value:a.value},{default:t(()=>[k(n(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(v,null,{default:t(()=>[s(y,null,{default:t(()=>[s(T,{type:"primary",onClick:P},{default:t(()=>[k(n(e.$t("common.search")),1)]),_:1}),s(T,{onClick:U},{default:t(()=>[k(n(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),m("div",de,[s(y,null,{default:t(()=>[s(T,{type:"primary",onClick:L},{icon:t(()=>[s(z(se))]),default:t(()=>[k(" "+n(e.$t("task.list.create")),1)]),_:1})]),_:1})])]),s(W,{columns:R.value,"data-source":E.value,loading:$.value,pagination:p,onChange:A},{bodyCell:t(({column:a,record:u})=>[a.key==="taskName"?(i(),b(y,{key:0},{default:t(()=>[s(J,{src:u.channelIcon},null,8,["src"]),k(" "+n(u.taskName),1)]),_:2},1024)):C("",!0),a.key==="taskQuota"?(i(),c(S,{key:1},[u.unlimitedQuota?(i(),c("span",ue,n(e.$t("task.list.unlimited")),1)):(i(),c("span",ce,n(u.quota),1)),m("span",null," / "+n(u.submittedCount),1)],64)):C("",!0),a.key==="taskStatus"?(i(),c(S,{key:2},[k(n(z(_).getEnumText("TaskStatus",u.taskStatus)),1)],64)):C("",!0),a.key==="action"?(i(),b(y,{key:3},{default:t(()=>[m("a",{onClick:X=>M(u)},n(e.$t("task.list.edit")),9,me),s(K,{title:e.$t("task.list.deleteConfirm"),onConfirm:X=>x(u)},{default:t(()=>[m("a",ke,n(e.$t("task.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},fe=Y(pe,[["__scopeId","data-v-d553282c"]]);export{fe as default};
