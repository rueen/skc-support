import{r as C,a as se,b as le,c as O,j as q,k as ne,d as p,e as k,f as s,w as a,g as u,l as P,m as $,h as oe,o,F as h,n as E,p as _,i,t as n,q as Q,P as ue,s as v,v as re}from"./index-CceWYLl8.js";const de={class:"content-container"},ie={class:"table-container"},ce={class:"table-header"},pe={class:"left"},ke={class:"right"},me={key:0},_e={key:1},fe=["onClick"],he=["onClick"],ge={__name:"list",setup(ve){const N=oe(),T=C(!1),y=se(),{t:c}=le(),r=O({taskName:"",channelId:void 0,taskStatus:void 0,taskGroupId:void 0}),F=C([]),j=C([]),R=q(()=>y.loaded?y.getEnumOptions("TaskStatus"):[]),A=q(()=>[{title:c("task.list.name"),key:"taskName"},{title:c("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:e})=>y.getEnumText("TaskStatus",e)},{title:c("task.list.quota"),key:"taskQuota"},{title:c("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:c("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0},{title:c("task.list.action"),key:"action"}]),z=C([]),m=O({current:1,pageSize:10,total:0}),B=O({sorterField:void 0,sorterOrder:void 0}),D=()=>{m.current=1,g()},L=()=>{Object.assign(r,{taskName:"",channelId:void 0,taskStatus:void 0,taskGroupId:void 0}),D()},M=(e,l,S)=>{Object.assign(m,e),Object.assign(B,{sorterField:S.field,sorterOrder:S.order}),g()},H=()=>{N.push("/task/create")},J=e=>{N.push(`/task/edit/${e.id}`)},K=e=>{N.push(`/task/copy/${e.id}`)},W=async e=>{try{const l=await re("task.delete",{},{urlParams:{id:e.id}});l.code===0?($.success(c("common.deleteSuccess")),g()):$.error(l.message)}catch{$.error(c("common.deleteFailed"))}},g=async()=>{T.value=!0;try{const e=await P("task.list",{page:m.current,pageSize:m.pageSize,...B,...r});e.code===0?(z.value=e.data.list,m.total=e.data.total):$.error(e.message)}finally{T.value=!1}},X=async()=>{const e=await P("channel.list");e.code===0&&(F.value=e.data.list)},U=async(e="")=>{const l=await P("taskGroup.list",{page:1,pageSize:50,taskGroupName:e});l.code===0&&(j.value=l.data.list||[])};return ne(async()=>{g(),X(),U()}),(e,l)=>{const S=u("a-input"),f=u("a-form-item"),I=u("a-select-option"),G=u("a-select"),w=u("a-button"),b=u("a-space"),Y=u("a-form"),Z=u("a-avatar"),x=u("a-tag"),ee=u("a-typography-text"),te=u("a-popconfirm"),ae=u("a-table");return o(),p("div",de,[k("div",ie,[k("div",ce,[k("div",pe,[s(Y,{layout:"inline",model:r},{default:a(()=>[s(f,{label:e.$t("task.search.taskName")},{default:a(()=>[s(S,{value:r.taskName,"onUpdate:value":l[0]||(l[0]=t=>r.taskName=t),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.channelId")},{default:a(()=>[s(G,{value:r.channelId,"onUpdate:value":l[1]||(l[1]=t=>r.channelId=t),placeholder:e.$t("common.selectPlaceholder"),"allow-clear":""},{default:a(()=>[(o(!0),p(h,null,E(F.value,t=>(o(),_(I,{key:t.id,value:t.id},{default:a(()=>[i(n(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.taskStatus")},{default:a(()=>[s(G,{value:r.taskStatus,"onUpdate:value":l[2]||(l[2]=t=>r.taskStatus=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:""},{default:a(()=>[(o(!0),p(h,null,E(R.value,t=>(o(),_(I,{key:t.value,value:t.value},{default:a(()=>[i(n(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,{label:e.$t("task.search.taskGroup")},{default:a(()=>[s(G,{value:r.taskGroupId,"onUpdate:value":l[3]||(l[3]=t=>r.taskGroupId=t),placeholder:e.$t("common.selectPlaceholder"),allowClear:"","show-search":"","filter-option":!1,onSearch:U},{default:a(()=>[(o(!0),p(h,null,E(j.value,t=>(o(),_(I,{key:t.id,value:t.id},{default:a(()=>[i(n(t.taskGroupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(f,null,{default:a(()=>[s(b,null,{default:a(()=>[s(w,{type:"primary",onClick:D},{default:a(()=>[i(n(e.$t("common.search")),1)]),_:1}),s(w,{onClick:L},{default:a(()=>[i(n(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),k("div",ke,[s(b,null,{default:a(()=>[s(w,{type:"primary",onClick:H},{icon:a(()=>[s(Q(ue))]),default:a(()=>[i(" "+n(e.$t("task.list.create")),1)]),_:1})]),_:1})])]),s(ae,{columns:A.value,"data-source":z.value,loading:T.value,pagination:m,showSorterTooltip:!1,onChange:M},{bodyCell:a(({column:t,record:d})=>[t.key==="taskName"?(o(),_(b,{key:0},{default:a(()=>[s(Z,{src:d.channelIcon},null,8,["src"]),i(" "+n(d.taskName)+" ",1),d.taskGroup?(o(),_(x,{key:0,color:"orange"},{default:a(()=>[i(n(d.taskGroup.taskGroupName),1)]),_:2},1024)):v("",!0)]),_:2},1024)):v("",!0),t.key==="taskQuota"?(o(),p(h,{key:1},[d.unlimitedQuota?(o(),p("span",me,n(e.$t("task.list.unlimited")),1)):(o(),p("span",_e,n(d.quota),1)),k("span",null," / "+n(d.submittedCount),1)],64)):v("",!0),t.key==="taskStatus"?(o(),p(h,{key:2},[i(n(Q(y).getEnumText("TaskStatus",d.taskStatus)),1)],64)):v("",!0),t.key==="action"?(o(),_(b,{key:3},{default:a(()=>[k("a",{onClick:V=>J(d)},n(e.$t("task.list.edit")),9,fe),k("a",{onClick:V=>K(d)},n(e.$t("task.list.copy")),9,he),s(te,{title:e.$t("task.list.deleteConfirm"),onConfirm:V=>W(d)},{default:a(()=>[k("a",null,[s(ee,{type:"danger"},{default:a(()=>[i(n(e.$t("task.list.delete")),1)]),_:1})])]),_:2},1032,["title","onConfirm"])]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}};export{ge as default};
