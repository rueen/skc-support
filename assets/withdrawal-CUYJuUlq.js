import{_ as ue,b as we,a as me,j as E,r as k,c as L,k as he,d as g,e as y,f as a,w as t,g as i,l as pe,m as d,h as ve,o as m,F as $,n as _e,p as R,i as h,t as s,q as O,s as p,M as P,A as V}from"./index-ChGVr3Iu.js";import{d as fe}from"./download-B1womGns.js";const ke={class:"withdrawal content-container"},ge={class:"table-container"},ye={class:"table-header"},be={class:"left"},Ne={class:"right"},Ce=["onClick"],Se=["onClick"],$e={__name:"withdrawal",setup(Re){const{t:c}=we(),j=ve(),T=me(),x=E(()=>T.loaded?T.getEnumOptions("WithdrawalStatus"):[]),D=k(!1),b=k(!1),I=k(!1),v=k(""),o=L({billNo:"",memberNickname:"",withdrawalStatus:"pending",timeRange:[]}),A=E(()=>[{title:c("withdrawal.list.billNo"),dataIndex:"billNo",key:"billNo"},{title:c("withdrawal.list.memberNickname"),key:"nickname"},{title:c("withdrawal.list.withdrawalAccount"),dataIndex:"account",key:"account"},{title:c("withdrawal.list.accountType"),dataIndex:"paymentChannelName",key:"paymentChannelName"},{title:c("withdrawal.list.applyWithdrawalAmount"),dataIndex:"amount",key:"amount",align:"right"},{title:c("withdrawal.list.name"),dataIndex:"withdrawalName",key:"withdrawalName"},{title:c("withdrawal.list.applyTime"),dataIndex:"createTime",key:"createTime"},{title:c("withdrawal.list.withdrawalStatus"),key:"withdrawalStatus"},{title:c("withdrawal.list.operator"),key:"waiterName"},{title:c("withdrawal.list.action"),key:"action",width:150}]),u=k([]),F={selectedRowKeys:u,onChange:e=>{u.value=e},getCheckboxProps:e=>({disabled:e.withdrawalStatus!=="pending"})},Y=k([]),_=L({current:1,pageSize:10,total:0}),B=()=>{_.current=1,N()},W=()=>{Object.assign(o,{billNo:"",memberNickname:"",withdrawalStatus:void 0,timeRange:[]}),B()},z=e=>{Object.assign(_,e),N()},K=()=>{P.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{const e=d.loading("正在导出数据，请稍候...",0),n={...o};try{await fe("withdrawals.export",n,`提现列表_${new Date().toLocaleDateString()}.xlsx`),d.success("导出成功")}catch(f){console.error("导出失败:",f),d.error("导出失败，请稍后重试")}finally{e()}}})},q=e=>{j.push(`/member/view/${e.memberId}`)},G=e=>{P.error({content:e.rejectReason})},J=async e=>{u.value=[e.id],H()},H=async()=>{if(!u.value.length){d.warning("请选择要操作的记录");return}const e=await V("withdrawals.batchResolve",{ids:u.value});e.code===0?(d.success("操作成功"),u.value=[],N()):d.error(e.message)},Q=e=>{u.value=[e.id],v.value="",b.value=!0},X=()=>{if(!u.value.length){d.warning("请选择要操作的记录");return}v.value="",b.value=!0},Z=async()=>{if(!v.value){d.error("请输入打款失败原因");return}I.value=!0;const e=await V("withdrawals.batchReject",{rejectReason:v.value,ids:u.value});I.value=!1,e.code===0?(d.success("操作成功"),b.value=!1,u.value=[],N()):d.error(e.message)},N=async()=>{var e,n;D.value=!0;try{const f={page:_.current,pageSize:_.pageSize,billNo:o.billNo,memberNickname:o.memberNickname,withdrawalStatus:o.withdrawalStatus,startTime:(e=o.timeRange)==null?void 0:e[0],endTime:(n=o.timeRange)==null?void 0:n[1]},w=await pe("withdrawals.list",{...f});w.code===0?(Y.value=w.data.list||[],_.total=w.data.total||0):d.error(w.message)}finally{D.value=!1}};return he(()=>{N()}),(e,n)=>{const f=i("a-input"),w=i("a-form-item"),ee=i("a-select-option"),ae=i("a-select"),te=i("a-range-picker"),C=i("a-button"),M=i("a-space"),le=i("a-form"),ne=i("RightOutlined"),U=i("a-typography-link"),oe=i("download-outlined"),ie=i("info-circle-outlined"),se=i("a-popconfirm"),re=i("a-table"),de=i("a-textarea"),ce=i("a-modal");return m(),g("div",ke,[y("div",ge,[y("div",ye,[y("div",be,[a(le,{layout:"inline",model:o},{default:t(()=>[a(w,{label:e.$t("withdrawal.list.billNo")},{default:t(()=>[a(f,{value:o.billNo,"onUpdate:value":n[0]||(n[0]=l=>o.billNo=l),placeholder:e.$t("withdrawal.list.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(w,{label:e.$t("withdrawal.list.memberNickname")},{default:t(()=>[a(f,{value:o.memberNickname,"onUpdate:value":n[1]||(n[1]=l=>o.memberNickname=l),placeholder:e.$t("withdrawal.list.memberNicknamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(w,{label:e.$t("withdrawal.list.withdrawalStatus")},{default:t(()=>[a(ae,{value:o.withdrawalStatus,"onUpdate:value":n[2]||(n[2]=l=>o.withdrawalStatus=l),placeholder:e.$t("withdrawal.list.withdrawalStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:t(()=>[(m(!0),g($,null,_e(x.value,l=>(m(),R(ee,{key:l.value,value:l.value},{default:t(()=>[h(s(l.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(w,{label:e.$t("withdrawal.list.applyTime")},{default:t(()=>[a(te,{value:o.timeRange,"onUpdate:value":n[3]||(n[3]=l=>o.timeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),a(w,null,{default:t(()=>[a(M,null,{default:t(()=>[a(C,{type:"primary",onClick:B},{default:t(()=>[h(s(e.$t("common.search")),1)]),_:1}),a(C,{onClick:W},{default:t(()=>[h(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),y("div",Ne,[a(M,null,{default:t(()=>[a(U,{onClick:n[4]||(n[4]=l=>O(j).push("/payment-transactions"))},{default:t(()=>[h(s(e.$t("withdrawal.list.viewWithdrawalTransactions")),1),a(ne)]),_:1}),a(C,{onClick:K},{icon:t(()=>[a(oe)]),default:t(()=>[h(" "+s(e.$t("withdrawal.list.export")),1)]),_:1}),a(C,{type:"primary",onClick:H},{default:t(()=>[h(s(e.$t("withdrawal.list.batchResolve")),1)]),_:1}),a(C,{danger:"",onClick:X},{default:t(()=>[h(s(e.$t("withdrawal.list.batchReject")),1)]),_:1})]),_:1})])]),a(re,{columns:A.value,"data-source":Y.value,loading:D.value,pagination:_,rowKey:"id","row-selection":F,onChange:z},{bodyCell:t(({column:l,record:r})=>[l.key==="nickname"?(m(),R(U,{key:0,onClick:S=>q(r)},{default:t(()=>[h(s(r.nickname),1)]),_:2},1032,["onClick"])):p("",!0),l.key==="withdrawalStatus"?(m(),g($,{key:1},[h(s(O(T).getEnumText("WithdrawalStatus",r.withdrawalStatus))+" ",1),r.withdrawalStatus==="failed"?(m(),R(ie,{key:0,class:"danger",onClick:S=>G(r)},null,8,["onClick"])):p("",!0)],64)):p("",!0),l.key==="waiterName"?(m(),g($,{key:2},[h(s(r.waiterName||"--"),1)],64)):p("",!0),l.key==="action"?(m(),g($,{key:3},[r.withdrawalStatus==="pending"?(m(),R(M,{key:0},{default:t(()=>[a(se,{title:e.$t("withdrawal.list.resolveConfirm"),onConfirm:S=>J(r)},{default:t(()=>[y("a",null,s(e.$t("withdrawal.list.resolve")),1)]),_:2},1032,["title","onConfirm"]),y("a",{class:"danger",onClick:S=>Q(r)},s(e.$t("withdrawal.list.reject")),9,Ce)]),_:2},1024)):p("",!0),r.withdrawalStatus==="failed"?(m(),g("a",{key:1,onClick:S=>O(j).push(`/payment-transactions?withdrawalId=${r.id}`)},"查看交易记录",8,Se)):p("",!0)],64)):p("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),a(ce,{open:b.value,"onUpdate:open":n[6]||(n[6]=l=>b.value=l),title:e.$t("withdrawal.list.rejectTitle"),onOk:Z,confirmLoading:I.value},{default:t(()=>[a(de,{value:v.value,"onUpdate:value":n[5]||(n[5]=l=>v.value=l),placeholder:e.$t("withdrawal.list.rejectPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},De=ue($e,[["__scopeId","data-v-f3c2d725"]]);export{De as default};
