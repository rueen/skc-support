import{_ as Te,b as Ie,a as Oe,r as v,c as L,j as Le,C as Ae,k as Re,x as Se,d as w,f as t,e as i,t as l,w as a,g as r,F as N,n as Q,l as _,h as Pe,o as d,p as y,s as f,i as m,q as z,M as Be,v as Ue,m as g,A as X}from"./index-kjD6dEwq.js";import{P as De}from"./PageHeader-idpqrkaO.js";import{_ as F}from"./CopyContent-Cm2g9eXR.js";import{G as Ee}from"./GroupOwner-CnYskeAT.js";const Ne={class:"member-view content-container"},ze={class:"detail-container"},Fe={class:"section"},Me={class:"section-title"},Ge={key:0},Ve={key:0},je={class:"section"},qe={class:"section-title"},He={class:"account-list"},We={class:"link-text-container",style:{"max-width":"300px"}},Je=["href"],Ke={class:"section",style:{"padding-bottom":"24px"}},Qe={class:"section-title"},Xe={class:"section",style:{"padding-bottom":"24px"}},Ye={class:"section-title"},Ze={class:"section"},xe={class:"section-title"},et={key:1},tt={__name:"view",setup(at){const{t:p}=Ie(),A=Oe(),Y=Se(),Z=Pe(),c=v(""),s=L({}),M=v([]),x=Le(()=>`${Ae.h5Url}?inviteCode=${s.inviteCode}`),R=L({}),S=L({}),P=L({}),G=v(),h=v(!1),I=v("grant"),b=L({amount:"",remark:""}),O=v(!1),ee=v({amount:[{required:!0,message:p("member.view.amountRequired")}],remark:[{required:!0,message:p("member.view.remarkRequired")}]}),te=async()=>{const e=await _("member.detail",{},{urlParams:{id:c.value}});e.code===0&&Object.assign(s,e.data||{})},B=async()=>{const e=await _("member.balance",{},{urlParams:{memberId:c.value}});e.code===0&&(s.balance=e.data.balance)},ae=async()=>{const e=await _("member.withdrawalsAccount",{},{urlParams:{memberId:c.value}});e.code===0&&(s.withdrawalsAccount=e.data[0]||{})},V=async()=>{const e=await _("account.list",{memberId:c.value});e.code===0&&(M.value=e.data.list||[])},ne=e=>{Z.push({name:"AccountEdit",params:{id:e.id}})},le=e=>{Be.confirm({content:p("common.deleteConfirm"),onOk:async()=>{const o=await Ue("account.delete",{},{urlParams:{id:e.id}});o.code===0?(g.success(o.message),V()):g.error(o.message)}})},se=async()=>{const e=await _("member.taskStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(R,e.data||{})},oe=async()=>{const e=await _("member.inviteStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(S,e.data||{})},re=async()=>{const e=await _("member.groupsStats",{},{urlParams:{memberId:c.value}});e.code===0&&Object.assign(P,e.data||{})},ie=()=>{h.value=!0,I.value="grant"},ue=()=>{h.value=!0,I.value="deduct"},U=v(!1),me=v([{title:p("member.view.balanceLogs.beforeBalance"),dataIndex:"beforeBalance",key:"beforeBalance",width:120},{title:p("member.view.balanceLogs.amount"),dataIndex:"amount",key:"amount",width:120},{title:p("member.view.balanceLogs.afterBalance"),dataIndex:"afterBalance",key:"afterBalance",width:120},{title:p("member.view.balanceLogs.transactionType"),key:"transactionType"},{title:p("member.view.balanceLogs.createTime"),dataIndex:"createTime",key:"createTime"}]),j=v([]),de=async()=>{U.value=!0;const e=await _("member.balanceLogs",{pageSize:3e3,pageNum:1},{urlParams:{memberId:c.value}});e.code===0&&(j.value=e.data.list||[])},ce=async()=>{O.value=!0;try{const e=await X("member.grantReward",{memberId:c.value,amount:b.amount,remark:b.remark});e.code===0?(g.success("奖励发放成功"),h.value=!1,B()):g.error(e.message)}catch{g.error("奖励发放失败")}finally{O.value=!1}},ve=async()=>{O.value=!0;try{const e=await X("member.deductReward",{memberId:c.value,amount:b.amount,remark:b.remark},{urlParams:{memberId:c.value}});e.code===0?(g.success("奖励扣除成功"),h.value=!1,B()):g.error(e.message)}catch{g.error("奖励扣除失败")}finally{O.value=!1}},be=async()=>{try{switch(await G.value.validate(),I.value){case"grant":ce();break;case"deduct":ve();break}}catch(e){console.log(e)}};return Re(()=>{c.value=Y.params.id,te(),B(),V(),se(),oe(),re(),ae()}),(e,o)=>{const pe=r("UserOutlined"),q=r("a-avatar"),H=r("a-tag"),$=r("a-space"),u=r("a-descriptions-item"),D=r("a-button"),we=r("PlusOutlined"),_e=r("MinusOutlined"),W=r("a-descriptions"),fe=r("EditOutlined"),ge=r("DeleteOutlined"),C=r("a-statistic"),T=r("a-col"),E=r("a-row"),ke=r("a-input"),J=r("a-form-item"),ye=r("a-textarea"),he=r("a-form"),K=r("a-modal"),$e=r("a-typography-text"),Ce=r("a-table");return d(),w("div",Ne,[t(De,{title:e.$t("member.view.pageTitle"),back:!0},null,8,["title"]),i("div",ze,[i("div",Fe,[i("div",Me,l(e.$t("member.view.memberInfo")),1),t(W,{column:2},{default:a(()=>[t(u,{label:e.$t("member.view.memberNickname")},{default:a(()=>[t($,null,{default:a(()=>[t(q,{src:s.avatar,size:"small"},{icon:a(()=>[t(pe)]),_:1},8,["src"]),i("span",null,l(s.nickname),1),s.isNew?(d(),y(H,{key:0,color:"green"},{default:a(()=>o[7]||(o[7]=[m("new")])),_:1})):f("",!0)]),_:1})]),_:1},8,["label"]),t(u,{label:e.$t("member.view.memberAccount")},{default:a(()=>[m(l(s.account),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.gender")},{default:a(()=>[m(l(z(A).getEnumText("GenderType",s.gender)),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.occupation")},{default:a(()=>[m(l(z(A).getEnumText("OccupationType",s.occupation))+" ",1),s.occupation===null?(d(),w("span",Ge," - ")):f("",!0)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.email")},{default:a(()=>[m(l(s.email||"-"),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.phone")},{default:a(()=>[m(l(s.phone||"-"),1)]),_:1},8,["label"]),t(u,{label:"Telegram"},{default:a(()=>[m(l(s.telegram||"-"),1)]),_:1}),t(u,{label:e.$t("member.view.group")},{default:a(()=>[(d(!0),w(N,null,Q(s.groups,n=>(d(),y($,{key:n.id},{default:a(()=>[m(l(n.groupName)+" ",1),n.isOwner?(d(),y(Ee,{key:0})):f("",!0)]),_:2},1024))),128)),!s.groups||!s.groups.length?(d(),w("span",Ve," - ")):f("",!0)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.inviter")},{default:a(()=>[m(l(s.inviterNickname||"-"),1)]),_:1},8,["label"]),t(u,{label:e.$t("member.view.inviteUrl")},{default:a(()=>[t(F,{content:x.value},null,8,["content"])]),_:1},8,["label"]),t(u,{label:e.$t("member.view.withdrawalsAccount")},{default:a(()=>[t($,null,{default:a(()=>{var n,k;return[i("span",null,l(((n=s==null?void 0:s.withdrawalsAccount)==null?void 0:n.paymentChannelName)||"-"),1),i("span",null,l(((k=s==null?void 0:s.withdrawalsAccount)==null?void 0:k.account)||"-"),1)]}),_:1})]),_:1},8,["label"]),t(u,{label:e.$t("member.view.balance")},{default:a(()=>[t($,{size:16},{default:a(()=>[i("span",null,l(s.balance),1),t(D,{type:"link",size:"small",onClick:o[0]||(o[0]=n=>de())},{default:a(()=>[m(l(e.$t("member.view.balanceLogs.view")),1)]),_:1}),t(D,{type:"primary",size:"small",onClick:o[1]||(o[1]=n=>ie())},{default:a(()=>[t(we),m(" "+l(e.$t("member.view.rewardGrant")),1)]),_:1}),t(D,{size:"small",danger:"",onClick:o[2]||(o[2]=n=>ue())},{default:a(()=>[t(_e),m(" "+l(e.$t("member.view.rewardDeduct")),1)]),_:1})]),_:1})]),_:1},8,["label"])]),_:1})]),i("div",je,[i("div",qe,l(e.$t("member.view.accountInfo")),1),i("div",He,[(d(!0),w(N,null,Q(M.value,n=>(d(),w("div",{key:n.channelId},[t(W,{column:1},{default:a(()=>[t(u,{label:e.$t("member.view.account")},{default:a(()=>[t($,{size:24},{default:a(()=>[t($,null,{default:a(()=>[t(q,{src:n.channelIcon,size:"small"},null,8,["src"]),i("span",null,l(n.account),1),t(H,{color:"warning"},{default:a(()=>[m(l(z(A).getEnumText("AccountAuditStatus",n.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024),t(fe,{onClick:k=>ne(n)},null,8,["onClick"]),t(ge,{onClick:k=>le(n)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["label"]),t(u,{label:e.$t("member.view.homepage")},{default:a(()=>[t(F,{content:n.homeUrl},{default:a(()=>[i("div",We,[i("a",{href:n.homeUrl,target:"_blank",class:"link-text"},l(n.homeUrl),9,Je)])]),_:2},1032,["content"])]),_:2},1032,["label"]),t(u,{label:"uid"},{default:a(()=>[t(F,{content:n.uid},null,8,["content"])]),_:2},1024),n.channelCustomFields.includes("fansCount")?(d(),y(u,{key:0,label:e.$t("member.view.fansCount")},{default:a(()=>[m(l(n.fansCount),1)]),_:2},1032,["label"])):f("",!0),n.channelCustomFields.includes("friendsCount")?(d(),y(u,{key:1,label:e.$t("member.view.friendsCount")},{default:a(()=>[m(l(n.friendsCount),1)]),_:2},1032,["label"])):f("",!0),n.channelCustomFields.includes("postsCount")?(d(),y(u,{key:2,label:e.$t("member.view.postsCount")},{default:a(()=>[m(l(n.postsCount),1)]),_:2},1032,["label"])):f("",!0)]),_:2},1024)]))),128))])]),i("div",Ke,[i("div",Qe,l(e.$t("member.view.taskStats")),1),t(E,{gutter:16},{default:a(()=>[t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.completedTaskCount"),value:R.completedTaskCount},null,8,["title","value"])]),_:1}),t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.taskReward"),value:R.totalTaskReward,precision:2},null,8,["title","value"])]),_:1})]),_:1})]),i("div",Xe,[i("div",Ye,l(e.$t("member.view.inviteStats")),1),t(E,null,{default:a(()=>[t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.inviteCount"),value:S.inviteCount},null,8,["title","value"])]),_:1}),t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.inviteReward"),value:S.totalReward},null,8,["title","value"])]),_:1})]),_:1})]),i("div",Ze,[i("div",xe,l(e.$t("member.view.groupStats")),1),t(E,null,{default:a(()=>[t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.groupCount"),value:P.groupCount},null,8,["title","value"])]),_:1}),t(T,{span:6},{default:a(()=>[t(C,{title:e.$t("member.view.groupEarnings"),value:P.totalCommission},null,8,["title","value"])]),_:1})]),_:1})])]),t(K,{open:h.value,"onUpdate:open":o[5]||(o[5]=n=>h.value=n),title:I.value==="grant"?e.$t("member.view.rewardGrant"):e.$t("member.view.rewardDeduct"),onOk:be,confirmLoading:O.value},{default:a(()=>[t(he,{ref_key:"rewardFormRef",ref:G,model:b,rules:ee.value,"label-col":{span:7},"wrapper-col":{span:16}},{default:a(()=>[t(J,{label:I.value==="grant"?e.$t("member.view.rewardAmount"):e.$t("member.view.deductAmount"),name:"amount"},{default:a(()=>[t(ke,{value:b.amount,"onUpdate:value":o[3]||(o[3]=n=>b.amount=n)},null,8,["value"])]),_:1},8,["label"]),t(J,{label:e.$t("member.view.remark"),name:"remark"},{default:a(()=>[t(ye,{value:b.remark,"onUpdate:value":o[4]||(o[4]=n=>b.remark=n),rows:4},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["open","title","confirmLoading"]),t(K,{open:U.value,"onUpdate:open":o[6]||(o[6]=n=>U.value=n),title:e.$t("member.view.balanceLogs.title"),width:800},{default:a(()=>[t(Ce,{size:"small",columns:me.value,"data-source":j.value,pagination:!1,scroll:{y:400}},{bodyCell:a(({column:n,record:k})=>[n.key==="transactionType"?(d(),w(N,{key:0},[k.transactionType==="withdrawal_refund"?(d(),y($e,{key:0,type:"danger"},{default:a(()=>o[8]||(o[8]=[m("余额退还")])),_:1})):(d(),w("span",et,l(k.transactionType),1))],64)):f("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["open","title"])])}}},rt=Te(tt,[["__scopeId","data-v-e6d28b33"]]);export{rt as default};
