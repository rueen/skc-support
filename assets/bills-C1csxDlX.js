import{_ as se,b as ie,a as re,j as C,r as N,c as P,k as ue,d,e as I,f as n,s as b,w as l,g as m,l as F,m as g,h as de,o,F as k,n as G,p as v,i as p,t as r,q as R,M as z}from"./index-D7FVaP0m.js";import{d as me}from"./download-BR5FZMNg.js";const ce={class:"other-bill content-container"},pe={class:"table-container"},be={class:"table-header"},ye={class:"left"},fe={key:1},ke={key:1},_e={key:5,style:{"max-width":"250px"}},ve={key:0},he={key:1},ge={key:0},Ne={key:1},we={key:0,class:"count-container"},Te={__name:"bills",setup(Se){const{t:c}=ie(),_=re(),x=de(),A=C(()=>_.loaded?_.getEnumOptions("BillType"):[]),V=C(()=>_.loaded?_.getEnumOptions("SettlementStatus"):[]),w=N(!1),a=P({billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",keyword:"",relatedGroupId:void 0}),j=e=>{z.error({title:"结算失败原因",content:e.failureReason})},L=C(()=>[{title:c("financial.bills.billNo"),dataIndex:"billNo",key:"billNo"},{title:c("financial.bills.memberNickname"),key:"memberNickname"},{title:c("financial.bills.billType"),dataIndex:"billType",key:"billType"},{title:c("financial.bills.relatedTaskName"),key:"taskName"},{title:c("financial.bills.relatedGroupName"),key:"relatedGroupName"},{title:c("financial.bills.amount"),dataIndex:"amount",key:"amount",align:"right"},{title:c("financial.bills.remark"),key:"remark"},{title:c("financial.bills.createTime"),dataIndex:"createTime",key:"createTime"},{title:c("financial.bills.settlementStatus"),key:"settlementStatus"}]),D=N([]),E=N(0),y=P({current:1,pageSize:10,total:0}),M=()=>{y.current=1,T()},q=()=>{Object.assign(a,{billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",keyword:"",relatedGroupId:void 0}),M()},W=e=>{Object.assign(y,e),T()},J=e=>{x.push(`/member/view/${e.memberId}`)},K=e=>{x.push(`/submitted-tasks/detail/${e.submittedId}?type=confirm`)},T=async()=>{var e,s;w.value=!0;try{const f={page:y.current,pageSize:y.pageSize,billNo:a.billNo,billType:a.billType,settlementStatus:a.settlementStatus,startTime:(e=a.timeRange)==null?void 0:e[0],endTime:(s=a.timeRange)==null?void 0:s[1],taskName:a.taskName,keyword:a.keyword,relatedGroupId:a.relatedGroupId},u=await F("finance.bills",{...f});u.code===0?(D.value=u.data.list,y.total=u.data.total,E.value=u.data.totalAmount):g.error(u.message)}finally{w.value=!1}},O=N([]),Y=async(e="")=>{try{const s=await F("group.list",{page:1,pageSize:50,groupName:e});s.code===0&&(O.value=s.data.list||[])}catch{g.error("获取群组列表失败")}},Q=()=>{z.confirm({title:c("common.export"),content:c("common.confirmExportContent"),onOk:async()=>{var f,u;const e=g.loading("正在导出数据，请稍候...",0),s={billNo:a.billNo,billType:a.billType,settlementStatus:a.settlementStatus,startTime:(f=a.timeRange)==null?void 0:f[0],endTime:(u=a.timeRange)==null?void 0:u[1],taskName:a.taskName,keyword:a.keyword,relatedGroupId:a.relatedGroupId};try{await me("finance.billsExport",s,`结算账单_${new Date().toLocaleDateString()}.xlsx`),g.success(c("common.exportSuccess"))}catch(h){console.error("导出失败:",h),g.error(c("common.exportFailed"))}finally{e()}}})};return ue(()=>{T(),Y()}),(e,s)=>{const f=m("a-input"),u=m("a-form-item"),h=m("a-select-option"),S=m("a-select"),X=m("a-range-picker"),$=m("a-button"),Z=m("download-outlined"),ee=m("a-space"),te=m("a-form"),B=m("a-typography-link"),ae=m("a-typography-text"),le=m("info-circle-outlined"),ne=m("a-table"),U=m("a-descriptions-item"),oe=m("a-descriptions");return o(),d("div",ce,[I("div",pe,[I("div",be,[I("div",ye,[n(te,{layout:"inline",model:a},{default:l(()=>[n(u,{label:e.$t("financial.bills.billNo")},{default:l(()=>[n(f,{value:a.billNo,"onUpdate:value":s[0]||(s[0]=t=>a.billNo=t),placeholder:e.$t("financial.bills.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("financial.bills.billType")},{default:l(()=>[n(S,{value:a.billType,"onUpdate:value":s[1]||(s[1]=t=>a.billType=t),placeholder:e.$t("financial.bills.billTypePlaceholder"),style:{width:"120px"},"allow-clear":""},{default:l(()=>[(o(!0),d(k,null,G(A.value,t=>(o(),v(h,{key:t.value,value:t.value},{default:l(()=>[p(r(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("financial.bills.settlementStatus")},{default:l(()=>[n(S,{value:a.settlementStatus,"onUpdate:value":s[2]||(s[2]=t=>a.settlementStatus=t),placeholder:e.$t("financial.bills.settlementStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:l(()=>[(o(!0),d(k,null,G(V.value,t=>(o(),v(h,{key:t.value,value:t.value},{default:l(()=>[p(r(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("financial.bills.createTime")},{default:l(()=>[n(X,{value:a.timeRange,"onUpdate:value":s[3]||(s[3]=t=>a.timeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),n(u,{label:e.$t("financial.bills.relatedTaskName")},{default:l(()=>[n(f,{value:a.taskName,"onUpdate:value":s[4]||(s[4]=t=>a.taskName=t),placeholder:e.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("financial.bills.memberNickname")},{default:l(()=>[n(f,{value:a.keyword,"onUpdate:value":s[5]||(s[5]=t=>a.keyword=t),placeholder:e.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(u,{label:e.$t("financial.bills.relatedGroupName")},{default:l(()=>[n(S,{value:a.relatedGroupId,"onUpdate:value":s[6]||(s[6]=t=>a.relatedGroupId=t),placeholder:e.$t("financial.bills.relatedGroupNamePlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:Y},{default:l(()=>[(o(!0),d(k,null,G(O.value,t=>(o(),v(h,{key:t.id,value:t.id},{default:l(()=>[p(r(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(u,null,{default:l(()=>[n(ee,null,{default:l(()=>[n($,{type:"primary",onClick:M},{default:l(()=>[p(r(e.$t("common.search")),1)]),_:1}),n($,{onClick:q},{default:l(()=>[p(r(e.$t("common.reset")),1)]),_:1}),n($,{onClick:Q},{icon:l(()=>[n(Z)]),default:l(()=>[p(" "+r(e.$t("common.export")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),n(ne,{columns:L.value,"data-source":D.value,loading:w.value,pagination:y,onChange:W},{bodyCell:l(({column:t,record:i})=>[t.key==="memberNickname"?(o(),v(B,{key:0,onClick:H=>J(i)},{default:l(()=>[p(r(i.memberNickname),1)]),_:2},1032,["onClick"])):b("",!0),t.key==="taskName"?(o(),d(k,{key:1},[i.taskName?(o(),v(B,{key:0,onClick:H=>K(i)},{default:l(()=>[p(r(i.taskName),1)]),_:2},1032,["onClick"])):(o(),d("span",fe,"--"))],64)):b("",!0),t.key==="relatedGroupName"?(o(),d(k,{key:2},[p(r(i.relatedGroupName||"--"),1)],64)):b("",!0),t.key==="billType"?(o(),d(k,{key:3},[p(r(R(_).getEnumText("BillType",i.billType)),1)],64)):b("",!0),t.key==="amount"?(o(),d(k,{key:4},[i.billType==="reward_deduction"?(o(),v(ae,{key:0,type:"danger"},{default:l(()=>[p(" - "+r(i.amount),1)]),_:2},1024)):(o(),d("span",ke,r(i.amount),1))],64)):b("",!0),t.key==="remark"?(o(),d("div",_e,[i.remark?(o(),d("span",ve,r(i.remark)+"("+r(e.$t("financial.bills.operator"))+": "+r(i.waiterName)+")",1)):(o(),d("span",he,"--"))])):b("",!0),t.key==="settlementStatus"?(o(),d(k,{key:6},[i.billType==="withdrawal"?(o(),d("span",ge,r(R(_).getEnumText("WithdrawalStatus",i.withdrawalStatus)),1)):(o(),d("span",Ne,r(R(_).getEnumText("SettlementStatus",i.settlementStatus)),1)),i.settlementStatus==="failed"||i.withdrawalStatus==="failed"?(o(),v(le,{key:2,class:"status-icon",onClick:H=>j(i)},null,8,["onClick"])):b("",!0)],64)):b("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),y.total?(o(),d("div",we,[n(oe,{column:2},{default:l(()=>[n(U,{label:e.$t("common.totalCount")},{default:l(()=>[p(r(y.total),1)]),_:1},8,["label"]),n(U,{label:e.$t("common.totalAmount")},{default:l(()=>[p(r(E.value),1)]),_:1},8,["label"])]),_:1})])):b("",!0)])])}}},Ie=se(Te,[["__scopeId","data-v-639059cc"]]);export{Ie as default};
