import{_ as de,b as ie,a as ne,x as ue,j as oe,c as F,r as I,k as re,d as p,f as a,e as c,w as t,g as b,t as s,F as C,n as R,p as m,s as k,l as P,m as f,h as ce,o as u,i,q as N,A as B}from"./index-CgSCA0Xz.js";import{P as me}from"./PageHeader-BWXFOVGe.js";import{_ as be}from"./CopyContent-0gEqJoFs.js";import{G as ke}from"./GroupOwner-CEf1NXlN.js";const pe={class:"task-audit-detail content-container"},fe={class:"detail-container"},_e={key:0},Te={key:1},ve={class:"detail-section"},he={class:"section-title"},ge={key:0},ye={class:"link-text-container"},$e=["href"],Ie={class:"detail-section"},Ce={class:"section-title"},Se={class:"detail-section"},Ae={class:"section-title"},je={class:"footer-btns"},we={class:"left"},Re={class:"right"},Pe={__name:"detail",setup(Ne){const{t:_}=ie(),S=ne(),D=ue(),L=ce(),q=D.query.type,E=oe(()=>n.taskPreAuditStatus==="approved"?"confirm":"pre"),A=I(!1),O=I(!1),h=I(""),T=I(null),n=F({submitContent:{}}),r=F({}),v=F({}),M=async()=>{const e=E.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",o=await B(e,{ids:[T.value]});o.code===0?(f.success(_("submittedTasks.resolveSuccess")),g()):f.error(o.message)},G=()=>{h.value="",A.value=!0},z=async()=>{if(!h.value){f.error(_("submittedTasks.rejectReasonRequired"));return}O.value=!0;const e=E.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject",o=await B(e,{ids:[T.value],reason:h.value});o.code===0?(f.success(_("submittedTasks.rejectSuccess")),A.value=!1,g()):f.error(o.message)},H=()=>{L.push(`/submitted-tasks/detail/${n.prevTaskId}?type=${q}`),T.value=n.prevTaskId,g()},Q=()=>{L.push(`/submitted-tasks/detail/${n.nextTaskId}?type=${q}`),T.value=n.nextTaskId,g()},W=async e=>{try{const o=await P("task.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(r,o.data):f.error(o.message)}catch{f.error(_("submittedTasks.detail.getTaskDetailFailed"))}},J=async e=>{try{const o=await P("member.detail",{},{urlParams:{id:e}});o.code===0?Object.assign(v,o.data):f.error(o.message)}catch{f.error(_("submittedTasks.detail.getMemberDetailFailed"))}},g=async()=>{try{const e=await P("taskSubmitted.detail",{auditType:q},{urlParams:{id:T.value}});e.code===0&&(Object.assign(n,e.data),e.data.taskId!=null&&await W(e.data.taskId),e.data.memberId!=null&&await J(e.data.memberId),e.data.taskId!=null&&e.data.memberId!=null&&await K())}catch{f.error(_("submittedTasks.detail.getDetailFailed"))}},U=I([]),K=async()=>{const e=await P("account.list",{taskId:n.taskId,memberId:n.memberId,channelId:r.channelId});e.code===0&&(U.value=e.data.list||[])};return re(async()=>{T.value=D.params.id,await g()}),(e,o)=>{const V=b("a-avatar"),y=b("a-space"),l=b("a-descriptions-item"),$=b("a-descriptions"),X=b("a-collapse-panel"),Y=b("a-collapse"),Z=b("a-tag"),x=b("a-image"),j=b("a-button"),ee=b("a-textarea"),te=b("a-modal");return u(),p("div",pe,[a(me,{title:e.$t("submittedTasks.detail.title"),back:!0},null,8,["title"]),c("div",fe,[a(Y,{ghost:"",class:"collapse"},{default:t(()=>[a(X,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(y,null,{default:t(()=>[a(V,{src:r.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(r.taskName),1)]),_:1})]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[i(s(r.category),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[i(s(N(S).getEnumText("TaskType",r.taskType)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[i(s(r.reward),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[i(s(r.brand),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var d;return[r.groupMode===0?(u(),p("span",_e,s(e.$t("submittedTasks.detail.noSpecify")),1)):(u(),p("span",Te,s((d=r.groupNames)==null?void 0:d.join("ã€")),1))]}),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[i(s(r.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(r.endTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[i(s(r.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):r.quota),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[i(s(r.fansRequired),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[i(s(r.contentRequirement),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[i(s(r.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),c("div",ve,[c("div",he,s(e.$t("submittedTasks.detail.memberInfo")),1),a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[i(s(v.nickname),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[i(s(v.account),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(u(!0),p(C,null,R(v.groups,d=>(u(),m(y,null,{default:t(()=>[c("span",null,s(d.groupName),1),d.isOwner?(u(),m(ke,{key:0})):k("",!0)]),_:2},1024))),256)),!v.groups||v.groups.length===0?(u(),p("span",ge,"--")):k("",!0)]),_:1},8,["label"])]),_:1}),(u(!0),p(C,null,R(U.value,d=>(u(),p("div",{key:d.channelId},[a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(y,null,{default:t(()=>[a(V,{src:d.channelIcon,size:"small"},null,8,["src"]),c("span",null,s(d.account),1),a(Z,{color:"warning"},{default:t(()=>[i(s(N(S).getEnumText("AccountAuditStatus",d.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(l,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(be,{content:d.homeUrl},{default:t(()=>[c("div",ye,[c("a",{href:d.homeUrl,target:"_blank",class:"link-text"},s(d.homeUrl),9,$e)])]),_:2},1032,["content"])]),_:2},1032,["label"]),d.channelCustomFields.includes("fansCount")?(u(),m(l,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[i(s(d.fansCount),1)]),_:2},1032,["label"])):k("",!0),d.channelCustomFields.includes("friendsCount")?(u(),m(l,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[i(s(d.friendsCount),1)]),_:2},1032,["label"])):k("",!0),d.channelCustomFields.includes("postsCount")?(u(),m(l,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[i(s(d.postsCount),1)]),_:2},1032,["label"])):k("",!0)]),_:2},1024)]))),128))]),c("div",Ie,[c("div",Ce,s(e.$t("submittedTasks.detail.submitInfo")),1),a($,{column:2},{default:t(()=>{var d;return[(u(!0),p(C,null,R((d=n==null?void 0:n.submitContent)==null?void 0:d.customFields,(w,ae)=>(u(),m(l,{key:ae,label:w.title},{default:t(()=>[w.type==="image"?(u(!0),p(C,{key:0},R(w.value,(se,le)=>(u(),m(x,{src:se.url,width:60,key:le},null,8,["src"]))),128)):(u(),p(C,{key:1},[i(s(w.value),1)],64))]),_:2},1032,["label"]))),128))]}),_:1})]),c("div",Se,[c("div",Ae,s(e.$t("submittedTasks.detail.auditInfo")),1),a($,{column:2},{default:t(()=>[a(l,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[i(s(n.submitTime),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[i(s(N(S).getEnumText("TaskPreAuditStatus",n.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(l,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[i(s(n.preWaiterName),1)]),_:1},8,["label"]),n.taskPreAuditStatus==="approved"?(u(),m(l,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[i(s(N(S).getEnumText("TaskAuditStatus",n.taskAuditStatus)),1)]),_:1},8,["label"])):k("",!0),n.taskPreAuditStatus==="approved"?(u(),m(l,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[i(s(n.waiterName),1)]),_:1},8,["label"])):k("",!0),n.auditStatus==="rejected"?(u(),m(l,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[i(s(n.rejectReason),1)]),_:1},8,["label"])):k("",!0)]),_:1})]),c("div",je,[c("div",we,[n.auditStatus==="pending"?(u(),m(y,{key:0},{default:t(()=>[a(j,{type:"primary",onClick:M},{default:t(()=>[i(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(j,{danger:"",onClick:G},{default:t(()=>[i(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):k("",!0)]),c("div",Re,[a(y,null,{default:t(()=>[n.prevTaskId&&n.prevTaskId!==n.nextTaskId?(u(),m(j,{key:0,onClick:H},{default:t(()=>[i(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):k("",!0),n.nextTaskId?(u(),m(j,{key:1,onClick:Q},{default:t(()=>[i(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):k("",!0)]),_:1})])])]),a(te,{open:A.value,"onUpdate:open":o[1]||(o[1]=d=>A.value=d),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:z,confirmLoading:O.value},{default:t(()=>[a(ee,{value:h.value,"onUpdate:value":o[0]||(o[0]=d=>h.value=d),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Ee=de(Pe,[["__scopeId","data-v-bb2a1a1c"]]);export{Ee as default};
