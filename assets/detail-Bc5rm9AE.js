import{_ as re,b as ce,a as me,x as be,j as ke,c as O,r as g,k as fe,d as b,f as s,e as r,w as t,g as p,t as a,F as $,n as N,p as m,s as k,A as V,m as _,l as G,h as pe,o as i,i as d,q as F}from"./index-vUqQ2LA3.js";import{P as _e}from"./PageHeader-B1ln4Qq5.js";import{_ as z}from"./CopyContent-Qq0dN2rW.js";import{G as Te}from"./GroupOwner-DTII3wXl.js";import{d as ye}from"./routeParamsEncryption-BKFTaOaF.js";const he={class:"task-audit-detail content-container"},ve={class:"detail-container"},ge={key:0},$e={key:1},Ie={class:"detail-section"},Ce={class:"section-title"},Se={key:0},qe={class:"link-text-container"},we=["href"],Ae={class:"detail-section"},je={class:"section-title"},Pe={class:"link-text-container"},Re=["href"],Ne={key:0,style:{"margin-left":"10px"}},Fe={key:1},Ue={class:"detail-section"},Be={class:"section-title"},Ee={class:"footer-btns"},Le={class:"left"},De={class:"right"},Oe={__name:"detail",setup(Ve){const{t:w}=ce(),A=me(),T=be(),U=pe(),j=T.query.type,M=ke(()=>o.taskPreAuditStatus==="approved"?"confirm":"pre"),P=g(!1),B=g(!1),I=g(""),H=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},h=g(null),o=O({submitContent:{}}),c=O({}),y=O({}),E=g(null),Q=()=>{const e=T.query.filters;e&&(E.value=ye(e))},J=async()=>{const e=M.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",l=await V(e,{ids:[h.value]});l.code===0?(_.success(w("submittedTasks.resolveSuccess")),C()):_.error(l.message)},K=()=>{I.value="",P.value=!0},X=async()=>{if(!I.value){_.error(w("submittedTasks.rejectReasonRequired"));return}B.value=!0;try{const e=M.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject";await V(e,{ids:[h.value],reason:I.value}),_.success(w("submittedTasks.rejectSuccess")),P.value=!1,C()}catch(e){_.error(e.message)}finally{B.value=!1}},Y=()=>{const e=j==="confirm"?"/confirm-audit-tasks":"/pre-audit-tasks",l={};T.query.filters&&(l.filters=T.query.filters),U.push({path:e,query:l})},Z=()=>{const e={type:j};T.query.filters&&(e.filters=T.query.filters),U.push({path:`/submitted-tasks/detail/${o.prevTaskId}`,query:e}),h.value=o.prevTaskId,C()},x=()=>{const e={type:j};T.query.filters&&(e.filters=T.query.filters),U.push({path:`/submitted-tasks/detail/${o.nextTaskId}`,query:e}),h.value=o.nextTaskId,C()},ee=async e=>{try{const l=await G("task.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(c,l.data):_.error(l.message)}catch(l){_.error(l.message)}},te=async e=>{try{const l=await G("member.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(y,l.data):_.error(l.message)}catch{_.error(w("submittedTasks.detail.getMemberDetailFailed"))}},C=async()=>{try{const e={auditType:j,id:h.value};E.value&&(e.filtersParam=E.value);const l=await V("taskSubmitted.detail",e);l.code===0&&(Object.assign(o,l.data),l.data.taskId!=null&&await ee(l.data.taskId),l.data.memberId!=null&&await te(l.data.memberId),l.data.taskId!=null&&l.data.memberId!=null&&await ae())}catch(e){_.error(e.message)}},L=g([]),ae=async()=>{const e=await G("account.list",{taskId:o.taskId,memberId:o.memberId,channelId:c.channelId});e.code===0&&(L.value=e.data.list||[])};return fe(async()=>{h.value=T.params.id,Q(),await C()}),(e,l)=>{const W=p("a-avatar"),v=p("a-space"),n=p("a-descriptions-item"),S=p("a-descriptions"),se=p("a-collapse-panel"),le=p("a-collapse"),q=p("a-tag"),ie=p("a-image"),R=p("a-button"),de=p("a-textarea"),ne=p("a-modal");return i(),b("div",he,[s(_e,{title:e.$t("submittedTasks.detail.title"),back:!0,useDefaultBack:!1,onBack:Y},null,8,["title"]),r("div",ve,[s(le,{ghost:"",class:"collapse"},{default:t(()=>[s(se,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[s(S,{column:2},{default:t(()=>[s(n,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[s(v,null,{default:t(()=>[s(W,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,a(c.taskName),1)]),_:1})]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[d(a(c.category),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[d(a(F(A).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[d(a(c.reward),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[d(a(c.brand),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var u;return[c.groupMode===0?(i(),b("span",ge,a(e.$t("submittedTasks.detail.noSpecify")),1)):(i(),b("span",$e,a((u=c.groupNames)==null?void 0:u.join("、")),1))]}),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[d(a(c.startTime)+" "+a(e.$t("submittedTasks.detail.to"))+" "+a(c.endTime),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[d(a(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[d(a(c.fansRequired),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[d(a(c.contentRequirement),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[d(a(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),r("div",Ie,[r("div",Ce,a(e.$t("submittedTasks.detail.memberInfo")),1),s(S,{column:2},{default:t(()=>[s(n,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[s(v,null,{default:t(()=>[r("span",null,a(y.nickname),1),y.isNew?(i(),m(q,{key:0,color:"green"},{default:t(()=>l[2]||(l[2]=[d("new")])),_:1})):k("",!0)]),_:1})]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[d(a(y.account),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(i(!0),b($,null,N(y.groups,u=>(i(),m(v,null,{default:t(()=>[r("span",null,a(u.groupName),1),u.isOwner?(i(),m(Te,{key:0})):k("",!0)]),_:2},1024))),256)),!y.groups||y.groups.length===0?(i(),b("span",Se,"--")):k("",!0)]),_:1},8,["label"])]),_:1}),(i(!0),b($,null,N(L.value,u=>(i(),b("div",{key:u.channelId},[s(S,{column:2},{default:t(()=>[s(n,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[s(v,null,{default:t(()=>[s(W,{src:u.channelIcon,size:"small"},null,8,["src"]),r("span",null,a(u.account),1),s(q,{color:"warning"},{default:t(()=>[d(a(F(A).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),s(n,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[s(z,{content:u.homeUrl},{default:t(()=>[r("div",qe,[r("a",{href:u.homeUrl,target:"_blank",class:"link-text"},a(u.homeUrl),9,we)])]),_:2},1032,["content"])]),_:2},1032,["label"]),u.channelCustomFields.includes("fansCount")?(i(),m(n,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[d(a(u.fansCount),1)]),_:2},1032,["label"])):k("",!0),u.channelCustomFields.includes("friendsCount")?(i(),m(n,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[d(a(u.friendsCount),1)]),_:2},1032,["label"])):k("",!0),u.channelCustomFields.includes("postsCount")?(i(),m(n,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[d(a(u.postsCount),1)]),_:2},1032,["label"])):k("",!0),s(n,{label:"uid"},{default:t(()=>[d(a(u.uid),1)]),_:2},1024)]),_:2},1024)]))),128))]),r("div",Ae,[r("div",je,a(e.$t("submittedTasks.detail.submitInfo")),1),s(S,{column:1},{default:t(()=>{var u;return[(i(!0),b($,null,N((u=o==null?void 0:o.submitContent)==null?void 0:u.customFields,(f,ue)=>(i(),m(n,{key:ue,label:f.title},{default:t(()=>[f.type==="image"?(i(!0),b($,{key:0},N(f.value,(D,oe)=>(i(),m(ie,{src:D.url,width:60,key:oe},null,8,["src"]))),128)):(i(),b($,{key:1},[H(f.value)?(i(),b($,{key:0},[s(z,{content:f.value},{default:t(()=>[r("div",Pe,[r("a",{href:f.value,target:"_blank",class:"link-text"},a(f.value),9,Re)])]),_:2},1032,["content"]),f.type==="post"?(i(),b("div",Ne,[f.uid==null?(i(),m(q,{key:0,color:"orange"},{default:t(()=>[d(a(e.$t("submittedTasks.detail.postUidCheckNeedCheck")),1)]),_:1})):L.value.find(D=>D.uid===f.uid)?(i(),m(q,{key:1,color:"green"},{default:t(()=>[d(a(e.$t("submittedTasks.detail.postUidCheckSuccess")),1)]),_:1})):(i(),m(q,{key:2,color:"red"},{default:t(()=>[d(a(e.$t("submittedTasks.detail.postUidCheckError")),1)]),_:1}))])):k("",!0)],64)):(i(),b("span",Fe,a(f.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),r("div",Ue,[r("div",Be,a(e.$t("submittedTasks.detail.auditInfo")),1),s(S,{column:2},{default:t(()=>[s(n,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[d(a(o.submitTime),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[d(a(F(A).getEnumText("TaskPreAuditStatus",o.taskPreAuditStatus)),1)]),_:1},8,["label"]),s(n,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[d(a(o.preWaiterName),1)]),_:1},8,["label"]),o.taskPreAuditStatus==="approved"?(i(),m(n,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[d(a(F(A).getEnumText("TaskAuditStatus",o.taskAuditStatus)),1)]),_:1},8,["label"])):k("",!0),o.taskPreAuditStatus==="approved"?(i(),m(n,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[d(a(o.waiterName),1)]),_:1},8,["label"])):k("",!0),o.auditStatus==="rejected"?(i(),m(n,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[d(a(o.rejectReason),1)]),_:1},8,["label"])):k("",!0),s(n,{label:e.$t("submittedTasks.detail.updateTime")},{default:t(()=>[d(a(o.updateTime),1)]),_:1},8,["label"])]),_:1})]),r("div",Ee,[r("div",Le,[o.auditStatus==="pending"?(i(),m(v,{key:0},{default:t(()=>[s(R,{type:"primary",onClick:J},{default:t(()=>[d(a(e.$t("submittedTasks.detail.approve")),1)]),_:1}),s(R,{danger:"",onClick:K},{default:t(()=>[d(a(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):k("",!0)]),r("div",De,[s(v,null,{default:t(()=>[o.prevTaskId&&o.prevTaskId!==o.nextTaskId?(i(),m(R,{key:0,onClick:Z},{default:t(()=>[d(a(e.$t("submittedTasks.detail.prev")),1)]),_:1})):k("",!0),o.nextTaskId?(i(),m(R,{key:1,onClick:x},{default:t(()=>[d(a(e.$t("submittedTasks.detail.next")),1)]),_:1})):k("",!0)]),_:1})])])]),s(ne,{open:P.value,"onUpdate:open":l[1]||(l[1]=u=>P.value=u),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:X,confirmLoading:B.value},{default:t(()=>[s(de,{value:I.value,"onUpdate:value":l[0]||(l[0]=u=>I.value=u),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Qe=re(Oe,[["__scopeId","data-v-a1b55f98"]]);export{Qe as default};
