import{b as ne,r as u,c as te,j as T,k as oe,d as B,e as m,f as t,w as s,g as o,l as le,o as v,i as L,t as k,p as N,s as C,B as se,v as ie,m as i,z as ce,A as de}from"./index-DaKgYBEv.js";const ue={class:"content-container"},re={class:"table-container"},me={class:"table-header"},pe={class:"right"},fe=["onClick"],ve={key:0},ge={__name:"index",setup(he){const{t:l}=ne(),h=u(!1),r=u(!1),_=u(!1),p=u("add"),w=u(),d=u([]),x=u([{label:l("channel.fansCount"),value:"fansCount"},{label:l("channel.friendsCount"),value:"friendsCount"},{label:l("channel.postsCount"),value:"postsCount"}]),$={action:se.imageUploadUrl,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},n=te({name:"",icon:"",customFields:["fansCount"]}),g=u(),F={name:[{required:!0,message:l("channel.nameRequired")}],icon:[{required:!0,message:l("channel.iconRequired")}]},D=T(()=>[{title:l("channel.channelIcon"),dataIndex:"icon",key:"icon",width:120},{title:l("channel.channelName"),dataIndex:"name",key:"name"},{title:l("channel.updateTime"),dataIndex:"updateTime",key:"updateTime"},{title:l("channel.action"),key:"action",width:200}]),I=u([]),M=T(()=>({add:l("channel.addTitle"),edit:l("channel.editTitle")})[p.value]),S=()=>{p.value="add",n.name="",n.icon="",d.value=[],r.value=!0},V=e=>{p.value="edit",g.value=e.id,n.name=e.name,n.icon=e.icon,d.value=e.icon?[{uid:"-1",name:"image.png",status:"done",url:e.icon}]:[],r.value=!0},q=async e=>{const a=await ie("channel.delete",{},{urlParams:{id:e.id}});a.code===0?(i.success(a.message),f()):i.error(a.message)},z=e=>{e.code===0?(n.icon=e.data.url,d.value=[{uid:"-1",name:"image.png",status:"done",url:n.icon}],i.success("上传成功")):(i.error(response.message||"上传失败"),d.value=d.value.filter(a=>a.uid!==file.uid))},E=()=>{i.error("上传失败"),d.value=[]},R=e=>e.type.startsWith("image/")?e.size/1024/1024<1?!0:(i.error("图片必须小于 1MB！"),!1):(i.error("只能上传图片文件！"),!1),A=async()=>{const e=await de("channel.add",n);e.code===0?(i.success("添加成功"),r.value=!1,f()):i.error(e.message)},O=async()=>{const e=await ce("channel.edit",{...n,id:g.value},{urlParams:{id:g.value}});e.code===0?(i.success("编辑成功"),r.value=!1,f()):i.error(e.message)},P=async()=>{try{switch(await w.value.validate(),_.value=!0,p.value){case"add":A();break;case"edit":O();break}}catch(e){console.error(e)}finally{_.value=!1}},f=async()=>{h.value=!0;try{const e=await le("channel.list",{page:1,pageSize:200});I.value=e.data.list}finally{h.value=!1}};return oe(()=>{f()}),(e,a)=>{const U=o("a-button"),j=o("a-image"),W=o("a-typography-text"),G=o("a-popconfirm"),H=o("a-space"),J=o("a-table"),K=o("plus-outlined"),Q=o("a-upload"),y=o("a-form-item"),X=o("a-input"),Y=o("a-checkbox-group"),Z=o("a-form"),ee=o("a-modal");return v(),B("div",ue,[m("div",re,[m("div",me,[a[4]||(a[4]=m("div",{class:"left"},null,-1)),m("div",pe,[t(U,{type:"primary",onClick:S},{default:s(()=>[L(k(e.$t("channel.add")),1)]),_:1})])]),t(J,{columns:D.value,"data-source":I.value,loading:h.value,pagination:!1},{bodyCell:s(({column:c,record:b})=>[c.key==="icon"?(v(),N(j,{key:0,width:40,height:40,src:b.icon},null,8,["src"])):C("",!0),c.key==="action"?(v(),N(H,{key:1},{default:s(()=>[m("a",{onClick:ae=>V(b)},k(e.$t("channel.edit")),9,fe),t(G,{title:e.$t("channel.deleteConfirm"),onConfirm:ae=>q(b)},{default:s(()=>[t(W,{type:"danger"},{default:s(()=>[L(k(e.$t("channel.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:2},1024)):C("",!0)]),_:1},8,["columns","data-source","loading"])]),t(ee,{open:r.value,"onUpdate:open":a[3]||(a[3]=c=>r.value=c),title:M.value,confirmLoading:_.value,onOk:P},{default:s(()=>[t(Z,{ref_key:"formRef",ref:w,model:n,rules:F,"label-col":{span:6},"wrapper-col":{span:16}},{default:s(()=>[t(y,{label:e.$t("channel.channelIcon"),name:"icon"},{default:s(()=>[t(Q,{"file-list":d.value,"onUpdate:fileList":a[0]||(a[0]=c=>d.value=c),action:$.action,headers:$.headers,"before-upload":R,onSuccess:z,onError:E,accept:"image/*","list-type":"picture-card","max-count":1},{default:s(()=>[d.value.length?C("",!0):(v(),B("div",ve,[t(K),a[5]||(a[5]=m("div",{style:{"margin-top":"8px"}},"上传",-1))]))]),_:1},8,["file-list","action","headers"])]),_:1},8,["label"]),t(y,{label:e.$t("channel.channelName"),name:"name"},{default:s(()=>[t(X,{value:n.name,"onUpdate:value":a[1]||(a[1]=c=>n.name=c),placeholder:e.$t("channel.channelNamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(y,{label:e.$t("channel.customFields"),name:"customFields"},{default:s(()=>[t(Y,{value:n.customFields,"onUpdate:value":a[2]||(a[2]=c=>n.customFields=c),options:x.value},null,8,["value","options"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}};export{ge as default};
