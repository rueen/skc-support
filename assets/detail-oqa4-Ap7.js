import{b as J,r as p,j as K,x as Q,c as X,k as Z,d as T,f as t,e as M,w as l,g as r,l as q,y as f,m as s,h as x,o as _,F as ee,n as ae,p as te,i as y,t as k,C as oe,s as le,z as ne,A as se}from"./index-By25O0OS.js";import{P as re}from"./PageHeader-CaiTP2yj.js";const ie={class:"content-container"},de={class:"form-container"},ce={key:0},fe={__name:"detail",setup(ue){const{t:i}=J(),g=Q(),v=x(),w=p(),d=p([]),Y={action:oe.imageUploadUrl,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},h=K(()=>g.name==="AdEdit"),o=X({title:"",location:"home_banner",startTime:void 0,endTime:void 0,content:{adImage:""}}),U={title:[{required:!0,message:i("ad.detail.validation.titleRequired")}],location:[{required:!0,message:i("ad.detail.validation.locationRequired")}],startTime:[{required:!0,message:i("ad.detail.validation.startTimeRequired")}],endTime:[{required:!0,message:i("ad.detail.validation.endTimeRequired")}]},C=e=>{e.file.status==="removed"&&(o.content.adImage="")},H=e=>{e.code===0?(o.content.adImage=e.data.url,d.value=[{uid:"-1",name:"image.png",status:"done",url:o.content.adImage}],s.success("上传成功")):(s.error(response.message||"上传失败"),d.value=d.value.filter(a=>a.uid!==file.uid))},R=()=>{s.error("上传失败"),d.value=[]},L=e=>e.type.startsWith("image/")?e.size/1024/1024<1?!0:(s.error("图片必须小于 1MB！"),!1):(s.error("只能上传图片文件！"),!1),S=async e=>{try{m.value=!0;const a=await se("ad.add",e);a.code===0?(s.success(i("common.submitSuccess")),v.back()):s.error(a.message)}catch(a){console.log(a),s.error(i("common.submitFailed"))}finally{m.value=!1}},B=async e=>{try{m.value=!0;const a=await ne("ad.edit",{...e},{urlParams:{id:g.params.id}});a.code===0?(s.success(i("common.submitSuccess")),v.back()):s.error(a.message)}catch(a){console.log(a),s.error(i("common.submitFailed"))}finally{m.value=!1}},m=p(!1),E=()=>{w.value.validate().then(async()=>{if(!o.content.adImage){s.error(i("ad.detail.validation.adImageRequired"));return}const e={...o,startTime:o.startTime?f(o.startTime).format("YYYY-MM-DD HH:mm:ss"):null,endTime:o.endTime?f(o.endTime).format("YYYY-MM-DD HH:mm:ss"):null};h.value?await B(e):await S(e)})},P=()=>{v.back()},z=async e=>{try{const a=await q("ad.detail",{},{urlParams:{id:e}});if(a.code===0){const c=a.data;Object.assign(o,c,{startTime:f(c.startTime),endTime:f(c.endTime)}),d.value=[{uid:"-1",name:"image.png",status:"done",url:c.content.adImage}]}}catch(a){console.log(a),s.error(a)}},$=p([]),A=async()=>{try{const e=await q("public.location",{});e.code===0&&($.value=e.data||[])}catch(e){console.log(e)}};return Z(()=>{A(),h.value&&z(g.params.id)}),(e,a)=>{const c=r("a-input"),u=r("a-form-item"),F=r("a-select-option"),N=r("a-select"),D=r("a-date-picker"),b=r("a-col"),V=r("a-row"),j=r("plus-outlined"),O=r("a-upload"),I=r("a-button"),W=r("a-space"),G=r("a-form");return _(),T("div",ie,[t(re,{title:h.value?e.$t("ad.detail.editTitle"):e.$t("ad.detail.createTitle"),back:!0,class:"page-header"},null,8,["title"]),M("div",de,[t(G,{ref_key:"formRef",ref:w,model:o,rules:U,"label-col":{span:5},"wrapper-col":{span:18},layout:"horizontal"},{default:l(()=>[t(u,{label:e.$t("ad.detail.title"),name:"title"},{default:l(()=>[t(c,{value:o.title,"onUpdate:value":a[0]||(a[0]=n=>o.title=n),placeholder:e.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),t(u,{label:e.$t("ad.detail.location"),name:"location"},{default:l(()=>[t(N,{value:o.location,"onUpdate:value":a[1]||(a[1]=n=>o.location=n),placeholder:e.$t("common.selectPlaceholder")},{default:l(()=>[(_(!0),T(ee,null,ae($.value,n=>(_(),te(F,{key:n.code,value:n.code},{default:l(()=>[y(k(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),t(u,{label:e.$t("ad.detail.adTime"),required:""},{default:l(()=>[t(V,{gutter:8},{default:l(()=>[t(b,{span:11},{default:l(()=>[t(u,{name:"startTime"},{default:l(()=>[t(D,{value:o.startTime,"onUpdate:value":a[2]||(a[2]=n=>o.startTime=n),"show-time":"",style:{width:"100%"},placeholder:e.$t("ad.detail.startTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1})]),_:1}),t(b,{span:2,style:{"text-align":"center","line-height":"32px"}},{default:l(()=>a[5]||(a[5]=[M("span",null,"至",-1)])),_:1}),t(b,{span:11},{default:l(()=>[t(u,{name:"endTime"},{default:l(()=>[t(D,{value:o.endTime,"onUpdate:value":a[3]||(a[3]=n=>o.endTime=n),"show-time":"",style:{width:"100%"},placeholder:e.$t("ad.detail.endTime"),format:"YYYY-MM-DD HH:mm:ss"},null,8,["value","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1},8,["label"]),t(u,{label:e.$t("ad.detail.adImage"),required:""},{default:l(()=>[t(O,{"file-list":d.value,"onUpdate:fileList":a[4]||(a[4]=n=>d.value=n),action:Y.action,headers:Y.headers,"before-upload":L,onSuccess:H,onError:R,onChange:C,accept:"image/*","list-type":"picture-card","max-count":1},{default:l(()=>[d.value.length?le("",!0):(_(),T("div",ce,[t(j)]))]),_:1},8,["file-list","action","headers"])]),_:1},8,["label"]),t(u,{"wrapper-col":{span:16,offset:4}},{default:l(()=>[t(W,null,{default:l(()=>[t(I,{type:"primary",onClick:E},{default:l(()=>[y(k(e.$t("common.submit")),1)]),_:1}),t(I,{onClick:P},{default:l(()=>[y(k(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}};export{fe as default};
