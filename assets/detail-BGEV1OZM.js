import{_ as E,r as m,b as F,j as G,x as H,c as J,k as K,d as I,f as r,e as Q,w as o,g as i,l as $,m as d,h as W,o as u,F as C,n as L,p as O,i as b,t as f,z as X,A as Y}from"./index-fiN95LW_.js";import{P as x}from"./PageHeader-6wFIfKwH.js";const ee={class:"member-form content-container"},ae={class:"form-container"},te={__name:"detail",setup(re){const v=H(),g=W(),P=m(),{t:A}=F(),c=G(()=>!!v.params.id),l=J({memberNickname:"",memberAccount:"",password:"",groupIds:[],inviterId:void 0}),_={memberAccount:[{required:!0,message:A("member.detail.memberAccountPlaceholder")},{validator:(e,a)=>{const n=/^1[3-9]\d{9}$/,s=/^(\+?63[0-9]{10}|09[0-9]{9}|9[0-9]{9})$/,p=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!a||n.test(a)||s.test(a)||p.test(a)?Promise.resolve():Promise.reject(A("member.detail.memberAccountRule"))}}]},w=m(!1),N=m([]),h=m(!1),R=m([]),U=(e,a)=>a.children.toLowerCase().indexOf(e.toLowerCase())>=0,k=async(e="")=>{w.value=!0;try{const a=await $("group.list",{page:1,pageSize:50,groupName:e,memberId:l.inviterId});a.code===0&&(N.value=a.data.list||[])}finally{w.value=!1}},B=e=>{k()},M=async()=>{h.value=!0;try{const e=await $("member.list",{page:1,pageSize:50});e.code===0&&(R.value=e.data.list||[])}finally{h.value=!1}},j=async()=>{if(c.value)try{const e=await $("member.detail",{},{urlParams:{id:v.params.id}});if(e.code===0){const a=e.data;Object.assign(l,{memberNickname:a.nickname,memberAccount:a.account,groupIds:a.groups.map(n=>n.groupId),inviterId:a.inviterId})}}catch{d.error("load member info failed"),g.back()}},T=async()=>{const e=await Y("member.add",l);e.code===0?(d.success("submit success"),g.back()):d.error(e.message)},V=async()=>{const e=await X("member.edit",l,{urlParams:{id:v.params.id}});e.code===0?(d.success("submit success"),g.back()):d.error(e.message)},y=m(!1),Z=()=>{P.value.validate().then(async()=>{try{y.value=!0,c.value?V():T()}catch{d.error("submit failed")}finally{y.value=!1}})};return K(async()=>{await j(),await M(),await k()}),(e,a)=>{const n=i("a-input"),s=i("a-form-item"),p=i("a-select-option"),S=i("a-select"),z=i("a-button"),q=i("a-space"),D=i("a-form");return u(),I("div",ee,[r(x,{title:c.value?e.$t("member.detail.editTitle"):e.$t("member.detail.addTitle"),back:!0},null,8,["title"]),Q("div",ae,[r(D,{ref_key:"formRef",ref:P,model:l,rules:_,"label-col":{span:6},"wrapper-col":{span:16}},{default:o(()=>[r(s,{label:e.$t("member.detail.memberAccount"),name:"memberAccount",rules:_.memberAccount},{default:o(()=>[r(n,{value:l.memberAccount,"onUpdate:value":a[0]||(a[0]=t=>l.memberAccount=t),placeholder:e.$t("member.detail.memberAccountPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(s,{label:e.$t("member.detail.password"),name:"password",rules:[{required:!c.value,message:e.$t("member.detail.passwordPlaceholder")}]},{default:o(()=>[r(n,{value:l.password,"onUpdate:value":a[1]||(a[1]=t=>l.password=t),placeholder:e.$t("member.detail.passwordPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(s,{label:e.$t("member.detail.memberNickname"),name:"memberNickname",rules:_.memberNickname},{default:o(()=>[r(n,{value:l.memberNickname,"onUpdate:value":a[2]||(a[2]=t=>l.memberNickname=t),placeholder:e.$t("member.detail.memberNicknamePlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label","rules"]),r(s,{label:e.$t("member.detail.inviter"),name:"inviterId"},{default:o(()=>[r(S,{value:l.inviterId,"onUpdate:value":a[3]||(a[3]=t=>l.inviterId=t),placeholder:e.$t("member.detail.inviterPlaceholder"),loading:h.value,"show-search":"","allow-clear":"","filter-option":U,onSelect:B},{default:o(()=>[(u(!0),I(C,null,L(R.value,t=>(u(),O(p,{key:t.id,value:t.id},{default:o(()=>[b(f(t.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),r(s,{label:e.$t("member.detail.group"),name:"groupIds"},{default:o(()=>[r(S,{value:l.groupIds,"onUpdate:value":a[4]||(a[4]=t=>l.groupIds=t),placeholder:e.$t("member.detail.groupPlaceholder"),loading:w.value,mode:"multiple","allow-clear":"","show-search":"","filter-option":!1,onSearch:k},{default:o(()=>[(u(!0),I(C,null,L(N.value,t=>(u(),O(p,{key:t.id,value:t.id},{default:o(()=>[b(f(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"]),r(s,{"wrapper-col":{offset:4}},{default:o(()=>[r(q,null,{default:o(()=>[r(z,{type:"primary",loading:y.value,onClick:Z},{default:o(()=>[b(f(e.$t("common.submit")),1)]),_:1},8,["loading"]),r(z,{onClick:a[5]||(a[5]=t=>e.$router.back())},{default:o(()=>[b(f(e.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},se=E(te,[["__scopeId","data-v-79b4fb6a"]]);export{se as default};
