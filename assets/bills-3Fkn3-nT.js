import{_ as ee,b as ae,a as te,j as T,r as S,c as B,k as le,d as u,e as $,f as i,w as n,g as m,l as H,m as P,h as ne,o as l,F as b,n as C,p as f,i as p,t as r,s as k,q as I,M as se}from"./index-hi5fq7yF.js";const ie={class:"other-bill content-container"},oe={class:"table-container"},ue={class:"table-header"},re={class:"left"},de={key:1},me={key:1},pe={key:5,style:{"max-width":"250px"}},ce={key:0},be={key:1},ke={key:0},ye={key:1},fe={__name:"bills",setup(_e){const{t:c}=ae(),y=te(),G=ne(),x=T(()=>y.loaded?y.getEnumOptions("BillType"):[]),z=T(()=>y.loaded?y.getEnumOptions("SettlementStatus"):[]),h=S(!1),t=B({billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",keyword:"",relatedGroupId:void 0}),F=a=>{se.error({title:"结算失败原因",content:a.failureReason})},V=T(()=>[{title:c("financial.bills.billNo"),dataIndex:"billNo",key:"billNo"},{title:c("financial.bills.memberNickname"),key:"memberNickname"},{title:c("financial.bills.billType"),dataIndex:"billType",key:"billType"},{title:c("financial.bills.relatedTaskName"),key:"taskName"},{title:c("financial.bills.relatedGroupName"),key:"relatedGroupName"},{title:c("financial.bills.amount"),dataIndex:"amount",key:"amount",align:"right"},{title:c("financial.bills.remark"),key:"remark"},{title:c("financial.bills.createTime"),dataIndex:"createTime",key:"createTime"},{title:c("financial.bills.settlementStatus"),key:"settlementStatus"}]),R=S([]),_=B({current:1,pageSize:10,total:0}),D=()=>{_.current=1,g()},j=()=>{Object.assign(t,{billNo:"",billType:void 0,settlementStatus:void 0,timeRange:[],taskName:"",keyword:"",relatedGroupId:void 0}),D()},q=a=>{Object.assign(_,a),g()},L=a=>{G.push(`/member/view/${a.memberId}`)},W=a=>{G.push(`/submitted-tasks/detail/${a.submittedId}?type=confirm`)},g=async()=>{var a,s;h.value=!0;try{const v={page:_.current,pageSize:_.pageSize,billNo:t.billNo,billType:t.billType,settlementStatus:t.settlementStatus,startTime:(a=t.timeRange)==null?void 0:a[0],endTime:(s=t.timeRange)==null?void 0:s[1],taskName:t.taskName,keyword:t.keyword,relatedGroupId:t.relatedGroupId},d=await H("finance.bills",{...v});d.code===0?(R.value=d.data.list,_.total=d.data.total):P.error(d.message)}finally{h.value=!1}},M=S([]),O=async(a="")=>{try{const s=await H("group.list",{page:1,pageSize:50,groupName:a});s.code===0&&(M.value=s.data.list||[])}catch{P.error("获取群组列表失败")}};return le(()=>{g(),O()}),(a,s)=>{const v=m("a-input"),d=m("a-form-item"),N=m("a-select-option"),w=m("a-select"),A=m("a-range-picker"),Y=m("a-button"),J=m("a-space"),K=m("a-form"),E=m("a-typography-link"),Q=m("a-typography-text"),X=m("info-circle-outlined"),Z=m("a-table");return l(),u("div",ie,[$("div",oe,[$("div",ue,[$("div",re,[i(K,{layout:"inline",model:t},{default:n(()=>[i(d,{label:a.$t("financial.bills.billNo")},{default:n(()=>[i(v,{value:t.billNo,"onUpdate:value":s[0]||(s[0]=e=>t.billNo=e),placeholder:a.$t("financial.bills.billNoPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),i(d,{label:a.$t("financial.bills.billType")},{default:n(()=>[i(w,{value:t.billType,"onUpdate:value":s[1]||(s[1]=e=>t.billType=e),placeholder:a.$t("financial.bills.billTypePlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(l(!0),u(b,null,C(x.value,e=>(l(),f(N,{key:e.value,value:e.value},{default:n(()=>[p(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),i(d,{label:a.$t("financial.bills.settlementStatus")},{default:n(()=>[i(w,{value:t.settlementStatus,"onUpdate:value":s[2]||(s[2]=e=>t.settlementStatus=e),placeholder:a.$t("financial.bills.settlementStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(l(!0),u(b,null,C(z.value,e=>(l(),f(N,{key:e.value,value:e.value},{default:n(()=>[p(r(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),i(d,{label:a.$t("financial.bills.createTime")},{default:n(()=>[i(A,{value:t.timeRange,"onUpdate:value":s[3]||(s[3]=e=>t.timeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["value"])]),_:1},8,["label"]),i(d,{label:a.$t("financial.bills.relatedTaskName")},{default:n(()=>[i(v,{value:t.taskName,"onUpdate:value":s[4]||(s[4]=e=>t.taskName=e),placeholder:a.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),i(d,{label:a.$t("financial.bills.memberNickname")},{default:n(()=>[i(v,{value:t.keyword,"onUpdate:value":s[5]||(s[5]=e=>t.keyword=e),placeholder:a.$t("financial.bills.taskNamePlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),i(d,{label:a.$t("financial.bills.relatedGroupName")},{default:n(()=>[i(w,{value:t.relatedGroupId,"onUpdate:value":s[6]||(s[6]=e=>t.relatedGroupId=e),placeholder:a.$t("financial.bills.relatedGroupNamePlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:O},{default:n(()=>[(l(!0),u(b,null,C(M.value,e=>(l(),f(N,{key:e.id,value:e.id},{default:n(()=>[p(r(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),i(d,null,{default:n(()=>[i(J,null,{default:n(()=>[i(Y,{type:"primary",onClick:D},{default:n(()=>[p(r(a.$t("common.search")),1)]),_:1}),i(Y,{onClick:j},{default:n(()=>[p(r(a.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])]),i(Z,{columns:V.value,"data-source":R.value,loading:h.value,pagination:_,onChange:q},{bodyCell:n(({column:e,record:o})=>[e.key==="memberNickname"?(l(),f(E,{key:0,onClick:U=>L(o)},{default:n(()=>[p(r(o.memberNickname),1)]),_:2},1032,["onClick"])):k("",!0),e.key==="taskName"?(l(),u(b,{key:1},[o.taskName?(l(),f(E,{key:0,onClick:U=>W(o)},{default:n(()=>[p(r(o.taskName),1)]),_:2},1032,["onClick"])):(l(),u("span",de,"--"))],64)):k("",!0),e.key==="relatedGroupName"?(l(),u(b,{key:2},[p(r(o.relatedGroupName||"--"),1)],64)):k("",!0),e.key==="billType"?(l(),u(b,{key:3},[p(r(I(y).getEnumText("BillType",o.billType)),1)],64)):k("",!0),e.key==="amount"?(l(),u(b,{key:4},[o.billType==="reward_deduction"?(l(),f(Q,{key:0,type:"danger"},{default:n(()=>[p(" - "+r(o.amount),1)]),_:2},1024)):(l(),u("span",me,r(o.amount),1))],64)):k("",!0),e.key==="remark"?(l(),u("div",pe,[o.remark?(l(),u("span",ce,r(o.remark)+"("+r(a.$t("financial.bills.operator"))+": "+r(o.waiterName)+")",1)):(l(),u("span",be,"--"))])):k("",!0),e.key==="settlementStatus"?(l(),u(b,{key:6},[o.billType==="withdrawal"?(l(),u("span",ke,r(I(y).getEnumText("WithdrawalStatus",o.withdrawalStatus)),1)):(l(),u("span",ye,r(I(y).getEnumText("SettlementStatus",o.settlementStatus)),1)),o.settlementStatus==="failed"||o.withdrawalStatus==="failed"?(l(),f(X,{key:2,class:"status-icon",onClick:U=>F(o)},null,8,["onClick"])):k("",!0)],64)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},he=ee(fe,[["__scopeId","data-v-3a389812"]]);export{he as default};
