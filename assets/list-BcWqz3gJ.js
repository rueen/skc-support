import{_ as ae,a as oe,b as ne,r as D,c as Y,x as le,j as se,k as re,d as _,e as r,f as o,w as t,g as m,l as z,m as v,h as ie,o as n,F as w,n as N,p as f,i as g,t as l,s as k,q as ce,M as me,v as ue}from"./index-RFcAcScc.js";import{_ as A}from"./CopyContent-bSRExvF6.js";import{G as de}from"./GroupOwner-BBHin5hc.js";import{d as pe}from"./download-D8JVeGNN.js";const _e={class:"member-list content-container"},ge={class:"table-container"},ke={class:"table-header"},fe={class:"left"},ye={class:"right"},he={class:"link-text-container"},be={class:"label"},ve=["href"],we={key:1},Ce={style:{color:"#999","font-size":"12px"}},Te={key:0},$e=["onClick"],Se=["onClick"],Ie={class:"danger"},De={__name:"list",setup(Ne){const H=oe(),{t:u}=ne(),$=ie(),U=le(),S=D(!1),s=Y({keyword:"",groupId:U.query.groupId,createTimeRange:[]}),I=D([]),y=Y({current:1,pageSize:10,total:0}),x=D([]),B=se(()=>[{title:u("member.list.memberNickname"),key:"nickname"},{title:u("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:u("member.list.accounts"),key:"accountList"},{title:u("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:u("member.list.inviter"),key:"inviterNickname"},{title:u("member.list.group"),key:"groups"},{title:u("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:u("member.list.action"),key:"action",fixed:"right",width:150}]),R=()=>{y.current=1,C()},L=()=>{Object.assign(s,{keyword:"",groupId:void 0,createTimeRange:[]}),R()},F=e=>{y.current=e.current,y.pageSize=e.pageSize,C()},V=()=>{$.push("/member/create")},j=e=>{$.push(`/member/edit/${e.id}`)},M=e=>{$.push(`/member/view/${e}`)},G=async e=>{const a=await ue("member.delete",{},{urlParams:{id:e.id}});a.code===0?(v.success("删除成功"),C()):v.error(a.message)},C=async()=>{var e,a;S.value=!0;try{const h={page:y.current,pageSize:y.pageSize,keyword:s.keyword,groupId:s.groupId,createStartTime:(e=s.createTimeRange)==null?void 0:e[0],createEndTime:(a=s.createTimeRange)==null?void 0:a[1]},p=await z("member.list",h);p.code===0?(I.value=p.data.list,y.total=p.data.total):v.error(p.message)}finally{S.value=!1}},E=async(e="")=>{try{const a=await z("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(x.value=a.data.list||[])}catch{v.error("获取群组列表失败")}},P=()=>{me.confirm({title:u("common.export"),content:u("common.confirmExportContent"),onOk:async()=>{var e,a;try{const h=v.loading(u("common.exporting"),0),p={keyword:s.keyword,groupId:s.groupId,createStartTime:(e=s.createTimeRange)==null?void 0:e[0],createEndTime:(a=s.createTimeRange)==null?void 0:a[1]};await pe("member.export",p,`会员列表_${new Date().toLocaleDateString()}.xlsx`),h(),v.success(u("common.exportSuccess"))}catch(h){console.error("导出失败:",h),v.error(u("common.exportFailed"))}}})};return re(()=>{C(),E()}),(e,a)=>{const h=m("a-input"),p=m("a-form-item"),q=m("a-select-option"),J=m("a-select"),K=m("a-range-picker"),T=m("a-button"),b=m("a-space"),Q=m("a-form"),W=m("DownloadOutlined"),X=m("plus-outlined"),O=m("a-tag"),Z=m("a-typography-link"),ee=m("a-popconfirm"),te=m("a-table");return n(),_("div",_e,[r("div",ge,[r("div",ke,[r("div",fe,[o(Q,{layout:"inline",model:s},{default:t(()=>[o(p,{label:e.$t("member.search.keyword")},{default:t(()=>[o(h,{value:s.keyword,"onUpdate:value":a[0]||(a[0]=i=>s.keyword=i),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("member.search.group")},{default:t(()=>[o(J,{value:s.groupId,"onUpdate:value":a[1]||(a[1]=i=>s.groupId=i),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:E,style:{width:"200px"}},{default:t(()=>[(n(!0),_(w,null,N(x.value,i=>(n(),f(q,{key:i.id,value:i.id},{default:t(()=>[g(l(i.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(p,{label:e.$t("member.search.createTime")},{default:t(()=>[o(K,{value:s.createTimeRange,"onUpdate:value":a[2]||(a[2]=i=>s.createTimeRange=i),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(p,null,{default:t(()=>[o(b,null,{default:t(()=>[o(T,{type:"primary",onClick:R},{default:t(()=>[g(l(e.$t("common.search")),1)]),_:1}),o(T,{onClick:L},{default:t(()=>[g(l(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),r("div",ye,[o(b,null,{default:t(()=>[I.value.length?(n(),f(T,{key:0,onClick:P},{icon:t(()=>[o(W)]),default:t(()=>[g(" "+l(e.$t("common.export")),1)]),_:1})):k("",!0),o(T,{type:"primary",onClick:V},{icon:t(()=>[o(X)]),default:t(()=>[g(" "+l(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),o(te,{columns:B.value,"data-source":I.value,loading:S.value,pagination:y,onChange:F},{bodyCell:t(({column:i,record:d})=>[i.key==="nickname"?(n(),f(b,{key:0},{default:t(()=>[r("span",null,l(d.nickname),1),d.isNew?(n(),f(O,{key:0,color:"green"},{default:t(()=>a[3]||(a[3]=[g("new")])),_:1})):k("",!0)]),_:2},1024)):k("",!0),i.key==="accountList"?(n(),f(b,{key:1,direction:"vertical"},{default:t(()=>[(n(!0),_(w,null,N(d.accountList,c=>(n(),_("div",null,[r("div",null,[o(b,null,{default:t(()=>[g(l(e.$t("member.list.account"))+"："+l(c.account)+" ",1),o(O,{color:"warning"},{default:t(()=>[g(l(ce(H).getEnumText("AccountAuditStatus",c.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),r("div",he,[r("span",be,l(e.$t("member.list.homepage"))+"：",1),o(A,{content:c.homeUrl},{default:t(()=>[r("a",{href:c.homeUrl,target:"_blank",class:"link-text"},l(c.homeUrl),9,ve)]),_:2},1032,["content"])]),r("div",null,[a[4]||(a[4]=r("span",{class:"label"},"uid：",-1)),o(A,{content:c.uid},null,8,["content"])])]))),256))]),_:2},1024)):k("",!0),i.key==="inviterNickname"?(n(),_(w,{key:2},[d.inviterId?(n(),f(Z,{key:0,onClick:c=>M(d.inviterId)},{default:t(()=>[g(l(d.inviterNickname),1)]),_:2},1032,["onClick"])):(n(),_("span",we,"--"))],64)):k("",!0),i.key==="groups"?(n(),_(w,{key:3},[(n(!0),_(w,null,N(d.groups,c=>(n(),_("div",null,[o(b,null,{default:t(()=>[r("span",null,l(c.groupName),1),c.isOwner?(n(),f(de,{key:0})):k("",!0)]),_:2},1024),r("div",Ce,l(c.joinTime),1)]))),256)),!d.groups||d.groups.length===0?(n(),_("span",Te,"--")):k("",!0)],64)):k("",!0),i.key==="action"?(n(),f(b,{key:4},{default:t(()=>[r("a",{onClick:c=>j(d)},l(e.$t("member.list.edit")),9,$e),r("a",{onClick:c=>M(d.id)},l(e.$t("member.list.view")),9,Se),o(ee,{title:e.$t("member.list.deleteConfirm"),onConfirm:c=>G(d)},{default:t(()=>[r("a",Ie,l(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):k("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},Oe=ae(De,[["__scopeId","data-v-716059f9"]]);export{Oe as default};
