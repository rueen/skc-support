import{_ as ge,a as he,b as ye,j as W,r as f,c as K,k as Te,d as g,e as k,f as s,w as a,g as u,l as M,m as p,h as we,o as i,F as w,n as U,p as _,i as d,t as o,s as v,q as Se,M as Ce,A as q}from"./index-Djsw4Cgw.js";import{d as Ae}from"./download-opslLBi0.js";import{G as Ne}from"./GroupOwner-DFxnIBLb.js";const Ie={class:"task-audit content-container"},$e={class:"table-container"},Re={class:"table-header"},xe={style:{width:"100%",display:"flex","justify-content":"space-between"}},Oe={key:4},je=["onClick"],De={__name:"confirm-audit-list",setup(Ee){const R=he(),{t:r}=ye(),J=W(()=>R.loaded?R.getEnumOptions("TaskAuditStatus"):[]),Y=we(),x=f(!1),B=f(!1),S=f(!1),L=f(!1),y=f(""),C=f(null),b=f([]),l=K({taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),V=f([]),H=f([]),Q=W(()=>[{title:r("submittedTasks.list.taskName"),key:"taskName"},{title:r("submittedTasks.list.reward"),dataIndex:"reward",key:"reward"},{title:r("submittedTasks.list.memberInfo"),key:"member"},{title:r("submittedTasks.list.status"),dataIndex:"taskAuditStatus",key:"taskAuditStatus"},{title:r("submittedTasks.list.preAuditor"),key:"preWaiterName"},{title:r("submittedTasks.list.confirmAuditor"),key:"waiterName"},{title:r("submittedTasks.list.action"),key:"action",fixed:"right",width:180}]),O=f([]),T=K({current:1,pageSize:10,total:0}),X={selectedRowKeys:b,onChange:t=>{b.value=t},getCheckboxProps:t=>({disabled:t.taskAuditStatus!=="pending"})},z=()=>{T.current=1,A()},Z=()=>{Object.assign(l,{taskName:"",channelId:void 0,taskAuditStatus:"pending",groupId:void 0,submitTimeRange:[],completedTaskCount:void 0}),z()},ee=t=>{Object.assign(T,t),A()},te=t=>{Y.push(`/member/view/${t.memberId}`)},ae=t=>{Y.push(`/submitted-tasks/detail/${t.id}?type=confirm`)},se=async t=>{b.value=[t.id],P()},P=async()=>{if(!b.value.length){p.warning(r("submittedTasks.list.selectTask"));return}const t=await q("taskSubmitted.batchConfirmAuditApprove",{ids:b.value});t.code===0?(p.success(r("submittedTasks.resolveSuccess")),b.value=[],A()):p.error(t.message)},ne=t=>{b.value=[t.id],y.value="",S.value=!0},le=async()=>{if(!y.value){p.error("请输入拒绝原因");return}L.value=!0;const t=await q("taskSubmitted.batchConfirmAuditReject",{ids:b.value,reason:y.value});t.code===0?(p.success("审核拒绝成功"),S.value=!1,A()):p.error(t.message)},oe=()=>{if(!b.value.length){p.warning("请选择要拒绝的任务");return}y.value="",S.value=!0},ue=async()=>{const t=await M("channel.list");t.code===0&&(V.value=t.data.list)},ie=()=>{Ce.confirm({title:r("common.export"),content:r("common.confirmExportContent"),onOk:async()=>{var t,n;try{const h=p.loading(r("common.exporting"),0),c={taskName:l.taskName,channelId:l.channelId,taskAuditStatus:l.taskAuditStatus,groupId:l.groupId,submitStartTime:(t=l.submitTimeRange)==null?void 0:t[0],submitEndTime:(n=l.submitTimeRange)==null?void 0:n[1],completedTaskCount:l.completedTaskCount};await Ae("taskSubmitted.confirmAuditExport",c,`复审列表_${new Date().toLocaleDateString()}.xlsx`),h(),p.success(r("common.exportSuccess"))}catch(h){console.error("导出失败:",h),p.error(r("common.exportFailed"))}}})},de=async(t="")=>{try{const n=await M("group.list",{params:{page:1,pageSize:50,keyword:t}});n.code===0&&(H.value=n.data.list||[])}catch{p.error("获取群组列表失败")}},A=async()=>{var t,n;x.value=!0;try{const h={page:T.current,pageSize:T.pageSize,taskName:l.taskName,channelId:l.channelId,taskAuditStatus:l.taskAuditStatus,groupId:l.groupId,submitStartTime:(t=l.submitTimeRange)==null?void 0:t[0],submitEndTime:(n=l.submitTimeRange)==null?void 0:n[1],completedTaskCount:l.completedTaskCount},c=await M("taskSubmitted.confirmAuditList",{...h});c.code===0?(O.value=c.data.list,T.total=c.data.total):p.error(c.message)}finally{x.value=!1}};return Te(()=>{A(),de(),ue()}),(t,n)=>{const h=u("a-input"),c=u("a-form-item"),j=u("a-select-option"),D=u("a-select"),re=u("a-range-picker"),me=u("a-input-number"),ce=u("a-form"),N=u("a-button"),I=u("a-space"),pe=u("DownloadOutlined"),ke=u("a-avatar"),fe=u("a-typography-link"),F=u("a-popconfirm"),ve=u("a-table"),$=u("a-descriptions-item"),be=u("a-descriptions"),G=u("a-modal"),_e=u("a-textarea");return i(),g("div",Ie,[k("div",$e,[k("div",Re,[s(ce,{layout:"inline",model:l},{default:a(()=>[s(c,{label:t.$t("submittedTasks.search.taskName")},{default:a(()=>[s(h,{value:l.taskName,"onUpdate:value":n[0]||(n[0]=e=>l.taskName=e),placeholder:t.$t("submittedTasks.search.taskNamePlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),s(c,{label:t.$t("submittedTasks.search.channel")},{default:a(()=>[s(D,{value:l.channelId,"onUpdate:value":n[1]||(n[1]=e=>l.channelId=e),placeholder:t.$t("submittedTasks.search.channelPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),g(w,null,U(V.value,e=>(i(),_(j,{key:e.id,value:e.id},{default:a(()=>[d(o(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(c,{label:t.$t("submittedTasks.search.taskAuditStatus")},{default:a(()=>[s(D,{value:l.taskAuditStatus,"onUpdate:value":n[2]||(n[2]=e=>l.taskAuditStatus=e),placeholder:t.$t("submittedTasks.search.taskAuditStatusPlaceholder"),"allow-clear":"",style:{width:"140px"}},{default:a(()=>[(i(!0),g(w,null,U(J.value,e=>(i(),_(j,{key:e.value,value:e.value},{default:a(()=>[d(o(e.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(c,{label:t.$t("submittedTasks.search.groupId")},{default:a(()=>[s(D,{value:l.groupId,"onUpdate:value":n[3]||(n[3]=e=>l.groupId=e),placeholder:t.$t("submittedTasks.search.groupIdPlaceholder"),"allow-clear":""},{default:a(()=>[(i(!0),g(w,null,U(H.value,e=>(i(),_(j,{key:e.id,value:e.id},{default:a(()=>[d(o(e.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(c,{label:t.$t("submittedTasks.search.submitTime")},{default:a(()=>[s(re,{value:l.submitTimeRange,"onUpdate:value":n[4]||(n[4]=e=>l.submitTimeRange=e),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),s(c,{label:t.$t("submittedTasks.search.completedTaskCount")},{default:a(()=>[s(me,{value:l.completedTaskCount,"onUpdate:value":n[5]||(n[5]=e=>l.completedTaskCount=e),min:0,max:9999,"addon-after":t.$t("submittedTasks.search.times"),style:{width:"100px!important"}},null,8,["value","addon-after"])]),_:1},8,["label"])]),_:1},8,["model"]),k("div",xe,[k("div",null,[s(I,null,{default:a(()=>[s(N,{type:"primary",onClick:z},{default:a(()=>[d(o(t.$t("common.search")),1)]),_:1}),s(N,{onClick:Z},{default:a(()=>[d(o(t.$t("common.reset")),1)]),_:1})]),_:1})]),k("div",null,[s(I,null,{default:a(()=>[O.value.length?(i(),_(N,{key:0,onClick:ie},{icon:a(()=>[s(pe)]),default:a(()=>[d(" "+o(t.$t("common.export")),1)]),_:1})):v("",!0),s(N,{type:"primary",onClick:P},{default:a(()=>[d(o(t.$t("common.batchResolve")),1)]),_:1}),s(N,{danger:"",onClick:oe},{default:a(()=>[d(o(t.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),s(ve,{columns:Q.value,"data-source":O.value,loading:x.value,pagination:T,"row-selection":X,rowKey:"id",onChange:ee},{bodyCell:a(({column:e,record:m})=>[e.key==="taskName"?(i(),_(I,{key:0},{default:a(()=>[s(ke,{src:m.channelIcon,size:"small"},null,8,["src"]),k("span",null,o(m.taskName),1)]),_:2},1024)):v("",!0),e.key==="taskAuditStatus"?(i(),g(w,{key:1},[d(o(Se(R).getEnumText("TaskAuditStatus",m.taskAuditStatus)),1)],64)):v("",!0),e.key==="preWaiterName"?(i(),g(w,{key:2},[d(o(m.preWaiterName||"--"),1)],64)):v("",!0),e.key==="waiterName"?(i(),g(w,{key:3},[d(o(m.waiterName||"--"),1)],64)):v("",!0),e.key==="member"?(i(),g("div",Oe,[k("div",null,[s(fe,{onClick:E=>te(m)},{default:a(()=>[d(o(m.nickname),1)]),_:2},1032,["onClick"])]),s(I,{class:"group-name"},{default:a(()=>[k("span",null,o(m.groupName),1),m.isOwner?(i(),_(Ne,{key:0})):v("",!0)]),_:2},1024)])):v("",!0),e.key==="action"?(i(),_(I,{key:5},{default:a(()=>[k("a",{onClick:E=>ae(m)},"查看",8,je),m.taskAuditStatus==="pending"?(i(),_(F,{key:0,title:"确定要通过该任务吗？",onConfirm:E=>se(m)},{default:a(()=>n[9]||(n[9]=[k("a",null,"通过",-1)])),_:2},1032,["onConfirm"])):v("",!0),m.taskAuditStatus==="pending"?(i(),_(F,{key:1,title:"确定要拒绝该任务吗？",onConfirm:E=>ne(m)},{default:a(()=>n[10]||(n[10]=[k("a",{class:"danger"},"拒绝",-1)])),_:2},1032,["onConfirm"])):v("",!0)]),_:2},1024)):v("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),s(G,{open:B.value,"onUpdate:open":n[6]||(n[6]=e=>B.value=e),title:"任务详情",footer:null},{default:a(()=>[s(be,{column:1},{default:a(()=>[s($,{label:"任务名称"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.taskName),1)]}),_:1}),s($,{label:"任务类型"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.taskType),1)]}),_:1}),s($,{label:"任务描述"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.description),1)]}),_:1}),s($,{label:"任务奖励"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.reward),1)]}),_:1}),s($,{label:"创建时间"},{default:a(()=>{var e;return[d(o((e=C.value)==null?void 0:e.createTime),1)]}),_:1})]),_:1})]),_:1},8,["open"]),s(G,{open:S.value,"onUpdate:open":n[8]||(n[8]=e=>S.value=e),title:"拒绝原因",onOk:le,confirmLoading:L.value},{default:a(()=>[s(_e,{value:y.value,"onUpdate:value":n[7]||(n[7]=e=>y.value=e),placeholder:"请输入拒绝原因",rows:4},null,8,["value"])]),_:1},8,["open","confirmLoading"])])}}},Be=ge(De,[["__scopeId","data-v-bca0b97b"]]);export{Be as default};
