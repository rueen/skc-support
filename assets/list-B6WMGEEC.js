import{_ as be,a as ke,b as we,j as q,r as g,c as J,k as Ce,d as r,e as i,f as o,w as n,g as d,l as O,m as v,h as $e,o as u,F as b,n as T,p as y,i as m,t as l,s as h,q as Se,A as Q,M as Ie,v as Re}from"./index-BNu2jVS-.js";import{_ as X}from"./CopyContent-DyWLbRtU.js";import{G as je}from"./GroupOwner-B7scK22v.js";const Ae={class:"account content-container"},Oe={class:"table-container"},Te={class:"table-header"},Ne={style:{width:"100%",display:"flex","justify-content":"space-between"}},Ue={class:"right"},ze={key:0,class:"account-info"},De={class:"link-text-container"},Me={class:"label"},Pe=["href"],Ye={class:"stats"},Ee={key:0,class:"stat-item"},Fe={key:1,class:"stat-item"},Be={key:2,class:"stat-item"},He={key:1},Ve={key:1},Ge={class:"danger"},Le=["onClick"],We={class:"danger"},Ke={__name:"list",setup(qe){const U=$e(),z=ke(),{t:p}=we(),Z=q(()=>z.loaded?z.getEnumOptions("AccountAuditStatus"):[]),D=g(!1),_=g([]),$=g(!1),M=g(!1),k=g(""),c=J({keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),E=g([]),F=g([]),B=g([]),P=g([]),x=q(()=>[{title:p("account.list.accountInfo"),key:"accountInfo",width:500},{title:p("account.list.memberInfo"),key:"member"},{title:p("account.list.submitTime"),dataIndex:"submitTime",key:"submitTime"},{title:p("account.list.auditStatus"),dataIndex:"accountAuditStatus",key:"accountAuditStatus"},{title:p("account.list.rejectReason"),key:"rejectReason"},{title:p("account.list.waiterName"),key:"waiterName"},{title:p("account.list.action"),key:"action"}]),ee={selectedRowKeys:_,onChange:e=>{_.value=e},getCheckboxProps:e=>({disabled:e.accountAuditStatus!=="pending"})},H=g([]),w=J({current:1,pageSize:10,total:0}),V=()=>{w.current=1,C()},te=()=>{Object.assign(c,{keyword:"",channelId:void 0,accountAuditStatus:"pending",waiterId:void 0,groupId:void 0,memberId:void 0,submitTimeRange:[]}),V()},ae=e=>{U.push(`/member/view/${e.memberId}`)},ne=e=>{U.push({name:"AccountEdit",params:{id:e.id}})},oe=()=>{U.push("/account/old")},le=e=>{Object.assign(w,{current:e.current,pageSize:e.pageSize}),C()},se=async e=>{_.value=[e.id],G()},G=async()=>{if(!_.value.length){v.warning(p("account.list.message.selectAccount"));return}const e=await Q("account.batchResolve",{ids:_.value});if(e.code===0){const a=e.data.failed.map(S=>S.reason).join(",");a?Ie.error({title:p("account.list.batchRejectFailedTitle"),content:`成功 ${e.data.successCount} 条，失败 ${e.data.failedCount} 条，失败原因：${a}`}):(v.success(p("account.list.message.success")),_.value=[],C())}else v.error(e.message)},ue=async()=>{if(!_.value.length){v.warning(p("account.list.message.selectAccount"));return}k.value="",$.value=!0},ce=e=>{_.value=[e.id],k.value="",$.value=!0},ie=async()=>{if(!k.value){v.error(p("account.list.message.rejectReason"));return}M.value=!0;try{const e=await Q("account.batchReject",{ids:_.value,rejectReason:k.value});e.code===0?(v.success(p("account.list.message.success")),_.value=[],$.value=!1,C()):v.error(e.message)}catch(e){console.log(e)}finally{M.value=!1}},C=async()=>{var e,a;D.value=!0;try{const S={page:w.current,pageSize:w.pageSize,keyword:c.keyword,channelId:c.channelId,accountAuditStatus:c.accountAuditStatus,waiterId:c.waiterId,groupId:c.groupId,memberId:c.memberId,submitStartTime:(e=c.submitTimeRange)==null?void 0:e[0],submitEndTime:(a=c.submitTimeRange)==null?void 0:a[1]},f=await O("account.list",{...S});f.code===0?(H.value=f.data.list,w.total=f.data.total):v.error(f.message)}finally{D.value=!1}},re=async()=>{const e=await O("channel.list");e.code===0&&(E.value=e.data.list)},L=async(e="")=>{try{const a=await O("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(F.value=a.data.list||[])}catch{v.error("获取群组列表失败")}},W=async(e="")=>{const a=await O("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(B.value=a.data.list||[])},de=async e=>{const a=await Re("account.delete",{},{urlParams:{id:e.id}});a.code===0?(v.success(a.message),C()):v.error(a.message)},me=async()=>{if(P.value.length)return;const e=await O("waiter.list",{page:1,pageSize:100});if(e.code===0){const a={id:0,username:"无"};P.value=[a,...e.data.list]}};return Ce(()=>{C(),L(),re(),W(),me()}),(e,a)=>{const S=d("a-input"),f=d("a-form-item"),I=d("a-select-option"),R=d("a-select"),pe=d("a-range-picker"),j=d("a-button"),A=d("a-space"),fe=d("a-form"),he=d("a-avatar"),K=d("a-typography-link"),ve=d("a-typography-text"),Y=d("a-popconfirm"),_e=d("a-table"),ge=d("a-textarea"),ye=d("a-modal");return u(),r("div",Ae,[i("div",Oe,[i("div",Te,[o(fe,{layout:"inline",model:c},{default:n(()=>[o(f,{label:e.$t("account.search.account")},{default:n(()=>[o(S,{value:c.keyword,"onUpdate:value":a[0]||(a[0]=t=>c.keyword=t),placeholder:e.$t("account.search.accountPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("account.search.channel")},{default:n(()=>[o(R,{value:c.channelId,"onUpdate:value":a[1]||(a[1]=t=>c.channelId=t),placeholder:e.$t("account.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(u(!0),r(b,null,T(E.value,t=>(u(),y(I,{key:t.id,value:t.id},{default:n(()=>[m(l(t.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("account.search.submitTime")},{default:n(()=>[o(pe,{value:c.submitTimeRange,"onUpdate:value":a[2]||(a[2]=t=>c.submitTimeRange=t),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),o(f,{label:e.$t("account.search.auditStatus")},{default:n(()=>[o(R,{value:c.accountAuditStatus,"onUpdate:value":a[3]||(a[3]=t=>c.accountAuditStatus=t),placeholder:e.$t("account.search.auditStatusPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:n(()=>[(u(!0),r(b,null,T(Z.value,t=>(u(),y(I,{key:t.value,value:t.value},{default:n(()=>[m(l(t.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("account.search.auditor")},{default:n(()=>[o(R,{value:c.waiterId,"onUpdate:value":a[4]||(a[4]=t=>c.waiterId=t),placeholder:e.$t("account.search.auditorPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:n(()=>[(u(!0),r(b,null,T(P.value,t=>(u(),y(I,{key:t.id,value:t.id},{default:n(()=>[m(l(t.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("account.search.group")},{default:n(()=>[o(R,{value:c.groupId,"onUpdate:value":a[5]||(a[5]=t=>c.groupId=t),placeholder:e.$t("account.search.groupPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:L},{default:n(()=>[(u(!0),r(b,null,T(F.value,t=>(u(),y(I,{key:t.id,value:t.id},{default:n(()=>[m(l(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(f,{label:e.$t("account.search.member")},{default:n(()=>[o(R,{value:c.memberId,"onUpdate:value":a[6]||(a[6]=t=>c.memberId=t),placeholder:e.$t("account.search.memberPlaceholder"),style:{width:"120px"},"allow-clear":"","show-search":"","filter-option":!1,onSearch:W},{default:n(()=>[(u(!0),r(b,null,T(B.value,t=>(u(),y(I,{key:t.id,value:t.id},{default:n(()=>[m(l(t.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(f,null,{default:n(()=>[o(A,null,{default:n(()=>[o(j,{type:"primary",onClick:V},{default:n(()=>[m(l(e.$t("common.search")),1)]),_:1}),o(j,{onClick:te},{default:n(()=>[m(l(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),i("div",Ne,[o(j,{onClick:oe},{default:n(()=>[m(l(e.$t("account.list.oldAccount")),1)]),_:1}),i("div",Ue,[o(A,null,{default:n(()=>[o(j,{type:"primary",onClick:G},{default:n(()=>[m(l(e.$t("common.batchResolve")),1)]),_:1}),o(j,{danger:"",onClick:ue},{default:n(()=>[m(l(e.$t("common.batchReject")),1)]),_:1})]),_:1})])])]),o(_e,{columns:x.value,"data-source":H.value,loading:D.value,pagination:w,"row-selection":ee,rowKey:"id",onChange:le},{bodyCell:n(({column:t,record:s})=>[t.key==="accountInfo"?(u(),r("div",ze,[o(A,null,{default:n(()=>[o(he,{src:s.channelIcon,size:"small"},null,8,["src"]),i("span",null,l(s.account),1)]),_:2},1024),i("div",null,[i("div",De,[i("span",Me,l(e.$t("account.list.homepage"))+"：",1),o(X,{content:s.homeUrl},{default:n(()=>[o(K,null,{default:n(()=>[i("a",{href:s.homeUrl,target:"_blank"},l(s.homeUrl),9,Pe)]),_:2},1024)]),_:2},1032,["content"])])]),i("div",null,[a[9]||(a[9]=i("span",{class:"label"},"uid：",-1)),o(X,{content:s.uid},null,8,["content"])]),i("div",Ye,[s.channelCustomFields.includes("fansCount")?(u(),r("div",Ee,l(e.$t("account.list.fansCount"))+"："+l(s.fansCount),1)):h("",!0),s.channelCustomFields.includes("friendsCount")?(u(),r("div",Fe,l(e.$t("account.list.friendsCount"))+"："+l(s.friendsCount),1)):h("",!0),s.channelCustomFields.includes("postsCount")?(u(),r("div",Be,l(e.$t("account.list.postsCount"))+"："+l(s.postsCount),1)):h("",!0)])])):h("",!0),t.key==="member"?(u(),r("div",He,[i("div",null,[o(K,{onClick:N=>ae(s)},{default:n(()=>[m(l(s.memberNickname),1)]),_:2},1032,["onClick"])]),o(A,{class:"group-name"},{default:n(()=>[i("span",null,l(s.groupName),1),s.isGroupOwner?(u(),y(je,{key:0})):h("",!0)]),_:2},1024)])):h("",!0),t.key==="accountAuditStatus"?(u(),r(b,{key:2},[m(l(Se(z).getEnumText("AccountAuditStatus",s.accountAuditStatus)),1)],64)):h("",!0),t.key==="rejectReason"?(u(),r(b,{key:3},[s.rejectReason?(u(),y(ve,{key:0,type:"danger"},{default:n(()=>[m(l(s.rejectReason),1)]),_:2},1024)):(u(),r("span",Ve,"--"))],64)):h("",!0),t.key==="waiterName"?(u(),r(b,{key:4},[m(l(s.waiterName||"--"),1)],64)):h("",!0),t.key==="action"?(u(),y(A,{key:5},{default:n(()=>[s.accountAuditStatus==="pending"?(u(),y(Y,{key:0,title:e.$t("account.list.resolveConfirm"),onConfirm:N=>se(s)},{default:n(()=>[i("a",null,l(e.$t("account.list.resolve")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),s.accountAuditStatus==="pending"?(u(),y(Y,{key:1,title:e.$t("account.list.rejectConfirm"),onConfirm:N=>ce(s)},{default:n(()=>[i("a",Ge,l(e.$t("account.list.reject")),1)]),_:2},1032,["title","onConfirm"])):h("",!0),i("a",{onClick:N=>ne(s)},l(e.$t("common.edit")),9,Le),o(Y,{title:e.$t("common.deleteConfirm"),onConfirm:N=>de(s)},{default:n(()=>[i("a",We,l(e.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):h("",!0)]),_:1},8,["columns","data-source","loading","pagination"])]),o(ye,{open:$.value,"onUpdate:open":a[8]||(a[8]=t=>$.value=t),title:e.$t("account.list.rejectReason"),onOk:ie,confirmLoading:M.value},{default:n(()=>[o(ge,{value:k.value,"onUpdate:value":a[7]||(a[7]=t=>k.value=t),placeholder:e.$t("account.list.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},Ze=be(Ke,[["__scopeId","data-v-9f77afb1"]]);export{Ze as default};
