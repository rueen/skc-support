import{E as Q,G as W,_ as X,r,a as z,j as Y,k as Z,H as ee,J as te,b as ae,d as s,c as o,w as n,e as i,l as oe,m as c,o as E,h as T,p as ne,q as le,A as S,K as B,s as se,y as ie,z as re}from"./index-BwTQ22HL.js";var ce=Q();const de=W(ce),ue={class:"article content-container"},pe={class:"table-container"},me={class:"table-header"},fe={class:"right"},_e=["onClick"],ve=["onClick"],ge={class:"editor-wrapper"},ye={__name:"index",setup(he){const v=r(!1),d=r(!1),p=r(!1),m=r("add"),b=r(),g=r(null),y=r(null);let l=null;const w={placeholderText:"请输入文章内容",height:300,toolbarButtons:["fontSize","textColor","backgroundColor","formatOL","html"],language:"zh_cn",imageUploadURL:S.imageUploadUrl,imageUploadParams:{type:"article"},imageUploadMethod:"POST",imageUploadHeaders:{Authorization:"Bearer "+localStorage.getItem("token")},imageMaxSize:5*1024*1024,imageAllowedTypes:["jpeg","jpg","png","gif"],events:{"image.uploaded":function(e){const t=JSON.parse(e);return t.code===0&&t.data&&t.data.url?t.data.url:!1},"image.error":function(e,t){c.error("图片上传失败: "+(e.message||"未知错误"))}}},a=z({title:"",location:"",content:""}),A={title:[{required:!0,message:"请输入文章标题"}],content:[{required:!0,message:"请输入文章内容"}]},O=[{title:"文章标题",dataIndex:"title",key:"title"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",key:"action",width:150}],x=r([]),f=z({current:1,pageSize:10,total:0}),j=Y(()=>({add:"添加文章",edit:"编辑文章"})[m.value]),D=async e=>{try{const t=await se("article.delete",{id:e.id},{urlParams:{id:e.id}});t.code===0?(c.success("删除成功"),_()):c.error(t.message)}catch(t){console.error(t)}},I=()=>{m.value="add",a.title="",a.location="",a.content="",d.value=!0},L=e=>{window.open(`${S.h5Url}/article/${e.id}`,"_blank")},N=e=>{m.value="edit",a.title=e.title,a.location=e.location,a.content=e.content,d.value=!0,g.value=e.id,B(()=>{l&&l.html.set(a.content||"")})},P=async()=>{p.value=!0;try{const e=await re("article.add",{...a});e.code===0?(c.success("添加成功"),d.value=!1,_()):c.error(e.message)}catch(e){console.error(e)}finally{p.value=!1}},V=async()=>{p.value=!0;try{const e=await ie("article.edit",{id:g.value,...a},{urlParams:{id:g.value}});e.code===0?(c.success("保存成功"),d.value=!1,_()):c.error(e.message)}catch(e){console.error(e)}finally{p.value=!1}},$=async()=>{switch(await b.value.validate(),m.value){case"add":await P();break;case"edit":await V();break}},_=async()=>{v.value=!0;try{const e=await oe("article.list",{page:f.current,pageSize:f.pageSize});e.code===0?(x.value=e.data.list,f.total=e.data.total):c.error(e.message)}finally{v.value=!1}};Z(()=>{_(),ee(d,e=>{e&&B(()=>{y.value&&!l&&q()})})});const q=()=>{l&&l.destroy(),l=new de(y.value,{...w,events:{...w.events,contentChanged:function(){a.content=this.html.get()},initialized:function(){this.html.set(a.content||"")}}})};return te(()=>{l&&(l.destroy(),l=null)}),(e,t)=>{const M=i("a-button"),F=i("a-typography-text"),R=i("a-popconfirm"),H=i("a-space"),J=i("a-table"),C=i("a-input"),h=i("a-form-item"),G=i("a-form"),K=i("a-modal");return E(),ae("div",ue,[s("div",pe,[s("div",me,[t[4]||(t[4]=s("div",{class:"left"},null,-1)),s("div",fe,[o(M,{type:"primary",onClick:I},{default:n(()=>t[3]||(t[3]=[T(" 添加文章 ")])),_:1})])]),o(J,{columns:O,"data-source":x.value,loading:v.value,pagination:f},{bodyCell:n(({column:u,record:k})=>[u.key==="action"?(E(),ne(H,{key:0},{default:n(()=>[s("a",{onClick:U=>L(k)},"预览",8,_e),s("a",{onClick:U=>N(k)},"编辑",8,ve),o(R,{title:"确定要删除该文章吗？",onConfirm:U=>D(k)},{default:n(()=>[s("a",null,[o(F,{type:"danger"},{default:n(()=>t[5]||(t[5]=[T("删除")])),_:1})])]),_:2},1032,["onConfirm"])]),_:2},1024)):le("",!0)]),_:1},8,["data-source","loading","pagination"])]),o(K,{open:d.value,"onUpdate:open":t[2]||(t[2]=u=>d.value=u),title:j.value,width:800,confirmLoading:p.value,onOk:$},{default:n(()=>[o(G,{ref_key:"formRef",ref:b,model:a,rules:A,"label-col":{span:4},"wrapper-col":{span:19}},{default:n(()=>[o(h,{label:"文章标题",name:"title"},{default:n(()=>[o(C,{value:a.title,"onUpdate:value":t[0]||(t[0]=u=>a.title=u),placeholder:"请输入文章标题"},null,8,["value"])]),_:1}),o(h,{label:"location",name:"location"},{default:n(()=>[o(C,{value:a.location,"onUpdate:value":t[1]||(t[1]=u=>a.location=u),placeholder:"英文字母、数字（不要以数字开头）、下划线"},null,8,["value"])]),_:1}),o(h,{label:"文章内容",name:"content"},{default:n(()=>[s("div",ge,[s("textarea",{ref_key:"editorEl",ref:y},null,512)])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},be=X(ye,[["__scopeId","data-v-18b25ea4"]]);export{be as default};
