import{_ as pe,a as _e,b as fe,r as C,c as P,x as he,j as ve,k as ge,d as v,e as u,f as n,s as g,w as a,g as c,h as ke,l as D,m as w,o as r,F as T,n as N,p as k,i as p,t as s,q as ye,M as be,v as we}from"./index-B__5RQXK.js";import{_ as j}from"./CopyContent-R07-iFPw.js";import{G as Ce}from"./GroupOwner-CSRiCLZV.js";import{d as Te}from"./download-DEDvENfL.js";import{d as $e,e as B}from"./routeParamsEncryption-BKFTaOaF.js";const Ie={class:"member-list content-container"},Se={class:"table-container"},Oe={class:"table-header"},De={class:"left"},Ne={class:"right"},Me={class:"link-text-container"},Re={class:"label"},Ee=["href"],Fe={key:1},ze={style:{color:"#999","font-size":"12px"}},Ae={key:0},Ue=["onClick"],xe=["onClick"],Ye={class:"danger"},qe={key:0,class:"count-container"},He={__name:"list",setup(Pe){const L=_e(),{t:m}=fe(),$=ke(),I=he(),M=C(!1),o=P({keyword:"",channelId:void 0,groupId:I.query.groupId,inviter:"",completedTaskCount:void 0,createTimeRange:[]}),R=C([]),F=C(0),_=P({current:1,pageSize:10,total:0}),z=C([]),V=ve(()=>[{title:m("member.list.memberNickname"),key:"nickname"},{title:m("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:m("member.list.accounts"),key:"accountList"},{title:m("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:m("member.list.inviter"),key:"inviterNickname"},{title:m("member.list.group"),key:"groups"},{title:m("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:m("member.list.action"),key:"action",fixed:"right",width:150}]),G=()=>{const e=I.query.filters;if(e){const t={},f=$e(e);Object.keys(f).forEach(y=>{y==="current"?_.current=f[y]:t[y]=f[y]}),Object.assign(o,{},t);const i={...I.query};delete i.filters,$.replace({path:I.path,query:i})}},A=()=>{_.current=1,S()},J=()=>{Object.assign(o,{keyword:"",channelId:void 0,groupId:void 0,inviter:"",completedTaskCount:void 0,createTimeRange:[]}),A()},K=e=>{_.current=e.current,_.pageSize=e.pageSize,S()},Q=()=>{$.push("/member/create")},W=e=>{const t=B({...o,current:_.current});$.push({name:"MemberEdit",params:{id:e.id},query:{filters:t}})},U=e=>{const t=B({...o,current:_.current});$.push({name:"MemberView",params:{id:e},query:{filters:t}})},X=async e=>{const t=await we("member.delete",{},{urlParams:{id:e.id}});t.code===0?(w.success("删除成功"),S()):w.error(t.message)},S=async()=>{var e,t;M.value=!0;try{const f={page:_.current,pageSize:_.pageSize,keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviter:o.inviter,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(t=o.createTimeRange)==null?void 0:t[1]},i=await D("member.list",f);i.code===0?(R.value=i.data.list,_.total=i.data.total,F.value=i.data.totalApproved):w.error(i.message)}finally{M.value=!1}},x=async(e="")=>{try{const t=await D("group.list",{page:1,pageSize:50,groupName:e});t.code===0&&(z.value=t.data.list||[])}catch{w.error("获取群组列表失败")}},Z=()=>{be.confirm({title:m("common.export"),content:m("common.confirmExportContent"),onOk:async()=>{var e,t;try{const f=w.loading(m("common.exporting"),0),i={keyword:o.keyword,channelId:o.channelId,groupId:o.groupId,inviter:o.inviter,completedTaskCount:o.completedTaskCount,createStartTime:(e=o.createTimeRange)==null?void 0:e[0],createEndTime:(t=o.createTimeRange)==null?void 0:t[1]};await Te("member.export",i,`会员列表_${new Date().toLocaleDateString()}.xlsx`),f(),w.success(m("common.exportSuccess"))}catch(f){console.error("导出失败:",f),w.error(m("common.exportFailed"))}}})},ee=C([]),te=async(e="")=>{const t=await D("member.list",{page:1,pageSize:50,memberNickname:e});t.code===0&&(ee.value=t.data.list||[])},E=C([]),ae=async()=>{if(!E.value.length)try{const e=await D("channel.list");e.code===0&&(E.value=e.data.list)}catch(e){console.error(e)}};return ge(()=>{G(),S(),x(),ae(),te()}),(e,t)=>{const f=c("a-input"),i=c("a-form-item"),y=c("a-select-option"),Y=c("a-select"),ne=c("a-input-number"),oe=c("a-range-picker"),O=c("a-button"),b=c("a-space"),le=c("a-form"),re=c("DownloadOutlined"),se=c("plus-outlined"),q=c("a-tag"),ie=c("a-avatar"),ce=c("a-typography-link"),ue=c("a-popconfirm"),de=c("a-table"),H=c("a-descriptions-item"),me=c("a-descriptions");return r(),v("div",Ie,[u("div",Se,[u("div",Oe,[u("div",De,[n(le,{layout:"inline",model:o},{default:a(()=>[n(i,{label:e.$t("member.search.keyword")},{default:a(()=>[n(f,{value:o.keyword,"onUpdate:value":t[0]||(t[0]=l=>o.keyword=l),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("common.channel")},{default:a(()=>[n(Y,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=l=>o.channelId=l),placeholder:e.$t("common.selectPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:a(()=>[(r(!0),v(T,null,N(E.value,l=>(r(),k(y,{key:l.id,value:l.id},{default:a(()=>[p(s(l.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("member.search.group")},{default:a(()=>[n(Y,{value:o.groupId,"onUpdate:value":t[2]||(t[2]=l=>o.groupId=l),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:x,style:{width:"200px"}},{default:a(()=>[(r(!0),v(T,null,N(z.value,l=>(r(),k(y,{key:l.id,value:l.id},{default:a(()=>[p(s(l.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("member.search.inviter")},{default:a(()=>[n(f,{value:o.inviter,"onUpdate:value":t[3]||(t[3]=l=>o.inviter=l),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),n(i,{label:e.$t("member.list.completedTaskCount")},{default:a(()=>[n(ne,{value:o.completedTaskCount,"onUpdate:value":t[4]||(t[4]=l=>o.completedTaskCount=l),min:0,max:9999,style:{width:"100px!important"}},null,8,["value"])]),_:1},8,["label"]),n(i,{label:e.$t("member.search.createTime")},{default:a(()=>[n(oe,{value:o.createTimeRange,"onUpdate:value":t[5]||(t[5]=l=>o.createTimeRange=l),"show-time":{format:"HH:mm"},format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"280px"}},null,8,["value"])]),_:1},8,["label"]),n(i,null,{default:a(()=>[n(b,null,{default:a(()=>[n(O,{type:"primary",onClick:A},{default:a(()=>[p(s(e.$t("common.search")),1)]),_:1}),n(O,{onClick:J},{default:a(()=>[p(s(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),u("div",Ne,[n(b,null,{default:a(()=>[R.value.length?(r(),k(O,{key:0,onClick:Z},{icon:a(()=>[n(re)]),default:a(()=>[p(" "+s(e.$t("common.export")),1)]),_:1})):g("",!0),n(O,{type:"primary",onClick:Q},{icon:a(()=>[n(se)]),default:a(()=>[p(" "+s(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),n(de,{columns:V.value,"data-source":R.value,loading:M.value,pagination:_,onChange:K},{bodyCell:a(({column:l,record:h})=>[l.key==="nickname"?(r(),k(b,{key:0},{default:a(()=>[u("span",null,s(h.nickname),1),h.isNew?(r(),k(q,{key:0,color:"green"},{default:a(()=>t[6]||(t[6]=[p("new")])),_:1})):g("",!0)]),_:2},1024)):g("",!0),l.key==="accountList"?(r(),k(b,{key:1,direction:"vertical"},{default:a(()=>[(r(!0),v(T,null,N(h.accountList,d=>(r(),v("div",null,[u("div",null,[n(b,null,{default:a(()=>[p(s(e.$t("member.list.account"))+"：",1),n(ie,{src:d.channelIcon,size:"small"},null,8,["src"]),p(" "+s(d.account)+" ",1),n(q,{color:"warning"},{default:a(()=>[p(s(ye(L).getEnumText("AccountAuditStatus",d.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),u("div",Me,[u("span",Re,s(e.$t("member.list.homepage"))+"：",1),n(j,{content:d.homeUrl},{default:a(()=>[u("a",{href:d.homeUrl,target:"_blank",class:"link-text"},s(d.homeUrl),9,Ee)]),_:2},1032,["content"])]),u("div",null,[t[7]||(t[7]=u("span",{class:"label"},"uid：",-1)),n(j,{content:d.uid},null,8,["content"])])]))),256))]),_:2},1024)):g("",!0),l.key==="inviterNickname"?(r(),v(T,{key:2},[h.inviterId?(r(),k(ce,{key:0,onClick:d=>U(h.inviterId)},{default:a(()=>[p(s(h.inviterNickname),1)]),_:2},1032,["onClick"])):(r(),v("span",Fe,"--"))],64)):g("",!0),l.key==="groups"?(r(),v(T,{key:3},[(r(!0),v(T,null,N(h.groups,d=>(r(),v("div",null,[n(b,null,{default:a(()=>[u("span",null,s(d.groupName),1),d.isOwner?(r(),k(Ce,{key:0})):g("",!0)]),_:2},1024),u("div",ze,s(d.joinTime),1)]))),256)),!h.groups||h.groups.length===0?(r(),v("span",Ae,"--")):g("",!0)],64)):g("",!0),l.key==="action"?(r(),k(b,{key:4},{default:a(()=>[u("a",{onClick:d=>W(h)},s(e.$t("member.list.edit")),9,Ue),u("a",{onClick:d=>U(h.id)},s(e.$t("member.list.view")),9,xe),n(ue,{title:e.$t("member.list.deleteConfirm"),onConfirm:d=>X(h)},{default:a(()=>[u("a",Ye,s(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):g("",!0)]),_:1},8,["columns","data-source","loading","pagination"]),_.total?(r(),v("div",qe,[n(me,{column:2},{default:a(()=>[n(H,{label:e.$t("common.totalCount"),style:{width:"125px"}},{default:a(()=>[p(s(_.total),1)]),_:1},8,["label"]),n(H,{label:e.$t("member.list.totalApproved")},{default:a(()=>[p(s(F.value),1)]),_:1},8,["label"])]),_:1})])):g("",!0)])])}}},Je=pe(He,[["__scopeId","data-v-2a872c94"]]);export{Je as default};
