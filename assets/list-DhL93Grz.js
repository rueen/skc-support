import{_ as ee,a as te,b as oe,r as x,c as A,x as ae,j as ne,k as le,d as m,e as s,f as o,w as t,g as u,l as E,m as h,h as se,o as n,F as y,n as I,p as b,i as p,t as l,s as _,q as re,M as ie,v as ce}from"./index-C3T5dVkq.js";import{_ as B}from"./CopyContent--iaVAEkd.js";import{G as ue}from"./GroupOwner-DWej0ra9.js";import{d as de}from"./download-BH4veutA.js";const me={class:"member-list content-container"},pe={class:"table-container"},_e={class:"table-header"},fe={class:"left"},ge={class:"right"},ke={class:"link-text-container"},he={class:"label"},be=["href"],ye={key:0},ve=["onClick"],we=["onClick"],Ce={class:"danger"},$e={__name:"list",setup(Se){const L=te(),{t:r}=oe(),C=se(),U=ae(),$=x(!1),f=A({keyword:"",groupId:U.query.groupId}),S=x([]),g=A({current:1,pageSize:10,total:0}),T=x([]),V=ne(()=>[{title:r("member.list.memberNickname"),key:"nickname"},{title:r("member.list.memberAccount"),dataIndex:"account",key:"account"},{title:r("member.list.accounts"),key:"accountList"},{title:r("member.list.completedTaskCount"),dataIndex:"completedTaskCount",key:"completedTaskCount"},{title:r("member.list.inviter"),key:"inviterNickname"},{title:r("member.list.group"),key:"groups"},{title:r("member.list.createTime"),dataIndex:"createTime",key:"createTime",width:180},{title:r("member.list.action"),key:"action",fixed:"right",width:150}]),D=()=>{g.current=1,v()},F=()=>{Object.assign(f,{keyword:"",groupId:void 0}),D()},M=e=>{g.current=e.current,g.pageSize=e.pageSize,v()},G=()=>{C.push("/member/create")},P=e=>{C.push(`/member/edit/${e.id}`)},R=e=>{C.push(`/member/view/${e.id}`)},j=async e=>{const a=await ce("member.delete",{},{urlParams:{id:e.id}});a.code===0?(h.success("删除成功"),v()):h.error(a.message)},v=async()=>{$.value=!0;try{const e=await E("member.list",{page:g.current,pageSize:g.pageSize,...f});e.code===0?(S.value=e.data.list,g.total=e.data.total):h.error(e.message)}finally{$.value=!1}},O=async(e="")=>{try{const a=await E("group.list",{page:1,pageSize:50,groupName:e});a.code===0&&(T.value=a.data.list||[])}catch{h.error("获取群组列表失败")}},q=()=>{ie.confirm({title:r("common.export"),content:r("common.confirmExportContent"),onOk:async()=>{try{const e=h.loading(r("common.exporting"),0),a={...f};await de("member.export",a,`会员列表_${new Date().toLocaleDateString()}.xlsx`),e(),h.success(r("common.exportSuccess"))}catch(e){console.error("导出失败:",e),h.error(r("common.exportFailed"))}}})};return le(()=>{v(),O()}),(e,a)=>{const H=u("a-input"),N=u("a-form-item"),J=u("a-select-option"),K=u("a-select"),w=u("a-button"),k=u("a-space"),Q=u("a-form"),W=u("DownloadOutlined"),X=u("plus-outlined"),z=u("a-tag"),Y=u("a-popconfirm"),Z=u("a-table");return n(),m("div",me,[s("div",pe,[s("div",_e,[s("div",fe,[o(Q,{layout:"inline",model:f},{default:t(()=>[o(N,{label:e.$t("member.search.keyword")},{default:t(()=>[o(H,{value:f.keyword,"onUpdate:value":a[0]||(a[0]=i=>f.keyword=i),placeholder:e.$t("member.search.keywordPlaceholder"),"allow-clear":""},null,8,["value","placeholder"])]),_:1},8,["label"]),o(N,{label:e.$t("member.search.group")},{default:t(()=>[o(K,{value:f.groupId,"onUpdate:value":a[1]||(a[1]=i=>f.groupId=i),placeholder:e.$t("member.search.groupPlaceholder"),"allow-clear":"","show-search":"","filter-option":!1,onSearch:O,style:{width:"200px"}},{default:t(()=>[(n(!0),m(y,null,I(T.value,i=>(n(),b(J,{key:i.id,value:i.id},{default:t(()=>[p(l(i.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),o(N,null,{default:t(()=>[o(k,null,{default:t(()=>[o(w,{type:"primary",onClick:D},{default:t(()=>[p(l(e.$t("common.search")),1)]),_:1}),o(w,{onClick:F},{default:t(()=>[p(l(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),s("div",ge,[o(k,null,{default:t(()=>[S.value.length?(n(),b(w,{key:0,onClick:q},{icon:t(()=>[o(W)]),default:t(()=>[p(" "+l(e.$t("common.export")),1)]),_:1})):_("",!0),o(w,{type:"primary",onClick:G},{icon:t(()=>[o(X)]),default:t(()=>[p(" "+l(e.$t("member.list.add")),1)]),_:1})]),_:1})])]),o(Z,{columns:V.value,"data-source":S.value,loading:$.value,pagination:g,onChange:M},{bodyCell:t(({column:i,record:d})=>[i.key==="nickname"?(n(),b(k,{key:0},{default:t(()=>[s("span",null,l(d.nickname),1),d.isNew?(n(),b(z,{key:0,color:"green"},{default:t(()=>a[2]||(a[2]=[p("new")])),_:1})):_("",!0)]),_:2},1024)):_("",!0),i.key==="accountList"?(n(),b(k,{key:1,direction:"vertical"},{default:t(()=>[(n(!0),m(y,null,I(d.accountList,c=>(n(),m("div",null,[s("div",null,[o(k,null,{default:t(()=>[p(l(e.$t("member.list.account"))+"："+l(c.account)+" ",1),o(z,{color:"warning"},{default:t(()=>[p(l(re(L).getEnumText("AccountAuditStatus",c.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),s("div",ke,[s("span",he,l(e.$t("member.list.homepage"))+"：",1),o(B,{content:c.homeUrl},{default:t(()=>[s("a",{href:c.homeUrl,target:"_blank",class:"link-text"},l(c.homeUrl),9,be)]),_:2},1032,["content"])]),s("div",null,[a[3]||(a[3]=s("span",{class:"label"},"uid：",-1)),o(B,{content:c.uid},null,8,["content"])])]))),256))]),_:2},1024)):_("",!0),i.key==="inviterNickname"?(n(),m(y,{key:2},[p(l(d.inviterNickname||"--"),1)],64)):_("",!0),i.key==="groups"?(n(),m(y,{key:3},[(n(!0),m(y,null,I(d.groups,c=>(n(),m("div",null,[o(k,null,{default:t(()=>[s("span",null,l(c.groupName),1),c.isOwner?(n(),b(ue,{key:0})):_("",!0)]),_:2},1024)]))),256)),!d.groups||d.groups.length===0?(n(),m("span",ye,"--")):_("",!0)],64)):_("",!0),i.key==="action"?(n(),b(k,{key:4},{default:t(()=>[s("a",{onClick:c=>P(d)},l(e.$t("member.list.edit")),9,ve),s("a",{onClick:c=>R(d)},l(e.$t("member.list.view")),9,we),o(Y,{title:e.$t("member.list.deleteConfirm"),onConfirm:c=>j(d)},{default:t(()=>[s("a",Ce,l(e.$t("member.list.delete")),1)]),_:2},1032,["title","onConfirm"])]),_:2},1024)):_("",!0)]),_:1},8,["columns","data-source","loading","pagination"])])])}}},De=ee($e,[["__scopeId","data-v-0af2cf0b"]]);export{De as default};
