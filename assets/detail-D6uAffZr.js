import{_ as re,b as ce,a as me,x as be,j as ke,c as D,r as g,k as fe,d as k,f as a,e as r,w as t,g as f,t as s,F as S,n as R,p as m,s as b,A as E,m as p,l as O,h as pe,o as d,i as o,q as N}from"./index-D-x0KPZe.js";import{P as _e}from"./PageHeader-BYMz8Nlc.js";import{_ as W}from"./CopyContent-BjbFktZA.js";import{G as Te}from"./GroupOwner-CYfRIBgp.js";import{d as he}from"./routeParamsEncryption-BKFTaOaF.js";const ve={class:"task-audit-detail content-container"},ye={class:"detail-container"},ge={key:0},$e={key:1},Ie={class:"detail-section"},Ce={class:"section-title"},Se={key:0},qe={class:"link-text-container"},we=["href"],Ae={class:"detail-section"},je={class:"section-title"},Pe={class:"link-text-container"},Re=["href"],Ne={key:1},Fe={class:"detail-section"},Be={class:"section-title"},Le={class:"footer-btns"},De={class:"left"},Ee={class:"right"},Oe={__name:"detail",setup(Ue){const{t:q}=ce(),w=me(),_=be(),F=pe(),A=_.query.type,U=ke(()=>n.taskPreAuditStatus==="approved"?"confirm":"pre"),j=g(!1),B=g(!1),$=g(""),z=e=>{try{return e?e.startsWith("http://")||e.startsWith("https://"):!1}catch{return!1}},v=g(null),n=D({submitContent:{}}),c=D({}),h=D({}),L=g(null),H=()=>{const e=_.query.filters;e&&(L.value=he(e))},Q=async()=>{const e=U.value==="confirm"?"taskSubmitted.batchConfirmAuditApprove":"taskSubmitted.batchPreAuditApprove",l=await E(e,{ids:[v.value]});l.code===0?(p.success(q("submittedTasks.resolveSuccess")),I()):p.error(l.message)},J=()=>{$.value="",j.value=!0},K=async()=>{if(!$.value){p.error(q("submittedTasks.rejectReasonRequired"));return}B.value=!0;try{const e=U.value==="confirm"?"taskSubmitted.batchConfirmAuditReject":"taskSubmitted.batchPreAuditReject";await E(e,{ids:[v.value],reason:$.value}),p.success(q("submittedTasks.rejectSuccess")),j.value=!1,I()}catch(e){p.error(e.message)}finally{B.value=!1}},X=()=>{const e=A==="confirm"?"/confirm-audit-tasks":"/pre-audit-tasks",l={};_.query.filters&&(l.filters=_.query.filters),F.push({path:e,query:l})},Y=()=>{const e={type:A};_.query.filters&&(e.filters=_.query.filters),F.push({path:`/submitted-tasks/detail/${n.prevTaskId}`,query:e}),v.value=n.prevTaskId,I()},Z=()=>{const e={type:A};_.query.filters&&(e.filters=_.query.filters),F.push({path:`/submitted-tasks/detail/${n.nextTaskId}`,query:e}),v.value=n.nextTaskId,I()},x=async e=>{try{const l=await O("task.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(c,l.data):p.error(l.message)}catch(l){p.error(l.message)}},ee=async e=>{try{const l=await O("member.detail",{},{urlParams:{id:e}});l.code===0?Object.assign(h,l.data):p.error(l.message)}catch{p.error(q("submittedTasks.detail.getMemberDetailFailed"))}},I=async()=>{try{const e={auditType:A,id:v.value};L.value&&(e.filtersParam=L.value);const l=await E("taskSubmitted.detail",e);l.code===0&&(Object.assign(n,l.data),l.data.taskId!=null&&await x(l.data.taskId),l.data.memberId!=null&&await ee(l.data.memberId),l.data.taskId!=null&&l.data.memberId!=null&&await te())}catch(e){p.error(e.message)}},V=g([]),te=async()=>{const e=await O("account.list",{taskId:n.taskId,memberId:n.memberId,channelId:c.channelId});e.code===0&&(V.value=e.data.list||[])};return fe(async()=>{v.value=_.params.id,H(),await I()}),(e,l)=>{const G=f("a-avatar"),y=f("a-space"),i=f("a-descriptions-item"),C=f("a-descriptions"),ae=f("a-collapse-panel"),se=f("a-collapse"),M=f("a-tag"),le=f("a-image"),P=f("a-button"),ie=f("a-textarea"),ne=f("a-modal");return d(),k("div",ve,[a(_e,{title:e.$t("submittedTasks.detail.title"),back:!0,useDefaultBack:!1,onBack:X},null,8,["title"]),r("div",ye,[a(se,{ghost:"",class:"collapse"},{default:t(()=>[a(ae,{header:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[a(C,{column:2},{default:t(()=>[a(i,{label:e.$t("submittedTasks.detail.taskName")},{default:t(()=>[a(y,null,{default:t(()=>[a(G,{src:c.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(c.taskName),1)]),_:1})]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.category")},{default:t(()=>[o(s(c.category),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.taskType")},{default:t(()=>[o(s(N(w).getEnumText("TaskType",c.taskType)),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.reward")},{default:t(()=>[o(s(c.reward),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.brand")},{default:t(()=>[o(s(c.brand),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.specifyGroup")},{default:t(()=>{var u;return[c.groupMode===0?(d(),k("span",ge,s(e.$t("submittedTasks.detail.noSpecify")),1)):(d(),k("span",$e,s((u=c.groupNames)==null?void 0:u.join("、")),1))]}),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.taskTime")},{default:t(()=>[o(s(c.startTime)+" "+s(e.$t("submittedTasks.detail.to"))+" "+s(c.endTime),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.quota")},{default:t(()=>[o(s(c.unlimitedQuota?e.$t("submittedTasks.detail.noLimit"):c.quota),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.fansRequired")},{default:t(()=>[o(s(c.fansRequired),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.contentRequirement")},{default:t(()=>[o(s(c.contentRequirement),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.taskInfo")},{default:t(()=>[o(s(c.taskInfo),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["header"])]),_:1}),r("div",Ie,[r("div",Ce,s(e.$t("submittedTasks.detail.memberInfo")),1),a(C,{column:2},{default:t(()=>[a(i,{label:e.$t("submittedTasks.detail.memberNickname")},{default:t(()=>[a(y,null,{default:t(()=>[r("span",null,s(h.nickname),1),h.isNew?(d(),m(M,{key:0,color:"green"},{default:t(()=>l[2]||(l[2]=[o("new")])),_:1})):b("",!0)]),_:1})]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[o(s(h.account),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.group")},{default:t(()=>[(d(!0),k(S,null,R(h.groups,u=>(d(),m(y,null,{default:t(()=>[r("span",null,s(u.groupName),1),u.isOwner?(d(),m(Te,{key:0})):b("",!0)]),_:2},1024))),256)),!h.groups||h.groups.length===0?(d(),k("span",Se,"--")):b("",!0)]),_:1},8,["label"])]),_:1}),(d(!0),k(S,null,R(V.value,u=>(d(),k("div",{key:u.channelId},[a(C,{column:2},{default:t(()=>[a(i,{label:e.$t("submittedTasks.detail.account")},{default:t(()=>[a(y,null,{default:t(()=>[a(G,{src:u.channelIcon,size:"small"},null,8,["src"]),r("span",null,s(u.account),1),a(M,{color:"warning"},{default:t(()=>[o(s(N(w).getEnumText("AccountAuditStatus",u.accountAuditStatus)),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["label"]),a(i,{label:e.$t("submittedTasks.detail.homepage")},{default:t(()=>[a(W,{content:u.homeUrl},{default:t(()=>[r("div",qe,[r("a",{href:u.homeUrl,target:"_blank",class:"link-text"},s(u.homeUrl),9,we)])]),_:2},1032,["content"])]),_:2},1032,["label"]),u.channelCustomFields.includes("fansCount")?(d(),m(i,{key:0,label:e.$t("submittedTasks.detail.fansCount")},{default:t(()=>[o(s(u.fansCount),1)]),_:2},1032,["label"])):b("",!0),u.channelCustomFields.includes("friendsCount")?(d(),m(i,{key:1,label:e.$t("submittedTasks.detail.friendsCount")},{default:t(()=>[o(s(u.friendsCount),1)]),_:2},1032,["label"])):b("",!0),u.channelCustomFields.includes("postsCount")?(d(),m(i,{key:2,label:e.$t("submittedTasks.detail.postsCount")},{default:t(()=>[o(s(u.postsCount),1)]),_:2},1032,["label"])):b("",!0)]),_:2},1024)]))),128))]),r("div",Ae,[r("div",je,s(e.$t("submittedTasks.detail.submitInfo")),1),a(C,{column:1},{default:t(()=>{var u;return[(d(!0),k(S,null,R((u=n==null?void 0:n.submitContent)==null?void 0:u.customFields,(T,ue)=>(d(),m(i,{key:ue,label:T.title},{default:t(()=>[T.type==="image"?(d(!0),k(S,{key:0},R(T.value,(de,oe)=>(d(),m(le,{src:de.url,width:60,key:oe},null,8,["src"]))),128)):(d(),k(S,{key:1},[z(T.value)?(d(),m(W,{key:0,content:T.value},{default:t(()=>[r("div",Pe,[r("a",{href:T.value,target:"_blank",class:"link-text"},s(T.value),9,Re)])]),_:2},1032,["content"])):(d(),k("span",Ne,s(T.value),1))],64))]),_:2},1032,["label"]))),128))]}),_:1})]),r("div",Fe,[r("div",Be,s(e.$t("submittedTasks.detail.auditInfo")),1),a(C,{column:2},{default:t(()=>[a(i,{label:e.$t("submittedTasks.detail.submitTime")},{default:t(()=>[o(s(n.submitTime),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.preAuditStatus")},{default:t(()=>[o(s(N(w).getEnumText("TaskPreAuditStatus",n.taskPreAuditStatus)),1)]),_:1},8,["label"]),a(i,{label:e.$t("submittedTasks.detail.preAuditor")},{default:t(()=>[o(s(n.preWaiterName),1)]),_:1},8,["label"]),n.taskPreAuditStatus==="approved"?(d(),m(i,{key:0,label:e.$t("submittedTasks.detail.confirmAuditStatus")},{default:t(()=>[o(s(N(w).getEnumText("TaskAuditStatus",n.taskAuditStatus)),1)]),_:1},8,["label"])):b("",!0),n.taskPreAuditStatus==="approved"?(d(),m(i,{key:1,label:e.$t("submittedTasks.detail.confirmAuditor")},{default:t(()=>[o(s(n.waiterName),1)]),_:1},8,["label"])):b("",!0),n.auditStatus==="rejected"?(d(),m(i,{key:2,label:e.$t("submittedTasks.detail.rejectReason")},{default:t(()=>[o(s(n.rejectReason),1)]),_:1},8,["label"])):b("",!0),a(i,{label:e.$t("submittedTasks.detail.updateTime")},{default:t(()=>[o(s(n.updateTime),1)]),_:1},8,["label"])]),_:1})]),r("div",Le,[r("div",De,[n.auditStatus==="pending"?(d(),m(y,{key:0},{default:t(()=>[a(P,{type:"primary",onClick:Q},{default:t(()=>[o(s(e.$t("submittedTasks.detail.approve")),1)]),_:1}),a(P,{danger:"",onClick:J},{default:t(()=>[o(s(e.$t("submittedTasks.detail.reject")),1)]),_:1})]),_:1})):b("",!0)]),r("div",Ee,[a(y,null,{default:t(()=>[n.prevTaskId&&n.prevTaskId!==n.nextTaskId?(d(),m(P,{key:0,onClick:Y},{default:t(()=>[o(s(e.$t("submittedTasks.detail.prev")),1)]),_:1})):b("",!0),n.nextTaskId?(d(),m(P,{key:1,onClick:Z},{default:t(()=>[o(s(e.$t("submittedTasks.detail.next")),1)]),_:1})):b("",!0)]),_:1})])])]),a(ne,{open:j.value,"onUpdate:open":l[1]||(l[1]=u=>j.value=u),title:e.$t("submittedTasks.rejectReasonTitle"),onOk:K,confirmLoading:B.value},{default:t(()=>[a(ie,{value:$.value,"onUpdate:value":l[0]||(l[0]=u=>$.value=u),placeholder:e.$t("submittedTasks.rejectReasonPlaceholder"),rows:4},null,8,["value","placeholder"])]),_:1},8,["open","title","confirmLoading"])])}}},He=re(Oe,[["__scopeId","data-v-31721f60"]]);export{He as default};
