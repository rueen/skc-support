import{_ as se,r as u,b as $,j as re,k as ue,c as b,d as i,e as n,w as t,f as s,l as j,m as r,g as ie,o as d,F as O,n as F,p as w,h as m,t as k,s as q,v as de,z as ce,A as pe}from"./index-D6TRxwQf.js";import{_ as me}from"./CopyContent-D3YTw710.js";const _e={class:"group content-container"},fe={class:"table-container"},ge={class:"table-header"},ve={class:"left"},ke={class:"right"},ye=["onClick"],be={class:"link-text-container"},we=["href"],he={__name:"index",setup(Ne){const A=ie(),h=u(!1),_=u(!1),N=u(!1),y=u("add"),T=u(),c=$({groupName:"",ownerId:void 0}),l=$({groupName:"",groupLink:"",ownerId:void 0}),U=u(void 0),E={groupName:[{required:!0,message:"请输入群名称"}],groupLink:[{required:!0,message:"请输入群链接"}]},C=u([]),G=[{title:"群名称",dataIndex:"groupName",key:"groupName"},{title:"群链接",dataIndex:"groupLink",key:"groupLink",ellipsis:!0},{title:"群主",dataIndex:"ownerName",key:"ownerName"},{title:"成员人数",key:"memberCount",align:"right"},{title:"更新时间",dataIndex:"updateTime",key:"updateTime"},{title:"操作",key:"action",width:200}],V=u([]),f=$({current:1,pageSize:10,total:0}),P=re(()=>({add:"添加群",edit:"编辑群"})[y.value]),z=()=>{f.current=1,g()},H=()=>{Object.assign(c,{name:"",ownerId:void 0}),z()},J=e=>{Object.assign(f,e),g()},K=()=>{y.value="add",l.groupName="",l.groupLink="",l.ownerId=void 0,_.value=!0},Q=e=>{A.push(`/member?groupId=${e.id}`)},W=e=>{U.value=e.id,y.value="edit",l.groupName=e.groupName,l.groupLink=e.groupLink,l.ownerId=e.ownerId,_.value=!0},X=async e=>{try{const a=await de("group.delete",{id:e.id},{urlParams:{id:e.id}});a.code===0?(r.success("删除成功"),g()):r.error(a.message)}catch{r.error("删除失败")}},Y=async()=>{const e=await pe("group.add",l);e.code===0?(r.success("添加成功"),_.value=!1,g()):r.error(e.message)},Z=async()=>{const e=await ce("group.edit",l,{urlParams:{id:U.value}});e.code===0?(r.success("编辑成功"),_.value=!1,g()):r.error(e.message)},ee=async()=>{try{switch(await T.value.validate(),N.value=!0,y.value){case"add":await Y();break;case"edit":await Z();break}}catch(e){console.error(e)}finally{N.value=!1}},g=async()=>{h.value=!0;try{const e=await j("group.list",{page:f.current,pageSize:f.pageSize,...c});e.code===0?(V.value=e.data.list,f.total=e.data.total):r.error(e.message)}finally{h.value=!1}},I=async(e="")=>{try{const a=await j("member.list",{page:1,pageSize:50,memberNickname:e});a.code===0&&(C.value=a.data.list||[])}catch{r.error("获取会员列表失败")}};return ue(()=>{g(),I()}),(e,a)=>{const L=s("a-input"),v=s("a-form-item"),D=s("a-select-option"),B=s("a-select"),x=s("a-button"),S=s("a-space"),M=s("a-form"),ae=s("plus-outlined"),te=s("a-typography-link"),oe=s("a-popconfirm"),ne=s("a-table"),le=s("a-modal");return d(),b("div",_e,[i("div",fe,[i("div",ge,[i("div",ve,[n(M,{layout:"inline",model:c},{default:t(()=>[n(v,{label:"群名称"},{default:t(()=>[n(L,{value:c.groupName,"onUpdate:value":a[0]||(a[0]=o=>c.groupName=o),placeholder:"请输入群名称","allow-clear":""},null,8,["value"])]),_:1}),n(v,{label:"群主"},{default:t(()=>[n(B,{value:c.ownerId,"onUpdate:value":a[1]||(a[1]=o=>c.ownerId=o),placeholder:"请选择群主","allow-clear":"","show-search":"","filter-option":!1,onSearch:I,style:{width:"200px"}},{default:t(()=>[(d(!0),b(O,null,F(C.value,o=>(d(),w(D,{key:o.id,value:o.id},{default:t(()=>[m(k(o.memberNickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),n(v,null,{default:t(()=>[n(S,null,{default:t(()=>[n(x,{type:"primary",onClick:z},{default:t(()=>[m(k(e.$t("common.search")),1)]),_:1}),n(x,{onClick:H},{default:t(()=>[m(k(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),i("div",ke,[n(S,null,{default:t(()=>[n(x,{type:"primary",onClick:K},{icon:t(()=>[n(ae)]),default:t(()=>[a[6]||(a[6]=m(" 新增群组 "))]),_:1})]),_:1})])]),n(ne,{columns:G,"data-source":V.value,loading:h.value,pagination:f,onChange:J},{bodyCell:t(({column:o,record:p})=>[o.key==="memberCount"?(d(),b(O,{key:0},[m(k(p.memberCount)+" ",1),n(te,{onClick:R=>Q(p)},{default:t(()=>a[7]||(a[7]=[m("查看")])),_:2},1032,["onClick"])],64)):q("",!0),o.key==="action"?(d(),w(S,{key:1},{default:t(()=>[i("a",{onClick:R=>W(p)},"编辑",8,ye),n(oe,{title:"确定要删除该群吗？",onConfirm:R=>X(p)},{default:t(()=>a[8]||(a[8]=[i("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):o.key==="groupLink"?(d(),w(me,{key:2,content:p.groupLink},{default:t(()=>[i("div",be,[i("a",{href:p.groupLink,target:"_blank",class:"link-text"},k(p.groupLink),9,we)])]),_:2},1032,["content"])):q("",!0)]),_:1},8,["data-source","loading","pagination"])]),n(le,{open:_.value,"onUpdate:open":a[5]||(a[5]=o=>_.value=o),title:P.value,confirmLoading:N.value,onOk:ee},{default:t(()=>[n(M,{ref_key:"formRef",ref:T,model:l,rules:E,"label-col":{span:6},"wrapper-col":{span:16}},{default:t(()=>[n(v,{label:"群名称",name:"groupName"},{default:t(()=>[n(L,{value:l.groupName,"onUpdate:value":a[2]||(a[2]=o=>l.groupName=o),placeholder:"请输入群名称"},null,8,["value"])]),_:1}),n(v,{label:"群链接",name:"groupLink"},{default:t(()=>[n(L,{value:l.groupLink,"onUpdate:value":a[3]||(a[3]=o=>l.groupLink=o),placeholder:"请输入群链接"},null,8,["value"])]),_:1}),n(v,{label:"群主",name:"ownerId"},{default:t(()=>[n(B,{value:l.ownerId,"onUpdate:value":a[4]||(a[4]=o=>l.ownerId=o),placeholder:"请选择群主","allow-clear":"","show-search":"","filter-option":!1,onSearch:I},{default:t(()=>[(d(!0),b(O,null,F(C.value,o=>(d(),w(D,{key:o.id,value:o.id},{default:t(()=>[m(k(o.nickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}},Le=se(he,[["__scopeId","data-v-bb158001"]]);export{Le as default};
