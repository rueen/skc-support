import{_ as W,r as x,i as X,a as B,j as Y,k as Z,b as r,d as _,c as s,w as e,e as i,l as M,m as p,f as tt,o as l,F as m,n as V,p as C,h as d,t as c,g as w,D as et,P as at,q as f,M as nt,s as st}from"./index-IvzggnH7.js";import{d as ot}from"./download-CrYuOG8i.js";const lt={class:"task content-container"},ut={class:"table-container"},it={class:"table-header"},dt={class:"left"},rt={class:"right"},ct={key:0},_t={key:1},pt=["onClick"],kt={__name:"list",setup(mt){const N=tt(),b=x(!1),y=X(),o=B({taskName:"",channelId:void 0,taskStatus:void 0}),T=x([]),$=Y(()=>y.loaded?y.getEnumOptions("TaskStatus"):[]),z=[{title:"任务名称",key:"taskName"},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus",customRender:({text:a})=>y.getEnumText("TaskStatus",a)},{title:"任务名额 / 已提交",key:"taskQuota"},{title:"任务时间",key:"taskTime"},{title:"操作",key:"action",fixed:"right",width:180}],D=x([]),k=B({current:1,pageSize:10,total:0}),O=()=>{k.current=1,v()},F=()=>{o.taskName="",o.channelId=void 0,o.taskStatus=void 0,O()},P=a=>{Object.assign(k,a),v()},Q=()=>{N.push("/task/create")},R=a=>{N.push(`/task/edit/${a.id}`)},U=async a=>{try{const t=await st("task.delete",{},{urlParams:{id:a.id}});t.code===0?(p.success("删除成功"),v()):p.error(t.message)}catch{p.error("删除失败")}},j=()=>{nt.confirm({title:"确认导出",content:"确定要导出当前筛选条件下的所有任务数据吗？",onOk:async()=>{try{const a=p.loading("正在导出数据，请稍候...",0),t={...o};await ot("task.export",t,`任务列表_${new Date().toLocaleDateString()}.xlsx`),a(),p.success("导出成功")}catch(a){console.error("导出失败:",a),p.error("导出失败，请稍后重试")}}})},v=async()=>{b.value=!0;try{const a=await M("task.list",{page:k.current,pageSize:k.pageSize,...o});a.code===0?(D.value=a.data.list,k.total=a.data.total):p.error(a.message)}finally{b.value=!1}},q=async()=>{const a=await M("channel.list");a.code===0&&(T.value=a.data.list)};return Z(async()=>{v(),q()}),(a,t)=>{const A=i("a-input"),g=i("a-form-item"),E=i("a-select-option"),I=i("a-select"),h=i("a-button"),S=i("a-space"),L=i("a-form"),G=i("a-avatar"),H=i("a-popconfirm"),J=i("a-table");return l(),r("div",lt,[_("div",ut,[_("div",it,[_("div",dt,[s(L,{layout:"inline",model:o},{default:e(()=>[s(g,{label:"任务名称"},{default:e(()=>[s(A,{value:o.taskName,"onUpdate:value":t[0]||(t[0]=n=>o.taskName=n),placeholder:"请输入任务名称","allow-clear":""},null,8,["value"])]),_:1}),s(g,{label:"平台渠道"},{default:e(()=>[s(I,{value:o.channelId,"onUpdate:value":t[1]||(t[1]=n=>o.channelId=n),placeholder:"请选择平台渠道",style:{width:"120px"},"allow-clear":""},{default:e(()=>[(l(!0),r(m,null,V(T.value,n=>(l(),C(E,{key:n.id,value:n.id},{default:e(()=>[d(c(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(g,{label:"任务状态"},{default:e(()=>[s(I,{value:o.taskStatus,"onUpdate:value":t[2]||(t[2]=n=>o.taskStatus=n),placeholder:"请选择任务状态",allowClear:""},{default:e(()=>[(l(!0),r(m,null,V($.value,n=>(l(),C(E,{key:n.value,value:n.value},{default:e(()=>[d(c(n.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),s(g,null,{default:e(()=>[s(S,null,{default:e(()=>[s(h,{type:"primary",onClick:O},{default:e(()=>t[3]||(t[3]=[d("查询")])),_:1}),s(h,{onClick:F},{default:e(()=>t[4]||(t[4]=[d("重置")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",rt,[s(S,null,{default:e(()=>[s(h,{onClick:j},{icon:e(()=>[s(w(et))]),default:e(()=>[t[5]||(t[5]=d(" 导出 "))]),_:1}),s(h,{type:"primary",onClick:Q},{icon:e(()=>[s(w(at))]),default:e(()=>[t[6]||(t[6]=d(" 新建任务 "))]),_:1})]),_:1})])]),s(J,{columns:z,"data-source":D.value,loading:b.value,pagination:k,onChange:P},{bodyCell:e(({column:n,record:u})=>[n.key==="taskName"?(l(),C(S,{key:0},{default:e(()=>[s(G,{src:u.channelIcon},null,8,["src"]),d(" "+c(u.taskName),1)]),_:2},1024)):f("",!0),n.key==="taskTime"?(l(),r(m,{key:1},[d(c(u.startTime)+" - "+c(u.endTime),1)],64)):f("",!0),n.key==="taskQuota"?(l(),r(m,{key:2},[u.unlimitedQuota?(l(),r("span",ct,"不限制")):(l(),r("span",_t,c(u.quota),1)),_("span",null," / "+c(u.submittedCount),1)],64)):f("",!0),n.key==="taskStatus"?(l(),r(m,{key:3},[d(c(w(y).getEnumText("TaskStatus",u.taskStatus)),1)],64)):f("",!0),n.key==="action"?(l(),C(S,{key:4},{default:e(()=>[_("a",{onClick:K=>R(u)},"编辑",8,pt),s(H,{title:"确定要删除该任务吗？",onConfirm:K=>U(u)},{default:e(()=>t[7]||(t[7]=[_("a",{class:"danger"},"删除",-1)])),_:2},1032,["onConfirm"])]),_:2},1024)):f("",!0)]),_:1},8,["data-source","loading","pagination"])])])}}},vt=W(kt,[["__scopeId","data-v-d6b82fde"]]);export{vt as default};
