import{_ as F,r as s,v as G,x as H,a as j,l as J,b as f,c as o,d as K,w as r,e as u,m as N,j as c,f as Q,o as i,F as A,n as x,p as O,h as m,t as L,z as W,A as X}from"./index-CrZnNwoR.js";import{P as Y}from"./index-B4u0WGUb.js";import{d as ee}from"./enum-Ciewj-1_.js";const ae={class:"member-form content-container"},te={class:"form-container"},oe={__name:"detail",setup(re){const v=H(),b=Q(),P=s(),p=G(()=>!!v.params.id),n=j({memberNickname:"",memberAccount:"",password:"",occupation:void 0,groupId:void 0,inviterId:void 0}),_={memberNickname:[{required:!0,message:"请输入会员昵称"}],memberAccount:[{required:!0,message:"请输入账号"},{validator:(t,e)=>{const d=/^1[3-9]\d{9}$/,l=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!e||d.test(e)||l.test(e)?Promise.resolve():Promise.reject("请输入正确的手机号或邮箱格式")}}],groupId:[{required:!0,message:"请选择所属群"}]},g=s(!1),z=s([]),y=s(!1),C=s([]),S=(t,e)=>e.children.toLowerCase().indexOf(t.toLowerCase())>=0,R=async(t="")=>{g.value=!0;try{const e=await N("group.list",{page:1,pageSize:50,groupName:t});e.code===0&&(z.value=e.data.list||[])}finally{g.value=!1}},T=async()=>{y.value=!0;try{const t=await N("member.list",{page:1,pageSize:50});t.code===0&&(C.value=t.data.list||[])}finally{y.value=!1}},q=async()=>{if(p.value)try{const t=await N("member.detail",{},{urlParams:{id:v.params.id}});if(t.code===0){const e=t.data;Object.assign(n,{memberNickname:e.memberNickname,memberAccount:e.memberAccount,occupation:e.occupation,groupId:e.groupId,inviterId:e.inviterId})}}catch{c.error("加载会员信息失败"),b.back()}},B=async()=>{const t=await X("member.add",n);t.code===0?(c.success("提交成功"),b.back()):c.error(t.message)},E=async()=>{const t=await W("member.edit",n,{urlParams:{id:v.params.id}});t.code===0?(c.success("提交成功"),b.back()):c.error(t.message)},k=s(!1),M=()=>{P.value.validate().then(async()=>{try{k.value=!0,p.value?E():B()}catch{c.error("提交失败")}finally{k.value=!1}})},U=s([]),$=j({}),V=async()=>{const t=await ee();U.value=Object.values(t),Object.values(t).map(e=>{$[e.value]=e.text})};return J(()=>{V(),R(),T(),q()}),(t,e)=>{const d=u("a-input"),l=u("a-form-item"),w=u("a-select-option"),I=u("a-select"),h=u("a-button"),Z=u("a-space"),D=u("a-form");return i(),f("div",ae,[o(Y,{title:p.value?"编辑会员":"新增会员",back:!0},null,8,["title"]),K("div",te,[o(D,{ref_key:"formRef",ref:P,model:n,rules:_,"label-col":{span:4},"wrapper-col":{span:16}},{default:r(()=>[o(l,{label:"会员昵称",name:"memberNickname",rules:_.memberNickname},{default:r(()=>[o(d,{value:n.memberNickname,"onUpdate:value":e[0]||(e[0]=a=>n.memberNickname=a),placeholder:"请输入会员昵称"},null,8,["value"])]),_:1},8,["rules"]),o(l,{label:"密码",name:"password",rules:[{required:!p.value,message:"请输入密码"}]},{default:r(()=>[o(d,{value:n.password,"onUpdate:value":e[1]||(e[1]=a=>n.password=a),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["rules"]),o(l,{label:"账号",name:"memberAccount",rules:_.memberAccount},{default:r(()=>[o(d,{value:n.memberAccount,"onUpdate:value":e[2]||(e[2]=a=>n.memberAccount=a),placeholder:"请输入账号（手机号/邮箱）"},null,8,["value"])]),_:1},8,["rules"]),o(l,{label:"所属群",name:"groupId"},{default:r(()=>[o(I,{value:n.groupId,"onUpdate:value":e[3]||(e[3]=a=>n.groupId=a),placeholder:"请选择所属群",loading:g.value,"allow-clear":"","show-search":"","filter-option":!1,onSearch:R},{default:r(()=>[(i(!0),f(A,null,x(z.value,a=>(i(),O(w,{key:a.id,value:a.id},{default:r(()=>[m(L(a.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(l,{label:"邀请人",name:"inviterId"},{default:r(()=>[o(I,{value:n.inviterId,"onUpdate:value":e[4]||(e[4]=a=>n.inviterId=a),placeholder:"请选择邀请人",loading:y.value,"show-search":"","filter-option":S},{default:r(()=>[(i(!0),f(A,null,x(C.value,a=>(i(),O(w,{key:a.id,value:a.id},{default:r(()=>[m(L(a.memberNickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(l,{label:"职业",name:"occupation"},{default:r(()=>[o(I,{value:n.occupation,"onUpdate:value":e[5]||(e[5]=a=>n.occupation=a),placeholder:"请选择职业",style:{width:"200px"}},{default:r(()=>[(i(!0),f(A,null,x(U.value,a=>(i(),O(w,{key:a.value,value:a.value},{default:r(()=>[m(L(a.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(l,{"wrapper-col":{offset:4}},{default:r(()=>[o(Z,null,{default:r(()=>[o(h,{type:"primary",loading:k.value,onClick:M},{default:r(()=>e[7]||(e[7]=[m(" 提交 ")])),_:1},8,["loading"]),o(h,{onClick:e[6]||(e[6]=a=>t.$router.back())},{default:r(()=>e[8]||(e[8]=[m("取消")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},ue=F(oe,[["__scopeId","data-v-39f750c2"]]);export{ue as default};
