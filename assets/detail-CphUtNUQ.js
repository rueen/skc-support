import{_ as le,a as ne,b as oe,r as k,c as L,j as D,B as te,k as ie,p as O,o as u,w as s,e as C,f as a,g as n,d as P,n as ae,F as A,i as v,t as c,s as G,q as re,l as H,m as K,x as ue,y as se,h as me}from"./index-CKH_sz6v.js";import{P as pe}from"./PageHeader-CEWp_hJO.js";const ke={class:"select-task-modal"},fe={class:"filter-form"},ve={class:"selected-info"},_e={key:1},he={__name:"SelectTask",props:{visible:{type:Boolean,default:!1},selectedId:{type:Array,default:()=>[]}},emits:["update:visible","confirm","cancel"],setup(M,{emit:_}){const $=ne(),{t:w}=oe(),h=M,N=_,S=k(!1),E=k(!1),r=k([]),i=L({taskName:"",channelId:void 0,taskStatus:void 0}),I=k([]),J=D(()=>$.loaded?$.getEnumOptions("TaskStatus"):[]),T=D(()=>[{title:w("task.list.name"),key:"taskName",width:200},{title:w("task.list.status"),key:"taskStatus",width:100},{title:w("task.list.startTime"),dataIndex:"startTime",key:"startTime",sorter:!0},{title:w("task.list.endTime"),dataIndex:"endTime",key:"endTime",sorter:!0}]),z=k([]),g=L({current:1,pageSize:10,total:0}),F=L({sorterField:"startTime",sorterOrder:"ascend"}),Q=D(()=>({selectedRowKeys:r.value,onChange:(e,m)=>{W(e)},getCheckboxProps:e=>({disabled:!1})})),W=(e,m)=>{const f=z.value.map(y=>y.id),b=r.value.filter(y=>!f.includes(y));r.value=[...b,...e]},U=()=>{g.current=1,t()},X=()=>{i.taskName="",i.channelId=void 0,i.taskStatus=void 0,U()},Y=(e,m,f)=>{Object.assign(g,e),Object.assign(F,{sorterField:f.field,sorterOrder:f.order}),t()},Z=()=>{N("confirm",{taskIds:r.value}),j()},j=()=>{N("update:visible",!1),N("cancel")},t=async()=>{S.value=!0;try{const e=await H("task.list",{page:g.current,pageSize:g.pageSize,...F,...i});e.code===0?(z.value=e.data.list,g.total=e.data.total):K.error(e.message)}finally{S.value=!1}},l=async()=>{const e=await H("channel.list");e.code===0&&(I.value=e.data.list)},d=()=>{h.selectedId&&h.selectedId.length>0&&(r.value=[...h.selectedId])};return te(()=>h.visible,e=>{e?(t(),I.value.length||l(),d()):(r.value=[],g.current=1)}),te(()=>h.selectedId,()=>{h.visible&&d()},{deep:!0}),ie(()=>{h.visible&&(t(),l(),d())}),(e,m)=>{const f=n("a-input"),b=n("a-form-item"),y=n("a-select-option"),q=n("a-select"),V=n("a-button"),x=n("a-space"),p=n("a-form"),R=n("a-alert"),ee=n("a-avatar"),de=n("a-table"),ce=n("a-modal");return u(),O(ce,{open:M.visible,title:e.$t("task.selectTask.title"),width:900,"confirm-loading":E.value,onOk:Z,onCancel:j},{default:s(()=>[C("div",ke,[C("div",fe,[a(p,{layout:"inline",model:i},{default:s(()=>[a(b,{label:e.$t("task.search.taskName")},{default:s(()=>[a(f,{value:i.taskName,"onUpdate:value":m[0]||(m[0]=o=>i.taskName=o),placeholder:e.$t("common.inputPlaceholder"),"allow-clear":"",style:{width:"140px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(b,{label:e.$t("task.search.channelId")},{default:s(()=>[a(q,{value:i.channelId,"onUpdate:value":m[1]||(m[1]=o=>i.channelId=o),placeholder:e.$t("task.search.channelPlaceholder"),style:{width:"120px"},"allow-clear":""},{default:s(()=>[(u(!0),P(A,null,ae(I.value,o=>(u(),O(y,{key:o.id,value:o.id},{default:s(()=>[v(c(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(b,{label:e.$t("task.search.taskStatus")},{default:s(()=>[a(q,{value:i.taskStatus,"onUpdate:value":m[2]||(m[2]=o=>i.taskStatus=o),placeholder:e.$t("task.search.statusPlaceholder"),"allow-clear":"",style:{width:"120px"}},{default:s(()=>[(u(!0),P(A,null,ae(J.value,o=>(u(),O(y,{key:o.value,value:o.value},{default:s(()=>[v(c(o.text),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),a(b,null,{default:s(()=>[a(x,null,{default:s(()=>[a(V,{type:"primary",onClick:U},{default:s(()=>[v(c(e.$t("common.search")),1)]),_:1}),a(V,{onClick:X},{default:s(()=>[v(c(e.$t("common.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),C("div",ve,[a(R,{message:e.$t("task.selectTask.selectedCount",{count:r.value.length}),type:"info","show-icon":""},null,8,["message"])]),a(de,{columns:T.value,"data-source":z.value,loading:S.value,pagination:g,"row-selection":Q.value,rowKey:"id",onChange:Y,size:"middle"},{bodyCell:s(({column:o,record:B})=>[o.key==="taskName"?(u(),O(x,{key:0},{default:s(()=>[a(ee,{src:B.channelIcon,size:"small"},null,8,["src"]),C("span",null,c(B.taskName),1)]),_:2},1024)):G("",!0),o.key==="taskTime"?(u(),P("div",_e,c(B.startTime)+" - "+c(B.endTime),1)):G("",!0),o.key==="taskStatus"?(u(),P(A,{key:2},[v(c(re($).getEnumText("TaskStatus",B.taskStatus)),1)],64)):G("",!0)]),_:1},8,["columns","data-source","loading","pagination","row-selection"])])]),_:1},8,["open","title","confirm-loading"])}}},ge=le(he,[["__scopeId","data-v-e561a7df"]]),ye={class:"task-form content-container"},Te={class:"danger"},be={__name:"detail",setup(M){const{t:_}=oe(),$=ne(),w=ue(),h=me(),N=k(),S=D(()=>w.name==="TaskEdit"),E=k(!1),r=k([]),i=k([]),I=k(!1),J=D(()=>[{title:"index",key:"index",width:60,customRender:({index:t})=>t+1},{title:_("task.list.name"),key:"taskName"},{title:_("task.list.status"),dataIndex:"taskStatus",key:"taskStatus",customRender:({text:t})=>$.getEnumText("TaskStatus",t)},{title:_("task.list.startTime"),dataIndex:"startTime",key:"startTime"},{title:_("task.list.endTime"),dataIndex:"endTime",key:"endTime"},{title:_("task.list.action"),key:"action",fixed:"right",width:180}]),T=L({taskGroupName:"",taskGroupReward:0}),z={taskGroupName:[{required:!0,message:_("task.group.validation.taskGroupNameRequired")}],taskGroupReward:[{required:!0,message:_("task.group.validation.taskGroupRewardRequired")}]},g=()=>{E.value=!0},F=({taskIds:t})=>{r.value=t,Q()},Q=async()=>{try{I.value=!0;const t=await H("task.list",{page:1,pageSize:100,sorterField:"startTime",sorterOrder:"ascend",taskIds:r.value});t.code===0?i.value=t.data.list:K.error(t.message)}catch(t){K.error(t)}finally{I.value=!1}},W=t=>{i.value=i.value.filter(l=>l.id!==t.id),r.value=r.value.filter(l=>l!==t.id)},U=async()=>{},X=async()=>{};k(!1);const Y=()=>{N.value.validate().then(async()=>{S.value?await X():await U()})},Z=()=>{h.back()},j=async t=>{try{const l=await H("task.detail",{},{urlParams:{id:t}});if(l.code===0){let d={};for(let e in l.data)e!=="groups"&&(d[e]=l.data[e]);d.startTime&&(d.startTime=se(d.startTime)),d.endTime&&(d.endTime=se(d.endTime)),Object.assign(T,d)}}catch(l){console.log(l),K.error(l)}};return ie(()=>{S.value&&j(w.params.id)}),(t,l)=>{const d=n("a-input"),e=n("a-form-item"),m=n("a-input-number"),f=n("a-button"),b=n("a-avatar"),y=n("a-space"),q=n("a-popconfirm"),V=n("a-table"),x=n("a-form");return u(),P("div",ye,[a(pe,{title:S.value?t.$t("task.group.editTitle"):t.$t("task.group.createTitle"),back:!0,class:"page-header"},null,8,["title"]),C("div",null,[a(x,{ref_key:"formRef",ref:N,model:T,rules:z,"label-col":{span:3},"wrapper-col":{span:19},layout:"horizontal"},{default:s(()=>[a(e,{label:t.$t("task.group.name")},{default:s(()=>[a(d,{value:T.taskGroupName,"onUpdate:value":l[0]||(l[0]=p=>T.taskGroupName=p),placeholder:t.$t("common.inputPlaceholder"),style:{width:"300px"}},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e,{label:t.$t("task.group.reward")},{default:s(()=>[a(m,{value:T.taskGroupReward,"onUpdate:value":l[1]||(l[1]=p=>T.taskGroupReward=p),min:0,precision:2,step:.1,placeholder:t.$t("common.inputPlaceholder")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(e,{label:t.$t("task.group.relatedTask")},{default:s(()=>[C("div",null,[a(f,{type:"primary",onClick:g},{default:s(()=>[v(c(t.$t("task.group.selectTaskBtnText",{count:r.value.length})),1)]),_:1}),a(V,{columns:J.value,"data-source":i.value,loading:I.value,pagination:!1,style:{"margin-top":"10px"}},{bodyCell:s(({column:p,record:R})=>[p.key==="taskName"?(u(),O(y,{key:0},{default:s(()=>[a(b,{src:R.channelIcon},null,8,["src"]),v(" "+c(R.taskName),1)]),_:2},1024)):G("",!0),p.key==="taskStatus"?(u(),P(A,{key:1},[v(c(re($).getEnumText("TaskStatus",R.taskStatus)),1)],64)):G("",!0),p.key==="action"?(u(),O(q,{key:2,title:t.$t("common.deleteConfirm"),onConfirm:ee=>W(R)},{default:s(()=>[C("a",Te,c(t.$t("common.delete")),1)]),_:2},1032,["title","onConfirm"])):G("",!0)]),_:1},8,["columns","data-source","loading"])])]),_:1},8,["label"]),a(e,{"wrapper-col":{span:16,offset:3}},{default:s(()=>[a(y,null,{default:s(()=>[a(f,{type:"primary",onClick:Y},{default:s(()=>[v(c(t.$t("common.submit")),1)]),_:1}),a(f,{onClick:Z},{default:s(()=>[v(c(t.$t("common.cancel")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),a(ge,{visible:E.value,"onUpdate:visible":l[2]||(l[2]=p=>E.value=p),selectedId:r.value,onConfirm:F},null,8,["visible","selectedId"])])}}},Ie=le(be,[["__scopeId","data-v-301637ab"]]);export{Ie as default};
