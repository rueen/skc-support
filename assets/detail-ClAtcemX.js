import{_ as D,r as i,j as E,p as F,q as H,a as J,k as K,b as p,c as o,d as Q,w as r,e as l,i as c,f as W,o as u,F as I,l as O,m as N,h as d,t as A,g as X}from"./index-BaQ8rHrh.js";import{P as Y}from"./index-CLzwVYoX.js";import{O as ee,k as ae}from"./enums-Vx4wKXVy.js";import{g as x,a as te,p as oe}from"./request-DhfVuOuI.js";const re={class:"member-form content-container"},ne={class:"form-container"},se={__name:"detail",setup(le){const f=H(),v=W(),G=i(),{t:ue,locale:C}=E(),_=F(()=>!!f.params.id),n=J({memberNickname:"",memberAccount:"",occupation:void 0,groupId:void 0,isGroupOwner:!1,inviterId:void 0}),R={memberNickname:[{required:!0,message:"请输入会员名称"}],memberAccount:[{required:!0,message:"请输入账号"},{validator:(a,e)=>{const m=/^1[3-9]\d{9}$/,s=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/;return!e||m.test(e)||s.test(e)?Promise.resolve():Promise.reject("请输入正确的手机号或邮箱格式")}}],groupId:[{required:!0,message:"请选择所属群"}]},b=i(!1),L=i([]),g=i(!1),P=i([]),U=(a,e)=>e.children.toLowerCase().indexOf(a.toLowerCase())>=0,z=async()=>{b.value=!0;try{const a=await x("group.list",{page:1,pageSize:50,keyword:""});a.code===0&&(L.value=a.data.list||[])}finally{b.value=!1}},T=async()=>{g.value=!0;try{const a=await x("member.list",{page:1,pageSize:50});a.code===0&&(P.value=a.data.list||[])}finally{g.value=!1}},j=async()=>{if(_.value)try{const a=await x("member.detail",{},{urlParams:{id:f.params.id}});if(a.code===0){const e=a.data;Object.assign(n,{memberNickname:e.memberNickname,memberAccount:e.memberAccount,occupation:e.occupation,groupId:e.groupId,isGroupOwner:e.isGroupOwner,inviterId:e.inviterId})}}catch{c.error("加载会员信息失败"),v.back()}},q=async()=>{const a=await oe("member.add",n);a.code===0?(c.success("提交成功"),v.back()):c.error(a.message)},B=async()=>{const a=await te("member.edit",n,{urlParams:{id:f.params.id}});a.code===0?(c.success("提交成功"),v.back()):c.error(a.message)},k=i(!1),M=()=>{G.value.validate().then(async()=>{try{k.value=!0,_.value?B():q()}catch{c.error("提交失败")}finally{k.value=!1}})},S=a=>{var e;return((e=ae[a])==null?void 0:e[C.value])||a};return K(()=>{z(),T(),j()}),(a,e)=>{const m=l("a-input"),s=l("a-form-item"),w=l("a-select-option"),y=l("a-select"),$=l("a-switch"),h=l("a-button"),V=l("a-space"),Z=l("a-form");return u(),p("div",re,[o(Y,{title:_.value?"编辑会员":"新增会员",back:!0},null,8,["title"]),Q("div",ne,[o(Z,{ref_key:"formRef",ref:G,model:n,rules:R,"label-col":{span:4},"wrapper-col":{span:16}},{default:r(()=>[o(s,{label:"会员名称",name:"memberNickname"},{default:r(()=>[o(m,{value:n.memberNickname,"onUpdate:value":e[0]||(e[0]=t=>n.memberNickname=t),placeholder:"请输入会员名称"},null,8,["value"])]),_:1}),o(s,{label:"账号",name:"memberAccount"},{default:r(()=>[o(m,{value:n.memberAccount,"onUpdate:value":e[1]||(e[1]=t=>n.memberAccount=t),placeholder:"请输入账号（手机号/邮箱）"},null,8,["value"])]),_:1}),o(s,{label:"所属群",name:"groupId"},{default:r(()=>[o(y,{value:n.groupId,"onUpdate:value":e[2]||(e[2]=t=>n.groupId=t),placeholder:"请选择所属群",loading:b.value},{default:r(()=>[(u(!0),p(I,null,O(L.value,t=>(u(),N(w,{key:t.id,value:t.id},{default:r(()=>[d(A(t.groupName),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(s,{label:"邀请人",name:"inviterId"},{default:r(()=>[o(y,{value:n.inviterId,"onUpdate:value":e[3]||(e[3]=t=>n.inviterId=t),placeholder:"请选择邀请人",loading:g.value,"show-search":"","filter-option":U},{default:r(()=>[(u(!0),p(I,null,O(P.value,t=>(u(),N(w,{key:t.id,value:t.id},{default:r(()=>[d(A(t.memberNickname),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","loading"])]),_:1}),o(s,{label:"职业",name:"occupation"},{default:r(()=>[o(y,{value:n.occupation,"onUpdate:value":e[4]||(e[4]=t=>n.occupation=t),placeholder:"请选择职业",style:{width:"200px"}},{default:r(()=>[(u(!0),p(I,null,O(Object.values(X(ee)),t=>(u(),N(w,{key:t,value:t},{default:r(()=>[d(A(S(t)),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(s,{label:"群主标识",name:"isGroupOwner"},{default:r(()=>[o($,{checked:n.isGroupOwner,"onUpdate:checked":e[5]||(e[5]=t=>n.isGroupOwner=t)},null,8,["checked"])]),_:1}),o(s,{"wrapper-col":{offset:4}},{default:r(()=>[o(V,null,{default:r(()=>[o(h,{type:"primary",loading:k.value,onClick:M},{default:r(()=>e[7]||(e[7]=[d(" 提交 ")])),_:1},8,["loading"]),o(h,{onClick:e[6]||(e[6]=t=>a.$router.back())},{default:r(()=>e[8]||(e[8]=[d("取消")])),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])])}}},pe=D(se,[["__scopeId","data-v-d1d303c2"]]);export{pe as default};
